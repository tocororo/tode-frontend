!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.substance={})}(this,function(t){"use strict";const e={inBrowser:!1,inNodeJS:!1,inElectron:!1,isIE:!1,isFF:!1,isOpera:!1,isWebkit:!1,isChromium:!1,version:-1,isWindows:!1,isMac:!1,devtools:!1,_reset:r};function r(){if("undefined"!=typeof window){e.inBrowser=!0;const t=window.navigator.userAgent,r=window.navigator.vendor,n=t.indexOf("MSIE "),s=t.indexOf("Trident/"),i=t.indexOf("Edge/"),o=window.opr,a=window.chrome;n>0?(e.isIE=!0,e.version=10):s>0?(e.isIE=!0,e.version=11,e.isTrident=!0):i>0&&(e.isIE=!0,e.isEdge=!0,e.version=12,parseInt(t.substring(i+5,t.indexOf(".",i)),10)),e.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,e.isWebkit=!e.isFF&&!e.isIE,e.isOpera=void 0!==o,e.isChromium=!!a&&"Google Inc."===r&&!e.isOpera&&!e.isEdge}else e.inBrowser=!1;e.inBrowser&&(e.isWindows=void 0!==window.navigator&&window.navigator.appVersion&&-1!==window.navigator.appVersion.indexOf("Win"),e.isMac=void 0!==window.navigator&&window.navigator.platform.indexOf("Mac")>=0),"undefined"!=typeof process&&process.release&&"node"===process.release.name&&(e.inBrowser?e.inElectron=!0:e.inNodeJS=!0)}function n(t){return"string"==typeof t}function s(t){return"number"==typeof t}function i(t){return null===t||void 0===t}r();const o="undefined"!=typeof global?global:window,a=o.hasOwnProperty("Substance")?o.Substance:o.Substance={DEBUG_RENDERING:!1},l=new Map;function c(t){let e;return t=t||"",e=l.has(t)?l.get(t):0,e++,l.set(t,e),t?`${t}-${e}`:String(e)}function h(t,e){if(a.DETERMINISTIC_UUID)return c(t);t&&"-"!==t[t.length-1]&&(t=t.concat("-"));var r,n,s="0123456789abcdefghijklmnopqrstuvwxyz".split(""),i=[];if(e=e||32)for(r=0;r<e;r++)i[r]=s[0|16*Math.random()];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=s[19===r?3&n|8:n]);return(t||"")+i.join("")}function u(t){const e=typeof t;return Boolean(t)&&("object"===e||"function"===e)}function d(t){return"function"==typeof t}function p(t){return Array.isArray(t)}function f(t,e){t&&(t.constructor.prototype.forEach?t.forEach(e):Object.keys(t).forEach(function(r){return e(t[r],r)}))}class g{constructor(t){this.arr=t,this.pos=-1}get _isArrayIterator(){return!0}hasNext(){return this.pos<this.arr.length-1}next(){return this.pos+=1,this.arr[this.pos]}back(){return this.pos>=0&&(this.pos-=1),this}peek(){return this.arr[this.pos+1]}}function m(t,e){if(!d(e))return t.indexOf(e);for(let r=0;r<t.length;r++)if(e(t[r]))return r;return-1}class _{constructor(t,e,r){if(!n(t)||!d(e))throw new Error("Illegal arguments: 'eventName' must be a String, and 'handler' must be a Function.");var s=e,i=(r=r||{}).context,o=Boolean(r.capture);i&&(e=e.bind(i)),!0===r.once&&(e=function(t,e){return function(r){e(r),t._el.removeEventListener(t)}}(this,e)),this.eventName=t,this.originalHandler=s,this.handler=e,this.capture=o,this.context=i,this.options=r,this._el=null}get _isDOMEventListener(){return!0}static findIndex(t,e,r){return arguments[1]._isDOMEventListener?t.indexOf(arguments[1]):m(t,function(t,e){return t.eventName===e.eventName&&t.originalHandler===e.originalHandler}.bind(null,{eventName:e,originalHandler:r}))}}const y="This method is not implemented.";class w{getNativeElement(){throw new Error(y)}isTextNode(){return!1}isElementNode(){return!1}isCommentNode(){return!1}isDocumentNode(){return!1}getTagName(){throw new Error(y)}setTagName(t){throw new Error(y)}getId(){return this.getAttribute("id")}setId(t){return this.setAttribute("id",t),this}hasClass(t){throw new Error(y)}addClass(t){throw new Error(y)}removeClass(t){throw new Error(y)}hasAttribute(t){return Boolean(this.getAttribute(t))}attr(){if(1===arguments.length){if(n(arguments[0]))return this.getAttribute(arguments[0]);u(arguments[0])&&f(arguments[0],function(t,e){this.setAttribute(e,t)}.bind(this))}else 2===arguments.length&&this.setAttribute(arguments[0],arguments[1]);return this}removeAttr(t){var e=t.split(/\s+/);return 1===e.length?this.removeAttribute(t):e.forEach(function(t){this.removeAttribute(t)}.bind(this)),this}getAttribute(t){throw new Error(y)}setAttribute(t,e){throw new Error(y)}removeAttribute(t){throw new Error(y)}getAttributes(){throw new Error(y)}htmlProp(){if(1===arguments.length){if(n(arguments[0]))return this.getProperty(arguments[0]);u(arguments[0])&&f(arguments[0],function(t,e){this.setProperty(e,t)}.bind(this))}else 2===arguments.length&&this.setProperty(arguments[0],arguments[1]);return this}getProperty(t){throw new Error(y)}setProperty(t,e){throw new Error(y)}val(t){return 0===arguments.length?this.getValue():(this.setValue(t),this)}getValue(){return this.getProperty("value")}setValue(t){return this.setProperty("value",t),this}css(){if(1===arguments.length){if(n(arguments[0]))return this.getStyle(arguments[0]);if(!u(arguments[0]))throw new Error("Illegal arguments.");f(arguments[0],function(t,e){this.setStyle(e,t)}.bind(this))}else{if(2!==arguments.length)throw new Error("Illegal arguments.");this.setStyle(arguments[0],arguments[1])}return this}getStyle(t){throw new Error(y)}setStyle(t,e){throw new Error(y)}text(t){return 0===arguments.length?this.getTextContent():(this.setTextContent(t),this)}getTextContent(){throw new Error(y)}setTextContent(t){throw new Error(y)}html(t){return 0===arguments.length?this.getInnerHTML():(this.setInnerHTML(t),this)}getInnerHTML(){throw new Error(y)}getInnerXML(){return this.getInnerHTML()}setInnerHTML(t){throw new Error(y)}setInnerXML(t){return this.setInnerHTML(t)}getOuterHTML(){throw new Error(y)}getOuterXML(){return this.getOuterHTML()}on(t,e,r,s){if(!n(t))throw new Error('Illegal argument: "event" must be a String.');if(s=s||{},r&&(s.context=r),!e||!d(e))throw new Error("Illegal argument: invalid handler function for event "+t);return this.addEventListener(t,e,s),this}off(t,e){if(1!==arguments.length||n(t))this.removeEventListener(t,e);else{let t=arguments[0];this.getEventListeners().filter(function(e){return e.context===t}).forEach(function(t){this.removeEventListener(t)}.bind(this))}return this}addEventListener(t,e,r={}){let n;return n=1===arguments.length&&arguments[0]?arguments[0]:this._createEventListener(t,e,r),this.eventListeners||(this.eventListeners=[]),n._el=this,this.eventListeners.push(n),this._addEventListenerNative(n),this}_createEventListener(t,e,r){return new _(t,e,r)}_addEventListenerNative(t){}removeEventListener(t,e){if(!this.eventListeners)return;let r=null,n=_.findIndex(this.eventListeners,t,e);return r=this.eventListeners[n],n>-1&&(this.eventListeners.splice(n,1),r._el=null,this._removeEventListenerNative(r)),this}_removeEventListenerNative(t){}removeAllEventListeners(){if(this.eventListeners){for(let t=0;t<this.eventListeners.length;t++){let e=this.eventListeners[t];e._el=null,this._removeEventListenerNative(e)}delete this.eventListeners}}getEventListeners(){return this.eventListeners||[]}getNodeType(){throw new Error(y)}getContentType(){throw new Error(y)}getChildCount(){throw new Error(y)}getChildNodes(){throw new Error(y)}getChildren(){throw new Error(y)}getChildAt(t){throw new Error(y)}getChildIndex(t){throw new Error(y)}getChildNodeIterator(){return new g(this.getChildNodes())}getLastChild(){throw new Error(y)}getFirstChild(){throw new Error(y)}getNextSibling(){throw new Error(y)}getPreviousSibling(){throw new Error(y)}clone(t){throw new Error(y)}createElement(t){throw new Error(y)}createTextNode(t){throw new Error(y)}createComment(t){throw new Error(y)}createProcessingInstruction(t,e){throw new Error(y)}createCDATASection(t){throw new Error(y)}is(t){throw new Error(y)}getParent(){throw new Error(y)}getOwnerDocument(){throw new Error(y)}getDoctype(){throw new Error("NOT_IMPLEMENTED")}setDoctype(t,e,r){throw new Error("NOT_IMPLEMENTED")}find(t){throw new Error(y)}findAll(t){throw new Error(y)}append(t){if(1===arguments.length){if(!p(t)){let e=t;return this.appendChild(e)}t=t.slice()}else t=arguments;return t&&Array.prototype.forEach.call(t,this.appendChild.bind(this)),this}appendChild(t){throw new Error(y)}insertAt(t,e){throw new Error(y)}insertBefore(t,e){throw new Error(y)}removeAt(t){throw new Error(y)}removeChild(t){throw new Error(y)}replaceChild(t,e){throw new Error(y)}remove(){var t=this.getParent();t&&t.removeChild(this)}empty(){throw new Error(y)}serialize(){return this.getOuterHTML()}isInDocument(){let t=this;for(;t;){if(t.isDocumentNode())return!0;t=t.getParent()}}focus(){return this}select(){return this}blur(){return this}click(){return this}getWidth(){return 0}getHeight(){return 0}getOuterHeight(t){return 0}getOffset(){return{top:0,left:0}}getPosition(){return{top:0,left:0}}getElementFactory(){return this.createElement.bind(this)}emit(t,e){throw new Error(y)}get id(){return this.getId()}set id(t){this.setId(t)}get tagName(){return this.getTagName()}set tagName(t){this.setTagName(t)}get nodeName(){return this.getTagName()}get nodeType(){return this.getNodeType()}get className(){return this.getAttribute("class")}set className(t){this.setAttribute("class",t)}get textContent(){return this.getTextContent()}set textContent(t){this.setTextContent(t)}get innerHTML(){return this.getInnerHTML()}set innerHTML(t){this.setInnerHTML(t)}get outerHTML(){return this.getOuterHTML()}get firstChild(){return this.getFirstChild()}get lastChild(){return this.getLastChild()}get nextSibling(){return this.getNextSibling()}get previousSibling(){return this.getPreviousSibling()}get parentNode(){return this.getParent()}get height(){return this.getHeight()}get width(){return this.getWidth()}get value(){return this.getValue()}set value(t){return this.setValue(t)}get _isDOMElement(){return!0}static get pxStyles(){return b}static get EMPTY_HTML(){return v}}const b={top:!0,bottom:!0,left:!0,right:!0,height:!0,width:!0},v="<html><head></head><body></body></html>",S=h("_BrowserDOMElement");function E(t,e){if(!e._isBrowserDOMElement)throw new Error("Invalid argument");if(t.hasOwnProperty(S))throw new Error("Already attached");t[S]=e}function C(t){delete t[S]}function x(t){return t[S]}class N extends w{constructor(t){super(),console.assert(t instanceof window.Node,"Expecting native DOM node."),this.el=t,E(t,this)}getNativeElement(){return this.el}getNodeType(){switch(this.el.nodeType){case window.Node.TEXT_NODE:return"text";case window.Node.ELEMENT_NODE:return"element";case window.Node.DOCUMENT_NODE:return"document";case window.Node.COMMENT_NODE:return"comment";case window.Node.PROCESSING_INSTRUCTION_NODE:return"directive";case window.Node.CDATA_SECTION_NODE:return"cdata"}}getDoctype(){return this.isDocumentNode()?this.el.doctype:this.getOwnerDocument().getDoctype()}setDoctype(t,e,r){let n=this._getNativeOwnerDocument(),s=n.doctype,i=n.implementation.createDocumentType(t,e,r);s?s.parentNode.replaceChild(i,s):n.insertBefore(i,n.firstChild)}isTextNode(){return this.el.nodeType===window.Node.TEXT_NODE}isElementNode(){return this.el.nodeType===window.Node.ELEMENT_NODE}isCommentNode(){return this.el.nodeType===window.Node.COMMENT_NODE}isDocumentNode(){return this.el.nodeType===window.Node.DOCUMENT_NODE}hasClass(t){return this.el.classList.contains(t)}addClass(t){return this.el.classList.add(t),this}removeClass(t){return this.el.classList.remove(t),this}hasAttribute(t){return this.el.hasAttribute(t)}getAttribute(t){if(this.el.hasAttribute(t))return this.el.getAttribute(t)}setAttribute(t,e){return this.el.setAttribute(t,String(e)),this}removeAttribute(t){return this.el.removeAttribute(t),this}getAttributes(){return this.el.attributes._mapAdapter||(this.el.attributes._mapAdapter=new P(this.el.attributes)),this.el.attributes._mapAdapter}getProperty(t){return this.el[t]}setProperty(t,e){if(this._isXML())throw new Error("setProperty() is only supported for HTML elements.");return this.el[t]=e,this}getTagName(){return this._isXML()?this.el.tagName:this.el.tagName?this.el.tagName.toLowerCase():void 0}setTagName(t){let e,r=this.createElement(t),n=this.el.attributes,s=n.length;for(e=0;e<s;e++){let t=n.item(e);r.setAttribute(t.name,t.value)}return this.eventListeners&&this.eventListeners.forEach(function(t){r.addEventListener(t.eventName,t.handler,t.capture)}),r.append(this.getChildNodes()),this._replaceNativeEl(r.getNativeElement()),this}getId(){return this.el.id}setId(t){return this.el.id=t,this}getStyle(t){let e=this.el.style[t];if(!e){e=this.getComputedStyle()[t]}return e}getComputedStyle(){return window.getComputedStyle(this.el)}setStyle(t,e){return w.pxStyles[t]&&s(e)&&(e+="px"),this.el.style[t]=e,this}getTextContent(){return this.el.textContent}setTextContent(t){return this.el.textContent=t,this}getInnerHTML(){if(this._isXML()){let t=new window.XMLSerializer;return Array.prototype.map.call(this.el.childNodes,e=>t.serializeToString(e)).join("")}return this.el.innerHTML}setInnerHTML(t){return this.el.innerHTML=t,this}getOuterHTML(){if(this._isXML()){return(new window.XMLSerializer).serializeToString(this.el)}return this.el.outerHTML}_addEventListenerNative(t){this.el.addEventListener(t.eventName,t.handler,t.capture)}_removeEventListenerNative(t){this.el.removeEventListener(t.eventName,t.handler)}getEventListeners(){return this.eventListeners||[]}getChildCount(){return this.el.childNodes.length}getChildNodes(){let t=[];for(let e=this.el.firstChild;e;e=e.nextSibling)t.push(N.wrap(e));return t}getChildNodeIterator(){return new I(this.el)}get childNodes(){return this.getChildNodes()}getChildren(){let t=[];for(let e=this.el.firstChild;e;e=e.nextSibling)e.nodeType===window.Node.ELEMENT_NODE&&t.push(N.wrap(e));return t}get children(){return this.getChildren()}getChildAt(t){return N.wrap(this.el.childNodes[t])}getChildIndex(t){if(!t._isBrowserDOMElement)throw new Error("Expecting a BrowserDOMElement instance.");return Array.prototype.indexOf.call(this.el.childNodes,t.el)}getFirstChild(){let t=this.el.firstChild;return t?N.wrap(t):null}getLastChild(){var t=this.el.lastChild;return t?N.wrap(t):null}getNextSibling(){let t=this.el.nextSibling;return t?N.wrap(t):null}getPreviousSibling(){let t=this.el.previousSibling;return t?N.wrap(t):null}clone(t){let e=this.el.cloneNode(t);return N.wrap(e)}createDocument(t,e){return N.createDocument(t,e)}createElement(t){let e=this._getNativeOwnerDocument().createElement(t);return N.wrap(e)}createTextNode(t){let e=this._getNativeOwnerDocument().createTextNode(t);return N.wrap(e)}createComment(t){let e=this._getNativeOwnerDocument().createComment(t);return N.wrap(e)}createProcessingInstruction(t,e){let r=this._getNativeOwnerDocument().createProcessingInstruction(t,e);return N.wrap(r)}createCDATASection(t){let e=this._getNativeOwnerDocument().createCDATASection(t);return N.wrap(e)}is(t){let e=this.el;return!!this.isElementNode()&&function(t,e){let r=window.Element.prototype;return(r.matches||r.matchesSelector||r.msMatchesSelector||r.webkitMatchesSelector).call(t,e)}(e,t)}getParent(){let t=this.el.parentNode;return t?N.wrap(t):null}getOwnerDocument(){return N.wrap(this._getNativeOwnerDocument())}get ownerDocument(){return this.getOwnerDocument()}_getNativeOwnerDocument(){return this.isDocumentNode()?this.el:this.el.ownerDocument}find(t){let e=null;return this.el.querySelector&&(e=this.el.querySelector(t)),e?N.wrap(e):null}findAll(t){let e=[];return this.el.querySelectorAll&&(e=this.el.querySelectorAll(t)),Array.prototype.map.call(e,function(t){return N.wrap(t)})}_normalizeChild(t){if(i(t))return t;if(t instanceof window.Node?t=N.wrap(t):!t._isBrowserDOMElement||t instanceof N?(n(t)||s(t))&&(t=this.createTextNode(t)):t=N.wrap(t),!t||!t._isBrowserDOMElement)throw new Error("Illegal child type.");return console.assert(x(t.el)===t,"The backlink to the wrapper should be consistent"),t.getNativeElement()}appendChild(t){let e=this._normalizeChild(t);return e&&this.el.appendChild(e),this}insertAt(t,e){let r=this._normalizeChild(e),n=this.el.childNodes;return t>=n.length?this.el.appendChild(r):this.el.insertBefore(r,n[t]),this}insertBefore(t,e){if(i(e))return this.appendChild(t);if(!e._isBrowserDOMElement)throw new Error('insertBefore(): Illegal arguments. "before" must be a BrowserDOMElement instance.');var r=this._normalizeChild(t);return r&&this.el.insertBefore(r,e.el),this}removeAt(t){return this.el.removeChild(this.el.childNodes[t]),this}removeChild(t){if(!t||!t._isBrowserDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a BrowserDOMElement instance.");return this.el.removeChild(t.el),this}replaceChild(t,e){if(!(e&&t&&e._isBrowserDOMElement&&t._isBrowserDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");return this.el.replaceChild(e.el,t.el),this}empty(){let t=this.el;for(;t.lastChild;)t.removeChild(t.lastChild);return this}remove(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this}serialize(){let t=this.el.outerHTML;if(n(t))return t;return(new window.XMLSerializer).serializeToString(this.el)}isInDocument(){let t=this.el;for(;t;){if(t.nodeType===window.Node.DOCUMENT_NODE)return!0;t=t.parentNode}}_replaceNativeEl(t){console.assert(t instanceof window.Node,"Expecting a native element.");let e=this.el,r=e.parentNode;r&&r.replaceChild(t,e),this.el=t,C(e),C(t),E(t,this)}_getChildNodeCount(){return this.el.childNodes.length}focus(t){return this.el.focus(t),this}select(){return this.el.select(),this}blur(){return this.el.blur(),this}click(){return this.el.click(),!0}getWidth(){let t=this.el.getClientRects()[0];return t?t.width:0}getHeight(){let t=this.el.getClientRects()[0];return t?t.height:0}getOffset(){let t=this.el.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}}getPosition(){return{left:this.el.offsetLeft,top:this.el.offsetTop}}getOuterHeight(t){let e=this.el.offsetHeight;if(t){let t=this.getComputedStyle();e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10)}return e}getContentType(){return this._getNativeOwnerDocument().contentType}_isXML(){return"application/xml"===this.getContentType()}emit(t,e){let r;r=e?new window.CustomEvent(t,{detail:e,bubbles:!0,cancelable:!0}):new window.Event(t,{bubbles:!0,cancelable:!0}),this.el.dispatchEvent(r)}}N.prototype._isBrowserDOMElement=!0,N.createDocument=function(t,e={}){let r;if("xml"===t){let t,n=[];e.version&&n.push(`version="${e.version}"`),e.encoding&&n.push(`encoding="${e.encoding}"`),t=n.length>0?`<?xml ${n.join(" ")}?><dummy/>`:"<dummy/>",(r=(new window.DOMParser).parseFromString(t,"application/xml")).removeChild(r.firstChild)}else r=(new window.DOMParser).parseFromString(w.EMPTY_HTML,"text/html");return N.wrap(r)},N.parseMarkup=function(t,e,r={}){if(!t)return N.createDocument(e);let n;r.snippet&&(t=`<div id='__snippet__'>${t}</div>`);let s=new window.DOMParser;if("html"===e?n=N.wrap(i(s.parseFromString(t,"text/html"))):"xml"===e&&(n=N.wrap(i(s.parseFromString(t,"application/xml")))),r.snippet){let t=n.find("#__snippet__").childNodes;return 1===t.length?t[0]:t}return n;function i(t){if(t){let e=t.querySelector("parsererror");if(e)throw new Error("ParserError: "+N.wrap(e).outerHTML)}return t}},N.wrap=N.wrapNativeElement=function(t){if(!t)return null;{let e=x(t);if(e)return e;if(t instanceof window.Node)return new N(t);if(t._isBrowserDOMElement)return t;if(t===window)return N.getBrowserWindow()}},N.unwrap=function(t){return x(t)};class T{constructor(){this.el=window,E(window,this)}get _isBrowserDOMElement(){return!0}}T.prototype.getNativeElement=N.prototype.getNativeElement,T.prototype.on=N.prototype.on,T.prototype.off=N.prototype.off,T.prototype.addEventListener=N.prototype.addEventListener,T.prototype.removeEventListener=N.prototype.removeEventListener,T.prototype._createEventListener=N.prototype._createEventListener,T.prototype._addEventListenerNative=N.prototype._addEventListenerNative,T.prototype._removeEventListenerNative=N.prototype._removeEventListenerNative,T.prototype.getEventListeners=N.prototype.getEventListeners,N.getBrowserWindow=function(){return window[S]?window[S]:new T(window)},N.isReverse=function(t,e,r,n){if(r&&t){N.isReverse._r1||(N.isReverse._r1=window.document.createRange(),N.isReverse._r2=window.document.createRange());const s=N.isReverse._r1,i=N.isReverse._r2;if(s.setStart(t.getNativeElement(),e),i.setStart(r.getNativeElement(),n),1===s.compareBoundaryPoints(window.Range.START_TO_START,i))return!0}return!1},N.getWindowSelection=function(){let t=window.getSelection();return{anchorNode:N.wrap(t.anchorNode),anchorOffset:t.anchorOffset,focusNode:N.wrap(t.focusNode),focusOffset:t.focusOffset}};class P{constructor(t){this.attributes=t}get size(){return this.attributes.length}get(t){let e=this.attributes.getNamedItem(t);if(e)return e.value}set(t,e){this.attributes.setNamedItem(t,e)}forEach(t){const e=this.size;for(let r=0;r<e;r++){const e=this.attributes.item(r);t(e.value,e.name)}}map(t){let e=[];return this.forEach((r,n)=>{e.push(t(r,n))}),e}keys(){return this.map((t,e)=>e)}values(){return this.map(t=>t)}entries(){return this.map((t,e)=>[e,t])}}class I{constructor(t){this._next=t.firstChild,this._curr=null}hasNext(){return Boolean(this._next)}next(){let t=this._next;return this._curr=t,this._next=t.nextSibling,N.wrap(t)}back(){this._next=this._curr,this._curr=this._curr.previousSibling}peek(){return N.wrap(this._curr)}}function O(t){return t[t.length-1]}var A=e.inBrowser,D={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(t){return"tag"===t.type||"script"===t.type||"style"===t.type}},L=function(){return!0},k=function(){return!1},M=function(t){if("even"===(t=t.trim().toLowerCase()))return[2,0];if("odd"===t)return[2,1];var e,r=t.match(R);if(!r)throw new SyntaxError("n-th rule couldn't be parsed ('"+t+"')");return r[1]?(e=parseInt(r[1],10),isNaN(e)&&(e="-"===r[1].charAt(0)?-1:1)):e=0,[e,r[3]?parseInt((r[2]||"")+r[3],10):0]},R=/^([+\-]?\d*n)?\s*(?:([+\-]?)\s*(\d+))?$/;var q=function(t){var e=t[0],r=t[1]-1;if(r<0&&e<=0)return j;if(-1===e)return function(t){return t<=r};if(0===e)return function(t){return t===r};if(1===e)return r<0?B:function(t){return t>=r};var n=r%e;n<0&&(n+=e);if(e>1)return function(t){return t>=r&&t%e===n};return e*=-1,function(t){return t<=r&&t%e===n}},B=L,j=k;var F=function(t){return q(M(t))},U=M,H=q;F.parse=U,F.compile=H;var V=function(t,e){var r=[];if(""!==(t=function t(e,r,n){var s,i,o,a,l=[],c=!1;function h(){var t=r.match(z)[0];return r=r.substr(t.length),tt(t)}function u(t){for(;et(r.charAt(t));)t++;r=r.substr(t)}for(u(0);""!==r;)if(et(i=r.charAt(0)))c=!0,u(1);else if(i in K)l.push({type:K[i]}),c=!1,u(1);else if(","===i){if(0===l.length)throw new SyntaxError("empty sub-selector");e.push(l),l=[],c=!1,u(1)}else if(c&&(l.length>0&&l.push({type:"descendant"}),c=!1),"*"===i)r=r.substr(1),l.push({type:"universal"});else if(i in W)r=r.substr(1),l.push({type:"attribute",name:W[i][0],action:W[i][1],value:h(),ignoreCase:!1});else if("["===i){if(r=r.substr(1),!(s=r.match($)))throw new SyntaxError("Malformed attribute selector: "+r);r=r.substr(s[0].length),o=tt(s[1]),n&&("lowerCaseAttributeNames"in n?!n.lowerCaseAttributeNames:n.xmlMode)||(o=o.toLowerCase()),l.push({type:"attribute",name:o,action:J[s[2]],value:tt(s[4]||s[5]||""),ignoreCase:!!s[6]})}else if(":"===i){if(":"===r.charAt(1)){r=r.substr(2),l.push({type:"pseudo-element",name:h().toLowerCase()});continue}if(r=r.substr(1),o=h().toLowerCase(),s=null,"("===r.charAt(0))if(o in X){var d=(a=r.charAt(1))in Z;if(r=r.substr(d+1),r=t(s=[],r,n),d){if(r.charAt(0)!==a)throw new SyntaxError("unmatched quotes in :"+o);r=r.substr(1)}if(")"!==r.charAt(0))throw new SyntaxError("missing closing parenthesis in :"+o+" "+r);r=r.substr(1)}else{for(var p=1,f=1;f>0&&p<r.length;p++)"("===r.charAt(p)?f++:")"===r.charAt(p)&&f--;if(f)throw new SyntaxError("parenthesis not matched");s=r.substr(1,p-2),r=r.substr(p),o in Y&&((a=s.charAt(0))===s.slice(-1)&&a in Z&&(s=s.slice(1,-1)),s=tt(s))}l.push({type:"pseudo",name:o,data:s})}else{if(!z.test(r))return l.length&&"descendant"===l[l.length-1].type&&l.pop(),rt(e,l),r;o=h(),n&&("lowerCaseTags"in n?!n.lowerCaseTags:n.xmlMode)||(o=o.toLowerCase()),l.push({type:"tag",name:o})}return rt(e,l),r}(r,t+"",e)))throw new SyntaxError("Unmatched selector: "+t);return r},z=/^(?:\\.|[\w\-\u00c0-\uFFFF])+/,G=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,$=/^\s*((?:\\.|[\w\u00c0-\uFFFF\-])+)\s*(?:(\S?)=\s*(?:(['"])(.*?)\3|(#?(?:\\.|[\w\u00c0-\uFFFF\-])*)|)|)\s*(i)?\]/,J={__proto__:null,undefined:"exists","":"equals","~":"element","^":"start",$:"end","*":"any","!":"not","|":"hyphen"},K={__proto__:null,">":"child","<":"parent","~":"sibling","+":"adjacent"},W={__proto__:null,"#":["id","equals"],".":["class","element"]},X={__proto__:null,has:!0,not:!0,matches:!0},Y={__proto__:null,contains:!0,icontains:!0},Z={__proto__:null,'"':!0,"'":!0};function Q(t,e,r){var n="0x"+e-65536;return n!=n||r?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)}function tt(t){return t.replace(G,Q)}function et(t){return" "===t||"\n"===t||"\t"===t||"\f"===t||"\r"===t}function rt(t,e){if(t.length>0&&0===e.length)throw new SyntaxError("empty sub-selector");t.push(e)}const nt=(t=>{let e=it({amp:"&",gt:">",lt:"<"});return ut(e,ot(e))})(),st=(t=>{let e=it({quot:'"'});return ut(e,ot(e))})();function it(t){return Object.keys(t).sort().reduce(function(e,r){return e[t[r]]="&"+r+";",e},{})}function ot(t){let e=[],r=[];return Object.keys(t).forEach(function(t){1===t.length?e.push("\\"+t):r.push(t)}),r.unshift("["+e.join("")+"]"),new RegExp(r.join("|"),"g")}const at=/[^\0-\x7F]/g,lt=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function ct(t){return"&#x"+t.charCodeAt(0).toString(16).toUpperCase()+";"}function ht(t){return"&#x"+(1024*(t.charCodeAt(0)-55296)+t.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function ut(t,e){function r(e){return t[e]}return function(t){return t.replace(e,r).replace(lt,ht).replace(at,ct)}}const dt={__proto__:null,allowfullscreen:!0,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,default:!0,defer:!0,disabled:!0,hidden:!0,ismap:!0,loop:!0,multiple:!0,muted:!0,open:!0,readonly:!0,required:!0,reversed:!0,scoped:!0,seamless:!0,selected:!0,typemustmatch:!0},pt={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0},ft={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};class gt{isTag(t){return D.isTag(t)}removeElement(t){if(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.parent){var e=t.parent.childNodes;let r=e.lastIndexOf(t);if(r<0)throw new Error("Invalid state");e.splice(r,1),t.parent=null}}replaceElement(t,e){e.parent&&this.removeElement(e);var r=e.prev=t.prev;r&&(r.next=e);var n=e.next=t.next;n&&(n.prev=e);var s=e.parent=t.parent;if(s){var i=s.childNodes;let r=i.lastIndexOf(t);if(r<0)throw new Error("Invalid state");i[r]=e}}appendChild(t,e){if(e.parent&&this.removeElement(e),e.parent=t,1!==t.childNodes.push(e)){var r=t.childNodes[t.childNodes.length-2];r.next=e,e.prev=r,e.next=null}}append(t,e){e.parent&&this.removeElement(e);let r=t.parent,n=t.next;if(e.next=n,e.prev=t,t.next=e,e.parent=r,n){if(n.prev=e,r){var s=r.childNodes;let t=s.lastIndexOf(n);if(t<0)throw new Error("Invalid state");s.splice(t,0,e)}}else r&&r.childNodes.push(e)}prepend(t,e){e.parent&&this.removeElement(e);var r=t.parent;if(r){var n=r.childNodes;let s=n.lastIndexOf(t);if(s<0)throw new Error("Invalid state");n.splice(s,0,e)}t.prev&&(t.prev.next=e),e.parent=r,e.prev=t.prev,e.next=t,t.prev=e}filter(t,e,r,n){return Array.isArray(e)||(e=[e]),"number"==typeof n&&isFinite(n)||(n=1/0),this.find(t,e,!1!==r,n)}find(t,e,r,n){let s,i=[];for(var o=0,a=e.length;o<a&&!(t(e[o])&&(i.push(e[o]),--n<=0))&&(s=this.getChildren(e[o]),!(r&&s&&s.length>0&&(s=this.find(t,s,r,n),i=i.concat(s),(n-=s.length)<=0)));o++);return i}findOneChild(t,e){for(var r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r];return null}findOne(t,e){for(var r=null,n=0,s=e.length;n<s&&!r;n++){const s=e[n];if(this.isTag(s))if(t(s))r=s;else{const e=this.getChildren(s);e.length>0&&(r=this.findOne(t,e))}}return r}existsOne(t,e){for(var r=0,n=e.length;r<n;r++){const n=e[r];if(!this.isTag(n))continue;if(t(n))return!0;const s=this.getChildren(n);if(s.length>0&&this.existsOne(t,s))return!0}return!1}findAll(t,e){for(var r=[],n=0,s=e.length;n<s;n++){const s=e[n];if(!this.isTag(s))continue;t(s)&&r.push(s);const i=this.getChildren(s);i.length>0&&(r=r.concat(this.findAll(t,i)))}return r}getAttributes(t){let e=t.getAttributes();if(e instanceof Map)return Array.from(e);if(e&&e.forEach){let t=[];return e.forEach((e,r)=>{t.push([r,e])}),t}return[]}formatAttribs(t,e={}){let r=[];return this.getAttributes(t).forEach(([t,n])=>{e.disallowHandlers&&/^\s*on/.exec(t)||e.disallowHandlers&&/^javascript[:]/.exec(n)||e.disallowedAttributes&&e.disallowedAttributes.has(t)||(!n&&dt[t]?r.push(t):r.push(t+'="'+(e.decodeEntities?st(n):n)+'"'))}),r.join(" ")}render(t,e){Array.isArray(t)||(t=[t]),e=e||{};let r=[];for(var n=0;n<t.length;n++){let s=t[n];switch(s.type){case"root":case"document":s._xmlInstruction&&r.push(this.render(s._xmlInstruction,e)),r.push(this.render(this.getChildren(s),e));break;case D.Tag:case D.Script:case D.Style:r.push(this.renderTag(s,e));break;case D.CDATA:e.stripCDATA||r.push(this.renderCdata(s));break;case D.Comment:e.stripComments||r.push(this.renderComment(s));break;case D.Directive:r.push(this.renderDirective(s));break;case D.Doctype:r.push(this.renderDoctype(s));break;case D.Text:r.push(this.renderText(s,e));break;default:throw new Error("Not implement yet: render of element type "+s.type)}}return r.join("")}renderTag(t,e){const r=this.getName(t);if(e.allowedTags&&!e.allowedTags.has(this.getNameWithoutNS(t)))return;if(e.disallowedTags&&e.disallowedTags.has(this.getNameWithoutNS(t)))return;"svg"===r&&(e=Object.assign({},e,{decodeEntities:e.decodeEntities,xmlMode:!0}));let n="<"+r,s=this.formatAttribs(t,e);s&&(n+=" "+s);const i=this.getChildren(t);return e.xmlMode&&0===i.length?n+="/>":(n+=">",i.length>0&&(n+=this.render(i,e)),ft[r]&&!e.xmlMode||(n+="</"+r+">")),n}renderDirective(t){return"<?"+this.getName(t)+" "+this.getData(t)+"?>"}renderDoctype(t){const{name:e,publicId:r,systemId:n}=this.getData(t);let s=["DOCTYPE",e];return r&&(s.push("PUBLIC"),s.push('"'+r+'"'),n&&s.push('"'+n+'"')),"<!"+s.join(" ")+">"}renderText(t,e){let r=this.getText(t);if(e.decodeEntities){const e=this.getParent(t);e&&this.getName(e)in pt||(r=nt(r))}return r}renderCdata(t){return"<![CDATA["+this.getData(t)+"]]>"}renderComment(t){return"\x3c!--"+this.getData(t)+"--\x3e"}getInnerHTML(t,e){return this.getChildren(t).map(t=>this.render(t,e)).join("")}getOuterHTML(t,e){return this.render(t,e)}getData(t){return t.data}getText(t,e){if(Array.isArray(t))return t.map(t=>this.getText(t,e)).join("");switch(t.type){case D.Tag:case D.Script:case D.Style:return this.getText(this.getChildren(t),!0);case D.Text:case D.CDATA:return t.data;case D.Comment:return e?"":t.data;default:return""}}getChildren(t){return t.childNodes}getParent(t){return t.parent}getSiblings(t){var e=this.getParent(t);return e?this.getChildren(e):[t]}getAttributeValue(t,e){return t.getAttribute(e)}hasAttrib(t,e){return t.hasAttribute(e)}getName(t){return t.name}getNameWithoutNS(t){return t.nameWithoutNS}}const mt=new gt;mt.DomUtils=gt;var _t={universal:50,tag:30,attribute:1,pseudo:0,descendant:-1,child:-1,parent:-1,sibling:-1,adjacent:-1},yt=Object.freeze({universal:50,tag:30,attribute:1,pseudo:0,descendant:-1,child:-1,parent:-1,sibling:-1,adjacent:-1,default:_t}),wt=yt&&_t||yt,bt=function(t){for(var e=t.map(St),r=1;r<t.length;r++){var n=e[r];if(!(n<0))for(var s=r-1;s>=0&&n<e[s];s--){var i=t[s+1];t[s+1]=t[s],t[s]=i,e[s+1]=e[s],e[s]=n}}},vt={__proto__:null,exists:10,equals:8,not:7,start:6,end:6,any:5,hyphen:4,element:4};function St(t){var e=wt[t.type];if(e===wt.attribute)(e=vt[t.action])===vt.equals&&"id"===t.name&&(e=9),t.ignoreCase&&(e>>=1);else if(e===wt.pseudo)if(t.data)if("has"===t.name||"contains"===t.name)e=0;else if("matches"===t.name||"not"===t.name){e=0;for(var r=0;r<t.data.length;r++)if(1===t.data[r].length){var n=St(t.data[r][0]);if(0===n){e=0;break}n>e&&(e=n)}t.data.length>1&&e>0&&(e-=1)}else e=1;else e=3;return e}var Et=k,Ct=/[-[\]{}()*+?.,\\^$|#\s]/g;var xt=function(t){var e={__proto__:null,equals:function(e,r){var n=r.name,s=r.value;return r.ignoreCase?(s=s.toLowerCase(),function(r){var i=t.getAttributeValue(r,n);return null!=i&&i.toLowerCase()===s&&e(r)}):function(r){return t.getAttributeValue(r,n)===s&&e(r)}},hyphen:function(e,r){var n=r.name,s=r.value,i=s.length;return r.ignoreCase?(s=s.toLowerCase(),function(r){var o=t.getAttributeValue(r,n);return null!=o&&(o.length===i||"-"===o.charAt(i))&&o.substr(0,i).toLowerCase()===s&&e(r)}):function(r){var o=t.getAttributeValue(r,n);return null!=o&&o.substr(0,i)===s&&(o.length===i||"-"===o.charAt(i))&&e(r)}},element:function(e,r){var n=r.name,s=r.value;if("class"===r.name){let t=r.value;return/\s/.test(t)?function(){return!1}:function(r){let n=r.classes;return n&&n.has(t)&&e(r)}}if(/\s/.test(s))return Et;var i="(?:^|\\s)"+(s=s.replace(Ct,"\\$&"))+"(?:$|\\s)",o=r.ignoreCase?"i":"",a=new RegExp(i,o);return function(r){var s=t.getAttributeValue(r,n);return null!=s&&a.test(s)&&e(r)}},exists:function(e,r){var n=r.name;return function(r){return t.hasAttrib(r,n)&&e(r)}},start:function(e,r){var n=r.name,s=r.value,i=s.length;return 0===i?Et:r.ignoreCase?(s=s.toLowerCase(),function(r){var o=t.getAttributeValue(r,n);return null!=o&&o.substr(0,i).toLowerCase()===s&&e(r)}):function(r){var o=t.getAttributeValue(r,n);return null!=o&&o.substr(0,i)===s&&e(r)}},end:function(e,r){var n=r.name,s=r.value,i=-s.length;return 0===i?Et:r.ignoreCase?(s=s.toLowerCase(),function(r){var o=t.getAttributeValue(r,n);return null!=o&&o.substr(i).toLowerCase()===s&&e(r)}):function(r){var o=t.getAttributeValue(r,n);return null!=o&&o.substr(i)===s&&e(r)}},any:function(e,r){var n=r.name,s=r.value;if(""===s)return Et;if(r.ignoreCase){var i=new RegExp(s.replace(Ct,"\\$&"),"i");return function(r){var s=t.getAttributeValue(r,n);return null!=s&&i.test(s)&&e(r)}}return function(r){var i=t.getAttributeValue(r,n);return null!=i&&i.indexOf(s)>=0&&e(r)}},not:function(e,r){var n=r.name,s=r.value;return""===s?function(r){return!!t.getAttributeValue(r,n)&&e(r)}:r.ignoreCase?(s=s.toLowerCase(),function(r){var i=t.getAttributeValue(r,n);return null!=i&&i.toLowerCase()!==s&&e(r)}):function(r){return t.getAttributeValue(r,n)!==s&&e(r)}}};return{compile:function(t,r,n){if(n&&n.strict&&(r.ignoreCase||"not"===r.action))throw new Error("Unsupported attribute selector");return e[r.action](t,r)},rules:e}};var Nt=function(t,e){return{__proto__:null,attribute:xt(t).compile,pseudo:e.compile,tag:function(e,r){var n=r.name;return function(r){return t.getNameWithoutNS(r)===n&&e(r)}},descendant:function(e){return function(r){for(var n=!1;!n&&(r=t.getParent(r));)n=e(r);return n}},_flexibleDescendant:function(e){return function(r){for(var n=e(r);!n&&(r=t.getParent(r));)n=e(r);return n}},parent:function(e,r,n){if(n&&n.strict)throw new Error("Parent selector isn't part of CSS3");return function(e){return t.getChildren(e).some(s)};function s(r){return t.isTag(r)&&e(r)}},child:function(e){return function(r){var n=t.getParent(r);return!!n&&e(n)}},sibling:function(e){return function(r){for(var n=t.getSiblings(r),s=0;s<n.length;s++)if(t.isTag(n[s])){if(n[s]===r)break;if(e(n[s]))return!0}return!1}},adjacent:function(e){return function(r){for(var n,s=t.getSiblings(r),i=0;i<s.length;i++)if(t.isTag(s[i])){if(s[i]===r)break;n=s[i]}return!!n&&e(n)}},universal:function(t){return t}}},Tt=L,Pt=k;function It(t){var e=xt(t).rules.equals;function r(t,r){var n={name:t,value:r};return function(t){return e(t,n)}}function n(e){return function(r){return!!t.getParent(r)&&e(r)}}var s={contains:function(e,r){return function(n){return e(n)&&t.getText(n).indexOf(r)>=0}},icontains:function(e,r){var n=r.toLowerCase();return function(r){return e(r)&&t.getText(r).toLowerCase().indexOf(n)>=0}},"nth-child":function(e,r){var s=F(r);return s===Pt?s:s===Tt?n(e):function(r){for(var n=t.getSiblings(r),i=0,o=0;i<n.length;i++)if(t.isTag(n[i])){if(n[i]===r)break;o++}return s(o)&&e(r)}},"nth-last-child":function(e,r){var s=F(r);return s===Pt?s:s===Tt?n(e):function(r){for(var n=t.getSiblings(r),i=0,o=n.length-1;o>=0;o--)if(t.isTag(n[o])){if(n[o]===r)break;i++}return s(i)&&e(r)}},"nth-of-type":function(e,r){var s=F(r);return s===Pt?s:s===Tt?n(e):function(r){for(var n=t.getSiblings(r),i=0,o=0;o<n.length;o++)if(t.isTag(n[o])){if(n[o]===r)break;t.getName(n[o])===t.getName(r)&&i++}return s(i)&&e(r)}},"nth-last-of-type":function(e,r){var s=F(r);return s===Pt?s:s===Tt?n(e):function(r){for(var n=t.getSiblings(r),i=0,o=n.length-1;o>=0;o--)if(t.isTag(n[o])){if(n[o]===r)break;t.getName(n[o])===t.getName(r)&&i++}return s(i)&&e(r)}},root:function(e){return function(r){return!t.getParent(r)&&e(r)}},scope:function(e,r,n,i){return i&&0!==i.length?1===i.length?function(r){return n=i[0],s=r,("function"==typeof t.equals?t.equals(n,s):n===s)&&e(r);var n,s}:function(t){return i.indexOf(t)>=0&&e(t)}:s.root(e)},checkbox:r("type","checkbox"),file:r("type","file"),password:r("type","password"),radio:r("type","radio"),reset:r("type","reset"),image:r("type","image"),submit:r("type","submit")};return s}function Ot(t){var e={empty:function(e){return!t.getChildren(e).some(function(e){return t.isTag(e)||"text"===e.type})},"first-child":function(e){return function(e){for(var r=0;e&&r<e.length;r++)if(t.isTag(e[r]))return e[r]}(t.getSiblings(e))===e},"last-child":function(e){for(var r=t.getSiblings(e),n=r.length-1;n>=0;n--){if(r[n]===e)return!0;if(t.isTag(r[n]))break}return!1},"first-of-type":function(e){for(var r=t.getSiblings(e),n=0;n<r.length;n++)if(t.isTag(r[n])){if(r[n]===e)return!0;if(t.getName(r[n])===t.getName(e))break}return!1},"last-of-type":function(e){for(var r=t.getSiblings(e),n=r.length-1;n>=0;n--)if(t.isTag(r[n])){if(r[n]===e)return!0;if(t.getName(r[n])===t.getName(e))break}return!1},"only-of-type":function(e){for(var r=t.getSiblings(e),n=0,s=r.length;n<s;n++)if(t.isTag(r[n])){if(r[n]===e)continue;if(t.getName(r[n])===t.getName(e))return!1}return!0},"only-child":function(e){for(var r=t.getSiblings(e),n=0;n<r.length;n++)if(t.isTag(r[n])&&r[n]!==e)return!1;return!0},link:function(e){return t.hasAttrib(e,"href")},visited:Pt,selected:function(e){if(t.hasAttrib(e,"selected"))return!0;if("option"!==t.getName(e))return!1;var r=t.getParent(e);if(!r||"select"!==t.getName(r)||t.hasAttrib(r,"multiple"))return!1;for(var n=t.getChildren(r),s=!1,i=0;i<n.length;i++)if(t.isTag(n[i]))if(n[i]===e)s=!0;else{if(!s)return!1;if(t.hasAttrib(n[i],"selected"))return!1}return s},disabled:function(e){return t.hasAttrib(e,"disabled")},enabled:function(e){return!t.hasAttrib(e,"disabled")},checked:function(r){return t.hasAttrib(r,"checked")||e.selected(r)},required:function(e){return t.hasAttrib(e,"required")},optional:function(e){return!t.hasAttrib(e,"required")},parent:function(t){return!e.empty(t)},header:function(e){var r=t.getName(e);return"h1"===r||"h2"===r||"h3"===r||"h4"===r||"h5"===r||"h6"===r},button:function(e){var r=t.getName(e);return"button"===r||"input"===r&&"button"===t.getAttributeValue(e,"type")},input:function(e){var r=t.getName(e);return"input"===r||"textarea"===r||"select"===r||"button"===r},text:function(e){var r;return"input"===t.getName(e)&&(!(r=t.getAttributeValue(e,"type"))||"text"===r.toLowerCase())}};return e}function At(t,e,r){if(null===r){if(t.length>1&&"scope"!==e)throw new Error("pseudo-selector :"+e+" requires an argument")}else if(1===t.length)throw new Error("pseudo-selector :"+e+" doesn't have any arguments")}var Dt=/^(?:(?:nth|last|first|only)-(?:child|of-type)|root|empty|(?:en|dis)abled|checked|not)$/;var Lt=function(t){var e=Ot(t),r=It(t);return{compile:function(t,n,s,i){var o=n.name,a=n.data;if(s&&s.strict&&!Dt.test(o))throw new Error(":"+o+" isn't part of CSS3");if("function"==typeof r[o])return At(r[o],o,a),r[o](t,a,s,i);if("function"==typeof e[o]){var l=e[o];return At(l,o,a),t===Tt?l:function(e){return l(e,a)&&t(e)}}throw new Error("unmatched pseudo-class :"+o)},filters:r,pseudos:e}},kt=function(t){var e=Lt(t),r=e.filters,n=Nt(t,e);function s(t,e,r){var n=o(t,e,r);return i(n)}function i(e){return function(r){return t.isTag(r)&&e(r)}}function o(t,e,r){var n=V(t,e);return d(n,e,r)}function a(t){return"pseudo"===t.type&&("scope"===t.name||Array.isArray(t.data)&&t.data.some(function(t){return t.some(a)}))}var l={type:"descendant"},c={type:"_flexibleDescendant"},h={type:"pseudo",name:"scope"},u={};function d(e,r,s){(e=e.filter(function(t){return t.length>0})).forEach(bt);var i=Array.isArray(s);(s=r&&r.context||s)&&!i&&(s=[s]),function(e,r){var n=!!r&&!!r.length&&r.every(function(e){return e===u||!!t.getParent(e)});e.forEach(function(t){if(t.length>0&&p(t[0])&&"descendant"!==t[0].type);else{if(!n||a(t))return;t.unshift(l)}t.unshift(h)})}(e,s);var o=!1,d=e.map(function(t){if(t[0]&&t[1]&&"scope"===t[0].name){var e=t[1].type;i&&"descendant"===e?t[1]=c:"adjacent"!==e&&"sibling"!==e||(o=!0)}return function(t,e,r){return t.reduce(function(t,s){return t===Rt?t:n[s.type](t,s,e,r)},e&&e.rootFunc||Mt)}(t,r,s)}).reduce(f,Rt);return d.shouldTestNextSiblings=o,d}function p(t){return wt[t.type]<0}function f(t,e){return e===Rt||t===Mt?t:t===Rt||e===Mt?e:function(r){return t(r)||e(r)}}function g(t){return t.some(p)}return r.not=function(t,e,r,n){var s={xmlMode:!(!r||!r.xmlMode),strict:!(!r||!r.strict)};if(s.strict&&(e.length>1||e.some(g)))throw new Error("complex selectors in :not aren't allowed in strict mode");var i=d(e,s,n);return i===Rt?t:i===Mt?Rt:function(e){return!i(e)&&t(e)}},r.has=function(e,r,n){var s={xmlMode:!(!n||!n.xmlMode),strict:!(!n||!n.strict)},o=r.some(g)?[u]:null,a=d(r,s,o);return a===Rt?Rt:a===Mt?function(r){return t.getChildren(r).some(t.isTag)&&e(r)}:(a=i(a),o?function(r){return e(r)&&(o[0]=r,t.existsOne(a,t.getChildren(r)))}:function(r){return e(r)&&t.existsOne(a,t.getChildren(r))})},r.matches=function(t,e,r,n){return d(e,{xmlMode:!(!r||!r.xmlMode),strict:!(!r||!r.strict),rootFunc:t},n)},s.compileToken=d,s.compileUnsafe=o,s.Pseudos=e,s},Mt=L,Rt=k;var qt=Gt,Bt=k,jt=kt(mt);function Ft(t){return t.__compile__||(t.__compile__=kt(t)),t.__compile__}function Ut(t){return function(e,r,n){(n=n||{}).adapter=n.adapter||mt;var s=Ft(n.adapter);return"function"!=typeof e&&(e=s.compileUnsafe(e,n,r)),e.shouldTestNextSiblings&&(r=function(t,e){Array.isArray(t)||(t=[t]);for(var r=t.slice(0),n=0,s=t.length;n<s;n++){var i=Ht(r[n],e);r.push.apply(r,i)}return r}(n&&n.context||r,n.adapter)),r=Array.isArray(r)?n.adapter.removeSubsets(r):n.adapter.getChildren(r),t(e,r,n)}}function Ht(t,e){var r=e.getSiblings(t);if(!Array.isArray(r))return[];for(r=r.slice(0);r.shift()!==t;);return r}var Vt=Ut(function(t,e,r){return t!==Bt&&e&&0!==e.length?r.adapter.findAll(t,e):[]}),zt=Ut(function(t,e,r){return t!==Bt&&e&&0!==e.length?r.adapter.findOne(t,e):null});function Gt(t,e,r){return Vt(t,e,r)}Gt.compile=jt,Gt.filters=jt.Pseudos.filters,Gt.pseudos=jt.Pseudos.pseudos,Gt.selectAll=Vt,Gt.selectOne=zt,Gt.is=function(t,e,r){(r=r||{}).adapter=r.adapter||mt;var n=Ft(r.adapter);return("function"==typeof e?e:n(e,r))(t)},Gt.parse=jt,Gt.iterate=Vt,Gt._compileUnsafe=jt.compileUnsafe,Gt._compileToken=jt.compileToken;var $t={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'},Jt=Object.freeze({amp:"&",apos:"'",gt:">",lt:"<",quot:'"',default:$t}),Kt={Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌",in:"∈",Map:"⤅"},Wt=Object.freeze({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌",default:Kt}),Xt=Wt&&Kt||Wt,Yt=ee(Jt&&$t||Jt),Zt=ae(Yt,re(Yt)),Qt=ee(Xt),te=ae(Qt,re(Qt));function ee(t){return Object.keys(t).sort().reduce(function(e,r){return e[t[r]]="&"+r+";",e},{})}function re(t){var e=[],r=[];return Object.keys(t).forEach(function(t){1===t.length?e.push("\\"+t):r.push(t)}),r.unshift("["+e.join("")+"]"),new RegExp(r.join("|"),"g")}var ne=/[^\0-\x7F]/g,se=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function ie(t){return"&#x"+t.charCodeAt(0).toString(16).toUpperCase()+";"}function oe(t){return"&#x"+(1024*(t.charCodeAt(0)-55296)+t.charCodeAt(1)-56320+65536).toString(16).toUpperCase()+";"}function ae(t,e){function r(e){return t[e]}return function(t){return t.replace(e,r).replace(se,oe).replace(ne,ie)}}var le=re(Yt);var ce={XML:Zt,HTML:te,escape:function(t){return t.replace(le,ie).replace(se,oe).replace(ne,ie)}},he={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376},ue=Object.freeze({default:he}),de=ue&&he||ue;var pe,fe,ge={encodeXML:ce.XML,decodeCodepoint:function(t){if(t>=55296&&t<=57343||t>1114111)return"�";t in de&&(t=de[t]);var e="";t>65535&&(t-=65536,e+=String.fromCharCode(t>>>10&1023|55296),t=56320|1023&t);return e+=String.fromCharCode(t)},entitiesJSON:Kt,legacyJSON:{Aacute:"Á",aacute:"á",Acirc:"Â",acirc:"â",acute:"´",AElig:"Æ",aelig:"æ",Agrave:"À",agrave:"à",amp:"&",AMP:"&",Aring:"Å",aring:"å",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",brvbar:"¦",Ccedil:"Ç",ccedil:"ç",cedil:"¸",cent:"¢",copy:"©",COPY:"©",curren:"¤",deg:"°",divide:"÷",Eacute:"É",eacute:"é",Ecirc:"Ê",ecirc:"ê",Egrave:"È",egrave:"è",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",frac12:"½",frac14:"¼",frac34:"¾",gt:">",GT:">",Iacute:"Í",iacute:"í",Icirc:"Î",icirc:"î",iexcl:"¡",Igrave:"Ì",igrave:"ì",iquest:"¿",Iuml:"Ï",iuml:"ï",laquo:"«",lt:"<",LT:"<",macr:"¯",micro:"µ",middot:"·",nbsp:" ",not:"¬",Ntilde:"Ñ",ntilde:"ñ",Oacute:"Ó",oacute:"ó",Ocirc:"Ô",ocirc:"ô",Ograve:"Ò",ograve:"ò",ordf:"ª",ordm:"º",Oslash:"Ø",oslash:"ø",Otilde:"Õ",otilde:"õ",Ouml:"Ö",ouml:"ö",para:"¶",plusmn:"±",pound:"£",quot:'"',QUOT:'"',raquo:"»",reg:"®",REG:"®",sect:"§",shy:"­",sup1:"¹",sup2:"²",sup3:"³",szlig:"ß",THORN:"Þ",thorn:"þ",times:"×",Uacute:"Ú",uacute:"ú",Ucirc:"Û",ucirc:"û",Ugrave:"Ù",ugrave:"ù",uml:"¨",Uuml:"Ü",uuml:"ü",Yacute:"Ý",yacute:"ý",yen:"¥",yuml:"ÿ"},xmlJSON:$t},me=ge.decodeCodepoint,_e=Object.freeze({default:me}),ye=ge.entitiesJSON,we=Object.freeze({default:ye}),be=ge.legacyJSON,ve=Object.freeze({default:be}),Se=ge.xmlJSON,Ee=Object.freeze({default:Se}),Ce=_e&&me||_e,xe=we&&ye||we,Ne=ve&&be||ve,Te=Ee&&Se||Ee,Pe=Br,Ie=0,Oe=Ie++,Ae=Ie++,De=Ie++,Le=Ie++,ke=Ie++,Me=Ie++,Re=Ie++,qe=Ie++,Be=Ie++,je=Ie++,Fe=Ie++,Ue=Ie++,He=Ie++,Ve=Ie++,ze=Ie++,Ge=Ie++,$e=Ie++,Je=Ie++,Ke=Ie++,We=Ie++,Xe=Ie++,Ye=Ie++,Ze=Ie++,Qe=Ie++,tr=Ie++,er=Ie++,rr=Ie++,nr=Ie++,sr=Ie++,ir=Ie++,or=Ie++,ar=Ie++,lr=Ie++,cr=Ie++,hr=Ie++,ur=Ie++,dr=Ie++,pr=Ie++,fr=Ie++,gr=Ie++,mr=Ie++,_r=Ie++,yr=Ie++,wr=Ie++,br=Ie++,vr=Ie++,Sr=Ie++,Er=Ie++,Cr=Ie++,xr=Ie++,Nr=Ie++,Tr=Ie++,Pr=Ie++,Ir=Ie++,Or=Ie++,Ar=0,Dr=Ar++,Lr=Ar++,kr=Ar++;function Mr(t){return" "===t||"\n"===t||"\t"===t||"\f"===t||"\r"===t}function Rr(t,e,r){var n=t.toLowerCase();return t===n?function(t){t===n?this._state=e:(this._state=r,this._index--)}:function(s){s===n||s===t?this._state=e:(this._state=r,this._index--)}}function qr(t,e){var r=t.toLowerCase();return function(n){n===r||n===t?this._state=e:(this._state=De,this._index--)}}function Br(t,e){this._state=Oe,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=Oe,this._special=Dr,this._cbs=e,this._running=!0,this._ended=!1,this._xmlMode=!(!t||!t.xmlMode),this._decodeEntities=!(!t||!t.decodeEntities)}Br.prototype._stateText=function(t){"<"===t?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=Ae,this._sectionStart=this._index):this._decodeEntities&&this._special===Dr&&"&"===t&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=Oe,this._state=Nr,this._sectionStart=this._index)},Br.prototype._stateBeforeTagName=function(t){"/"===t?this._state=ke:"<"===t?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===t||this._special!==Dr||Mr(t)?this._state=Oe:"!"===t?(this._state=ze,this._sectionStart=this._index+1):"?"===t?(this._state=$e,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==t&&"S"!==t?De:or,this._sectionStart=this._index)},Br.prototype._stateInTagName=function(t){("/"===t||">"===t||Mr(t))&&(this._emitToken("onopentagname"),this._state=qe,this._index--)},Br.prototype._stateBeforeCloseingTagName=function(t){Mr(t)||(">"===t?this._state=Oe:this._special!==Dr?"s"===t||"S"===t?this._state=ar:(this._state=Oe,this._index--):(this._state=Me,this._sectionStart=this._index))},Br.prototype._stateInCloseingTagName=function(t){(">"===t||Mr(t))&&(this._emitToken("onclosetag"),this._state=Re,this._index--)},Br.prototype._stateAfterCloseingTagName=function(t){">"===t&&(this._state=Oe,this._sectionStart=this._index+1)},Br.prototype._stateBeforeAttributeName=function(t){">"===t?(this._cbs.onopentagend(),this._state=Oe,this._sectionStart=this._index+1):"/"===t?this._state=Le:Mr(t)||(this._state=Be,this._sectionStart=this._index)},Br.prototype._stateInSelfClosingTag=function(t){">"===t?(this._cbs.onselfclosingtag(),this._state=Oe,this._sectionStart=this._index+1):Mr(t)||(this._state=qe,this._index--)},Br.prototype._stateInAttributeName=function(t){("="===t||"/"===t||">"===t||Mr(t))&&(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=je,this._index--)},Br.prototype._stateAfterAttributeName=function(t){"="===t?this._state=Fe:"/"===t||">"===t?(this._cbs.onattribend(),this._state=qe,this._index--):Mr(t)||(this._cbs.onattribend(),this._state=Be,this._sectionStart=this._index)},Br.prototype._stateBeforeAttributeValue=function(t){'"'===t?(this._state=Ue,this._sectionStart=this._index+1):"'"===t?(this._state=He,this._sectionStart=this._index+1):Mr(t)||(this._state=Ve,this._sectionStart=this._index,this._index--)},Br.prototype._stateInAttributeValueDoubleQuotes=function(t){'"'===t?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=qe):this._decodeEntities&&"&"===t&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=Nr,this._sectionStart=this._index)},Br.prototype._stateInAttributeValueSingleQuotes=function(t){"'"===t?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=qe):this._decodeEntities&&"&"===t&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=Nr,this._sectionStart=this._index)},Br.prototype._stateInAttributeValueNoQuotes=function(t){Mr(t)||">"===t?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=qe,this._index--):this._decodeEntities&&"&"===t&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=Nr,this._sectionStart=this._index)},Br.prototype._stateBeforeDeclaration=function(t){this._state="["===t?Ye:"-"===t?Je:Ge},Br.prototype._stateInDeclaration=function(t){">"===t&&(this._cbs.ondeclaration(this._getSection()),this._state=Oe,this._sectionStart=this._index+1)},Br.prototype._stateInProcessingInstruction=function(t){">"===t&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=Oe,this._sectionStart=this._index+1)},Br.prototype._stateBeforeComment=function(t){"-"===t?(this._state=Ke,this._sectionStart=this._index+1):this._state=Ge},Br.prototype._stateInComment=function(t){"-"===t&&(this._state=We)},Br.prototype._stateAfterComment1=function(t){this._state="-"===t?Xe:Ke},Br.prototype._stateAfterComment2=function(t){">"===t?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=Oe,this._sectionStart=this._index+1):"-"!==t&&(this._state=Ke)},Br.prototype._stateBeforeCdata1=Rr("C",Ze,Ge),Br.prototype._stateBeforeCdata2=Rr("D",Qe,Ge),Br.prototype._stateBeforeCdata3=Rr("A",tr,Ge),Br.prototype._stateBeforeCdata4=Rr("T",er,Ge),Br.prototype._stateBeforeCdata5=Rr("A",rr,Ge),Br.prototype._stateBeforeCdata6=function(t){"["===t?(this._state=nr,this._sectionStart=this._index+1):(this._state=Ge,this._index--)},Br.prototype._stateInCdata=function(t){"]"===t&&(this._state=sr)},Br.prototype._stateAfterCdata1=(pe="]",fe=ir,function(t){t===pe&&(this._state=fe)}),Br.prototype._stateAfterCdata2=function(t){">"===t?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=Oe,this._sectionStart=this._index+1):"]"!==t&&(this._state=nr)},Br.prototype._stateBeforeSpecial=function(t){"c"===t||"C"===t?this._state=lr:"t"===t||"T"===t?this._state=yr:(this._state=De,this._index--)},Br.prototype._stateBeforeSpecialEnd=function(t){this._special!==Lr||"c"!==t&&"C"!==t?this._special!==kr||"t"!==t&&"T"!==t?this._state=Oe:this._state=Sr:this._state=pr},Br.prototype._stateBeforeScript1=qr("R",cr),Br.prototype._stateBeforeScript2=qr("I",hr),Br.prototype._stateBeforeScript3=qr("P",ur),Br.prototype._stateBeforeScript4=qr("T",dr),Br.prototype._stateBeforeScript5=function(t){("/"===t||">"===t||Mr(t))&&(this._special=Lr),this._state=De,this._index--},Br.prototype._stateAfterScript1=Rr("R",fr,Oe),Br.prototype._stateAfterScript2=Rr("I",gr,Oe),Br.prototype._stateAfterScript3=Rr("P",mr,Oe),Br.prototype._stateAfterScript4=Rr("T",_r,Oe),Br.prototype._stateAfterScript5=function(t){">"===t||Mr(t)?(this._special=Dr,this._state=Me,this._sectionStart=this._index-6,this._index--):this._state=Oe},Br.prototype._stateBeforeStyle1=qr("Y",wr),Br.prototype._stateBeforeStyle2=qr("L",br),Br.prototype._stateBeforeStyle3=qr("E",vr),Br.prototype._stateBeforeStyle4=function(t){("/"===t||">"===t||Mr(t))&&(this._special=kr),this._state=De,this._index--},Br.prototype._stateAfterStyle1=Rr("Y",Er,Oe),Br.prototype._stateAfterStyle2=Rr("L",Cr,Oe),Br.prototype._stateAfterStyle3=Rr("E",xr,Oe),Br.prototype._stateAfterStyle4=function(t){">"===t||Mr(t)?(this._special=Dr,this._state=Me,this._sectionStart=this._index-5,this._index--):this._state=Oe},Br.prototype._stateBeforeEntity=Rr("#",Tr,Pr),Br.prototype._stateBeforeNumericEntity=Rr("X",Or,Ir),Br.prototype._parseNamedEntityStrict=function(){if(this._sectionStart+1<this._index){var t=this._buffer.substring(this._sectionStart+1,this._index),e=this._xmlMode?Te:xe;e.hasOwnProperty(t)&&(this._emitPartial(e[t]),this._sectionStart=this._index+1)}},Br.prototype._parseLegacyEntity=function(){var t=this._sectionStart+1,e=this._index-t;for(e>6&&(e=6);e>=2;){var r=this._buffer.substr(t,e);if(Ne.hasOwnProperty(r))return this._emitPartial(Ne[r]),void(this._sectionStart+=e+1);e--}},Br.prototype._stateInNamedEntity=function(t){";"===t?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(t<"a"||t>"z")&&(t<"A"||t>"Z")&&(t<"0"||t>"9")&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==Oe?"="!==t&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},Br.prototype._decodeNumericEntity=function(t,e){var r=this._sectionStart+t;if(r!==this._index){var n=this._buffer.substring(r,this._index),s=parseInt(n,e);this._emitPartial(Ce(s)),this._sectionStart=this._index}else this._sectionStart--;this._state=this._baseState},Br.prototype._stateInNumericEntity=function(t){";"===t?(this._decodeNumericEntity(2,10),this._sectionStart++):(t<"0"||t>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},Br.prototype._stateInHexEntity=function(t){";"===t?(this._decodeNumericEntity(3,16),this._sectionStart++):(t<"a"||t>"f")&&(t<"A"||t>"F")&&(t<"0"||t>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},Br.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._bufferOffset+=this._index,this._index=0):this._running&&(this._state===Oe?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},Br.prototype.write=function(t){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=t,this._parse()},Br.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var t=this._buffer.charAt(this._index);this._state===Oe?this._stateText(t):this._state===Ae?this._stateBeforeTagName(t):this._state===De?this._stateInTagName(t):this._state===ke?this._stateBeforeCloseingTagName(t):this._state===Me?this._stateInCloseingTagName(t):this._state===Re?this._stateAfterCloseingTagName(t):this._state===Le?this._stateInSelfClosingTag(t):this._state===qe?this._stateBeforeAttributeName(t):this._state===Be?this._stateInAttributeName(t):this._state===je?this._stateAfterAttributeName(t):this._state===Fe?this._stateBeforeAttributeValue(t):this._state===Ue?this._stateInAttributeValueDoubleQuotes(t):this._state===He?this._stateInAttributeValueSingleQuotes(t):this._state===Ve?this._stateInAttributeValueNoQuotes(t):this._state===ze?this._stateBeforeDeclaration(t):this._state===Ge?this._stateInDeclaration(t):this._state===$e?this._stateInProcessingInstruction(t):this._state===Je?this._stateBeforeComment(t):this._state===Ke?this._stateInComment(t):this._state===We?this._stateAfterComment1(t):this._state===Xe?this._stateAfterComment2(t):this._state===Ye?this._stateBeforeCdata1(t):this._state===Ze?this._stateBeforeCdata2(t):this._state===Qe?this._stateBeforeCdata3(t):this._state===tr?this._stateBeforeCdata4(t):this._state===er?this._stateBeforeCdata5(t):this._state===rr?this._stateBeforeCdata6(t):this._state===nr?this._stateInCdata(t):this._state===sr?this._stateAfterCdata1(t):this._state===ir?this._stateAfterCdata2(t):this._state===or?this._stateBeforeSpecial(t):this._state===ar?this._stateBeforeSpecialEnd(t):this._state===lr?this._stateBeforeScript1(t):this._state===cr?this._stateBeforeScript2(t):this._state===hr?this._stateBeforeScript3(t):this._state===ur?this._stateBeforeScript4(t):this._state===dr?this._stateBeforeScript5(t):this._state===pr?this._stateAfterScript1(t):this._state===fr?this._stateAfterScript2(t):this._state===gr?this._stateAfterScript3(t):this._state===mr?this._stateAfterScript4(t):this._state===_r?this._stateAfterScript5(t):this._state===yr?this._stateBeforeStyle1(t):this._state===wr?this._stateBeforeStyle2(t):this._state===br?this._stateBeforeStyle3(t):this._state===vr?this._stateBeforeStyle4(t):this._state===Sr?this._stateAfterStyle1(t):this._state===Er?this._stateAfterStyle2(t):this._state===Cr?this._stateAfterStyle3(t):this._state===xr?this._stateAfterStyle4(t):this._state===Nr?this._stateBeforeEntity(t):this._state===Tr?this._stateBeforeNumericEntity(t):this._state===Pr?this._stateInNamedEntity(t):this._state===Ir?this._stateInNumericEntity(t):this._state===Or?this._stateInHexEntity(t):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},Br.prototype.pause=function(){this._running=!1},Br.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},Br.prototype.end=function(t){this._ended&&this._cbs.onerror(Error(".end() after done!")),t&&this.write(t),this._ended=!0,this._running&&this._finish()},Br.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},Br.prototype._handleTrailingData=function(){var t=this._buffer.substr(this._sectionStart);this._state===nr||this._state===sr||this._state===ir?this._cbs.oncdata(t):this._state===Ke||this._state===We||this._state===Xe?this._cbs.oncomment(t):this._state!==Pr||this._xmlMode?this._state!==Ir||this._xmlMode?this._state!==Or||this._xmlMode?this._state!==De&&this._state!==qe&&this._state!==Fe&&this._state!==je&&this._state!==Be&&this._state!==He&&this._state!==Ue&&this._state!==Ve&&this._state!==Me&&this._cbs.ontext(t):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},Br.prototype.reset=function(){Br.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},Br.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},Br.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},Br.prototype._emitToken=function(t){this._cbs[t](this._getSection()),this._sectionStart=-1},Br.prototype._emitPartial=function(t){this._baseState!==Oe?this._cbs.onattribdata(t):this._cbs.ontext(t)};var jr=function(){},Fr=Object.freeze({default:jr}),Ur={},Hr=Object.freeze({default:Ur}),Vr=Pe,zr={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},Gr={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:zr,input:zr,output:zr,button:zr,datalist:zr,textarea:zr,option:{option:!0},optgroup:{optgroup:!0}},$r={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,path:!0,circle:!0,ellipse:!0,line:!0,rect:!0,use:!0,stop:!0,polyline:!0,polygon:!0},Jr=/\s|\//;function Kr(t,e){this._options=e||{},this._cbs=t||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(Vr=this._options.Tokenizer),this._tokenizer=new Vr(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}(Fr&&jr||Fr)(Kr,(Hr&&Ur||Hr).EventEmitter),Kr.prototype._updatePosition=function(t){null===this.endIndex?this._tokenizer._sectionStart<=t?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-t:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},Kr.prototype.ontext=function(t){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(t)},Kr.prototype.onopentagname=function(t){if(this._lowerCaseTagNames&&(t=t.toLowerCase()),this._tagname=t,!this._options.xmlMode&&t in Gr)for(var e;(e=this._stack[this._stack.length-1])in Gr[t];this.onclosetag(e));!this._options.xmlMode&&t in $r||this._stack.push(t),this._cbs.onopentagname&&this._cbs.onopentagname(t),this._cbs.onopentag&&(this._attribs={})},Kr.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in $r&&this._cbs.onclosetag(this._tagname),this._tagname=""},Kr.prototype.onclosetag=function(t){if(this._updatePosition(1),this._lowerCaseTagNames&&(t=t.toLowerCase()),this._options.xmlMode){const e=this._stack;let r=e.pop();for(;r!==t;)this._cbs.onerror&&this._cbs.onerror("Unclosed tag <"+r+">"),r=e.pop();this.onopentagend(),this._cbs.onclosetag&&this._cbs.onclosetag(r)}else if(!this._stack.length||t in $r)"br"!==t&&"p"!==t||(this.onopentagname(t),this._closeCurrentTag());else{let e=this._stack.lastIndexOf(t);if(-1!==e)if(this._cbs.onclosetag)for(e=this._stack.length-e;e--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=e;else"p"===t&&(this.onopentagname(t),this._closeCurrentTag())}},Kr.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing?this._closeCurrentTag():this.onopentagend()},Kr.prototype._closeCurrentTag=function(){var t=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===t&&(this._cbs.onclosetag&&this._cbs.onclosetag(t),this._stack.pop())},Kr.prototype.onattribname=function(t){this._lowerCaseAttributeNames&&(t=t.toLowerCase()),this._attribname=t},Kr.prototype.onattribdata=function(t){this._attribvalue+=t},Kr.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},Kr.prototype._getInstructionName=function(t){var e=t.search(Jr),r=e<0?t:t.substr(0,e);return this._lowerCaseTagNames&&(r=r.toLowerCase()),r},Kr.prototype.ondeclaration=function(t){if(this._cbs.onprocessinginstruction){var e=this._getInstructionName(t);this._cbs.onprocessinginstruction("!"+e,"!"+t)}},Kr.prototype.onprocessinginstruction=function(t){if(this._cbs.onprocessinginstruction){var e=this._getInstructionName(t);this._cbs.onprocessinginstruction("?"+e,"?"+t)}},Kr.prototype.oncomment=function(t){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(t),this._cbs.oncommentend&&this._cbs.oncommentend()},Kr.prototype.oncdata=function(t){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(t),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+t+"]]")},Kr.prototype.onerror=function(t){this._cbs.onerror&&this._cbs.onerror(t)},Kr.prototype.onend=function(){if(this._cbs.onclosetag)for(var t=this._stack.length;t>0;this._cbs.onclosetag(this._stack[--t]));this._cbs.onend&&this._cbs.onend()},Kr.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},Kr.prototype.parseComplete=function(t){this.reset(),this.end(t)},Kr.prototype.write=function(t){this._tokenizer.write(t)},Kr.prototype.end=function(t){this._tokenizer.end(t)},Kr.prototype.pause=function(){this._tokenizer.pause()},Kr.prototype.resume=function(){this._tokenizer.resume()},Kr.prototype.parseChunk=Kr.prototype.write,Kr.prototype.done=Kr.prototype.end;var Wr=Kr;function Xr(t,e){let r=e.ownerDocument?e.ownerDocument.format:e.format;if(!r)throw new Error("Either 'ownerDocument' or 'format' must be set.");let n=Object.assign({},e,{xmlMode:"xml"===r}),s=new Qr({format:r,elementFactory:e.elementFactory});return new Wr(s,n).end(t),s.document}Wr.prototype.ondeclaration=function(t){if(this._cbs.ondeclaration)this._cbs.ondeclaration(t);else if(this._cbs.onprocessinginstruction){var e=this._getInstructionName(t);this._cbs.onprocessinginstruction("!"+e,"!"+t)}},Wr.prototype.oncdata=function(t){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(t),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+t+"]]")};const Yr=/\s+/g,Zr=/^DOCTYPE\s+([^\s]+)(?:\s+PUBLIC\s+["]([^"]+)["](?:\s+["]([^"]+)["])?)\s*$/;class Qr{constructor(t={}){if(this.elementFactory=t.elementFactory,!this.elementFactory)throw new Error("'elementFactory' is required");this.options=t,this.document=null,this._tagStack=[]}onparserinit(){this.document=this.elementFactory("document",{format:this.options.format}),this._tagStack=[this.document]}onend(){if(this._tagStack.length>1)throw new Error("Unexpected EOF. Tag was opened but not closed.")}onerror(t){throw new Error(t)}onclosetag(){this._tagStack.pop()}_addDomElement(t){let e=this._tagStack[this._tagStack.length-1];e.childNodes||(e.childNodes=[]);let r=e.childNodes,n=r[r.length-1];t.next=null,n?(t.prev=n,n.next=t):t.prev=null,r.push(t),t.parent=e||null}onopentag(t,e){let r=this.document.createElement(t);f(e,(t,e)=>{r.setAttribute(e,t)}),this._addDomElement(r),this._tagStack.push(r)}ontext(t){let e;this.options.normalizeWhitespace&&(t=t.replace(Yr," "));let r=this._tagStack[this._tagStack.length-1];if(r&&r.childNodes&&(e=r.childNodes[r.childNodes.length-1]),e&&e.type===D.Text)e.data+=t;else{let e=this.document.createTextNode(t);this._addDomElement(e)}}oncomment(t){var e=this._tagStack[this._tagStack.length-1];if(e&&e.type===D.Comment)e.data+=t;else{let e=this.document.createComment(t);this._addDomElement(e),this._tagStack.push(e)}}oncommentend(){this._tagStack.pop()}oncdatastart(t){let e=this.document.createCDATASection(t);this._addDomElement(e),this._tagStack.push(e)}oncdataend(){this._tagStack.pop()}onprocessinginstruction(t,e){e=e.slice(t.length,-1).trim(),t=t.slice(1);let r=this.document.createProcessingInstruction(t,e);"xml"===t?this.document._xmlInstruction=r:this._addDomElement(r)}ondeclaration(t){if(!t.startsWith("DOCTYPE"))throw new Error("Not implemented: parse declaration "+t);{let e=Zr.exec(t);if(!e)throw new Error("Could not parse DOCTYPE element: "+t);this.document.setDoctype(e[1],e[2],e[3])}}}let tn;class en extends w{constructor(t,e={}){if(super(),this.type=t,!t)throw new Error("'type' is mandatory");if(this.ownerDocument=e.ownerDocument,"document"!==t&&!this.ownerDocument)throw new Error("'ownerDocument' is mandatory");switch(t){case D.Tag:if(!e.name)throw new Error("'name' is mandatory.");this.name=this._normalizeName(e.name),this.nameWithoutNS=dn(this.name),this.properties=new Map,this.attributes=new Map,this.classes=new Set,this.styles=new Map,this.eventListeners=[],this.childNodes=e.children||e.childNodes||[],this._assign(e);break;case D.Text:case D.Comment:case D.CDATA:this.data=e.data||"";break;case D.Directive:if(!e.name)throw new Error("'name' is mandatory.");this.name=this._normalizeName(e.name),this.nameWithoutNS=dn(this.name),this.data=e.data;break;case D.Doctype:this.data=e.data;break;case"document":{let t=e.format;if(this.format=t,!t)throw new Error("'format' is mandatory.");switch(this.childNodes=e.children||e.childNodes||[],t){case"xml":this.contentType="application/xml";break;case"html":this.contentType="text/html";break;default:throw new Error("Unsupported format "+t)}break}default:this.name=null,this.properties=new Map,this.attributes=new Map,this.classes=new Set,this.styles=new Map,this.eventListeners=[],this.childNodes=e.children||e.childNodes||[]}}getNativeElement(){return this}getNodeType(){switch(this.type){case D.Tag:case D.Script:case D.Style:return"element";default:return this.type}}isTextNode(){return"text"===this.type}isElementNode(){return"tag"===this.type||"script"===this.type}isCommentNode(){return"comment"===this.type}isDocumentNode(){return"document"===this.type}isComponentNode(){return"component"===this.type}clone(t){let e=new en(this.type,this);return this.childNodes&&(e.childNodes.length=0,t&&this.childNodes.forEach(r=>{e.appendChild(r.clone(t))})),e}get tagName(){return this.getTagName()}set tagName(t){this.setTagName(t)}getTagName(){return this.name}setTagName(t){return this._isXML()?this.name=String(t):this.name=String(t).toLowerCase(),this.nameWithoutNS=dn(this.name),this}hasAttribute(t){if(this.attributes)return this.attributes.has(t)}getAttribute(t){if(this.attributes)return this.attributes.get(t)}setAttribute(t,e){if(this.attributes){switch(e=String(e),t){case"class":this.classes=new Set,sn(this.classes,e);break;case"style":this.styles=new Map,an(this.styles,e)}this.attributes.set(t,e),this._isHTML()&&function(t,e,r){const n=pn[t.tagName];if(n){let s=n[e];!0===s?t.setProperty(e,r):s&&s(t,e,r)}}(this,t,e)}return this}removeAttribute(t){if(this.attributes){switch(t){case"class":this.classes=new Set;break;case"style":this.styles=new Map}this.attributes.delete(t)}return this}getAttributes(){return this.attributes}getProperty(t){if(this.properties)return this.properties.get(t)}setProperty(t,e){if(this.properties){if(this._isXML())throw new Error("setProperty() is only be used on HTML elements");!function(t,e,r){const n=fn[t.tagName];if(n){let s=n[e];if(s)return void s(t,e,r)}gn(t,e,r)}(this,t,e)}return this}hasClass(t){if(this.classes)return this.classes.has(t)}addClass(t){return this.classes&&(this.classes.add(t),this.attributes.set("class",on(this.classes))),this}removeClass(t){return this.classes&&this.classes.has(t)&&(this.classes.delete(t),this.attributes.set("class",on(this.classes))),this}getContentType(){return this.getOwnerDocument().contentType}getDoctype(){return this.isDocumentNode()?mn(this):this.getOwnerDocument().getDoctype()}setDoctype(t,e,r){let n=this.getOwnerDocument(),s=mn(n),i=this.createDocumentType(t,e,r);s?n.replaceChild(s,i):n.insertBefore(i,n.getChildren()[0]),n.doctype=i}getInnerHTML(){let t=this._isXML();return mt.getInnerHTML(this,{xmlMode:t,decodeEntities:!t})}setInnerHTML(t){if(this.childNodes){let e=this._isXML(),r=Xr(t,{ownerDocument:this.getOwnerDocument(),format:e?"xml":"html",decodeEntities:!e,elementFactory:rn});this.empty(),r.childNodes.slice(0).forEach(t=>{this.appendChild(t)})}return this}getOuterHTML(){let t=this._isXML();return mt.getOuterHTML(this,{xmlMode:t,decodeEntities:!t})}getTextContent(){return mt.getText(this)}setTextContent(t){switch(this.type){case D.Text:case D.Comment:case D.CDATA:this.data=t;break;default:if(this.childNodes){let e=this.createTextNode(t);this.empty(),this.appendChild(e)}}return this}getStyle(t){if(this.styles)return this.styles.get(t)}setStyle(t,e){return this.styles&&(w.pxStyles[t]&&s(e)&&(e+="px"),this.styles.set(t,e),this.attributes.set("style",function(t){if(!t)return"";let e=Object.keys(t).map(e=>e+":"+t[e]).join(";");e.length>0&&(e+=";");return e}(this.styles))),this}is(t){return qt.is(this,t,{xmlMode:this._isXML()})}find(t){return qt.selectOne(t,this,{xmlMode:this._isXML()})}findAll(t){return qt.selectAll(t,this,{xmlMode:this._isXML()})}getChildCount(){return this.childNodes?this.childNodes.length:0}getChildNodes(){return this.childNodes.slice(0)}getChildren(){return this.childNodes.filter(function(t){return"tag"===t.type})}get children(){return this.getChildren()}getChildAt(t){if(this.childNodes)return this.childNodes[t]}getChildIndex(t){if(this.childNodes)return this.childNodes.indexOf(t)}getLastChild(){if(this.childNodes)return O(this.childNodes)}getFirstChild(){if(this.childNodes)return this.childNodes[0]}getNextSibling(){return this.next}getPreviousSibling(){return this.prev}getParent(){return this.parent}getOwnerDocument(){return"document"===this.type?this:this.ownerDocument}getFormat(){return this.getOwnerDocument().format}createDocument(t){return en.createDocument(t)}createElement(t){return new en(D.Tag,{name:t,ownerDocument:this.getOwnerDocument()})}createTextNode(t){return new en(D.Text,{data:t,ownerDocument:this.getOwnerDocument()})}createComment(t){return new en(D.Comment,{data:t,ownerDocument:this.getOwnerDocument()})}createProcessingInstruction(t,e){return new en(D.Directive,{name:t,data:e,ownerDocument:this.getOwnerDocument()})}createDocumentType(t,e,r){return new nn(D.Doctype,{data:{name:t,publicId:e,systemId:r},ownerDocument:this.getOwnerDocument()})}createCDATASection(t){return new en(D.CDATA,{data:t,ownerDocument:this.getOwnerDocument()})}appendChild(t){if(this.childNodes&&!i(t)){if(!(t=this._normalizeChild(t)))return this;mt.appendChild(this,t),t.ownerDocument=this.getOwnerDocument()}return this}removeChild(t){t.parentNode===this&&t.remove()}insertAt(t,e){if(!(e=this._normalizeChild(e)))return this;let r=this.childNodes;return r&&(t>=r.length?mt.appendChild(this,e):mt.prepend(r[t],e),e.ownerDocument=this.getOwnerDocument()),this}insertBefore(t,e){if(i(e))return this.appendChild(t);if(this.childNodes){if(!(this.childNodes.indexOf(e)>-1))throw new Error("insertBefore(): reference node is not a child of this element.");mt.prepend(e,t),t.ownerDocument=this.getOwnerDocument()}return this}removeAt(t){let e=this.childNodes;if(e){e[t].remove()}return this}empty(){let t=this.childNodes;return t&&(t.forEach(t=>{t.next=t.prev=t.parent=null}),t.length=0),this}remove(){return mt.removeElement(this),this}replaceChild(t,e){return t.parent===this&&t.replaceWith(e),this}replaceWith(t){return t=this._normalizeChild(t),mt.replaceElement(this,t),t.ownerDocument=this.getOwnerDocument(),this}getEventListeners(){return this.eventListeners||[]}click(){return this.emit("click",{target:this,currentTarget:this}),!0}emit(t,e){this._propagateEvent(new cn(t,this,e))}getBoundingClientRect(){return{top:0,left:0,height:0,width:0}}getClientRects(){return[{top:0,left:0,height:0,width:0}]}_propagateEvent(t){let e=this.eventListeners;if(e){if(e.forEach(e=>{e.eventName===t.type&&e.handler(t)}),t.stopped)return;let r=this.parentNode;r&&r._propagateEvent(t)}}removeAllEventListeners(){return this.eventListeners=[],this}_assign(t){t.name&&(this.name=t.name),this.classes&&t.classes&&t.classes.forEach(t=>{this.classes.add(t)}),this.styles&&t.styles&&f(t.styles,(t,e)=>{this.styles.set(e,t)});let e=t.attributes||t.attribs;this.attributes&&e&&f(e,(t,e)=>{switch(e){case"class":sn(this.classes,t);break;case"style":an(this.styles,t)}this.attributes.set(e,t)}),this.eventListeners&&t.eventListeners&&(this.eventListeners=this.eventListeners.concat(t.eventListeners))}_normalizeChild(t){if(!i(t)){if(n(t)&&(t=this.createTextNode(t)),!t||!t._isMemoryDOMElement)throw new Error("Illegal argument: only String and MemoryDOMElement instances are valid.");return t}}_normalizeName(t){return this._isXML()?t:t.toLowerCase()}_isHTML(){return"html"===this.getFormat()}_isXML(){return"xml"===this.getFormat()}get _isMemoryDOMElement(){return!0}static createDocument(t,e={}){if("xml"===t){let r=new en("document",{format:t}),n=[];return e.version&&n.push(`version="${e.version}"`),e.encoding&&n.push(`encoding="${e.encoding}"`),n.length>0&&(r._xmlInstruction=r.createProcessingInstruction("xml",n.join(" "))),r}return en.parseMarkup(w.EMPTY_HTML,"html")}static parseMarkup(t,e,r={}){if(!t)return en.createDocument(e);let n,s="html"===e,i=Object.assign({format:e,decodeEntities:s,elementFactory:rn},r);if(r.raw)return Xr(t,i);if(r.snippet&&(t=`<__snippet__>${t}</__snippet__>`),"html"===e?function(t){let e=t.find("html");if(!e){let r=t.find("head"),n=t.find("title"),s=t.findAll("meta"),i=t.find("body");r&&r.remove(),n&&n.remove(),s.forEach(t=>t.remove()),i&&i.remove();let o=t.childNodes.slice();o.forEach(t=>{t.parent=null}),t.childNodes.length=0,e=t.createElement("html"),r||((r=t.createElement("head")).appendChild(n),r.append(s),e.appendChild(r)),i||(i=t.createElement("body")).append(o),e.appendChild(i),t.append(e)}}(n=Xr(t,i)):"xml"===e&&(n=Xr(t,i)),r.snippet){let t=n.find("__snippet__").childNodes;return 1===t.length?t[0]:t}return n}static wrapNativeElement(t){if(A){if(t===window||t===window.document)return new hn;t instanceof window.Node||t._isBrowserDOMElement}if(!t._isMemoryDOMElement)throw new Error("Illegal argument: expected MemoryDOMElement instance");return t}static wrap(t){return en.wrapNativeElement(t)}static unwrap(t){if(!t._isMemoryDOMElement)throw new Error("Illegal argument: expected MemoryDOMElement instance");return t}static isReverse(){return!1}static getBrowserWindow(){return tn||(tn=new un),tn}}function rn(t,e){return new en(t,e)}class nn extends en{get name(){return this.data.name}get publicId(){return this.data.publicId}get systemId(){return this.data.systemId}}function sn(t,e){e.split(/\s+/).forEach(e=>{t.add(e)})}function on(t){return Array.from(t).join(" ")}function an(t,e){(e=(e||"").trim())&&e.split(";").forEach(e=>{let r=e.indexOf(":");if(r<1||r===e.length-1)return;let n=e.slice(0,r).trim(),s=e.slice(r+1).trim();t.set(n,s)})}const ln=["keydown","keyup","keypress","mousedown","mouseup","mouseover","click","dblclick"].reduce((t,e)=>(t[e]=!0,t),{});class cn{constructor(t,e,r){this.type=t,this.timeStamp=Date.now(),this.target=e,ln[t]?r&&Object.assign(this,r):this.detail=r}stopPropagation(){this.stopped=!0}preventDefault(){this.defaultPrevented=!0}}class hn{on(){}off(){}}class un extends en{constructor(){super("window",{ownerDocument:en.createDocument("html")});let t={href:"",hash:""};function e(e){let r=e.indexOf("#");t.href=e,r>=0&&(t.hash=e.slice(r))}let r={replaceState(t,r,n){e(n)},pushState(t,r,n){e(n)}};this.location=t,this.history=r}}function dn(t){const e=t.indexOf(":");return e>0?t.slice(e+1):t}const pn={input:{value:!0,checked:(t,e,r)=>{const n="off"!==r;t.setProperty("checked",n)}}};const fn={input:{checked:(t,e,r)=>{!0===r?(t.properties.set(e,!0),t.properties.set("value","on")):(t.properties.set(e,!1),t.properties.set("value","off"))},value:(t,e,r)=>{switch(t.getAttribute("type")){case"checkbox":"on"===r?(t.properties.set(e,!0),t.properties.set("value","on")):(t.properties.set(e,!1),t.properties.set("value","off"));break;default:gn(t,e,r)}}}};function gn(t,e,r){void 0===r?t.properties.delete(e):t.properties.set(e,String(r))}function mn(t){if(t.doctype)return t.doctype;const e=t.childNodes;for(let r=0;r<e.length;r++){let n=e[r];if(n.type===D.Doctype)return t.doctype=n,n}}let _n={};function yn(){return _n._forceMemoryDOM?en:e.inBrowser||e.inElectron?N:en}_n.createDocument=function(t,e){return yn().createDocument(t,e)},_n.createElement=function(t){return console.error("DEPRECATED: every element should have an ownerDocument. Use DefaultDOMElement.createDocument() to create a document first"),_n.createDocument("html").createElement(t)},_n.createTextNode=function(t){return console.error("DEPRECATED: every element should have a ownerDocument. Use DefaultDOMElement.createDocument() to create a document first"),_n.createDocument("html").createTextNode(t)},_n.getBrowserWindow=function(){return yn().getBrowserWindow()},_n.parseHTML=function(t,e){return yn().parseMarkup(t,"html",e)},_n.parseXML=function(t,e){return yn().parseMarkup(t,"xml",e)},_n.parseSnippet=function(t,e){return yn().parseMarkup(t,e,{snippet:!0})},_n.wrap=_n.wrapNativeElement=function(t){if(!t)throw new Error("Illegal argument");return yn().wrap(t)},_n.unwrap=function(t){if(!t)throw new Error("Illegal argument");return yn().unwrap(t)},_n.isReverse=function(t,e,r,n){return yn().isReverse(t,e,r,n)},_n._forceMemoryDOM=!1;var wn=Object.freeze({findParentDOMElement:function(t){for(;t;){let e=_n.unwrap(t);if(e)return e;t=t.parentNode}},findParent:function(t,e){for(;t;){if(t.is(e))return t;t=t.getParent()}},stop:function(t){t.stopPropagation()},stopAndPrevent:function(t){t.stopPropagation(),t.preventDefault()},walk:function(t,e){!function t(e,r,n){if(r(e,n),e.getChildCount()>0){let s=e.getChildNodeIterator();for(;s.hasNext();)t(s.next(),r,n+1)}}(t,e,0)},isRightButton:function(t){let e=!1;return"which"in t?e=3===t.which:"button"in t&&(e=2===t.button),e},getBoundingRect:function(t){let e=t.getNativeElement().getBoundingClientRect();return{top:e.top,left:e.left,height:e.height,width:e.width}},getBoundingRectForRects:function(...t){let e,r,n,s;if(t.length>0){let i=t[0];e=i.top,r=i.left,n=e+i.height,s=r+i.width;for(let i=1;i<t.length;i++){let o=t[i];e=Math.min(e,o.top),r=Math.min(r,o.left),n=Math.max(n,o.top+o.height),s=Math.max(s,o.left+o.width)}}return{top:e,left:r,right:s,bottom:n,height:n-e,width:s-r}},isXInside:function(t,e){return t>=e.left&&t<=e.left+e.width},isYInside:function(t,e){return t>=e.top&&t<=e.top+e.height}});const bn=-1,vn=1,Sn=-2,En=2;function Cn(t){return Boolean(/^\s*$/.exec(t.textContent))}const xn=new Set(["script","object","embed","link","math","iframe","comment","base"]),Nn=new Set(["form","formaction","autofocus","dirname"]);class Tn{constructor(){var t={};Object.defineProperty(this,"_internal",{enumerable:!1,value:t}),t.doc=null}clone(){var t=this._clone();return this._internal.doc&&t.attach(this._internal.doc),t}getDocument(){var t=this._internal.doc;if(!t)throw new Error("Selection is not attached to a document.");return t}isAttached(){return Boolean(this._internal.doc)}attach(t){return this._internal.doc=t,this}isNull(){return!1}isPropertySelection(){return!1}isContainerSelection(){return!1}isNodeSelection(){return!1}isCustomSelection(){return!1}isCollapsed(){return!0}isReverse(){return!1}getType(){throw new Error("Selection.getType() is abstract.")}get type(){return this.getType()}getNodeId(){return null}equals(t){return this===t||!!t&&(this.isNull()===t.isNull()&&this.getType()===t.getType())}toString(){return"null"}toJSON(){throw new Error("This method is abstract.")}createWith(t){let e=this.constructor,r=this.toJSON();return Object.assign(r,t),e.fromJSON(r)}get _isSelection(){return!0}static get nullSelection(){return Pn}}const Pn=Object.freeze(new class extends Tn{isNull(){return!0}getType(){return"null"}toJSON(){return null}clone(){return this}});function In(t,e){if(t===e)return!0;if(!p(t)||!p(e))return!1;if(t.length!==e.length)return!1;let r=t.length;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}class On{constructor(t,e){if("SKIP"!==arguments[0]){if(1===arguments.length){let t=arguments[0];this.path=t.path,this.offset=t.offset}else this.path=t,this.offset=e;if(!p(this.path))throw new Error("Invalid arguments: path should be an array.");if(!s(this.offset)||this.offset<0)throw new Error("Invalid arguments: offset must be a positive number.")}}equals(t){return t===this||In(t.path,this.path)&&t.offset===this.offset}withCharPos(t){return new On(this.path,t)}getNodeId(){return this.path[0]}getPath(){return this.path}getOffset(){return this.offset}toJSON(){return{path:this.path.slice(),offset:this.offset}}clone(){return new On(this.toJSON())}toString(){return"("+this.path.join(".")+", "+this.offset+")"}isPropertyCoordinate(){return this.path.length>1}isNodeCoordinate(){return 1===this.path.length}hasSamePath(t){return In(this.path,t.path)}isEqual(t){return!!t&&(this.offset===t.offset&&this.hasSamePath(t))}get _isCoordinate(){return!0}}class An extends Tn{constructor(t,e,r,n,i,o){if(super(),1===arguments.length){let s=arguments[0];t=s.path,e=s.startOffset,r=s.endOffset,n=s.reverse,i=s.containerPath,o=s.surfaceId}if(!t||!s(e))throw new Error("Invalid arguments: `path` and `startOffset` are mandatory");this.start=new On(t,e),this.end=new On(t,s(r)?r:e),this.reverse=Boolean(n),this.containerPath=i,this.surfaceId=o}get path(){return this.start.path}get startOffset(){return this.start.offset}get endOffset(){return this.end.offset}toJSON(){return{type:"property",path:this.start.path,startOffset:this.start.offset,endOffset:this.end.offset,reverse:this.reverse,containerPath:this.containerPath,surfaceId:this.surfaceId}}isPropertySelection(){return!0}getType(){return"property"}isNull(){return!1}isCollapsed(){return this.start.offset===this.end.offset}isReverse(){return this.reverse}equals(t){return Tn.prototype.equals.call(this,t)&&this.start.equals(t.start)&&this.end.equals(t.end)}toString(){return["PropertySelection(",JSON.stringify(this.path),", ",this.start.offset," -> ",this.end.offset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}collapse(t){var e;return e="left"===t?this.start.offset:this.end.offset,this.createWithNewRange(e,e)}getPath(){return this.start.path}getNodeId(){return this.start.path[0]}getPropertyName(){return this.start.path[1]}isInsideOf(t,e){return!t.isNull()&&(t.isContainerSelection()?t.contains(this,e):e?In(this.path,t.path)&&this.start.offset>t.start.offset&&this.end.offset<t.end.offset:In(this.path,t.path)&&this.start.offset>=t.start.offset&&this.end.offset<=t.end.offset)}contains(t,e){return!t.isNull()&&t.isInsideOf(this,e)}overlaps(t,e){return!t.isNull()&&(t.isContainerSelection()?t.overlaps(this):!!In(this.path,t.path)&&(e?!(this.start.offset>=t.end.offset||this.end.offset<=t.start.offset):!(this.start.offset>t.end.offset||this.end.offset<t.start.offset)))}isRightAlignedWith(t){return!t.isNull()&&(t.isContainerSelection()?t.isRightAlignedWith(this):In(this.path,t.path)&&this.end.offset===t.end.offset)}isLeftAlignedWith(t){return!t.isNull()&&(t.isContainerSelection()?t.isLeftAlignedWith(this):In(this.path,t.path)&&this.start.offset===t.start.offset)}expand(t){if(t.isNull())return this;if(t.isContainerSelection())return t.expand(this);if(!In(this.path,t.path))throw new Error("Can not expand PropertySelection to a different property.");var e=Math.min(this.start.offset,t.start.offset),r=Math.max(this.end.offset,t.end.offset);return this.createWithNewRange(e,r)}truncateWith(t){if(t.isNull())return this;if(t.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(t))return this;let e,r,n,s;if(t.isPropertySelection())e=t.start.offset,r=t.end.offset;else{if(!t.isContainerSelection())return this;e=In(t.start.path,this.start.path)?t.start.offset:this.start.offset,r=In(t.end.path,this.start.path)?t.end.offset:this.end.offset}if(this.start.offset>e&&this.end.offset>r)n=r,s=this.end.offset;else if(this.start.offset<e&&this.end.offset<r)n=this.start.offset,s=e;else if(this.start.offset===e){if(this.end.offset<=r)return Tn.nullSelection;n=r,s=this.end.offset}else{if(this.end.offset!==r){if(t.contains(this))return Tn.nullSelection;throw new Error("Illegal state.")}if(this.start.offset>=e)return Tn.nullSelection;n=this.start.offset,s=e}return this.createWithNewRange(n,s)}createWithNewRange(t,e){var r=new An(this.path,t,e,!1,this.containerPath,this.surfaceId),n=this._internal.doc;return n&&r.attach(n),r}_clone(){return new An(this.start.path,this.start.offset,this.end.offset,this.reverse,this.containerPath,this.surfaceId)}}function Dn(t,e,r,n){if(r.hasSamePath(n))return Math.sign(r.offset-n.offset);{let s=Ln(t,e,r),i=Ln(t,e,n),o=Math.min(s.length,i.length);for(let t=0;t<o;t++){let e=s[t],r=i[t];if(e<r)return-1;if(e>r)return 1}return s.length===i.length?Math.sign(r.offset-n.offset):(console.error("FIXME: unexpected case in compareCoordinates()"),0)}}function Ln(t,e,r){let n=e[0],s=r.path[0],i=t.get(s).getXpath(),o=[];for(;i;){if(i.id===n)return o;o.unshift(i.pos||0),i=i.prev}}function kn(t,e,r,n,s){let i=Dn(t,e,r,n);return s?i<0:i<=0}An.fromJSON=function(t){return new An(t)};class Mn extends Tn{constructor(t,e,r,n,s,o,a){if(super(),1===arguments.length){let i=arguments[0];t=i.containerPath,e=i.startPath,r=i.startOffset,n=i.endPath,s=i.endOffset,o=i.reverse,a=i.surfaceId}if(this.containerPath=t,!this.containerPath)throw new Error("Invalid arguments: `containerPath` is mandatory");this.start=new On(e,r),this.end=new On(i(n)?e:n,i(s)?r:s),this.reverse=Boolean(o),this.surfaceId=a}get startPath(){return console.warn("DEPRECATED: use sel.start.path instead."),this.start.path}get startOffset(){return console.warn("DEPRECATED: use sel.start.offset instead."),this.start.offset}get endPath(){return console.warn("DEPRECATED: use sel.end.path instead."),this.end.path}get endOffset(){return console.warn("DEPRECATED: use sel.end.offset instead."),this.end.offset}toJSON(){return{type:"container",containerPath:this.containerPath,startPath:this.start.path,startOffset:this.start.offset,endPath:this.end.path,endOffset:this.end.offset,reverse:this.reverse,surfaceId:this.surfaceId}}isContainerSelection(){return!0}getType(){return"container"}isNull(){return!1}isCollapsed(){return this.start.equals(this.end)}isReverse(){return this.reverse}equals(t){return Tn.prototype.equals.call(this,t)&&In(this.containerPath,t.containerPath)&&this.start.equals(t.start)&&this.end.equals(t.end)}toString(){return["ContainerSelection(",this.containerPath,", ",JSON.stringify(this.start.path),", ",this.start.offset," -> ",JSON.stringify(this.end.path),", ",this.end.offset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}isInsideOf(t,e){return!t.isNull()&&(this._isCoordinateBefore(t.start,this.start,e)&&this._isCoordinateBefore(this.end,t.end,e))}contains(t,e){return!t.isNull()&&(this._isCoordinateBefore(this.start,t.start,e)&&this._isCoordinateBefore(t.end,this.end,e))}containsNode(t){let e=this.containerPath,r=this.getDocument(),n=new On([t],0),s=Dn(r,e,n,this.start),i=Dn(r,e,n,this.end);return s>=0&&i<0}overlaps(t){return!this._isCoordinateBefore(this.end,t.start,!1)||this._isCoordinateBefore(t.end,this.start,!1)}isLeftAlignedWith(t){return this.start.isEqual(t.start)}isRightAlignedWith(t){return this.end.isEqual(t.end)}collapse(t){let e;return Rn(this,e="left"===t?this.start:this.end,e)}expand(t){let e,r;return Rn(this,e=this.start.isEqual(t.start)?new On(this.start.path,Math.min(this.start.offset,t.start.offset)):this._isCoordinateBefore(t.start,this.start,!1)?new On(t.start.path,t.start.offset):this.start,r=this.end.isEqual(t.end)?new On(this.end.path,Math.max(this.end.offset,t.end.offset)):this._isCoordinateBefore(this.end,t.end,!1)?new On(t.end.path,t.end.offset):this.end)}truncateWith(t){if(t.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(t))return this;let e,r;if(this._isCoordinateBefore(t.start,this.start,"strict")&&this._isCoordinateBefore(t.end,this.end,"strict"))e=t.end,r=this.end;else if(this._isCoordinateBefore(this.start,t.start,"strict")&&this._isCoordinateBefore(this.end,t.end,"strict"))e=this.start,r=t.start;else if(this.start.isEqual(t.start)){if(!this._isCoordinateBefore(t.end,this.end,"strict"))return Tn.nullSelection;e=t.end,r=this.end}else{if(!this.end.isEqual(t.end)){if(this.isInsideOf(t))return Tn.nullSelection;throw new Error("Could not determine coordinates for truncate. Check input")}if(!this._isCoordinateBefore(this.start,t.start,"strict"))return Tn.nullSelection;e=this.start,r=t.start}return Rn(this,e,r)}splitIntoPropertySelections(){return this.getFragments().filter(t=>t instanceof Tn.Fragment).map(t=>new An(t.path,t.startOffset,t.endOffset,!1,this.containerPath,this.surfaceId))}_getContainerContent(){return this.getDocument().get(this.containerPath)}_clone(){return new Mn(this)}_isCoordinateBefore(t,e,r){return kn(this.getDocument(),this.containerPath,t,e,r)}get path(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead")}get _isContainerSelection(){return!0}static fromJSON(t){return new Mn(t)}}function Rn(t,e,r){let n;n=e===r?new An({path:e.path,startOffset:e.offset,endOffset:e.offset,containerPath:t.containerPath,surfaceId:t.surfaceId}):new Mn(t.containerPath,e.path,e.offset,r.path,r.offset,!1,t.surfaceId);const s=t._internal.doc;return s&&n.attach(s),n}class qn extends Tn{constructor(t,e,r,s,i){if(super(),1===arguments.length){let n=arguments[0];t=n.containerPath,e=n.nodeId,r=n.mode,s=n.reverse,i=n.surfaceId}if(!p(t))throw new Error("'containerPath' is mandatory.");if(!n(e))throw new Error("'nodeId' is mandatory.");r=r||"full",this.containerPath=t,this.nodeId=e,this.mode=r,this.reverse=Boolean(s),this.surfaceId=i,this.start=new On([e],0),this.end=new On([e],1)}equals(t){return super.equals(t)&&this.nodeId===t.nodeId&&this.mode===t.mode}isNodeSelection(){return!0}getType(){return"node"}getNodeId(){return this.nodeId}isFull(){return"full"===this.mode}isBefore(){return"before"===this.mode}isAfter(){return"after"===this.mode}isCollapsed(){return"full"!==this.mode}toJSON(){return{type:"node",nodeId:this.nodeId,mode:this.mode,reverse:this.reverse,containerPath:this.containerPath,surfaceId:this.surfaceId}}toString(){return["NodeSelection(",this.containerPath,".",this.nodeId,", ",this.mode,", ",this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")}collapse(t){if("left"===t)return this.isBefore()?this:new qn(this.containerPath,this.nodeId,"before",this.reverse,this.surfaceId);if("right"===t)return this.isAfter()?this:new qn(this.containerPath,this.nodeId,"after",this.reverse,this.surfaceId);throw new Error("'direction' must be either 'left' or 'right'")}_getCoordinate(){return"before"===this.mode?new On([this.nodeId],0):"after"===this.mode?new On([this.nodeId],1):void 0}_clone(){return new qn(this)}static fromJSON(t){return new qn(t)}get _isNodeSelection(){return!0}}var Bn="object"==typeof global&&global&&global.Object===Object&&global,jn="object"==typeof self&&self&&self.Object===Object&&self,Fn=Bn||jn||Function("return this")(),Un=Fn.Symbol;function Hn(t,e){for(var r=-1,n=null==t?0:t.length,s=Array(n);++r<n;)s[r]=e(t[r],r,t);return s}var Vn=Array.isArray,zn=Object.prototype,Gn=zn.hasOwnProperty,$n=zn.toString,Jn=Un?Un.toStringTag:void 0;var Kn=Object.prototype.toString;var Wn="[object Null]",Xn="[object Undefined]",Yn=Un?Un.toStringTag:void 0;function Zn(t){return null==t?void 0===t?Xn:Wn:Yn&&Yn in Object(t)?function(t){var e=Gn.call(t,Jn),r=t[Jn];try{t[Jn]=void 0;var n=!0}catch(t){}var s=$n.call(t);return n&&(e?t[Jn]=r:delete t[Jn]),s}(t):function(t){return Kn.call(t)}(t)}function Qn(t){return null!=t&&"object"==typeof t}var ts="[object Symbol]";function es(t){return"symbol"==typeof t||Qn(t)&&Zn(t)==ts}var rs=1/0,ns=Un?Un.prototype:void 0,ss=ns?ns.toString:void 0;function is(t){if("string"==typeof t)return t;if(Vn(t))return Hn(t,is)+"";if(es(t))return ss?ss.call(t):"";var e=t+"";return"0"==e&&1/t==-rs?"-0":e}function os(t){return null==t?"":is(t)}function as(t,e,r){var n=-1,s=t.length;e<0&&(e=-e>s?0:s+e),(r=r>s?s:r)<0&&(r+=s),s=e>r?0:r-e>>>0,e>>>=0;for(var i=Array(s);++n<s;)i[n]=t[n+e];return i}var ls=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function cs(t){return ls.test(t)}var hs="[\\ud800-\\udfff]",us="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",ds="\\ud83c[\\udffb-\\udfff]",ps="[^\\ud800-\\udfff]",fs="(?:\\ud83c[\\udde6-\\uddff]){2}",gs="[\\ud800-\\udbff][\\udc00-\\udfff]",ms="(?:"+us+"|"+ds+")"+"?",_s="[\\ufe0e\\ufe0f]?"+ms+("(?:\\u200d(?:"+[ps,fs,gs].join("|")+")[\\ufe0e\\ufe0f]?"+ms+")*"),ys="(?:"+[ps+us+"?",us,fs,gs,hs].join("|")+")",ws=RegExp(ds+"(?="+ds+")|"+ys+_s,"g");function bs(t){return cs(t)?function(t){return t.match(ws)||[]}(t):function(t){return t.split("")}(t)}var vs,Ss=(vs="toUpperCase",function(t){var e,r,n,s,i=cs(t=os(t))?bs(t):void 0,o=i?i[0]:t.charAt(0),a=i?(e=i,r=1,s=e.length,n=void 0===n?s:n,!r&&n>=s?e:as(e,r,n)).join(""):t.slice(1);return o[vs]()+a});function Es(t){return Ss(os(t).toLowerCase())}var Cs,xs=(Cs={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"},function(t){return null==Cs?void 0:Cs[t]}),Ns=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ts=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var Ps=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var Is=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var Os="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",As="["+Os+"]",Ds="\\d+",Ls="[\\u2700-\\u27bf]",ks="[a-z\\xdf-\\xf6\\xf8-\\xff]",Ms="[^\\ud800-\\udfff"+Os+Ds+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",Rs="(?:\\ud83c[\\udde6-\\uddff]){2}",qs="[\\ud800-\\udbff][\\udc00-\\udfff]",Bs="[A-Z\\xc0-\\xd6\\xd8-\\xde]",js="(?:"+ks+"|"+Ms+")",Fs="(?:"+Bs+"|"+Ms+")",Us="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",Hs="[\\ufe0e\\ufe0f]?"+Us+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",Rs,qs].join("|")+")[\\ufe0e\\ufe0f]?"+Us+")*"),Vs="(?:"+[Ls,Rs,qs].join("|")+")"+Hs,zs=RegExp([Bs+"?"+ks+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[As,Bs,"$"].join("|")+")",Fs+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[As,Bs+js,"$"].join("|")+")",Bs+"?"+js+"+(?:['’](?:d|ll|m|re|s|t|ve))?",Bs+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ds,Vs].join("|"),"g");function Gs(t,e,r){return t=os(t),void 0===(e=r?void 0:e)?function(t){return Is.test(t)}(t)?function(t){return t.match(zs)||[]}(t):function(t){return t.match(Ps)||[]}(t):t.match(e)||[]}var $s=RegExp("['’]","g");var Js,Ks=(Js=function(t,e,r){return e=e.toLowerCase(),t+(r?Es(e):e)},function(t){return function(t,e,r,n){var s=-1,i=null==t?0:t.length;for(n&&i&&(r=t[++s]);++s<i;)r=e(r,t[s],s,t);return r}(Gs(function(t){return(t=os(t))&&t.replace(Ns,xs).replace(Ts,"")}(t).replace($s,"")),Js,"")});function Ws(t,e){return t===e||t!=t&&e!=e}function Xs(t,e){for(var r=t.length;r--;)if(Ws(t[r][0],e))return r;return-1}var Ys=Array.prototype.splice;function Zs(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Qs(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}Zs.prototype.clear=function(){this.__data__=[],this.size=0},Zs.prototype.delete=function(t){var e=this.__data__,r=Xs(e,t);return!(r<0||(r==e.length-1?e.pop():Ys.call(e,r,1),--this.size,0))},Zs.prototype.get=function(t){var e=this.__data__,r=Xs(e,t);return r<0?void 0:e[r][1]},Zs.prototype.has=function(t){return Xs(this.__data__,t)>-1},Zs.prototype.set=function(t,e){var r=this.__data__,n=Xs(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var ti="[object AsyncFunction]",ei="[object Function]",ri="[object GeneratorFunction]",ni="[object Proxy]";function si(t){if(!Qs(t))return!1;var e=Zn(t);return e==ei||e==ri||e==ti||e==ni}var ii,oi=Fn["__core-js_shared__"],ai=(ii=/[^.]+$/.exec(oi&&oi.keys&&oi.keys.IE_PROTO||""))?"Symbol(src)_1."+ii:"";var li=Function.prototype.toString;function ci(t){if(null!=t){try{return li.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var hi=/^\[object .+?Constructor\]$/,ui=Function.prototype,di=Object.prototype,pi=ui.toString,fi=di.hasOwnProperty,gi=RegExp("^"+pi.call(fi).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function mi(t){return!(!Qs(t)||ai&&ai in t)&&(si(t)?gi:hi).test(ci(t))}function _i(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return mi(r)?r:void 0}var yi=_i(Fn,"Map"),wi=_i(Object,"create");var bi="__lodash_hash_undefined__",vi=Object.prototype.hasOwnProperty;var Si=Object.prototype.hasOwnProperty;var Ei="__lodash_hash_undefined__";function Ci(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function xi(t,e){var r,n,s=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?s["string"==typeof e?"string":"hash"]:s.map}function Ni(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ci.prototype.clear=function(){this.__data__=wi?wi(null):{},this.size=0},Ci.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Ci.prototype.get=function(t){var e=this.__data__;if(wi){var r=e[t];return r===bi?void 0:r}return vi.call(e,t)?e[t]:void 0},Ci.prototype.has=function(t){var e=this.__data__;return wi?void 0!==e[t]:Si.call(e,t)},Ci.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=wi&&void 0===e?Ei:e,this},Ni.prototype.clear=function(){this.size=0,this.__data__={hash:new Ci,map:new(yi||Zs),string:new Ci}},Ni.prototype.delete=function(t){var e=xi(this,t).delete(t);return this.size-=e?1:0,e},Ni.prototype.get=function(t){return xi(this,t).get(t)},Ni.prototype.has=function(t){return xi(this,t).has(t)},Ni.prototype.set=function(t,e){var r=xi(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var Ti=200;function Pi(t){var e=this.__data__=new Zs(t);this.size=e.size}Pi.prototype.clear=function(){this.__data__=new Zs,this.size=0},Pi.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Pi.prototype.get=function(t){return this.__data__.get(t)},Pi.prototype.has=function(t){return this.__data__.has(t)},Pi.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Zs){var n=r.__data__;if(!yi||n.length<Ti-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Ni(n)}return r.set(t,e),this.size=r.size,this};var Ii=function(){try{var t=_i(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function Oi(t,e,r){"__proto__"==e&&Ii?Ii(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Ai=Object.prototype.hasOwnProperty;function Di(t,e,r){var n=t[e];Ai.call(t,e)&&Ws(n,r)&&(void 0!==r||e in t)||Oi(t,e,r)}function Li(t,e,r,n){var s=!r;r||(r={});for(var i=-1,o=e.length;++i<o;){var a=e[i],l=n?n(r[a],t[a],a,r,t):void 0;void 0===l&&(l=t[a]),s?Oi(r,a,l):Di(r,a,l)}return r}var ki="[object Arguments]";function Mi(t){return Qn(t)&&Zn(t)==ki}var Ri=Object.prototype,qi=Ri.hasOwnProperty,Bi=Ri.propertyIsEnumerable,ji=Mi(function(){return arguments}())?Mi:function(t){return Qn(t)&&qi.call(t,"callee")&&!Bi.call(t,"callee")};var Fi="object"==typeof t&&t&&!t.nodeType&&t,Ui=Fi&&"object"==typeof module&&module&&!module.nodeType&&module,Hi=Ui&&Ui.exports===Fi?Fn.Buffer:void 0,Vi=(Hi?Hi.isBuffer:void 0)||function(){return!1},zi=9007199254740991,Gi=/^(?:0|[1-9]\d*)$/;function $i(t,e){var r=typeof t;return!!(e=null==e?zi:e)&&("number"==r||"symbol"!=r&&Gi.test(t))&&t>-1&&t%1==0&&t<e}var Ji=9007199254740991;function Ki(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Ji}var Wi={};function Xi(t){return function(e){return t(e)}}Wi["[object Float32Array]"]=Wi["[object Float64Array]"]=Wi["[object Int8Array]"]=Wi["[object Int16Array]"]=Wi["[object Int32Array]"]=Wi["[object Uint8Array]"]=Wi["[object Uint8ClampedArray]"]=Wi["[object Uint16Array]"]=Wi["[object Uint32Array]"]=!0,Wi["[object Arguments]"]=Wi["[object Array]"]=Wi["[object ArrayBuffer]"]=Wi["[object Boolean]"]=Wi["[object DataView]"]=Wi["[object Date]"]=Wi["[object Error]"]=Wi["[object Function]"]=Wi["[object Map]"]=Wi["[object Number]"]=Wi["[object Object]"]=Wi["[object RegExp]"]=Wi["[object Set]"]=Wi["[object String]"]=Wi["[object WeakMap]"]=!1;var Yi="object"==typeof t&&t&&!t.nodeType&&t,Zi=Yi&&"object"==typeof module&&module&&!module.nodeType&&module,Qi=Zi&&Zi.exports===Yi&&Bn.process,to=function(){try{var t=Zi&&Zi.require&&Zi.require("util").types;return t||Qi&&Qi.binding&&Qi.binding("util")}catch(t){}}(),eo=to&&to.isTypedArray,ro=eo?Xi(eo):function(t){return Qn(t)&&Ki(t.length)&&!!Wi[Zn(t)]},no=Object.prototype.hasOwnProperty;function so(t,e){var r=Vn(t),n=!r&&ji(t),s=!r&&!n&&Vi(t),i=!r&&!n&&!s&&ro(t),o=r||n||s||i,a=o?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],l=a.length;for(var c in t)!e&&!no.call(t,c)||o&&("length"==c||s&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||$i(c,l))||a.push(c);return a}var io=Object.prototype;function oo(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||io)}function ao(t,e){return function(r){return t(e(r))}}var lo=ao(Object.keys,Object),co=Object.prototype.hasOwnProperty;function ho(t){return null!=t&&Ki(t.length)&&!si(t)}function uo(t){return ho(t)?so(t):function(t){if(!oo(t))return lo(t);var e=[];for(var r in Object(t))co.call(t,r)&&"constructor"!=r&&e.push(r);return e}(t)}var po=Object.prototype.hasOwnProperty;function fo(t){if(!Qs(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=oo(t),r=[];for(var n in t)("constructor"!=n||!e&&po.call(t,n))&&r.push(n);return r}function go(t){return ho(t)?so(t,!0):fo(t)}var mo="object"==typeof t&&t&&!t.nodeType&&t,_o=mo&&"object"==typeof module&&module&&!module.nodeType&&module,yo=_o&&_o.exports===mo?Fn.Buffer:void 0,wo=yo?yo.allocUnsafe:void 0;function bo(t,e){if(e)return t.slice();var r=t.length,n=wo?wo(r):new t.constructor(r);return t.copy(n),n}function vo(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}function So(){return[]}var Eo=Object.prototype.propertyIsEnumerable,Co=Object.getOwnPropertySymbols,xo=Co?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,s=0,i=[];++r<n;){var o=t[r];e(o,r,t)&&(i[s++]=o)}return i}(Co(t),function(e){return Eo.call(t,e)}))}:So;function No(t,e){for(var r=-1,n=e.length,s=t.length;++r<n;)t[s+r]=e[r];return t}var To=ao(Object.getPrototypeOf,Object),Po=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)No(e,xo(t)),t=To(t);return e}:So;function Io(t,e,r){var n=e(t);return Vn(t)?n:No(n,r(t))}function Oo(t){return Io(t,uo,xo)}function Ao(t){return Io(t,go,Po)}var Do=_i(Fn,"DataView"),Lo=_i(Fn,"Promise"),ko=_i(Fn,"Set"),Mo=_i(Fn,"WeakMap"),Ro=ci(Do),qo=ci(yi),Bo=ci(Lo),jo=ci(ko),Fo=ci(Mo),Uo=Zn;(Do&&"[object DataView]"!=Uo(new Do(new ArrayBuffer(1)))||yi&&"[object Map]"!=Uo(new yi)||Lo&&"[object Promise]"!=Uo(Lo.resolve())||ko&&"[object Set]"!=Uo(new ko)||Mo&&"[object WeakMap]"!=Uo(new Mo))&&(Uo=function(t){var e=Zn(t),r="[object Object]"==e?t.constructor:void 0,n=r?ci(r):"";if(n)switch(n){case Ro:return"[object DataView]";case qo:return"[object Map]";case Bo:return"[object Promise]";case jo:return"[object Set]";case Fo:return"[object WeakMap]"}return e});var Ho=Uo,Vo=Object.prototype.hasOwnProperty;var zo=Fn.Uint8Array;function Go(t){var e=new t.constructor(t.byteLength);return new zo(e).set(new zo(t)),e}var $o=/\w*$/;var Jo=Un?Un.prototype:void 0,Ko=Jo?Jo.valueOf:void 0;function Wo(t,e){var r=e?Go(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var Xo="[object Boolean]",Yo="[object Date]",Zo="[object Map]",Qo="[object Number]",ta="[object RegExp]",ea="[object Set]",ra="[object String]",na="[object Symbol]",sa="[object ArrayBuffer]",ia="[object DataView]",oa="[object Float32Array]",aa="[object Float64Array]",la="[object Int8Array]",ca="[object Int16Array]",ha="[object Int32Array]",ua="[object Uint8Array]",da="[object Uint8ClampedArray]",pa="[object Uint16Array]",fa="[object Uint32Array]";function ga(t,e,r){var n,s,i,o=t.constructor;switch(e){case sa:return Go(t);case Xo:case Yo:return new o(+t);case ia:return function(t,e){var r=e?Go(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case oa:case aa:case la:case ca:case ha:case ua:case da:case pa:case fa:return Wo(t,r);case Zo:return new o;case Qo:case ra:return new o(t);case ta:return(i=new(s=t).constructor(s.source,$o.exec(s))).lastIndex=s.lastIndex,i;case ea:return new o;case na:return n=t,Ko?Object(Ko.call(n)):{}}}var ma=Object.create,_a=function(){function t(){}return function(e){if(!Qs(e))return{};if(ma)return ma(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();function ya(t){return"function"!=typeof t.constructor||oo(t)?{}:_a(To(t))}var wa="[object Map]";var ba=to&&to.isMap,va=ba?Xi(ba):function(t){return Qn(t)&&Ho(t)==wa},Sa="[object Set]";var Ea=to&&to.isSet,Ca=Ea?Xi(Ea):function(t){return Qn(t)&&Ho(t)==Sa},xa=1,Na=2,Ta=4,Pa="[object Arguments]",Ia="[object Function]",Oa="[object GeneratorFunction]",Aa="[object Object]",Da={};function La(t,e,r,n,s,i){var o,a=e&xa,l=e&Na,c=e&Ta;if(r&&(o=s?r(t,n,s,i):r(t)),void 0!==o)return o;if(!Qs(t))return t;var h=Vn(t);if(h){if(o=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&Vo.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!a)return vo(t,o)}else{var u=Ho(t),d=u==Ia||u==Oa;if(Vi(t))return bo(t,a);if(u==Aa||u==Pa||d&&!s){if(o=l||d?{}:ya(t),!a)return l?function(t,e){return Li(t,Po(t),e)}(t,function(t,e){return t&&Li(e,go(e),t)}(o,t)):function(t,e){return Li(t,xo(t),e)}(t,function(t,e){return t&&Li(e,uo(e),t)}(o,t))}else{if(!Da[u])return s?t:{};o=ga(t,u,a)}}i||(i=new Pi);var p=i.get(t);if(p)return p;if(i.set(t,o),Ca(t))return t.forEach(function(n){o.add(La(n,e,r,n,t,i))}),o;if(va(t))return t.forEach(function(n,s){o.set(s,La(n,e,r,s,t,i))}),o;var f=c?l?Ao:Oo:l?keysIn:uo,g=h?void 0:f(t);return function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););}(g||t,function(n,s){g&&(n=t[s=n]),Di(o,s,La(n,e,r,s,t,i))}),o}Da[Pa]=Da["[object Array]"]=Da["[object ArrayBuffer]"]=Da["[object DataView]"]=Da["[object Boolean]"]=Da["[object Date]"]=Da["[object Float32Array]"]=Da["[object Float64Array]"]=Da["[object Int8Array]"]=Da["[object Int16Array]"]=Da["[object Int32Array]"]=Da["[object Map]"]=Da["[object Number]"]=Da[Aa]=Da["[object RegExp]"]=Da["[object Set]"]=Da["[object String]"]=Da["[object Symbol]"]=Da["[object Uint8Array]"]=Da["[object Uint8ClampedArray]"]=Da["[object Uint16Array]"]=Da["[object Uint32Array]"]=!0,Da["[object Error]"]=Da[Ia]=Da["[object WeakMap]"]=!1;var ka=4;function Ma(t){return La(t,ka)}var Ra=1,qa=4;var Ba=function(){return Fn.Date.now()},ja=NaN,Fa=/^\s+|\s+$/g,Ua=/^[-+]0x[0-9a-f]+$/i,Ha=/^0b[01]+$/i,Va=/^0o[0-7]+$/i,za=parseInt;function Ga(t){if("number"==typeof t)return t;if(es(t))return ja;if(Qs(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Qs(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Fa,"");var r=Ha.test(t);return r||Va.test(t)?za(t.slice(2),r?2:8):Ua.test(t)?ja:+t}var $a="Expected a function",Ja=Math.max,Ka=Math.min;function Wa(t,e,r){var n,s,i,o,a,l,c=0,h=!1,u=!1,d=!0;if("function"!=typeof t)throw new TypeError($a);function p(e){var r=n,i=s;return n=s=void 0,c=e,o=t.apply(i,r)}function f(t){var r=t-l;return void 0===l||r>=e||r<0||u&&t-c>=i}function g(){var t=Ba();if(f(t))return m(t);a=setTimeout(g,function(t){var r=e-(t-l);return u?Ka(r,i-(t-c)):r}(t))}function m(t){return a=void 0,d&&n?p(t):(n=s=void 0,o)}function _(){var t=Ba(),r=f(t);if(n=arguments,s=this,l=t,r){if(void 0===a)return function(t){return c=t,a=setTimeout(g,e),h?p(t):o}(l);if(u)return a=setTimeout(g,e),p(l)}return void 0===a&&(a=setTimeout(g,e)),o}return e=Ga(e)||0,Qs(r)&&(h=!!r.leading,i=(u="maxWait"in r)?Ja(Ga(r.maxWait)||0,e):i,d="trailing"in r?!!r.trailing:d),_.cancel=function(){void 0!==a&&clearTimeout(a),c=0,n=l=s=a=void 0},_.flush=function(){return void 0===a?o:m(Ba())},_}var Xa=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ya=/^\w*$/;function Za(t,e){if(Vn(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!es(t))||(Ya.test(t)||!Xa.test(t)||null!=e&&t in Object(e))}var Qa="Expected a function";function tl(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Qa);var r=function(){var n=arguments,s=e?e.apply(this,n):n[0],i=r.cache;if(i.has(s))return i.get(s);var o=t.apply(this,n);return r.cache=i.set(s,o)||i,o};return r.cache=new(tl.Cache||Ni),r}tl.Cache=Ni;var el=500;var rl,nl,sl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,il=/\\(\\)?/g,ol=(rl=tl(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(sl,function(t,r,n,s){e.push(n?s.replace(il,"$1"):r||t)}),e},function(t){return nl.size===el&&nl.clear(),t}),nl=rl.cache,rl);function al(t,e){return Vn(t)?t:Za(t,e)?[t]:ol(os(t))}var ll=1/0;function cl(t){if("string"==typeof t||es(t))return t;var e=t+"";return"0"==e&&1/t==-ll?"-0":e}function hl(t,e){for(var r=0,n=(e=al(e,t)).length;null!=t&&r<n;)t=t[cl(e[r++])];return r&&r==n?t:void 0}function ul(t,e,r){var n=null==t?void 0:hl(t,e);return void 0===n?r:n}var dl="__lodash_hash_undefined__";function pl(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Ni;++e<r;)this.add(t[e])}function fl(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function gl(t,e){return t.has(e)}pl.prototype.add=pl.prototype.push=function(t){return this.__data__.set(t,dl),this},pl.prototype.has=function(t){return this.__data__.has(t)};var ml=1,_l=2;function yl(t,e,r,n,s,i){var o=r&ml,a=t.length,l=e.length;if(a!=l&&!(o&&l>a))return!1;var c=i.get(t);if(c&&i.get(e))return c==e;var h=-1,u=!0,d=r&_l?new pl:void 0;for(i.set(t,e),i.set(e,t);++h<a;){var p=t[h],f=e[h];if(n)var g=o?n(f,p,h,e,t,i):n(p,f,h,t,e,i);if(void 0!==g){if(g)continue;u=!1;break}if(d){if(!fl(e,function(t,e){if(!gl(d,e)&&(p===t||s(p,t,r,n,i)))return d.push(e)})){u=!1;break}}else if(p!==f&&!s(p,f,r,n,i)){u=!1;break}}return i.delete(t),i.delete(e),u}function wl(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r}function bl(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var vl=1,Sl=2,El="[object Boolean]",Cl="[object Date]",xl="[object Error]",Nl="[object Map]",Tl="[object Number]",Pl="[object RegExp]",Il="[object Set]",Ol="[object String]",Al="[object Symbol]",Dl="[object ArrayBuffer]",Ll="[object DataView]",kl=Un?Un.prototype:void 0,Ml=kl?kl.valueOf:void 0;var Rl=1,ql=Object.prototype.hasOwnProperty;var Bl=1,jl="[object Arguments]",Fl="[object Array]",Ul="[object Object]",Hl=Object.prototype.hasOwnProperty;function Vl(t,e,r,n,s,i){var o=Vn(t),a=Vn(e),l=o?Fl:Ho(t),c=a?Fl:Ho(e),h=(l=l==jl?Ul:l)==Ul,u=(c=c==jl?Ul:c)==Ul,d=l==c;if(d&&Vi(t)){if(!Vi(e))return!1;o=!0,h=!1}if(d&&!h)return i||(i=new Pi),o||ro(t)?yl(t,e,r,n,s,i):function(t,e,r,n,s,i,o){switch(r){case Ll:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Dl:return!(t.byteLength!=e.byteLength||!i(new zo(t),new zo(e)));case El:case Cl:case Tl:return Ws(+t,+e);case xl:return t.name==e.name&&t.message==e.message;case Pl:case Ol:return t==e+"";case Nl:var a=wl;case Il:var l=n&vl;if(a||(a=bl),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;n|=Sl,o.set(t,e);var h=yl(a(t),a(e),n,s,i,o);return o.delete(t),h;case Al:if(Ml)return Ml.call(t)==Ml.call(e)}return!1}(t,e,l,r,n,s,i);if(!(r&Bl)){var p=h&&Hl.call(t,"__wrapped__"),f=u&&Hl.call(e,"__wrapped__");if(p||f){var g=p?t.value():t,m=f?e.value():e;return i||(i=new Pi),s(g,m,r,n,i)}}return!!d&&(i||(i=new Pi),function(t,e,r,n,s,i){var o=r&Rl,a=Oo(t),l=a.length;if(l!=Oo(e).length&&!o)return!1;for(var c=l;c--;){var h=a[c];if(!(o?h in e:ql.call(e,h)))return!1}var u=i.get(t);if(u&&i.get(e))return u==e;var d=!0;i.set(t,e),i.set(e,t);for(var p=o;++c<l;){var f=t[h=a[c]],g=e[h];if(n)var m=o?n(g,f,h,e,t,i):n(f,g,h,t,e,i);if(!(void 0===m?f===g||s(f,g,r,n,i):m)){d=!1;break}p||(p="constructor"==h)}if(d&&!p){var _=t.constructor,y=e.constructor;_!=y&&"constructor"in t&&"constructor"in e&&!("function"==typeof _&&_ instanceof _&&"function"==typeof y&&y instanceof y)&&(d=!1)}return i.delete(t),i.delete(e),d}(t,e,r,n,s,i))}function zl(t,e,r,n,s){return t===e||(null==t||null==e||!Qn(t)&&!Qn(e)?t!=t&&e!=e:Vl(t,e,r,n,zl,s))}var Gl=1,$l=2;function Jl(t,e,r,n){var s=r.length,i=s,o=!n;if(null==t)return!i;for(t=Object(t);s--;){var a=r[s];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++s<i;){var l=(a=r[s])[0],c=t[l],h=a[1];if(o&&a[2]){if(void 0===c&&!(l in t))return!1}else{var u=new Pi;if(n)var d=n(c,h,l,t,e,u);if(!(void 0===d?zl(h,c,Gl|$l,n,u):d))return!1}}return!0}function Kl(t){return t==t&&!Qs(t)}function Wl(t){for(var e=uo(t),r=e.length;r--;){var n=e[r],s=t[n];e[r]=[n,s,Kl(s)]}return e}function Xl(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}}function Yl(t,e){return null!=t&&e in Object(t)}function Zl(t,e){return null!=t&&function(t,e,r){for(var n=-1,s=(e=al(e,t)).length,i=!1;++n<s;){var o=cl(e[n]);if(!(i=null!=t&&r(t,o)))break;t=t[o]}return i||++n!=s?i:!!(s=null==t?0:t.length)&&Ki(s)&&$i(o,s)&&(Vn(t)||ji(t))}(t,e,Yl)}var Ql=1,tc=2;function ec(t){return t}function rc(t){return Za(t)?(e=cl(t),function(t){return null==t?void 0:t[e]}):function(t){return function(e){return hl(e,t)}}(t);var e}function nc(t){return"function"==typeof t?t:null==t?ec:"object"==typeof t?Vn(t)?(n=t[0],s=t[1],Za(n)&&Kl(s)?Xl(cl(n),s):function(t){var e=ul(t,n);return void 0===e&&e===s?Zl(t,n):zl(s,e,Ql|tc)}):1==(r=Wl(e=t)).length&&r[0][2]?Xl(r[0][0],r[0][1]):function(t){return t===e||Jl(t,e,r)}:rc(t);var e,r,n,s}function sc(t,e,r,n){for(var s=t.length,i=r+(n?1:-1);n?i--:++i<s;)if(e(t[i],i,t))return i;return-1}var ic=1/0,oc=1.7976931348623157e308;function ac(t){var e=function(t){return t?(t=Ga(t))===ic||t===-ic?(t<0?-1:1)*oc:t==t?t:0:0===t?t:0}(t),r=e%1;return e==e?r?e-r:e:0}var lc=Math.max;var cc,hc=(cc=function(t,e,r){var n=null==t?0:t.length;if(!n)return-1;var s=null==r?0:ac(r);return s<0&&(s=lc(n+s,0)),sc(t,nc(e),s)},function(t,e,r){var n=Object(t);if(!ho(t)){var s=nc(e);t=uo(t),e=function(t){return s(n[t],t,n)}}var i=cc(t,e,r);return i>-1?n[s?t[i]:i]:void 0});function uc(t,e){return t===e||Jl(t,e,Wl(e))}function dc(t,e,r){(void 0===r||Ws(t[e],r))&&(void 0!==r||e in t)||Oi(t,e,r)}var pc,fc=function(t,e,r){for(var n=-1,s=Object(t),i=r(t),o=i.length;o--;){var a=i[pc?o:++n];if(!1===e(s[a],a,s))break}return t};function gc(t){return Qn(t)&&ho(t)}var mc="[object Object]",_c=Function.prototype,yc=Object.prototype,wc=_c.toString,bc=yc.hasOwnProperty,vc=wc.call(Object);function Sc(t,e){if("__proto__"!=e)return t[e]}function Ec(t,e,r,n,s,i,o){var a=Sc(t,r),l=Sc(e,r),c=o.get(l);if(c)dc(t,r,c);else{var h,u=i?i(a,l,r+"",t,e,o):void 0,d=void 0===u;if(d){var p=Vn(l),f=!p&&Vi(l),g=!p&&!f&&ro(l);u=l,p||f||g?Vn(a)?u=a:gc(a)?u=vo(a):f?(d=!1,u=bo(l,!0)):g?(d=!1,u=Wo(l,!0)):u=[]:function(t){if(!Qn(t)||Zn(t)!=mc)return!1;var e=To(t);if(null===e)return!0;var r=bc.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&wc.call(r)==vc}(l)||ji(l)?(u=a,ji(a)?u=Li(h=a,go(h)):Qs(a)&&!si(a)||(u=ya(l))):d=!1}d&&(o.set(l,u),s(u,l,n,i,o),o.delete(l)),dc(t,r,u)}}function Cc(t,e,r,n,s){t!==e&&fc(e,function(i,o){if(Qs(i))s||(s=new Pi),Ec(t,e,o,r,Cc,n,s);else{var a=n?n(Sc(t,o),i,o+"",t,e,s):void 0;void 0===a&&(a=i),dc(t,o,a)}},go)}var xc=Math.max;function Nc(t,e,r){return e=xc(void 0===e?t.length-1:e,0),function(){for(var n=arguments,s=-1,i=xc(n.length-e,0),o=Array(i);++s<i;)o[s]=n[e+s];s=-1;for(var a=Array(e+1);++s<e;)a[s]=n[s];return a[e]=r(o),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(t,this,a)}}var Tc=Ii?function(t,e){return Ii(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:ec,Pc=800,Ic=16,Oc=Date.now;var Ac=function(t){var e=0,r=0;return function(){var n=Oc(),s=Ic-(n-r);if(r=n,s>0){if(++e>=Pc)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Tc);function Dc(t,e){return Ac(Nc(t,e,ec),t+"")}function Lc(t){return Dc(function(e,r){var n=-1,s=r.length,i=s>1?r[s-1]:void 0,o=s>2?r[2]:void 0;for(i=t.length>3&&"function"==typeof i?(s--,i):void 0,o&&function(t,e,r){if(!Qs(r))return!1;var n=typeof e;return!!("number"==n?ho(r)&&$i(e,r.length):"string"==n&&e in r)&&Ws(r[e],t)}(r[0],r[1],o)&&(i=s<3?void 0:i,s=1),e=Object(e);++n<s;){var a=r[n];a&&t(e,a,n,i)}return e})}var kc=Lc(function(t,e,r){Cc(t,e,r)}),Mc=Lc(function(t,e,r,n){Cc(t,e,r,n)});function Rc(t,e,r,n){if(!Qs(t))return t;for(var s=-1,i=(e=al(e,t)).length,o=i-1,a=t;null!=a&&++s<i;){var l=cl(e[s]),c=r;if(s!=o){var h=a[l];void 0===(c=n?n(h,l,a):void 0)&&(c=Qs(h)?h:$i(e[s+1])?[]:{})}Di(a,l,c),a=a[l]}return t}function qc(t,e){return function(t,e,r){for(var n=-1,s=e.length,i={};++n<s;){var o=e[n],a=hl(t,o);r(a,o)&&Rc(i,al(o,t),a)}return i}(t,e,function(e,r){return Zl(t,r)})}var Bc=Un?Un.isConcatSpreadable:void 0;function jc(t){return Vn(t)||ji(t)||!!(Bc&&t&&t[Bc])}function Fc(t){return(null==t?0:t.length)?function t(e,r,n,s,i){var o=-1,a=e.length;for(n||(n=jc),i||(i=[]);++o<a;){var l=e[o];r>0&&n(l)?r>1?t(l,r-1,n,s,i):No(i,l):s||(i[i.length]=l)}return i}(t,1):[]}var Uc=function(t){return Ac(Nc(t,void 0,Fc),t+"")}(function(t,e){return null==t?{}:qc(t,e)});function Hc(t,e,r,n){return n="function"==typeof n?n:void 0,null==t?t:Rc(t,e,r,n)}function Vc(t){return t!=t}function zc(t,e){return!!(null==t?0:t.length)&&function(t,e,r){return e==e?function(t,e,r){for(var n=r-1,s=t.length;++n<s;)if(t[n]===e)return n;return-1}(t,e,r):sc(t,Vc,r)}(t,e,0)>-1}function Gc(t,e,r){for(var n=-1,s=null==t?0:t.length;++n<s;)if(r(e,t[n]))return!0;return!1}var $c=ko&&1/bl(new ko([,-0]))[1]==1/0?function(t){return new ko(t)}:function(){},Jc=200;function Kc(t,e){return null==(t=function(t,e){return e.length<2?t:hl(t,as(e,0,-1))}(t,e=al(e,t)))||delete t[cl((r=e,n=null==r?0:r.length,n?r[n-1]:void 0))];var r,n}var Wc=200;var Xc=Dc(function(t,e){return gc(t)?function(t,e,r,n){var s=-1,i=zc,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;r&&(e=Hn(e,Xi(r))),n?(i=Gc,o=!1):e.length>=Wc&&(i=gl,o=!1,e=new pl(e));t:for(;++s<a;){var h=t[s],u=null==r?h:r(h);if(h=n||0!==h?h:0,o&&u==u){for(var d=c;d--;)if(e[d]===u)continue t;l.push(h)}else i(e,u,n)||l.push(h)}return l}(t,e):[]});var Yc=function(t,e){return function(r,n){if(null==r)return r;if(!ho(r))return t(r,n);for(var s=r.length,i=e?s:-1,o=Object(r);(e?i--:++i<s)&&!1!==n(o[i],i,o););return r}}(function(t,e){return t&&fc(t,e,uo)});function Zc(t,e){if(t!==e){var r=void 0!==t,n=null===t,s=t==t,i=es(t),o=void 0!==e,a=null===e,l=e==e,c=es(e);if(!a&&!c&&!i&&t>e||i&&o&&l&&!a&&!c||n&&o&&l||!r&&l||!s)return 1;if(!n&&!i&&!c&&t<e||c&&r&&s&&!n&&!i||a&&r&&s||!o&&s||!l)return-1}return 0}function Qc(t,e,r){var n=-1;return e=Hn(e.length?e:[ec],Xi(nc)),function(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}(function(t,e){var r=-1,n=ho(t)?Array(t.length):[];return Yc(t,function(t,s,i){n[++r]=e(t,s,i)}),n}(t,function(t,r,s){return{criteria:Hn(e,function(e){return e(t)}),index:++n,value:t}}),function(t,e){return function(t,e,r){for(var n=-1,s=t.criteria,i=e.criteria,o=s.length,a=r.length;++n<o;){var l=Zc(s[n],i[n]);if(l)return n>=a?l:l*("desc"==r[n]?-1:1)}return t.index-e.index}(t,e,r)})}function th(t){return La(t,Ra|qa,r="function"==typeof(r=(t=>{if(e.inBrowser&&t instanceof window.File)return t}))?r:void 0);var r}function eh(t){return Boolean(t)&&t.constructor==={}.constructor}function rh(t,e){if(t===e)return!0;if(p(t)&&p(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!rh(t[r],e[r]))return!1;return!0}if(eh(t)&&eh(e)){let r=Object.keys(t).sort();if(!rh(r,Object.keys(e).sort()))return!1;for(let n=0;n<r.length;n++){let s=r[n];if(!rh(t[s],e[s]))return!1}return!0}return!1}class nh extends Tn{constructor(t,e,r,n){if(super(),1===arguments.length){let s=arguments[0];t=s.customType,e=s.data,r=s.nodeId,n=s.surfaceId}if(!t)throw new Error("'customType' is required");if(!r)throw new Error("'nodeId' is required");this.customType=t,this.data=e||{},this.nodeId=r,this.surfaceId=n}isCustomSelection(){return!0}getType(){return"custom"}getCustomType(){return this.customType}getNodeId(){return this.nodeId}toJSON(){let t={type:"custom",customType:this.customType,nodeId:this.nodeId,data:th(this.data)};return this.surfaceId&&(t.surfaceId=this.surfaceId),t}toString(){return["CustomSelection(",this.customType,", ",JSON.stringify(this.data),")"].join("")}equals(t){return Tn.prototype.equals.call(this,t)&&t.isCustomSelection()&&rh(this.data,t.data)}_clone(){return new nh(this)}get _isCustomSelection(){return!0}static fromJSON(t){return new nh(t)}}function sh(t,e,r){let n=t.get(r),s=e[0];for(;n;){let t=n.getParent();if(t&&t.id===s)return n;n=t}}function ih(t,e,r){return sh(t,e,r).getPosition()}function oh(t){if(!t)return Tn.nullSelection;switch(t.type){case"property":return An.fromJSON(t);case"container":return Mn.fromJSON(t);case"node":return qn.fromJSON(t);case"custom":return nh.fromJSON(t);default:return Tn.nullSelection}}function ah(t,e,r){if(r.isNodeCoordinate())return 0===r.offset;let n=sh(t,e,r.path[0]);if(n.isText())return 0===r.offset;if(n.isList()){let t=r.path[0];return n.items[0]===t&&0===r.offset}return!1}function lh(t,e,r){if(r.isNodeCoordinate())return r.offset>0;let n=sh(t,e,r.path[0]);if(n.isText())return r.offset>=n.getLength();if(n.isList()){let e=r.path[0],s=t.get(e);return O(n.items)===e&&r.offset===s.getLength()}return!1}function ch(t,e,r,n){let{isEntirelySelected:s}=function(t,e,r,n){let s=!0,i=!0;(e.isText()||e.isListItem())&&(r&&0!==r.offset&&(s=!1),n&&n.offset<e.getLength()&&(i=!1));return{isFirst:s,isLast:i,isEntirelySelected:s&&i}}(0,e,r,n);return s}function hh(t,e,r,n){if(e.isText()){let s=0;if("after"===n){s=e.getText().length}t.setSelection({type:"property",path:e.getPath(),startOffset:s,containerPath:r})}else if(e.isList()){let s,i;"after"===n?i=(s=e.getLastItem()).getLength():(s=e.getFirstItem(),i=0),t.setSelection({type:"property",path:s.getPath(),startOffset:i,containerPath:r})}else t.setSelection({type:"node",containerPath:r,nodeId:e.id})}function uh(t,e,r){t.setSelection(dh({doc:t,nodeId:e,containerPath:r}))}function dh({doc:t,nodeId:e,containerPath:r,mode:n,reverse:s,surfaceId:i}){let o=t.get(e);if(!o)return Tn.nullSelection;if((o=sh(t,r,e)).isText())return new An({path:o.getPath(),startOffset:"after"===n?o.getLength():0,endOffset:"before"===n?0:o.getLength(),reverse:s,containerPath:r,surfaceId:i});if(o.isList()&&o.getLength()>0){let t=o.getFirstItem(),e=o.getLastItem(),a={path:t.getPath(),offset:0},l={path:e.getPath(),offset:e.getLength()};return"after"===n?a=l:"before"===n&&(l=a),new Mn({startPath:a.path,startOffset:a.offset,endPath:l.path,endOffset:l.offset,reverse:s,containerPath:r,surfaceId:i})}return new qn({nodeId:e,mode:n,reverse:s,containerPath:r,surfaceId:i})}function ph(t,e){if(e.grabFocus())return!0;let r=e.find(".sc-surface");if(r){if(r._isTextPropertyEditor){const e=t.getDocument(),n=r.getPath(),s=e.get(n,"strict");return t.setSelection({type:"property",path:n,startOffset:s.length,surfaceId:r.id}),!0}if(r._isContainerEditor){let e=t.getDocument(),n=r.getContainerPath(),s=e.get();if(s.length>0){hh(t,e.get(s[0]),n,"after")}return!0}}return!1}function fh(t,e){return t&&e&&!t.surfaceId&&!e.isNull()&&(t.containerPath=t.containerPath||e.containerPath,t.surfaceId=t.surfaceId||e.surfaceId),t}function gh(t,e){let r=e.containerPath,n=ih(t,r,e.start.path[0]),s=ih(t,r,e.end.path[0]);return t.get(r).slice(n,s+1)}var mh=Object.freeze({fromJSON:oh,isFirst:ah,isLast:lh,isEntirelySelected:ch,setCursor:hh,selectNode:uh,createNodeSelection:dh,stepIntoIsolatedNode:ph,augmentSelection:fh,getNodeIdsCoveredByContainerSelection:gh});class _h{constructor(t){t&&(this.__root__=t)}contains(t){return Boolean(this.getRoot()[t])}getRoot(){return this.__root__?this.__root__:this}get(t){if(t){if(n(t)){let e=t;return this.getRoot()[e]}if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),!p(t))throw new Error("Illegal argument for PathObject.get()");return ul(this.getRoot(),t)}}set(t,e){if(!t)throw new Error("Illegal argument: PathObject.set(>path<, value) - path is mandatory.");if(n(t)){let r=t;this.getRoot()[r]=e}else Hc(this.getRoot(),t,e)}delete(t){if(n(t)){let e=t;delete this.getRoot()[e]}else if(1===t.length)delete this.getRoot()[t[0]];else{if(!function(t,e){return null==t||Kc(t,e)}(this.getRoot(),t))throw new Error("Could not delete property at path"+t)}}clear(){var t=this.getRoot();for(var e in t)t.hasOwnProperty(e)&&delete t[e]}}_h.prototype._isPathObject=!0;class yh extends Error{constructor(t,e){super("Conflict: "+JSON.stringify(t)+" vs "+JSON.stringify(e)),this.a=t,this.b=e}}const wh="insert",bh="delete";class vh{constructor(t){if(!t||void 0===t.type||void 0===t.pos||void 0===t.str)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.pos=t.pos,this.str=t.str,!this.isInsert()&&!this.isDelete())throw new Error("Illegal type.");if(!n(this.str))throw new Error("Illegal argument: expecting string.");if(!s(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}apply(t){if(this.isEmpty())return t;if(this.type===wh){if(t.length<this.pos)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,0,this.str):t.slice(0,this.pos).concat(this.str).concat(t.slice(this.pos))}if(t.length<this.pos+this.str.length)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,this.str.length):t.slice(0,this.pos).concat(t.slice(this.pos+this.str.length))}clone(){return new vh(this)}isNOP(){return"NOP"===this.type||0===this.str.length}isInsert(){return this.type===wh}isDelete(){return this.type===bh}getLength(){return this.str.length}invert(){var t={type:this.isInsert()?bh:wh,pos:this.pos,str:this.str};return new vh(t)}hasConflict(t){return Sh(this,t)}isEmpty(){return 0===this.str.length}toJSON(){return{type:this.type,pos:this.pos,str:this.str}}toString(){return["(",this.isInsert()?wh:bh,",",this.pos,",'",this.str,"')"].join("")}get _isOperation(){return!0}get _isTextOperation(){return!0}static transform(t,e,r){return function(t,e,r){if((r=r||{})["no-conflict"]&&Sh(t,e))throw new yh(t,e);t.type===wh&&e.type===wh?function(t,e){t.pos===e.pos?e.pos+=t.str.length:t.pos<e.pos?e.pos+=t.str.length:t.pos+=e.str.length}(t,e):t.type===bh&&e.type===bh?function t(e,r,n){if(e.pos>r.pos)return t(r,e,!n);if(e.pos===r.pos&&e.str.length>r.str.length)return t(r,e,!n);if(r.pos<e.pos+e.str.length){var s=r.pos-e.pos,i=e.str.length-s,o=s+r.str.length;e.str=e.str.slice(0,s)+e.str.slice(o),r.str=r.str.slice(i),r.pos-=s}else r.pos-=e.str.length}(t,e,!0):function t(e,r){if(e.type===bh)return t(r,e);if(e.pos<=r.pos)r.pos+=e.str.length;else if(e.pos>=r.pos+r.str.length)e.pos-=r.str.length;else{var n=e.pos-r.pos;r.str=r.str.slice(0,n)+e.str+r.str.slice(n),e.str=""}}(t,e);return[t,e]}(t,e,r)}static hasConflict(t,e){return Sh(t,e)}static Insert(t,e){return new vh({type:wh,pos:t,str:e})}static Delete(t,e){return new vh({type:bh,pos:t,str:e})}static fromJSON(t){return new vh(t)}static get INSERT(){return wh}static get DELETE(){return bh}}function Sh(t,e){return t.type===wh&&e.type===wh?t.pos===e.pos:t.type===bh&&e.type===bh?!(t.pos>=e.pos+e.str.length||e.pos>=t.pos+t.str.length):(t.type===bh?(r=t,n=e):(r=e,n=t),n.pos>=r.pos&&n.pos<r.pos+r.str.length);var r,n}const Eh="NOP",Ch="delete",xh="insert";class Nh{constructor(t){if(!t||!t.type)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.type!==Eh){if(this.type!==xh&&this.type!==Ch)throw new Error("Illegal type.");if(this.pos=t.pos,this.val=t.val,!s(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}}apply(t){if(this.type===Eh)return t;if(this.type===xh){if(t.length<this.pos)throw new Error("Provided array is too small.");return t.splice(this.pos,0,this.val),t}if(t.length<this.pos)throw new Error("Provided array is too small.");if(!rh(t[this.pos],this.val))throw Error("Unexpected value at position "+this.pos+". Expected "+this.val+", found "+t[this.pos]);return t.splice(this.pos,1),t}clone(){var t={type:this.type,pos:this.pos,val:th(this.val)};return new Nh(t)}invert(){var t=this.toJSON();return this.type===Eh?t.type=Eh:this.type===xh?t.type=Ch:t.type=xh,new Nh(t)}hasConflict(t){return Nh.hasConflict(this,t)}toJSON(){var t={type:this.type};return this.type===Eh?t:(t.pos=this.pos,t.val=th(this.val),t)}isInsert(){return this.type===xh}isDelete(){return this.type===Ch}getOffset(){return this.pos}getValue(){return this.val}isNOP(){return this.type===Eh}toString(){return["(",this.isInsert()?xh:Ch,",",this.getOffset(),",'",this.getValue(),"')"].join("")}get _isOperation(){return!0}get _isArrayOperation(){return!0}static transform(t,e,r){return Ph(t,e,r)}static hasConflict(t,e){return Th(t,e)}static Insert(t,e){return new Nh({type:xh,pos:t,val:e})}static Delete(t,e){return new Nh({type:Ch,pos:t,val:e})}static Nop(){return new Nh({type:Eh})}static fromJSON(t){return new Nh(t)}static get NOP(){return Eh}static get DELETE(){return Ch}static get INSERT(){return xh}}function Th(t,e){return t.type!==Eh&&e.type!==Eh&&(t.type===xh&&e.type===xh&&t.pos===e.pos)}var Ph=function(t,e,r={}){if(r["no-conflict"]&&Th(t,e))throw new yh(t,e);return t.type===Eh||e.type===Eh||(t.type===xh&&e.type===xh?function(t,e){t.pos===e.pos?e.pos+=1:t.pos<e.pos?e.pos+=1:t.pos+=1}(t,e):t.type===Ch&&e.type===Ch?function(t,e,r={}){t.pos===e.pos?(t.val!==e.val&&console.error("FIXME: transforming array delete-delete at the same position but with different values."),r.rebase||(e.type=Eh,t.type=Eh)):t.pos<e.pos?e.pos-=1:t.pos-=1}(t,e,r):function(t,e,r={}){t.type===Ch&&([t,e]=[e,t]),r.rebase?t.pos<e.pos?e.pos+=1:t.pos>e.pos&&(t.pos-=1):t.pos<=e.pos?e.pos+=1:t.pos-=1}(t,e,r)),[t,e]};const Ih="shift";class Oh{constructor(t){if(!t||void 0===t.type)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.val=t.val,!this.isShift())throw new Error("Illegal type.");if(!s(this.val))throw new Error("Illegal argument: expecting number as shift value.")}apply(t){return t.offset=t.offset+this.val,t}isShift(){return this.type===Ih}isNOP(){switch(this.type){case Ih:return 0===this.val;default:return!1}}clone(){return new Oh(this)}invert(){let t;switch(this.type){case Ih:t={type:Ih,val:-this.val};break;default:throw new Error("Invalid type.")}return new Oh(t)}hasConflict(){return!1}toJSON(){return{type:this.type,val:this.val}}toString(){return["(",this.type,",",this.val,"')"].join("")}get _isOperation(){return!0}get _isCoordinateOperation(){return!0}static transform(t,e,r){return function(t,e,r={}){if(t.type!==Ih||e.type!==Ih)throw new Error("Illegal type");!function(t,e,r){r.rebase||(t.val+=e.val,e.val+=t.val)}(t,e,r);return[t,e]}(t,e,r)}static fromJSON(t){return new Oh(t)}static Shift(t){return new Oh({type:Ih,val:t})}static get SHIFT(){return Ih}}const Ah="NOP",Dh="create",Lh="delete",kh="update",Mh="set";class Rh{constructor(t){if(!t)throw new Error("Data of ObjectOperation is missing.");if(!t.type)throw new Error("Invalid data: type is mandatory.");if(this.type=t.type,t.type!==Ah){if(this.path=t.path,!t.path)throw new Error("Invalid data: path is mandatory.");if(this.type===Dh||this.type===Lh){if(!t.val)throw new Error("Invalid data: value is missing.");this.val=t.val}else if(this.type===kh){if(!t.diff)throw new Error("Invalid data: diff is mandatory for update operation.");if(this.diff=t.diff,t.diff._isTextOperation)this.propertyType="string";else if(t.diff._isArrayOperation)this.propertyType="array";else{if(!t.diff._isCoordinateOperation)throw new Error("Invalid data: unsupported operation type for incremental update.");this.propertyType="coordinate"}}else{if(this.type!==Mh)throw new Error("Invalid type: "+t.type);this.val=t.val,this.original=t.original}}}apply(t){if(this.type===Ah)return t;var e;if(e=t._isPathObject?t:new _h(t),this.type===Dh)return e.set(this.path,th(this.val)),t;if(this.type===Lh)e.delete(this.path,"strict");else if(this.type===kh){var r=this.diff;switch(this.propertyType){case"array":{let t=e.get(this.path);r.apply(t);break}case"string":{let t=e.get(this.path);i(t)&&(t=""),t=r.apply(t),e.set(this.path,t);break}case"coordinate":{let t=e.get(this.path);if(!t)throw new Error("No coordinate with path "+this.path);r.apply(t);break}default:throw new Error("Unsupported property type for incremental update: "+this.propertyType)}}else{if(this.type!==Mh)throw new Error("Invalid type.");e.set(this.path,th(this.val))}return t}clone(){var t={type:this.type,path:this.path};return this.val&&(t.val=th(this.val)),this.diff&&(t.diff=this.diff.clone()),new Rh(t)}isNOP(){return this.type===Ah||(this.type===kh?this.diff.isNOP():void 0)}isCreate(){return this.type===Dh}isDelete(){return this.type===Lh}isUpdate(t){return t?this.type===kh&&this.propertyType===t:this.type===kh}isSet(){return this.type===Mh}invert(){if(this.type===Ah)return new Rh({type:Ah});var t=new Rh(this);return this.type===Dh?t.type=Lh:this.type===Lh?t.type=Dh:this.type===kh?t.diff=this.diff.clone().invert():(t.val=this.original,t.original=this.val),t}hasConflict(t){return Rh.hasConflict(this,t)}toJSON(){if(this.type===Ah)return{type:Ah};var t={type:this.type,path:this.path};if(this.type===Dh||this.type===Lh)t.val=this.val;else if(this.type===kh){if(this.diff._isTextOperation)t.propertyType="string";else if(this.diff._isArrayOperation)t.propertyType="array";else{if(!this.diff._isCoordinateOperation)throw new Error("Invalid property type.");t.propertyType="coordinate"}t.diff=this.diff.toJSON()}else t.val=this.val,t.original=this.original;return t}getType(){return this.type}getPath(){return this.path}getValue(){return this.val}getOldValue(){return this.original}getValueOp(){return this.diff}toString(){switch(this.type){case Dh:return["(+,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case Lh:return["(-,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case kh:return["(>>,",JSON.stringify(this.path),this.propertyType,this.diff.toString(),")"].join("");case Mh:return["(=,",JSON.stringify(this.path),this.val,this.original,")"].join("");case Ah:return"NOP";default:throw new Error("Invalid type")}}static transform(t,e,r){return function(t,e,r={}){if(r["no-conflict"]&&qh(t,e))throw new yh(t,e);if(t.isNOP()||e.isNOP())return[t,e];rh(t.path,e.path)&&Xh[Wh[t.type]|Wh[e.type]](t,e,r);return[t,e]}(t,e,r)}static hasConflict(t,e){return qh(t,e)}static Create(t,e){var r;return r=n(t)?[t]:t,new Rh({type:Dh,path:r,val:e})}static Delete(t,e){var r;return r=n(t)?[t]:t,new Rh({type:Lh,path:r,val:e})}static Update(t,e){return new Rh({type:kh,path:t,diff:e})}static Set(t,e,r){return new Rh({type:Mh,path:t,val:th(r),original:th(e)})}static fromJSON(t){return"update"===(t=th(t)).type&&(t.diff=zh(t.propertyType,t.diff)),new Rh(t)}static get NOP(){return Ah}static get CREATE(){return Dh}static get DELETE(){return Lh}static get UPDATE(){return kh}static get SET(){return Mh}get _isOperation(){return!0}get _isObjectOperation(){return!0}}function qh(t,e){return t.type!==Ah&&e.type!==Ah&&rh(t.path,e.path)}function Bh(t,e,r={}){r.rebase||(t.type=Ah,e.type=Ah)}function jh(t,e,r={}){if(!r.rebase)throw new Error("Can not transform two concurring creates of the same property")}function Fh(t,e,r={}){if(!r.rebase)throw new Error("Illegal state: can not create and delete a value at the same time.")}function Uh(t,e,r={}){return function t(e,r,n,s={}){if(!s.rebase){if(e.type!==Lh)return t(r,e,!0,s);let i=zh(r.propertyType,r.diff);n?(e.val=i.apply(e.val),r.type=Ah):(e.type=Ah,r.type=Dh,r.val=i.apply(e.val))}}(t,e,!1,r)}function Hh(){throw new Error("Can not transform a concurring create and update of the same property")}function Vh(t,e,r={}){let n,s=zh(t.propertyType,t.diff),i=zh(e.propertyType,e.diff);switch(e.propertyType){case"string":n=vh.transform(s,i,r);break;case"array":n=Nh.transform(s,i,r);break;case"coordinate":n=Oh.transform(s,i,r);break;default:throw new Error("Unsupported property type for incremental update")}t.diff=n[0],e.diff=n[1]}function zh(t,e){if(e._isOperation)return e;switch(t){case"string":return vh.fromJSON(e);case"array":return Nh.fromJSON(e);case"coordinate":return Oh.fromJSON(e);default:throw new Error("Unsupported property type for incremental update.")}}function Gh(t,e,r={}){if(!r.rebase)throw new Error("Illegal state: can not create and set a value at the same time.")}function $h(t,e,r={}){return function t(e,r,n,s={}){if(e.type!==Lh)return t(r,e,!0,s);s.rebase||(n?(e.val=r.val,r.type=Ah):(e.type=Ah,r.type=Dh,r.original=void 0))}(t,e,!1,r)}function Jh(t,e,r={}){if(!r.rebase)throw new Error("Unresolvable conflict: update + set.")}function Kh(t,e,r={}){r.rebase||(t.type=Ah,e.original=t.val)}const Wh=(()=>{const t={};return t[Ah]=0,t[Dh]=1,t[Lh]=2,t[kh]=4,t[Mh]=8,t})(),Xh=(()=>{const t={};return t[2]=Bh,t[3]=Fh,t[6]=Uh,t[1]=jh,t[5]=Hh,t[4]=Vh,t[9]=Gh,t[10]=$h,t[12]=Jh,t[8]=Kh,t})();function Yh(t,e,r={}){!function(t,e,r={}){p(t)||(t=[t]);p(e)||(e=[e]);for(let n=0;n<t.length;n++){let s=t[n];for(let t=0;t<e.length;t++){let n=e[t];Qh(s,n,r)}}}(t,e,r)}function Zh(t,e,r){let n=t.clone();return tu(n,e,r)?n:t}function Qh(t,e,r={}){let n=r.immutableLeft,s=r.immutableRight;for(let i=0;i<t.ops.length;i++)for(let o=0;o<e.ops.length;o++){let a=t.ops[i],l=e.ops[o];n&&(a=a.clone()),s&&(l=l.clone()),Rh.transform(a,l,r)}n||(t.before&&tu(t.before.selection,e,r),t.after&&tu(t.after.selection,e,r)),s||(e.before&&tu(e.before.selection,t,r),e.after&&tu(e.after.selection,t,r))}function tu(t,e,r={}){if(!t||!t.isPropertySelection()&&!t.isContainerSelection())return!1;let n=e.ops,s=!1,i=t.isCollapsed();for(let e=0;e<n.length;e++){let o=n[e];s|=eu(t.start,o,r),i?(t.isContainerSelection()&&(t.end.path=t.start.path),t.end.offset=t.start.offset):s|=eu(t.end,o,r)}return s}function eu(t,e,r){if(!rh(e.path,t.path))return!1;let n=!1;if("update"===e.type&&"string"===e.propertyType){let r,s=e.diff;s.isInsert()&&s.pos<=t.offset?(r=t.offset+s.str.length,t.offset=r,n=!0):s.isDelete()&&s.pos<=t.offset&&(r=Math.max(s.pos,t.offset-s.str.length),t.offset=r,n=!0)}return n}var ru=Object.freeze({transformDocumentChange:Yh,transformSelection:Zh}),nu={insertedText:function(t,e,r){if(!r)return;var n=t.getIndex("annotations").get(e.path);for(let c=0;c<n.length;c++){let h=n[c];var s=e.offset,i=h.start.offset,o=h.end.offset,a=i,l=o;(s<i||s===i)&&(a+=r),(s<o||s===o&&!h.isInlineNode())&&(l+=r),a!==i&&t.set([h.id,"start","offset"],a),l!==o&&t.set([h.id,"end","offset"],l)}},deletedText:function(t,e,r,n){if(r===n)return;var s=t.getIndex("annotations").get(e),i=n-r;for(let e=0;e<s.length;e++){let d=s[e];var o=r,a=n,l=d.start.offset,c=d.end.offset,h=l,u=c;a<=l?(h-=i,u-=i,t.set([d.id,"start","offset"],h),t.set([d.id,"end","offset"],u)):(o<=l&&(h=l-Math.min(a-o,l-o)),o<=c&&(u=c-Math.min(a-o,c-o)),l!==c&&h===u?t.delete(d.id):(l!==h&&t.set([d.id,"start","offset"],h),c!==u&&t.set([d.id,"end","offset"],u)))}},transferAnnotations:function(t,e,r,n,s){var i=t.getIndex("annotations").get(e,r);for(let e=0;e<i.length;e++){let c=i[e];var o=r>c.start.offset&&r<c.end.offset,a=c.start.offset,l=c.end.offset;if(o){if(c.canSplit()){let e=c.toJSON();e.id=h(c.type+"_"),e.start.path=n,e.start.offset=s,e.end.path=n,e.end.offset=s+c.end.offset-r,t.create(e)}let e=c.start.offset,i=r;i===e?t.delete(c.id):(e!==a&&t.set([c.id,"start","offset"],e),i!==l&&t.set([c.id,"end","offset"],i))}else c.start.offset>=r&&(t.set([c.id,"start","path"],n),t.set([c.id,"start","offset"],s+c.start.offset-r),t.set([c.id,"end","path"],n),t.set([c.id,"end","offset"],s+c.end.offset-r))}},expandAnnotation:su,fuseAnnotation:function(t,e){if(!p(e)||e.length<2)throw new Error("fuseAnnotation(): at least two annotations are necessary.");let r,n;e.forEach(function(t,e){if(0===e)r=t.getSelection(),n=t.type;else{if(t.type!==n)throw new Error("fuseAnnotation(): all annotations must be of the same type.");r=r.expand(t.getSelection())}});for(var s=1;s<e.length;s++)t.delete(e[s].id);su(t,e[0],r),t.setSelection(r)},truncateAnnotation:function(t,e,r){if(!r||!r._isSelection)throw new Error('Argument "selection" is required.');if(!e||!e.isAnnotation())throw new Error('Argument "anno" is required and must be an annotation.');let n=e.getSelection().truncateWith(r);return e._updateRange(t,n),e}};function su(t,e,r){if(!r||!r._isSelection)throw new Error('Argument "selection" is required.');if(!e||!e.isAnnotation())throw new Error('Argument "anno" is required and must be an annotation.');let n=e.getSelection().expand(r);return e._updateRange(t,n),e}class iu{select(t){throw new Error("This method is abstract.")}clear(){throw new Error("This method is abstract")}create(t){throw new Error("This method is abstract.")}delete(t){throw new Error("This method is abstract.")}set(t,e,r,n){this.update(t,e,r,n)}update(t,e,r,n){throw new Error("This method is abstract.")}reset(t){this.clear(),this._initialize(t)}clone(){return new(0,this.constructor)}_initialize(t){f(t.getNodes(),function(t){this.select(t)&&this.create(t)}.bind(this))}}iu.create=function(t){var e=Object.assign(new iu,t);return e.clone=function(){return iu.create(t)},e},iu.filterByType=function(t){return function(e){return e.isInstanceOf(t)}};class ou extends iu{}function au(t,e){if(!t)return[];if(t.constructor.prototype.filter&&d(t.constructor.prototype.filter))return t.filter(e);let r=[];return f(t,(t,n)=>{e(t,n)&&r.push(t)}),r}function lu(t){return Array.prototype.concat.apply([],t)}function cu(t,e){if(!(e>0))throw new Error("'max' must be a positive number");let r=t.length;t=lu(t);let n=1;for(;n<e&&r<t.length;)r=t.length,t=lu(t),n++;return t}function hu(t,e,r){if(r=r||{},!e.isPropertySelection())return[];let n=e.getPath(),s=t.getIndex("annotations").get(n,e.start.offset,e.end.offset);return r.type&&(s=au(s,ou.filterByType(r.type))),s}function uu(t,e,r,n){if(!r)throw new Error("'containerPath' is required.");n=n||{};let s=t.getIndex("container-annotations"),i=[];return s&&(i=au(i=s.get(r,n.type),function(t){return e.overlaps(t.getSelection())})),i}function du(t,e){if(!e||e.isNull())return"";if(e.isPropertySelection()){return t.get(e.start.path).substring(e.start.offset,e.end.offset)}if(e.isContainerSelection()){let r=[],n=gh(t,e),s=n.length;for(let i=0;i<s;i++){let o=n[i],a=t.get(o);if(a.isText()){let t=a.getText();i===s-1&&(t=t.slice(0,e.end.offset)),0===i&&(t=t.slice(e.start.offset)),r.push(t)}}return r.join("\n")}}function pu(t,e){if(!e||!e.isPropertySelection())return[];const r=e.getPath();return au(t.getIndex("markers").get(r),function(t){return t.containsSelection(e)})}function fu(t,e){if(!e)return void console.warn("Invalid arguments");if(n(e)&&(e=t.get(e)),e.isText()){let r=t.getIndex("annotations").get(e.id);for(let e=0;e<r.length;e++)t.delete(r[e].id)}let r=e.getSchema();for(let n of r)if(n.isText()){let r=t.getAnnotations([e.id,n.name]);for(let e of r)fu(t,e)}t.delete(e.id);for(let n of r)if(n.isOwned()){let r=e[n.name];if(n.isArray()){let e=r;e.length>0&&(p(e[0])&&(e=cu(e,2)),e.forEach(e=>{fu(t,t.get(e))}))}else fu(t,t.get(r))}}function gu(t){let e=[],r=t.getDocument(),n=t.getSchema();for(let r of n)if(r.isReference()&&r.isOwned()||"file"===r.type){let n=t[r.name];e.push(s(n))}return e.push(t.toJSON()),f(t.getDocument().getIndex("annotations").get([t.id]),function(t){e.push(t.toJSON())}),lu(e).filter(Boolean);function s(t){if(!t)return null;if(p(t))return lu(t.map(s));{let e=t;if(!e)return null;let n=r.get(e);if(!n)return;return gu(n)}}}function mu(t,e,r){e||(e={path:r.path,offset:0});let n=e.path,s=t.get(n);if(r||(r={path:e.path,offset:s.length}),!In(e.path,r.path))throw new Error("start and end must be on one property");let i=e.offset;if(i<0)throw new Error("start offset must be >= 0");let o=r.offset;if(o>s.length)throw new Error("end offset must be smaller than the text length");t.update(n,{type:"delete",start:i,end:o}),t.getAnnotations(n).forEach(function(e){let r=e.start.offset,n=e.end.offset;n<=i||(r>=o?(t.update([e.id,"start"],{type:"shift",value:i-o}),t.update([e.id,"end"],{type:"shift",value:i-o})):r>=i&&n<=o?t.delete(e.id):r>=i&&n>=o?(r>i&&t.update([e.id,"start"],{type:"shift",value:i-r}),t.update([e.id,"end"],{type:"shift",value:i-o})):r<=i&&n<=o?t.update([e.id,"end"],{type:"shift",value:i-n}):r<i&&n>=o?t.update([e.id,"end"],{type:"shift",value:i-o}):console.warn("TODO: handle annotation update case."))})}function _u(t,e,r,n,s={}){let i,o;t!==e.getDocument()&&(e=t.get(e.id)),r?i=t.get(r.path[0]):r={path:(i=e.getItemAt(0)).getPath(),offset:0},n?o=t.get(n.path[0]):n={path:(o=e.getLastItem()).getPath(),offset:o.getLength()};let a=e.getItemPosition(i),l=e.getItemPosition(o);if(a===l)return void mu(t,r,n);a>l&&([r,n]=[n,r],[a,l]=[l,a],[i,o]=[o,i]);let c=ch(0,i,r,null),h=ch(0,o,null,n);h?(e.removeItemAt(l),fu(t,o)):mu(t,null,n);let u=e.getItems();for(let r=l-1;r>a;r--){let n=u[r];e.removeItemAt(r),fu(t,n)}c&&s.deleteEmptyFirstItem?(e.removeItemAt(a),fu(t,i)):mu(t,r,null),c||h||wu(t,e.id,a)}function yu(t,e,r){return t.get(e).length>0&&mu(t,{path:e,offset:0}),t.update(e,{type:"insert",start:0,text:r}),this}function wu(t,e,r){let n=t.get(e),s=n.getItemAt(r),i=s.getPath(),o=s.getLength(),a=n.getItemAt(r+1),l=a.getPath();n.removeItemAt(r+1),t.update(i,{type:"insert",start:o,text:a.getText()}),nu.transferAnnotations(t,l,0,i,o),fu(t,a)}const bu="snippet",vu="text-snippet";function Su(t,e,r,n){t.update(e,{type:"insert",pos:r,value:n})}function Eu(t,e,r){Su(t,e,t.get(e).length,r)}function Cu(t,e,r){let n=t.update(e,{type:"delete",pos:r});if(n&&n.diff)return n.diff.val}function xu(t,e){return Nu(t,t.get(e))}function Nu(t,e){return e.map(e=>t.get(e,"strict"))}function Tu(t,e,r){let n=t.get(e);return t.get(n[r])}function Pu(t,e,r){if(r>0)return Tu(t,e,r-1)}function Iu(t,e,r){return Tu(t,e,r+1)}function Ou(t){const e=t.getDocument(),r=t.id,n=t.getSchema();let s=[];for(let i of n){const n=i.name;if(i.isText()){f(e.getAnnotations([r,n]),t=>s.push(t))}else if(i.isReference()&&i.isOwned()){let r=t[n];r&&(i.isArray()?s=s.concat(r.map(t=>e.get(t))):s.push(e.get(r)))}}return s}function Au(t){if(t._isAnnotation){let e=t,r=e.start.path[0];return e.getDocument().get(r)}return t.getParent()}var Du=Object.freeze({getPropertyAnnotationsForSelection:hu,getContainerAnnotationsForSelection:uu,isContainerAnnotation:function(t,e){return t.getSchema().isInstanceOf(e,"@container-annotation")},getTextForSelection:du,getMarkersForSelection:pu,deleteNode:function(t,e){return console.error("DEPRECATED: use documentHelpers.deepDeleteNode() instead"),fu(t,e)},deepDeleteNode:fu,copyNode:gu,deleteTextRange:mu,deleteListRange:_u,setText:yu,mergeListItems:wu,SNIPPET_ID:bu,TEXT_SNIPPET_ID:vu,insertAt:Su,append:Eu,removeAt:Cu,removeFromCollection:function(t,e,r){let n=t.get(e).indexOf(r);return n>=0&&Cu(t,e,n)},getNodesForPath:xu,getNodesForIds:Nu,getNodeAt:Tu,getPreviousNode:Pu,getNextNode:Iu,getChildren:Ou,getParent:Au,createNodeFromJson:function t(e,r){if(!r)throw new Error("'data' is mandatory");if(!r.type)throw new Error("'data.type' is mandatory");if(!d(e.create))throw new Error("First argument must be document or tx");let n=r.type,s=e.getSchema().getNodeSchema(n),i={type:n,id:r.id};for(let n of s){const s=n.name;if(!r.hasOwnProperty(s))continue;let o=r[s];if(n.isReference())if(n.isArray())i[s]=o.map(r=>t(e,r).id);else{let r=t(e,o);i[s]=r.id}else i[n.name]=o}return e.create(i)},compareCoordinates:Dn,isCoordinateBefore:kn,getContainerRoot:sh,getContainerPosition:ih});function Lu(t,e){if(!t)return[];if(e||(e=function(t){return t}),Array.isArray(t))return t.map(e);if(t instanceof Map){let r=[];for(let[n,s]of t)r.push(e(s,n));return r}if(t instanceof Set){let r=[],n=0;return t.forEach(t=>{r.push(e(t,n++))}),r}return Object.keys(t).map(function(r){return e(t[r],r)})}function ku(t,e){if(t)for(var r=0;r<t.length;r++)t[r]===e&&(t.splice(r,1),r--)}class Mu{}class Ru{get(t){return arguments.length>1&&(t=Array.prototype.slice(arguments,0)),ul(this,t=qu(t))}getAll(t){if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),!p(t=qu(t)))throw new Error("Illegal argument for TreeIndex.get()");let e=ul(this,t);return this._collectValues(e)}set(t,e){Hc(this,t=qu(t),e,function(t){if(!t)return new Mu})}delete(t){if(1===(t=qu(t)).length)delete this[t[0]];else{let e=t[t.length-1],r=ul(this,t=t.slice(0,-1));r&&delete r[e]}}clear(){let t=this;for(let e in t)t.hasOwnProperty(e)&&delete t[e]}traverse(t){this._traverse(this,[],t)}forEach(...t){this.traverse(...t)}_traverse(t,e,r){let n;for(n in t){if(!t.hasOwnProperty(n))continue;let s=t[n],i=e.concat([n]);s instanceof Mu?this._traverse(s,i,r):r(s,i)}}_collectValues(t){let e={};return this._traverse(t,[],function(t,r){let n=r[r.length-1];e[n]=t}),e}}function qu(t){return n(t)?[t]:t}Ru.Arrays=class extends Ru{contains(t){let e=super.get(t);return Boolean(e)}get(t){let e=super.get(t);return e instanceof Mu&&(e=e.__values__||[]),e}set(t,e){super.get(t).__values__=e}add(t,e){if(!p(t=qu(t)))throw new Error("Illegal arguments.");let r;Hc(this,t.concat(["__values__","__dummy__"]),void 0,function(t,e){return"__values__"===e?(t||(t=[]),r=t):t||(t=new Mu),t}),delete r.__dummy__,r.push(e)}remove(t,e){let r=ul(this,t);r instanceof Mu&&(1===arguments.length?delete r.__values__:ku(r.__values__,e))}_collectValues(t){let e=[];return this._traverse(t,[],function(t){e.push(t)}),e=Array.prototype.concat.apply([],e)}};class Bu extends ou{constructor(){super(),this.byPath=new Ru,this.byType=new Ru}select(t){return t.isPropertyAnnotation()||t.isInlineNode()}clear(){this.byPath.clear(),this.byType.clear()}get(t,e,r,i){var o;return o=Lu(o=n(t)||1===t.length?this.byPath.getAll(t)||{}:this.byPath.get(t)),s(e)&&(o=au(o,Bu.filterByRange(e,r))),i&&(o=au(o,ou.filterByType(i))),o}create(t){const e=t.start.path;this.byType.set([t.type,t.id],t),e&&e.length>0&&this.byPath.set(t.start.path.concat([t.id]),t)}delete(t){this._delete(t.type,t.id,t.start.path)}_delete(t,e,r){this.byType.delete([t,e]),r&&r.length>0&&this.byPath.delete(r.concat([e]))}update(t,e,r,n){this.select(t)&&"start"===e[1]&&"path"===e[2]&&(this._delete(t.type,t.id,n),this.create(t))}}Bu.filterByRange=function(t,e){return function(r){var n=r.start.offset,i=r.end.offset>=t;return s(e)&&(i=i&&n<=e),i}};const ju=1,Fu=-1,Uu=-2;class Hu{onText(t,e,r){}onOpen(t,e){return{}}onClose(t,e,r){}start(t,e,r){if(!n(e))throw new Error("Illegal argument: 'text' must be a String, but was "+e);let s=this._init(t,e,r),i=s.boundaries,o=s.stack,a=()=>o[o.length-1],l=0,c=0,h=2*i.length;for(;i.length>0;){if(++c>h)throw new Error("FIXME: infinity loop in Fragmenter implementation");let t=i.shift(),r=a().context;if(t.offset>l){let n=e.slice(l,t.offset);this.onText(r,n),l=t.offset}switch(t.type){case Uu:{let e=r,n=this.onOpen(t,e);this._close(t,n,e);break}case Fu:{let{context:e,entry:r}=a();if(r.node!==t.node){i.unshift(t),this._fixOrderOfClosers(o,i,0);continue}o.pop();let n=a().context;this._close(t,e,n);break}case ju:{let e=a().entry;if(!e||e.endOffset>=t.endOffset){t.stackLevel=o.length;let e=this.onOpen(t,r);o.push({context:e,entry:t})}else{if(!(t.weight<=e.weight)){i.unshift(t);let r={type:Fu,offset:t.offset,node:e.node,opener:e},n={type:ju,offset:t.offset,node:e.node,fragmentCount:e.fragmentCount+1,endOffset:e.endOffset,weight:e.weight,closer:e.closer};e.closer.opener=n,e.closer=r,e.endOffset=t.offset,this._insertBoundary(i,r),this._insertBoundary(i,n);continue}{t.stackLevel=o.length;let n={type:Fu,offset:e.endOffset,node:t.node,opener:t},s={type:ju,offset:e.endOffset,node:t.node,fragmentCount:t.fragmentCount+1,endOffset:t.endOffset,weight:t.weight,closer:t.closer};t.closer.opener=s,t.closer=n,t.endOffset=e.endOffset,this._insertBoundary(i,n),this._insertBoundary(i,s);let a=this.onOpen(t,r);o.push({context:a,entry:t})}}break}}}let u=e.substring(l);u&&this.onText(t,u)}_init(t,e,r){let n=[];return r.forEach(t=>{if(t.isAnchor()||t.start.offset===t.end.offset)n.push({type:Uu,offset:t.start.offset,endOffset:t.start.offset,length:0,node:t});else{let e={type:ju,offset:t.start.offset,node:t,fragmentCount:0,endOffset:t.end.offset,weight:t._getFragmentWeight()},r={type:Fu,offset:t.end.offset,node:t,opener:e};e.closer=r,n.push(e),n.push(r)}}),n.sort(this._compareBoundaries.bind(this)),{stack:[{context:t,entry:null}],boundaries:n}}_close(t,e,r){t.type===Fu&&((t=t.opener).length=t.endOffset-t.offset),this.onClose(t,e,r)}_compareBoundaries(t,e){return t.offset<e.offset?-1:t.offset>e.offset?1:t.type<e.type?-1:t.type>e.type?1:t.type===ju?t.endOffset>e.endOffset?-1:t.endOffset<e.endOffset?1:t.weight>e.weight?-1:t.weight<e.weight?1:t.stackLevel&&e.stackLevel?t.stackLevel-e.stackLevel:0:t.type===Fu?-this._compareBoundaries(t.opener,e.opener):0}_insertBoundary(t,e,r=0){for(let n=r,s=t.length;n<s;n++)if(-1===this._compareBoundaries(e,t[n]))return t.splice(n,0,e),n;return t.push(e),t.length-1}_fixOrderOfClosers(t,e,r){let n={},s=e[r],i=[s];for(let t=r+1,n=e.length;t<n;t++){let n=e[r+t];if(n.type!==Fu||n.offset!==s.offset)break;i.push(n)}for(let e=t.length-1;e>=1;e--){let r=t[e].entry;n[r.node.id]=r}for(let t=0,e=i.length;t<e;t++){let e=i[t],r=n[e.node.id];if(!r)throw new Error("Fragmenter Error: there is no opener for closer");e.opener=r}i.sort(this._compareBoundaries.bind(this));console.assert((()=>{for(let e=0;e<i.length;e++)if(t[t.length-1-e].entry.node!==i[e].node)return!1;return!0})(),"Fragmenter: closers should be alligned with the current stack of elements"),e.splice(r,i.length,...i)}}function Vu(t){class e extends t{constructor(t,e){super(t,function(t){if(t.hasOwnProperty("start"))t.hasOwnProperty("end")&&!t.end.path&&(t.end.path=t.start.path);else{let e,r;(t.hasOwnProperty("startPath")||t.hasOwnProperty("path"))&&(e={path:t.startPath||t.path,offset:t.startOffset}),(t.hasOwnProperty("endPath")||t.hasOwnProperty("endOffset"))&&(r={path:t.endPath||t.path,offset:t.endOffset}),e&&!r&&(r=th(e)),e&&(delete(t=Object.assign({},t)).path,delete t.startPath,delete t.endPath,delete t.startOffset,delete t.endOffset,t.start=e,t.end=r)}return t}(e)),this._properties.start=new On(this.start),this._properties.end=new On(this.end)}get path(){return console.warn("DEPRECATED: use annotation.start.path instead"),this.start.path}getPath(){return this.start.path}get startPath(){return console.warn("DEPRECATED: use annotation.start.path instead."),this.start.path}set startPath(t){console.warn("DEPRECATED: use annotation.start.path instead."),this.start.path=t}get startOffset(){return console.warn("DEPRECATED: use annotation.start.offset instead."),this.start.offset}set startOffset(t){console.warn("DEPRECATED: use annotation.start.offset instead."),this.start.offset=t}get endPath(){return console.warn("DEPRECATED: use annotation.end.path instead."),this.end.path}set endPath(t){console.warn("DEPRECATED: use annotation.end.path instead."),this.end.path=t}get endOffset(){return console.warn("DEPRECATED: use annotation.end.offset instead."),this.end.offset}set endOffset(t){console.warn("DEPRECATED: use annotation.end.offset instead."),this.end.offset=t}getText(){var t=this.getDocument();return t?du(t,this.getSelection()):(console.warn("Trying to use a Annotation which is not attached to the document."),"")}isAnnotation(){return!0}canSplit(){return!0}getSelection(){const t=this.getDocument();return t?this.isContainerAnnotation()?t.createSelection({type:"container",containerPath:this.containerPath,startPath:this.start.path,startOffset:this.start.offset,endPath:this.end.path,endOffset:this.end.offset}):this.getDocument().createSelection({type:"property",path:this.start.path,startOffset:this.start.offset,endOffset:this.end.offset}):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),Tn.nullSelection())}_updateRange(t,e){if(e.isContainerSelection())rh(this.start.path,e.start.path)||t.set([this.id,"start","path"],e.start.path),this.start.offset!==e.start.offset&&t.set([this.id,"start","offset"],e.start.offset),rh(this.end.path,e.end.path)||t.set([this.id,"end","path"],e.end.path),this.end.offset!==e.end.offset&&t.set([this.id,"end","offset"],e.end.offset);else{if(!e.isPropertySelection())throw new Error("Invalid selection.");In(this.start.path,e.start.path)||t.set([this.id,"path"],e.start.path),this.start.offset!==e.start.offset&&t.set([this.id,"start","offset"],e.start.offset),this.end.offset!==e.end.offset&&t.set([this.id,"end","offset"],e.end.offset)}}mustNotBeSplit(){return!1}shouldNotBeSplit(){return!1}_getFragmentWeight(){return this.mustNotBeSplit()?Hu.MUST_NOT_SPLIT:this.shouldNotBeSplit()?Hu.SHOULD_NOT_SPLIT:this.getFragmentWeight?this.getFragmentWeight():Hu.NORMAL}static isAnnotation(){return!0}}return e.schema={start:{type:"coordinate",default:{path:[],offset:0}},end:{type:"coordinate",default:{path:[],offset:0}}},e}Hu.MUST_NOT_SPLIT=Number.MAX_VALUE,Hu.SHOULD_NOT_SPLIT=1e3,Hu.NORMAL=100,Hu.ALWAYS_ON_TOP=0;var zu=Object.freeze({series:function t(e,r,n){e[n=n||0](function(s,...i){if(s)return r(s);n===e.length-1?r(s,...i):t(e,r,n+1)})}});const Gu="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function $u(t){if(!s(t))throw new Error("Illegal argument.");let e="";for(;;){let r=t%Gu.length;if(t=Math.floor(t/Gu.length),e=Gu[r]+e,t>0)t--;else if(0===t)break}return e}function Ju(t){var e=/^([A-Z]+)([1-9][0-9]*)$/.exec(t);return[parseInt(e[2],10)-1,Xu(e[1])]}const Ku="A".charCodeAt(0),Wu=Gu.length;function Xu(t){let e=0,r=0;for(let n=t.length-1;n>=0;n--){let s=t.charCodeAt(n)-Ku;if(s<0||s>=Wu)throw new Error("Illegal column label: "+t);e+=Math.pow(Wu,r)*(s+1),r++}return e-1}var Yu=Object.freeze({ALPHABET:Gu,getColumnLabel:$u,getRowCol:Ju,getColumnIndex:Xu,getCellLabel:function(t,e){return $u(e)+(t+1)},getIndexesFromRange:function(t,e){let r,n,[s,i]=Ju(t);return e?([r,n]=Ju(e),s>r&&([s,r]=[r,s]),i>n&&([i,n]=[n,i])):[r,n]=[s,i],{startRow:s,startCol:i,endRow:r,endCol:n}},getRangeFromMatrix:function(t,e,r,n,s,i){if(!i){if(e===n&&r===s){let n=t[e];return n?n[r]:void 0}if(e===n){let n=t[e];return n?n.slice(r,s+1):[]}if(r===s){let s=[];for(let i=e;i<=n;i++){let e=t[i];e&&s.push(e[r])}return s}}let o=[];for(var a=e;a<n+1;a++){let e=t[a];e&&o.push(e.slice(r,s+1))}return o}});function Zu(t){return void 0===t._key&&Object.defineProperty(t,"_key",{value:t.join("."),writable:!1,enumerable:!1}),t._key}function Qu(t){return t.reduce((t,e)=>(t[e]=!0,t),{})}function td(){var t={};return function(e){return t.hasOwnProperty(e)||(t[e]=1),[e,"-",t[e]++].join("")}}function ed(t,e){let r=[];for(let n=0;n<=e.length;n++){if(r[n]=[n],0===n)continue;let s=n-1;for(let i=0;i<=t.length;i++){if(r[0][i]=i,0===i)continue;let o=i-1;r[n][i]=e.charAt(s)===t.charAt(o)?r[s][o]:Math.min(r[s][o]+1,r[n][o]+1,r[s][i]+1)}}return r}function rd(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}const nd=!1;let sd=0;const id="%s listeners registered in the whole system.";class od{emit(t){if(t in this.__events__){for(var e=this.__events__[t].slice(),r=Array.prototype.slice.call(arguments,1),n=0,s=e.length;n<s;n++){var i=e[n];i.method.apply(i.context,r)}return!0}return!1}on(t,e,r){(function(t,e,r){var n;ld(e,r),n=this.__events__.hasOwnProperty(t)?this.__events__[t]:this.__events__[t]=[];n.push({method:e,context:r||null}),nd&&(sd++,console.info("_on()",t,e.name,r,this),console.info(id,sd));return this}).call(this,t,e,r)}off(t,e,r){1===arguments.length&&u(arguments[0])?function(t){return f(this.__events__,(e,r)=>{for(let n=e.length-1;n>=0;n--)e[n]&&e[n].context===t&&ad.call(this,r,e[n].method,t)}),this}.call(this,arguments[0]):ad.apply(this,arguments)}_debugEvents(){console.log("### EventEmitter: ",this),f(this.__events__,(t,e)=>{console.log("- %s listeners for %s: ",t.length,e,t)})}get __events__(){return this.___events___||(this.___events___={}),this.___events___}}function ad(t,e,r){if(0===arguments.length)return nd&&(f(this.__events__,t=>{t.forEach(t=>{console.info("_off()",t.method.name,t.context,this)}),sd-=t.length}),console.info(id,sd)),this.___events___={},this;if(1===arguments.length)return nd&&(sd-=(this.__events__[t]||[]).length,console.info(id,sd)),delete this.__events__[t],this;if(ld(e,r),!(t in this.__events__&&this.__events__[t].length))return nd&&console.info("NO MATCHING BINDINGS"),this;arguments.length<3&&(r=null);let n=this.__events__[t];for(let t=n.length-1;t>=0;t--){const s=n[t];s.method===e&&s.context===r&&(n.splice(t,1),nd&&sd--)}return 0===n.length&&delete this.__events__[t],nd&&console.info(id,sd),this}function ld(t,e){if("string"==typeof t){if(void 0===e||null===e)throw new Error('Method name "'+t+'" has no context.');if(!(t in e))throw new Error('Method not found: "'+t+'"');if("function"!=typeof e[t])throw new Error('Property "'+t+'" is not a function')}else if("function"!=typeof t)throw new Error("Invalid callback. Function or method name expected.")}function cd(...t){return Object.assign(...t)}const hd={};class ud{constructor(t,e){this.entries={},this.names=[],this.validator=e,t&&f(t,function(t,e){this.add(e,t)}.bind(this))}contains(t){return this.entries.hasOwnProperty(t)}add(t,e){if(this.validator&&this.validator(e),hd[t])throw new Error('Illegal key: "'+t+'" is a property of Object which is thus not allowed as a key.');this.contains(t)&&this.remove(t),this.entries[t]=e,this.names.push(t)}remove(t){let e=this.names.indexOf(t);e>=0&&this.names.splice(e,1),delete this.entries[t]}clear(){this.names=[],this.entries={}}get(t,e){let r=this.entries[t];if(e&&!r)throw new Error("No entry registered for name "+t);return r}forEach(t){for(let e=0;e<this.names.length;e++){let r=this.names[e];if(!1===t(this.entries[r],r))break}}map(t){let e=[];return this.forEach((r,n)=>{e.push(t(r,n))}),e}filter(t){let e=[];return this.forEach(function(r,n){t(r,n)&&e.push(r)}),e}values(){return this.filter(()=>!0)}get _isRegistry(){return!0}}function dd(t){var e={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,width:Number.NaN,height:Number.NaN};return f(t,function(t){t.left<e.left&&(e.left=t.left),t.top<e.top&&(e.top=t.top),t.left+t.width>e.right&&(e.right=t.left+t.width),t.top+t.height>e.bottom&&(e.bottom=t.top+t.height)}),e.width=e.right-e.left,e.height=e.bottom-e.top,e}function pd(t,e){let r=e.getBoundingClientRect(),n=t.clientX-r.left,s=t.clientY-r.top;return{left:n,right:r.width-n,top:s,bottom:r.height-s}}function fd(t){return!0===t||!1===t||t&&t.constructor===Boolean}let gd={UNDEFINED:0,BACKSPACE:8,DELETE:46,INSERT:45,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,RETURN:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,ESC:27,SHIFT:16,SPACE:32,PLUS:171,VOLUMEUP:183,VOLUMEDOWN:182,VOLUMEMUTE:181,PRINTSCREEN:44};for(let t=1;t<=24;t++)gd["F"+t]=111+t;function md(t,e){return p(t)?t.concat(e):null}function _d(t,e){return p(t)?e:null}function yd(t){let r=t.split("+"),n={keyCode:-1};for(var s=0;s<r.length;s++){let i=r[s].toUpperCase();switch(i){case"ALT":n.altKey=!0;break;case"ALTGR":n.altKey=!0,n.code="AltRight";break;case"CMD":n.metaKey=!0;break;case"CTRL":n.ctrlKey=!0;break;case"COMMANDORCONTROL":e.isMac?n.metaKey=!0:n.ctrlKey=!0;break;case"MEDIANEXTTRACK":n.code="MediaTrackNext";break;case"MEDIAPLAYPAUSE":n.code="MediaPlayPause";break;case"MEDIAPREVIOUSTRACK":n.code="MediaPreviousTrack";break;case"MEDIASTOP":n.code="MediaStop";break;case"SHIFT":n.shiftKey=!0;break;case"SUPER":n.metaKey=!0;break;default:if(1===i.length)n.keyCode=i.charCodeAt(0);else{if(!gd.hasOwnProperty(i))throw new Error("Unsupported keyboard command: "+t);n.keyCode=gd[i]}}}return n}function wd(t,e){let r=[];return t.altKey&&("AltRight"===t.code?r.push("ALTGR"):r.push("ALT")),t.ctrlKey&&r.push("CTRL"),t.metaKey&&r.push("META"),t.shiftKey&&r.push("SHIFT"),e||r.push(t.keyCode),r.join("+")}function bd(t,e){return!!n(t)&&(t.startsWith?t.startsWith(e):(n(e)||(e=String(e)),t.slice(0,e.length)===e))}class vd extends Error{constructor(t,e){super(t,e),this.name=t,this.message=e.message,this.info=e.info,this.errorCode=e.errorCode,this.cause=e.cause,Error.captureStackTrace&&Error.captureStackTrace(this,vd)}inspect(){var t=[];return t.push(this.stack),this.info&&t.push(this.info+". "),this.cause&&(t.push("\nCaused by: "),this.cause.inspect?t.push(this.cause.inspect()):t.push(this.cause.toString())),t.join("")}}function Sd(t){let e,r=t.clientX,n=t.clientY;if(document.body.createTextRange)(e=document.body.createTextRange()).moveToPoint(r,n);else if(!i(document.createRange))if(i(t.rangeParent))if(document.caretPositionFromPoint){let t=document.caretPositionFromPoint(r,n);(e=document.createRange()).setStart(t.offsetNode,t.offset),e.collapse(!0)}else document.caretRangeFromPoint&&(e=document.caretRangeFromPoint(r,n));else(e=document.createRange()).setStart(t.rangeParent,t.rangeOffset),e.collapse(!0);return e}function Ed(t,e){var r=e.left-t.left,n=e.top-t.top;return{left:r,top:n,right:t.width-r-e.width,bottom:t.height-n-e.height,width:e.width,height:e.height}}function Cd(t){if(e.inBrowser){const e=window.getSelection();if(0===e.rangeCount)return;const r=e.getRangeAt(0);let n=t,s=r.getBoundingClientRect();if(0===s.top&&0===s.bottom){let t=function(t,e){let r=t.anchorNode;if(!r||!r.getBoundingClientRect)return;let n=r.getBoundingClientRect();return{left:n.left,top:n.top,width:0,height:n.height,right:n.width,bottom:n.bottom}}(e);t&&(s=t)}return Ed(n,s)}}function xd(t,e){if(!e)throw new Error("'selection' is mandatory.");let r=null;return e.isNull()||e.isCollapsed()||(e.isPropertySelection()?r=function(t,e){let r=e.start.path,n=e.start.offset,s=e.end.offset,i=t.get(r),o=t.createSnippet(),a=o.getContainer();return o.create({type:t.schema.getDefaultTextType(),id:vu,content:i.substring(n,s)}),a.append(vu),f(t.getIndex("annotations").get(r,n,s),function(t){let e=th(t.toJSON()),r=[vu,"content"];e.start={path:r,offset:Math.max(n,t.start.offset)-n},e.end={path:r,offset:Math.min(s,t.end.offset)-n},o.create(e)}),o}(t,e):e.isContainerSelection()?r=function(t,e){let r=e.containerPath,n=t.createSnippet(),s=n.getContainer().getContentPath(),i=gh(t,e),o=i.length;if(0===o)return n;let a=e.start,l=e.end,c=!1,h=!1,u={};for(let e=0;e<o;e++){let d=i[e],p=t.get(d);0===e&&lh(t,r,a)?c=!0:e===o-1&&ah(t,r,l)?h=!0:u[d]||(gu(p).forEach(t=>{let e=n.create(t);u[e.id]=!0}),Eu(n,s,d))}if(!c){let t=sh(n,s,a.getNodeId());t.isText()?mu(n,null,a):t.isList()&&_u(n,t,null,a,{deleteEmptyFirstItem:!0})}if(!h){let t=sh(n,s,l.getNodeId());t.isText()?mu(n,l,null):t.isList()&&_u(n,t,l,null)}return n}(t,e):e.isNodeSelection()?r=function(t,e){let r=t.createSnippet(),n=r.getContainer().getContentPath(),s=e.getNodeId(),i=t.get(s);return gu(i).forEach(t=>{r.create(t)}),Eu(r,n,i.id),r}(t,e):console.error("Copy is not yet supported for selection type.")),r}function Nd(t,e,r,n){if(n[r])throw new Error("FIXME: dont call me twice");n[r]=r;const s=t.get(r,"strict"),i=s.toJSON();let o,a=r;e.contains(r)&&(o=h(s.type),i.id=o);const l=t.getIndex("annotations"),c=s.getSchema();let u=[];for(let r of c){const s=r.name;if("id"!==s&&"type"!==s)if(r.isReference()&&r.isOwned()||"file"===r.type)if(r.isArray()){let r=i[s];i[s]=Td(t,e,r,n)}else{let r=i[s];n[r]||(i[s]=Nd(t,e,r,n))}else if(r.isText()){let t=l.get([a,r.name]);for(let e=0;e<t.length;e++){let r=t[e];r.start.path[0]===a&&o&&(r.start.path[0]=o),r.end.path[0]===a&&o&&(r.end.path[0]=o),u.push(r)}}}e.create(i);for(let r=0;r<u.length;r++)Nd(t,e,u[r].id,n);return i.id}function Td(t,e,r,n){let s=r.slice(0);for(let i=0;i<r.length;i++){let o=r[i];if(p(o))s[i]=Td(t,e,o,n);else{let r=o;r&&!n[r]&&(s[i]=Nd(t,e,r,n))}}return s}function Pd(t,e){let r=t.selection;if(!r||r.isNull())throw new Error("Can not paste without selection.");if(r.isCustomSelection())throw new Error("Paste not implemented for custom selection.");(e=e||{}).text=e.text||"";let n=e.doc,s=Boolean(r.containerPath);if(r.isCollapsed()||t.deleteSelection(),!n){if(!s)return void t.insertText(e.text);n=function(t,e){let r,n=e.text.split(/\s*\n\s*\n/),s=t.getDocument().newInstance(),i=s.getSchema().getDefaultTextType(),o=s.create({type:"@container",id:bu,nodes:[]});if(1===n.length)r=s.create({id:vu,type:i,content:n[0]}),o.append(r.id);else for(let t=0;t<n.length;t++)r=s.create({id:h(i),type:i,content:n[t]}),o.append(r.id);return s}(t,e)}let i=n.get(bu),o=i.getLength();if(0===o)return;let a=i.getNodeAt(0);return s?(a.isText()&&(Id(t,n),i.removeAt(0),o--),o>0&&function(t,e){let r=e.get(bu);if(0===r.getLength())return;let n,s=t.selection,i=s.containerPath;if(s.isPropertySelection()){let e=s.start.path,o=sh(t,i,s.start.getNodeId());if(o.isText()){let r=o.getPosition(),a=t.get(e);0===a.length?(Cu(t,i,n=r),fu(t,t.get(o.id))):a.length===s.start.offset?n=r+1:(t.break(),n=r+1)}else if(o.isList()){let e=o,a=t.get(s.start.getNodeId()),l=r.getNodeAt(0);if(l.isList()){if(l.getLength()>0){let n=a.getPosition();0===a.getLength()?(Cu(t,e.getItemsPath(),n),fu(t,a),Od(t,e,l,n)):0===s.start.offset?Od(t,e,l,n):s.start.offset>=a.getLength()?Od(t,e,l,n+1):(t.break(),Od(t,e,l,n+1)),r.getLength()>1&&Ad(t,i,e)}r.removeAt(0),n=e.getPosition()+1}else 1===e.getLength()&&0===a.getLength()?(n=e.getPosition(),Cu(t,i,n),fu(t,e)):0===a.getPosition()&&0===s.start.offset?n=e.getPosition():a.getPosition()===e.getLength()-1&&s.end.offset>=a.getLength()?n=e.getPosition()+1:(n=e.getPosition()+1,Ad(t,i,e))}}else if(s.isNodeSelection()){let e=ih(t,i,s.getNodeId());if(s.isBefore())n=e;else{if(!s.isAfter())throw new Error("Illegal state: the selection should be collapsed.");n=e+1}}!function(t,e,r,n){let s=[],i={},o=e.get(bu).nodes.map(t=>e.get(t)),a=t.getProperty(r).targetTypes;a&&a.size>0&&(o=o.filter(t=>a.has(t.type)));for(let e of o){let o=Nd(e.getDocument(),t,e.id,i);e=t.get(o),Su(t,r,n++,o),s.push(e)}if(s.length>0){let e=O(s);hh(t,e,r,"after")}}(t,e,i,n)}(t,n)):1===o?a.isText()&&Id(t,n):Id(t,n=function(t,e){let r=t.selection.start.path,n=t.createSnippet(),s=n.getSchema().getDefaultTextType(),i=e.get("snippet").getContent(),o=[],a=0,l=[];for(let t of i){let n=e.get(t);if(n.isText()){let t=n.getText();o.length>0&&(o.push(" "),a+=1);let e=Lu(n.getAnnotations(),t=>{let e=t.toJSON();return e.start.path=r.slice(0),e.start.offset+=a,e.end.offset+=a,e});o.push(t),l=l.concat(e),a+=t.length}}return n.create({id:vu,type:s,content:o.join("")}),l.forEach(t=>n.create(t)),n.getContainer().append(vu),n}(t,n)),e}function Id(t,e){let r=t.selection;const n=e.get(bu).nodes[0],s=e.get(n).getPath(),i=e.get(s),o=e.getIndex("annotations").get(s);let a=r.start.path,l=r.start.offset;t.insertText(i);let c=t.getProperty(a);if(c.isText()){let e=Lu(o),r=c.targetTypes;r&&r.size>0&&(e=e.filter(t=>r.has(t.type)));for(let r of e){let e=r.toJSON();e.start.path=a.slice(0),e.start.offset+=l,e.end.offset+=l,t.get(e.id)&&(e.id=h(e.type)),t.create(e)}}}function Od(t,e,r,n){let s,i=t.getSelection(),o=r.resolve("items"),a={};for(let r of o){let i=Nd(r.getDocument(),t,r.id,a);Su(t,e.getItemsPath(),n++,i),s=t.get(i)}t.setSelection({type:"property",path:s.getPath(),startOffset:s.getLength(),surfaceId:i.surfaceId,containerPath:i.containerPath})}function Ad(t,e,r){let n=r.getPosition(),s=t.selection;t.break(),t.get(t.selection.start.getNodeId()).getLength()>0&&(t.setSelection(s),t.break()),console.assert(0===t.get(t.selection.start.getNodeId()).getLength(),"at this point the current list-item should be empty"),t.break(),fu(t,Cu(t,e,n+1))}vd.fromJSON=function(t){return t?new vd(t.name,{message:t.message,info:t.info,errorCode:t.errorCode,cause:vd.fromJSON(t.cause)}):null};class Dd{annotate(t,e){let r=t.selection,n=t.getSchema().getNodeClass(e.type);if(!n)throw new Error("Unknown annotation type",e);let s={start:r.start,end:r.end,containerPath:r.containerPath};if(r.isPropertySelection()){if(!n.isAnnotation())throw new Error("Annotation can not be created for a selection.")}else r.isContainerSelection()&&n.isPropertyAnnotation()&&console.warn("NOT SUPPORTED YET: creating property annotations for a non collapsed container selection.");return Object.assign(s,e),t.create(s)}break(t){let e=t.selection;if(e.isNodeSelection()){let r=e.containerPath,n=ih(t,r,e.getNodeId()),s=this.createTextNode(t,r);e.isBefore()?Su(t,r,n,s.id):(Su(t,r,n+1,s.id),hh(t,s,r,"before"))}else if(e.isCustomSelection());else if(e.isCollapsed()||e.isPropertySelection()){let r=e.containerPath;if(e.isCollapsed()||(this._deletePropertySelection(t,e),t.setSelection(e.collapse("left"))),r){let n=e.start.path[0],s=t.get(n);this._breakNode(t,s,e.start,r)}}else if(e.isContainerSelection()){let r=e.start,n=e.containerPath,s=ih(t,n,r.path[0]);this._deleteContainerSelection(t,e,{noMerge:!0}),hh(t,Iu(t,n,s),n,"before")}}createTextNode(t,e,r){let n=t.getProperty(e);if(!n.defaultTextType)throw new Error('Container properties must have a "defaultTextType" defined in the schema');return t.create({type:n.defaultTextType,content:r})}createListNode(t,e,r={}){return t.create({type:"list",items:[],listType:r.listType||"bullet"})}delete(t,e){let r=t.selection;if(r.isNodeSelection())this._deleteNodeSelection(t,r,e);else if(r.isCustomSelection());else if(r.isCollapsed()){let n=r.start.path,s=n[0],i=r.containerPath,o=t.get(n),a=r.start.offset;if(i&&(0===a&&"left"===e||a===o.length&&"right"===e)){let n=sh(t,i,s);if(n.isList()&&0===a&&"left"===e)return this.toggleList(t);this._merge(t,n,r.start,e,i)}else{if(0===a&&"left"===e||a===o.length&&"right"===e)return;let s="left"===e?a-1:a;mu(t,{path:n,offset:s},{path:n,offset:s+1}),t.setSelection({type:"property",path:n,startOffset:s,containerPath:r.containerPath})}}else r.isPropertySelection()?(mu(t,r.start,r.end),t.setSelection(r.collapse("left"))):r.isContainerSelection()?this._deleteContainerSelection(t,r):console.warn("Unsupported case: tx.delete(%)",e,r)}_deleteNodeSelection(t,e,r){let n=e.getNodeId(),s=e.containerPath,i=ih(t,s,n);if(e.isFull()||e.isBefore()&&"right"===r||e.isAfter()&&"left"===r){Cu(t,s,i),fu(t,t.get(n));let r=this.createTextNode(t,e.containerPath);Su(t,s,i,r.id),t.setSelection({type:"property",path:r.getPath(),startOffset:0,containerPath:s})}else if(e.isBefore()&&"left"===r){if(i>0){let e=Pu(t,s,i);e.isText()?(t.setSelection({type:"property",path:e.getPath(),startOffset:e.getLength()}),this.delete(t,r)):t.setSelection({type:"node",nodeId:e.id,containerPath:s})}}else if(e.isAfter()&&"right"===r){if(i<t.get(s).length-1){let e=Iu(t,s,i);e.isText()?(t.setSelection({type:"property",path:e.getPath(),startOffset:0}),this.delete(t,r)):t.setSelection({type:"node",nodeId:e.id,containerPath:s})}}else console.warn("Unsupported case: delete(%s)",r,e)}_deletePropertySelection(t,e){let r=e.start.path,n=e.start.offset,s=e.end.offset;t.update(r,{type:"delete",start:n,end:s}),nu.deletedText(t,r,n,s)}_deleteContainerSelection(t,e,r={}){let n=e.containerPath,s=e.start,i=e.end,o=s.getNodeId(),a=i.getNodeId(),l=ih(t,n,o),c=ih(t,n,a);if(l===c){let r=sh(t,n,o);if(r.isText())mu(t,s,i);else{if(!r.isList())throw new Error("Not supported yet.");_u(t,r,s,i)}return void t.setSelection(e.collapse("left"))}let h=s.getNodeId(),u=i.getNodeId(),d=t.get(s.getNodeId()),p=t.get(i.getNodeId()),f=ch(0,d,s,null),g=ch(0,p,null,i);if(g)Cu(t,n,c),fu(t,p);else{let e=sh(t,n,u);e.isText()?mu(t,null,i):e.isList()&&_u(t,e,null,i)}for(let e=c-1;e>l;e--){let r=Cu(t,n,e);fu(t,t.get(r))}if(f)Cu(t,n,l),fu(t,d);else{let e=sh(t,n,h);e.isText()?mu(t,s,null):e.isList()&&_u(t,e,s,null)}if(f&&g){let e=this.createTextNode(t,n);Su(t,n,l,e.id),t.setSelection({type:"property",path:e.getPath(),startOffset:0,containerPath:n})}else if(f||g)f?hh(t,p,n,"before"):hh(t,d,n,"after");else{if(!r.noMerge){let r=sh(t,n,d.id);this._merge(t,r,e.start,"right",n)}t.setSelection(e.collapse("left"))}}insertInlineNode(t,e){let r=t.selection;this.insertText(t,"\ufeff"),r=t.selection;let n=t.selection.end.offset,s=n-"\ufeff".length;return e=Object.assign({},e,{start:{path:r.path,offset:s},end:{path:r.path,offset:n}}),t.create(e)}insertBlockNode(t,e){let r,n=t.selection,s=n.containerPath;if(r=e._isNode&&t.get(e.id)?t.get(e.id):t.create(e),n.isNodeSelection()){let e=n.getNodeId(),i=ih(t,s,e);n.isBefore()?Su(t,s,i,r.id):n.isAfter()?(Su(t,s,i+1,r.id),t.setSelection({type:"node",containerPath:s,nodeId:r.id,mode:"after"})):(Cu(t,s,i),fu(t,t.get(e)),Su(t,s,i,r.id),t.setSelection({type:"node",containerPath:s,nodeId:r.id,mode:"after"}))}else if(n.isPropertySelection()){if(!s)throw new Error("insertBlockNode can only be used within a container.");n.isCollapsed()||(this._deletePropertySelection(t,n),t.setSelection(n.collapse("left")));let e=t.get(n.path[0]);if(!e)throw new Error("Invalid selection.");let i=ih(t,s,e.id);if(e.isText()){let o=e.getText();0===o.length?(Cu(t,s,i),fu(t,e),Su(t,s,i,r.id),hh(t,r,s,"after")):0===n.start.offset?Su(t,s,i,r.id):n.start.offset===o.length?(Su(t,s,i+1,r.id),hh(t,r,s,"before")):(this.break(t),Su(t,s,i+1,r.id),hh(t,r,s,"after"))}else console.error("Not supported: insertBlockNode() on a custom node")}else if(n.isContainerSelection()){if(n.isCollapsed()){let e=n.start;if(e.isPropertyCoordinate())t.setSelection({type:"property",path:e.path,startOffset:e.offset,containerPath:s});else{if(!e.isNodeCoordinate())throw new Error("Unsupported selection for insertBlockNode");t.setSelection({type:"node",containerPath:s,nodeId:e.path[0],mode:0===e.offset?"before":"after"})}return this.insertBlockNode(t,r)}return this.break(t),this.insertBlockNode(t,r)}return r}insertText(t,e){let r=t.selection;if(r.isNodeSelection()){let n=r.containerPath,s=r.getNodeId(),i=ih(t,n,s),o=this.createTextNode(t,n,e);r.isBefore()?Su(t,n,i,o.id):r.isAfter()?Su(t,n,i+1,o.id):(Cu(t,n,i),fu(t,t.get(s)),Su(t,n,i,o.id)),hh(t,o,n,"after")}else r.isCustomSelection()||(r.isCollapsed()||r.isPropertySelection()?this._insertText(t,r,e):r.isContainerSelection()&&(this._deleteContainerSelection(t,r),this.insertText(t,e)))}paste(t,e){if(e)if(n(e))Pd(t,{text:e});else{if(!e._isDocument)throw new Error("Illegal content for paste.");Pd(t,{doc:e})}}switchTextType(t,e){let r=t.selection;if(!r.isPropertySelection())throw new Error("Selection must be a PropertySelection.");let n=r.containerPath;if(!n)throw new Error("Selection must be within a container.");let s=r.path,i=s[0],o=t.get(i);if(!o.isText())throw new Error("Trying to use switchTextType on a non text node.");const a=h(e.type),l=o.getPath();console.assert(2===l.length,"Currently we assume that TextNodes store the plain-text on the first level");const c=l[1];let u=[a,c],d=Object.assign({id:a,type:e.type,direction:o.direction},e);d[c]=o.getText();let p=t.create(d);nu.transferAnnotations(t,s,0,u,0);let f=ih(t,n,i);return Cu(t,n,f),fu(t,o),Su(t,n,f,p.id),t.setSelection({type:"property",path:u,startOffset:r.start.offset,endOffset:r.end.offset,containerPath:n}),p}toggleList(t,e){let r=t.selection,n=r.containerPath;if(!n)throw new Error("Selection must be within a container.");if(r.isPropertySelection()){let s=sh(t,n,r.start.path[0]),i=s.getPosition();if(s.isText()){Cu(t,n,i);let o=this.createListNode(t,n,e),a=o.createListItem(s.getText());nu.transferAnnotations(t,s.getPath(),0,a.getPath(),0),o.appendItem(a),fu(t,s),Su(t,n,i,o.id),t.setSelection({type:"property",path:a.getPath(),startOffset:r.start.offset,containerPath:n})}else if(s.isList()){let e=r.start.path[0],o=t.get(e),a=s.getItemPosition(o),l=this.createTextNode(t,n,o.getText());if(nu.transferAnnotations(t,o.getPath(),0,l.getPath(),0),s.removeItemAt(a),s.isEmpty())Cu(t,n,i),fu(t,s),Su(t,n,i,l.id);else if(0===a)Su(t,n,i,l.id);else if(s.getLength()<=a)Su(t,n,i+1,l.id);else{let e=[];const r=s.getItems();for(let t=r.length-1;t>=a;t--)e.unshift(r[t]),s.removeItemAt(t);let o=this.createListNode(t,n,s);for(let t=0;t<e.length;t++)o.appendItem(e[t]);Su(t,n,i+1,l.id),Su(t,n,i+2,o.id)}t.setSelection({type:"property",path:l.getPath(),startOffset:r.start.offset,containerPath:n})}}else r.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}indent(t){let e=t.selection,r=e.containerPath;if(e.isPropertySelection()){let n=sh(t,r,e.start.getNodeId());if(n.isList()){let r=e.start.path[0],s=t.get(r),i=s.getLevel();s&&i<3&&(s.setLevel(s.level+1),t.set([n.id,"_itemsChanged"],!0))}}else e.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}dedent(t){let e=t.selection,r=e.containerPath;if(e.isPropertySelection()){let n=sh(t,r,e.start.getNodeId());if(n.isList()){let r=e.start.path[0],s=t.get(r),i=s.getLevel();s&&i>1&&(s.setLevel(s.level-1),t.set([n.id,"_itemsChanged"],!0))}}else e.isContainerSelection()&&console.error("TODO: support toggleList with ContainerSelection")}_insertText(t,e,r){let n=e.start,s=e.end;if(!In(n.path,s.path))throw new Error("Unsupported state: range should be on one property");let i=n.path,o=n.offset,a=s.offset,l=!e.isCollapsed(),c=r.length;l&&t.update(i,{type:"delete",start:o,end:a}),t.update(i,{type:"insert",start:o,text:r}),t.getAnnotations(i).forEach(function(e){let r=e.start.offset,n=e.end.offset;n<o||(r>=a?(t.update([e.id,"start"],{type:"shift",value:o-a+c}),t.update([e.id,"end"],{type:"shift",value:o-a+c})):r>=o&&n<a||e.isInlineNode()&&r>=o&&n<=a?t.delete(e.id):r>=o&&n>=a?((r>o||!l)&&t.update([e.id,"start"],{type:"shift",value:o-r+c}),t.update([e.id,"end"],{type:"shift",value:o-a+c})):r<o&&n<a?t.update([e.id,"end"],{type:"shift",value:o-n+c}):(n!==o||e.constructor.autoExpandRight)&&(r<o&&n>=a?e.isInlineNode()||t.update([e.id,"end"],{type:"shift",value:o-a+c}):console.warn("TODO: handle annotation update case.")))});let h=o+r.length;t.setSelection({type:"property",path:n.path,startOffset:h,containerPath:e.containerPath,surfaceId:e.surfaceId})}_breakNode(t,e,r,n){(e=sh(t,n,e.id)).isText()?this._breakTextNode(t,e,r,n):e.isList()?this._breakListNode(t,e,r,n):console.error("FIXME: _breakNode() not supported for type",e.type)}_breakTextNode(t,e,r,n){let s=r.path,i=r.offset,o=e.getPosition(),a=e.getText();if(0===i){Su(t,n,o,t.create({type:e.type,content:""}).id),t.setSelection({type:"property",path:s,startOffset:0,containerPath:n})}else{const r=e.getPath()[1],l=h(e.type);let c=e.toJSON();c.id=l,c[r]=a.substring(i),i===a.length&&(c.type=t.getSchema().getDefaultTextType());let u=t.create(c);i<a.length&&(nu.transferAnnotations(t,s,i,u.getPath(),0),t.update(s,{type:"delete",start:i,end:a.length})),Su(t,n,o+1,u.id),t.setSelection({type:"property",path:u.getPath(),startOffset:0,containerPath:n})}}_breakListNode(t,e,r,n){let s=r.path,i=r.offset,o=t.get(s[0]),a=e.length,l=e.getItemPosition(o),c=o.getText(),h=o.getPath()[1],u=o.toJSON();if(delete u.id,0===i)if(c){u[h]="";let r=t.create(u);e.insertItemAt(l,r),t.setSelection({type:"property",path:o.getPath(),startOffset:0})}else{let r=e.getPosition(),s=this.createTextNode(t,n);if(a<2)Cu(t,n,r),fu(t,e),Su(t,n,r,s.id);else if(0===l)e.removeItem(o),fu(t,o),Su(t,n,r,s.id);else if(l>=a-1)e.removeItem(o),fu(t,o),Su(t,n,r+1,s.id);else{let i=[];const o=e.getItems().slice();for(let t=a-1;t>l;t--)i.unshift(o[t]),e.removeItem(o[t]);e.removeItem(o[l]);let c=this.createListNode(t,n,e);for(let t=0;t<i.length;t++)c.appendItem(i[t]);Su(t,n,r+1,s.id),Su(t,n,r+2,c.id)}t.setSelection({type:"property",path:s.getPath(),startOffset:0})}else{u[h]=c.substring(i);let r=t.create(u);i<c.length&&(nu.transferAnnotations(t,s,i,r.getPath(),0),t.update(s,{type:"delete",start:i,end:c.length})),e.insertItemAt(l+1,r),t.setSelection({type:"property",path:r.getPath(),startOffset:0})}}_merge(t,e,r,n,s){if(e.isList()){let i=e,o=r.path[0],a=t.get(o),l=i.getItemPosition(a);if("left"===n&&l>0||"right"===n&&l<i.items.length-1){l="left"===n?l-1:l;let e=i.getItemAt(l),r=e.getLength();return wu(t,i.id,l),void t.setSelection({type:"property",path:e.getPath(),startOffset:r,containerPath:s})}}let i=t.get(s),o=e.getPosition();"left"===n&&o>0?this._mergeNodes(t,s,o-1,n):"right"===n&&o<i.length-1&&this._mergeNodes(t,s,o,n)}_mergeNodes(t,e,r,n){let s=t.get(e),i=t.get(s[r]),o=r+1,a=t.get(s[o]);if(i.isText()){if(i.isEmpty())return Cu(t,e,r),o--,fu(t,i),void hh(t,a,e,"before");let s=i,l=s.getPath(),c=s.getLength();if(a.isText()){let r=a,n=r.getPath();Cu(t,e,o),t.update(l,{type:"insert",start:c,text:r.getText()}),nu.transferAnnotations(t,n,0,l,c),fu(t,r),t.setSelection({type:"property",path:l,startOffset:c,containerPath:e})}else if(a.isList()){let r=a;if(!a.isEmpty()){let e=r.getFirstItem(),n=e.getPath();r.removeItemAt(0),t.update(l,{type:"insert",start:c,text:e.getText()}),nu.transferAnnotations(t,n,0,l,c),fu(t,e)}r.isEmpty()&&(Cu(t,e,o),fu(t,r)),t.setSelection({type:"property",path:l,startOffset:c,containerPath:e})}else uh(t,"left"===n?i.id:a.id,e)}else if(i.isList())if(a.isText()){let n=i.getLastItem(),l=n.getPath(),c=n.getLength(),h=s.length>r+2?t.get(s[r+2]):null;if(0===a.getLength())Cu(t,e,o),fu(t,a);else{let r=a,n=r.getPath();Cu(t,e,o),t.update(l,{type:"insert",start:c,text:r.getText()}),nu.transferAnnotations(t,n,0,l,c),fu(t,r)}h&&h.type===i.type&&this._mergeTwoLists(t,e,i,h),t.setSelection({type:"property",path:n.getPath(),startOffset:c,containerPath:e})}else if(a.isList()){if("right"!==n)throw new Error("Illegal state");let r=i.getLastItem();this._mergeTwoLists(t,e,i,a),t.setSelection({type:"property",path:r.getPath(),startOffset:r.getLength(),containerPath:e})}else uh(t,"left"===n?i.id:a.id,e);else a.isText()&&a.isEmpty()?(Cu(t,e,o),fu(t,a),hh(t,i,e,"after")):uh(t,"left"===n?i.id:a.id,e)}_mergeTwoLists(t,e,r,n){Cu(t,e,n.getPosition());let s=n.getItems().slice();for(let t=0;t<s.length;t++)n.removeItemAt(0),r.appendItem(s[t]);fu(t,n)}}class Ld{constructor(t,e={}){this._document=t,this._selection=null,this._impl=e.editing||new Dd,this._direction=null}dispose(){}getDocument(){return this._document}get(...t){return this._document.get(...t)}getProperty(...t){return this._document.getProperty(...t)}contains(t){return this._document.contains(t)}find(t){return this._document.find(t)}findAll(t){return this._document.findAll(t)}create(t){return this._document.create(t)}delete(t){return this._document.delete(t)}deepDeleteNode(t){return fu(this._document.get(t))}set(t,e){return this._document.set(t,e)}update(t,e){return this._document.update(t,e)}updateNode(t,e){return this._document.updateNode(t,e)}createSelection(t){return t=fh(t,this._selection),this._document.createSelection(t)}setSelection(t){return t?eh(t)?t=this.createSelection(t):t.isNull()||(t=fh(t,this._selection)):t=Tn.nullSelection,this._selection=t,t}getSelection(){return this._selection}get selection(){return this._selection}set selection(t){this.setSelection(t)}get textDirection(){return this._direction}set textDirection(t){this._direction=t}annotate(t){const e=this._selection;if(e&&(e.isPropertySelection()||e.isContainerSelection()))return this._impl.annotate(this,t)}break(){this._selection&&!this._selection.isNull()&&this._impl.break(this)}copySelection(){const t=this.getDocument(),e=this._selection;if(e&&!e.isNull()&&!e.isCollapsed())return xd(t,this._selection)}deleteSelection(t){const e=this._selection;!e||e.isNull()||e.isCollapsed()||this._impl.delete(this,"right",t)}deleteCharacter(t){const e=this._selection;!e||e.isNull()||(e.isCollapsed()?this._impl.delete(this,t):this.deleteSelection())}insertText(t){const e=this._selection;e&&!e.isNull()&&this._impl.insertText(this,t)}insertInlineNode(t){const e=this._selection;if(e&&!e.isNull()&&e.isPropertySelection())return this._impl.insertInlineNode(this,t)}insertBlockNode(t){const e=this._selection;if(e&&!e.isNull())return this._impl.insertBlockNode(this,t)}paste(t){const e=this._selection;if(e&&!e.isNull()&&!e.isCustomSelection())return this._impl.paste(this,t)}switchTextType(t){const e=this._selection;if(e&&!e.isNull())return this._impl.switchTextType(this,t)}toggleList(t){const e=this._selection;if(e&&!e.isNull())return this._impl.toggleList(this,t)}indent(){const t=this._selection;if(t&&!t.isNull())return this._impl.indent(this)}dedent(){const t=this._selection;if(t&&!t.isNull())return this._impl.dedent(this)}getIndex(...t){return this._document.getIndex(...t)}getAnnotations(...t){return this._document.getAnnotations(...t)}getSchema(){return this._document.getSchema()}createSnippet(){return this._document.createSnippet()}}class kd{constructor(){this.SEPARATOR="\t"}serialize(t){var e=[];switch(t.type){case"create":e.push("c"),e.push(t.val.id),e.push(t.val);break;case"delete":e.push("d"),e.push(t.val.id),e.push(t.val);break;case"set":e.push("s"),e.push(t.path.join(".")),e.push(t.val),e.push(t.original);break;case"update":e.push("u"),e.push(t.path.join(".")),Array.prototype.push.apply(e,this.serializePrimitiveOp(t.diff));break;default:throw new Error("Unsupported operation type.")}return e}serializePrimitiveOp(t){var e=[];if(t._isTextOperation)t.isInsert()?e.push("t+"):t.isDelete()&&e.push("t-"),e.push(t.pos),e.push(t.str);else if(t._isArrayOperation)t.isInsert()?e.push("a+"):t.isDelete()&&e.push("a-"),e.push(t.pos),e.push(t.val);else{if(!t._isCoordinateOperation)throw new Error("Unsupported operation type.");if(!t.isShift())throw new Error("Unsupported CoordinateOperation type.");e.push("c>>"),e.push(t.pos),e.push(t.val)}return e}deserialize(t,e){e||(e=new Md(t,this.SEPARATOR));var r,n,s,i,o,a=e.getString();switch(a){case"c":n=e.getPath(),s=e.getObject(),r=Rh.Create(n,s);break;case"d":n=e.getPath(),s=e.getObject(),r=Rh.Delete(n,s);break;case"s":n=e.getPath(),s=e.getAny(),i=e.getAny(),r=Rh.Set(n,i,s);break;case"u":n=e.getPath(),o=this.deserializePrimitiveOp(t,e),r=Rh.Update(n,o);break;default:throw new Error("Illegal type for ObjectOperation: "+a)}return r}deserializePrimitiveOp(t,e){e||(e=new Md(t,this.SEPARATOR));var r,n,s,i=e.getString();switch(i){case"t+":n=e.getNumber(),s=e.getString(),r=vh.Insert(n,s);break;case"t-":n=e.getNumber(),s=e.getString(),r=vh.Delete(n,s);break;case"a+":n=e.getNumber(),s=e.getAny(),r=Nh.Insert(n,s);break;case"a-":n=e.getNumber(),s=e.getAny(),r=Nh.Delete(n,s);break;case"c>>":s=e.getNumber(),r=Oh.Shift(s);break;default:throw new Error("Unsupported operation type: "+i)}return r}}class Md{constructor(t,e){p(arguments[0])?this.tokens=arguments[0]:this.tokens=t.split(e),this.pos=-1}error(t){throw new Error("Parsing error: "+t+"\n"+this.tokens[this.pos])}getString(){this.pos++;var t=this.tokens[this.pos];return'"'===t[0]&&(t=t.slice(1,-1)),t}getNumber(){this.pos++;var t=this.tokens[this.pos];try{return s(t)?t:parseInt(this.tokens[this.pos],10)}catch(t){this.error("expected number")}}getObject(){this.pos++;var t=this.tokens[this.pos];try{return u(t)?t:JSON.parse(this.tokens[this.pos])}catch(t){this.error("expected object")}}getAny(){return this.pos++,this.tokens[this.pos]}getPath(){return this.getString().split(".")}}kd.Tokenizer=Md;class Rd{constructor(t,e,r){if(1===arguments.length&&eh(arguments[0])){let t=arguments[0];this.sha=t.sha,this.timestamp=t.timestamp,this.before=t.before||{},this.ops=t.ops,this.info=t.info,this.after=t.after||{}}else{if(3!==arguments.length)throw new Error("Illegal arguments.");this.sha=h(),this.info={},this.timestamp=Date.now(),this.ops=t.slice(0),this.before=e||{},this.after=r||{}}this.updated=null,this.created=null,this.deleted=null}_extractInformation(t){if(this._extracted)return;let e=this.ops,r={},n={},s={},i=[];function o(e){switch(e.type){case"create":case"delete":{let t=e.val;t.hasOwnProperty("start")&&t.start.path&&(s[Zu(t.start.path)]=!0),t.hasOwnProperty("end")&&t.end.path&&(s[Zu(t.end.path)]=!0);break}case"update":case"set":{let r=t.get(e.path[0]);r&&(r.isPropertyAnnotation()?s[Zu(r.start.path)]=!0:r.isContainerAnnotation()&&i.push(r));break}}}for(let t=0;t<e.length;t++){let i=e[t];"create"===i.type&&(r[i.val.id]=i.val,delete n[i.val.id]),"delete"===i.type&&(delete r[i.val.id],n[i.val.id]=i.val),"set"!==i.type&&"update"!==i.type||(s[Zu(i.path)]=!0,s[i.path[0]]=!0),o(i)}i.forEach(e=>{let r=ih(t,e.containerPath,e.start.path[0]),i=ih(t,e.containerPath,e.end.path[0]),o=t.get(e.containerPath);for(let e=r;e<=i;e++){let r,i=t.get(o[e]);r=i.isText()?i.getPath():[i.id],n[i.id]||(s[Zu(r)]=!0)}}),Object.keys(n).length>0&&f(s,function(t,e){let r=e.split(".")[0];n[r]&&delete s[e]}),this.created=r,this.deleted=n,this.updated=s,this._extracted=!0}invert(){let t=this.toJSON();t.ops=[];let e=t.before;t.before=t.after,t.after=e;let r=Rd.fromJSON(t),n=[];for(let t=this.ops.length-1;t>=0;t--)n.push(this.ops[t].invert());return r.ops=n,r}hasUpdated(t){let e;return e=n(t)?t:Zu(t),this.updated[e]}hasDeleted(t){return this.deleted[t]}serialize(){let t=new kd,e=this.toJSON();return e.ops=this.ops.map(function(e){return t.serialize(e)}),JSON.stringify(e)}clone(){return Rd.fromJSON(this.toJSON())}toJSON(){let t={sha:this.sha,before:Ma(this.before),ops:Lu(this.ops,function(t){return t.toJSON()}),info:this.info,after:Ma(this.after)};t.after.selection=void 0,t.before.selection=void 0;let e=this.before.selection;return e&&e._isSelection&&(t.before.selection=e.toJSON()),(e=this.after.selection)&&e._isSelection&&(t.after.selection=e.toJSON()),t}}Rd.deserialize=function(t){let e=new kd,r=JSON.parse(t);return r.ops=r.ops.map(function(t){return e.deserialize(t)}),r.before.selection&&(r.before.selection=oh(r.before.selection)),r.after.selection&&(r.after.selection=oh(r.after.selection)),new Rd(r)},Rd.fromJSON=function(t){let e=th(t);return e.ops=t.ops.map(function(t){return Rh.fromJSON(t)}),e.before.selection=oh(t.before.selection),e.after.selection=oh(t.after.selection),new Rd(e)};class qd extends Ld{constructor(t){super(t.clone())}generateChange(){const t=this.getDocument(),e=t._ops.slice();t._ops.length=0;let r=new Rd(e,{},{});return r._extractInformation(t),r}}class Bd{constructor(t,e){this.name=t,this.definition=e,Object.freeze(this),Object.freeze(e)}isArray(){return p(this.definition.type)}isReference(){return this.isArray()?"id"===O(this.definition.type):"id"===this.definition.type}isText(){return Boolean(this.definition._isText)}isContainer(){return Boolean(this.definition._isContainer)}isOwned(){return Boolean(this.definition.owned)}isOptional(){return this.definition.optional||this.hasDefault()}isNotNull(){return Boolean(this.definition.notNull)}hasDefault(){return this.definition.hasOwnProperty("default")}getDefault(){return this.definition.default}createDefaultValue(){if(p(this.definition.type))return[];switch(this.definition.type){case"boolean":return!1;case"string":return"";case"number":return-1;case"object":return{};case"coordinate":return new On([],0);default:return null}}get type(){return this.definition.type}get targetTypes(){return this.definition.targetTypes}get defaultTextType(){return this.definition.defaultTextType}get values(){return this.definition.values}}class jd{constructor(t,e){this._properties=t,this._superTypes=e,this._ownedPropNames=new Set,this._ownedProps=[];for(let e of t.values())(e.isReference()&&e.isOwned()||"file"===e.type)&&(this._ownedPropNames.add(e.name),this._ownedProps.push(e))}getProperty(t){return this._properties.get(t)}hasOwnedProperties(){return this._ownedPropNames.size>0}getOwnedProperties(){return this._ownedProps.slice()}isOwned(t){return this._ownedPropNames.has(t)}getSuperType(){return this._superTypes[0]}getSuperTypes(){return this._superTypes.slice()}[Symbol.iterator](){return this._properties.values()}}const Fd=new Set(["id","string","number","boolean","enum","object","array","coordinate"]);class Ud extends od{constructor(...t){super(),this._properties={},this._initialize(...t)}_initialize(t){let e=this.constructor.schema;for(let r of e){let e=r.name;const n=void 0!==t[e],s=r.isOptional(),i=r.hasDefault();if(!s&&!n)throw new Error("Property "+e+" is mandatory for node type "+this.type);n?this._properties[e]=Vd(r,t[e]):i&&(this._properties[e]=th(Vd(r,r.getDefault())))}}dispose(){this._disposed=!0}isDisposed(){return Boolean(this._disposed)}isInstanceOf(t){return Ud.isInstanceOf(this.constructor,t)}getSchema(){return this.constructor.schema}getTypeNames(){let t=this.constructor,e=this.schema.getSuperTypes();return t.hasOwnProperty("type")&&e.unshift(t.type),e}getPropertyType(t){return this.constructor.schema.getProperty(t).type}toJSON(){var t={type:this.type};const e=this.getSchema();for(let r of e){let e=this[r.name];r.isOptional()&&void 0===e||((p(e)||u(e))&&(e=th(e)),t[r.name]=e)}return t}get type(){return this.constructor.type}_set(t,e){this._properties[t]=e}static isInstanceOf(t,e){let r=t.schema;if(!r)return!1;if(t.type===e)return!0;for(let t of r._superTypes)if(t===e)return!0;return!1}get _isNode(){return!0}static _defineSchema(t){Ud.schema=t}}function Hd(t){return Fd.has(t)}function Vd(t,e){let r,i=t.name;if(r=t.isArray()?"array":t.type,null===e){if(t.isNotNull())throw new Error("Value for property "+i+" is null.");return e}if(void 0===e)throw new Error("Value for property "+i+" is undefined.");if("string"===r&&!n(e)||"enum"===r&&!n(e)||"boolean"===r&&!fd(e)||"number"===r&&!s(e)||"array"===r&&!p(e)||"id"===r&&!n(e)||"object"===r&&!u(e))throw new Error("Illegal value type for property "+i+": expected "+r+", was "+typeof e);return e}function zd(t){var e=[];let r=Gd(t);for(;r&&"@node"!==r.type;)r.hasOwnProperty("type")&&e.push(r.type),r=Gd(r);return e}function Gd(t){var e=Object.getPrototypeOf(t.prototype);if(e)return e.constructor}Object.defineProperty(Ud,"schema",{get(){let t=this;if(!t.hasOwnProperty("_schema")){let e=Gd(t).schema;t._schema=new jd(e._properties,zd(t))}return t._schema},set(t){let e=this;t.type&&(e.type=t.type),e._schema=function(t,e){let r=[function(t){let e=new Map;return f(t,function(t,r){"type"!==r&&((t=function(t){let e=Object.assign({},t),r=t.type;if(p(r)){let t=r,n=t.length-1,s=t[0],i=t[n],o="array"===s;o?(e.type=t.slice(),"id"===i||Hd(i)||(e.targetTypes=[i],e.type[n]="id")):t.length>1?(t.forEach(t=>{if(Hd(t))throw new Error("Multi-types must consist of node types.")}),e.type=["array","id"],e.targetTypes=t):Hd(s)?e.type=["array",s]:(e.type=["array","id"],e.targetTypes=t)}else"text"===r?e={type:"string",default:"",_isText:!0,targetTypes:t.targetTypes}:"id"===r||Hd(r)||(e.type="id",e.targetTypes=[r]);return e.targetTypes&&(e.targetTypes=new Set(e.targetTypes)),e}(t=n(t)||p(t)?{type:t}:th(t))).name=r,e.set(r,new Bd(r,t)))}),e}(e)],s=Gd(t);for(;s;)s&&s._schema&&r.unshift(s._schema._properties),s=Gd(s);let i=zd(t),o=new jd(function(t){let e=new Map;for(let r of t)for(let[t,n]of r)e.has(t)&&e.delete(t),e.set(t,n);return e}(r),i);for(let e of o){let r=e.name;Object.defineProperty(t.prototype,r,{get(){return this._properties[r]},set(t){this.set(r,t)},enumerable:!0,configurable:!0})}return o}(e,t)}}),Ud.schema={type:"@node",id:"string"};class $d{constructor(t,e){this.id=t,this.type=e,this.prev=null,this.property=null,this.pos=null}toJSON(){let t={id:this.id,type:this.type};return this.property&&(t.property=this.property),s(this.pos)&&(t.pos=this.pos),t}toArray(){let t=[this.toJSON()],e=this;for(;e.prev;)e=e.prev,t.unshift(e.toJSON());return t}}const Jd=new class extends mt.DomUtils{isTag(){return!0}getChildren(t){return Ou(t)}getParent(t){return Au(t)}getAttributeValue(t,e){return t[e]}getAttributes(t){return["id",t.id]}hasAttrib(t,e){return"id"===e||t.hasOwnProperty(e)}getName(t){return t.type}getNameWithoutNS(t){return this.getName(t)}getText(t){return t.isText()?t.getText():""}};class Kd extends Ud{_initialize(t,e){this.document=t,super._initialize(e),this._xpath=new $d(this.id,this.type)}getDocument(){return this.document}resolve(t){let e=this[t];if(e){let t=this.getDocument();return p(e)?e.map(e=>t.get(e)):t.get(e)}}set(t,e){this.getDocument().set([this.id,t],e)}assign(t){t&&Object.keys(t).forEach(e=>{this.set(e,t[e])})}hasParent(){return Boolean(this.parent)}getParent(){return n(this.parent)?this.document.get(this.parent):this.parent}setParent(t){n(t)&&(t=this.document.get(t)),this.parent=t}getRoot(){let t=this;for(;t.parent;)t=t.parent;return t}find(t){return qt.selectOne(t,this,{xmlMode:!0,adapter:Jd})}findAll(t){return qt.selectAll(t,this,{xmlMode:!0,adapter:Jd})}getXpath(){return this._xpath}getPosition(){return this._xpath.pos}isAnchor(){return this.constructor.isAnchor()}isAnnotation(){return this.constructor.isAnnotation()}isContainer(){return this.constructor.isContainer()}isContainerAnnotation(){return this.constructor.isContainerAnnotation()}isInlineNode(){return this.constructor.isInlineNode()}isList(){return this.constructor.isList()}isListItem(){return this.constructor.isListItem()}isPropertyAnnotation(){return this.constructor.isPropertyAnnotation()}isText(){return this.constructor.isText()}static isAnchor(){return!1}static isAnnotation(){return!1}static isBlock(){return!1}static isContainer(){return!1}static isContainerAnnotation(){return!1}static isInlineNode(){return!1}static isList(){return!1}static isListItem(){return!1}static isPropertyAnnotation(){return!1}static isText(){return!1}get _isDocumentNode(){return!0}}function Wd(t){return class extends t{getContentPath(){throw new Error("This method is abstract")}getContent(){return this.getDocument().get(this.getContentPath())}contains(t){return this.getChildIndex(t)>=0}getNodeAt(t){const e=this._getNodeIdAt(t);if(e)return this.getDocument().get(e)}getNodes(){const t=this.getDocument();return this.getContent().map(e=>t.get(e)).filter(Boolean)}getNodeIndex(t){return this.getContent().indexOf(t)}getPath(){return this.getContentPath()}append(t){const e=arguments[0];return n(e)||e._isNode&&(t=e.id),this.insertAt(this.length,t)}insertAt(t,e){const r=this.getDocument(),i=this.length;if(!s(t)||t<0||t>i)throw new Error("Index out of bounds");if(!n(e)){if(!e._isNode)throw new Error("Invalid argument.");e=e.id}r.update(this.getContentPath(),{type:"insert",pos:t,value:e})}remove(t){const e=ih(this.getDocument(),this.getContentPath(),t);this.removeAt(e)}removeAt(t){const e=this.length;if(!(t>=0&&t<e))throw new Error("Index out of bounds.");this.getDocument().update(this.getContentPath(),{type:"delete",pos:t})}get length(){return this.getLength()}getLength(){return this.getContent().length}_getNodeIdAt(t){let e=this.getContent();return t<0||t>=e.length?void 0:e[t]}static isContainer(){return!0}}}class Xd extends(Wd(Kd)){getContentPath(){return[this.id,"nodes"]}getContent(){return this.nodes}}Xd.schema={type:"@container",nodes:{type:["array","id"],default:[],owned:!0}};class Yd extends(Vu(Kd)){setHighlighted(t,e){this.highlighted!==t&&(this.highlighted=t,this.highlightedScope=e,this.emit("highlighted",t,e),f(this.fragments,function(r){r.emit("highlighted",t,e)}))}static isAnnotation(){return!0}static isContainerAnnotation(){return!0}}Yd.schema={type:"@container-annotation",containerPath:{type:["array","id"]},start:"coordinate",end:"coordinate"};class Zd extends ou{constructor(){super(),this.byId=new Ru}select(t){return t.isContainerAnnotation()}clear(){this.byId.clear()}get(t,e){var r=Lu(this.byId.get(String(t)));return n(e)&&(r=au(r,ou.filterByType)),r}create(t){this.byId.set([String(t.containerPath),t.id],t)}delete(t){this.byId.delete([String(t.containerPath),t.id])}update(t,e,r,n){}}class Qd extends od{constructor(t,e){if(super(),!t)throw new Error("schema is mandatory");if(!e)throw new Error("nodeFactory is mandatory");this.schema=t,this.nodeFactory=e,this.nodes={},this.indexes={},this.__QUEUE_INDEXING__=!1,this.queue=[]}contains(t){return Boolean(this.nodes[t])}get(t,e){let r=this._get(t);if(e&&void 0===r)throw n(t)?new Error("Could not find node with id '"+t+"'."):this.contains(t[0])?new Error("Property for path '"+t+"' us undefined."):new Error("Could not find node with id '"+t[0]+"'.");return r}_get(t){if(!t)return;let e;if(n(t)){let r=t;e=this.nodes[r]}else if(1===t.length){let r=t[0];e=this.nodes[r]}else if(t.length>1){let r=t[0],n=this.nodes[r];for(let e=1;e<t.length-1;e++){if(!n)return;n=n[t[e]]}if(!n)return;e=n[t[t.length-1]]}return e}getNodes(){return this.nodes}create(t){var e=this.nodeFactory.create(t.type,t);if(!e)throw new Error("Illegal argument: could not create node for data:",t);if(this.contains(e.id))throw new Error("Node already exists: "+e.id);if(!e.id||!e.type)throw new Error("Node id and type are mandatory.");this.nodes[e.id]=e;var r={type:"create",node:e};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),e}delete(t){var e=this.nodes[t];if(e){e.dispose(),delete this.nodes[t];var r={type:"delete",node:e};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),e}}set(t,e){let r=this.get(t[0]),n=this._set(t,e);var s={type:"set",node:r,path:t,newValue:e,oldValue:n};return this.__QUEUE_INDEXING__?this.queue.push(s):this._updateIndexes(s),n}_set(t,e){return function(t,e,r){p(r)?r=r.slice():eh(r)&&(r=th(r));let n=t,s=e.length;for(let t=0;t<s-1;t++)if(!(n=n[e[t]]))throw new Error("Can not set value.");let i=e[s-1],o=n[i];n._isNode?n._set(i,r):n[i]=r;return o}(this.nodes,t,e)}update(t,e){let r,s=this.get(t[0]),i=this._get(t);if(e._isOperation)if(e._isArrayOperation){let t=i;i=Array.from(i),r=e.apply(t)}else if(e._isCoordinateOperation){let t=i;i=i.clone(),r=e.apply(t)}else r=e.apply(i);else if(e=this._normalizeDiff(i,e),n(i))switch(e.type){case"delete":r=i.split("").splice(e.start,e.end-e.start).join("");break;case"insert":r=[i.substring(0,e.start),e.text,i.substring(e.start)].join("");break;default:throw new Error("Unknown diff type")}else if(p(i))switch(r=i.slice(0),e.type){case"delete":r.splice(e.pos,1);break;case"insert":r.splice(e.pos,0,e.value);break;default:throw new Error("Unknown diff type")}else{if(!i._isCoordinate)throw new Error("Diff is not supported:",JSON.stringify(e));switch(e.type){case"shift":(r=i={path:i.path,offset:i.offset}).offset+=e.value;break;default:throw new Error("Unknown diff type")}}this._set(t,r);var o={type:"update",node:s,path:t,newValue:r,oldValue:i};return this.__QUEUE_INDEXING__?this.queue.push(o):this._updateIndexes(o),i}_normalizeDiff(t,e){return n(t)?e.delete?(console.warn('DEPRECATED: use doc.update(path, {type:"delete", start:s, end: e}) instead'),e={type:"delete",start:e.delete.start,end:e.delete.end}):e.insert&&(console.warn('DEPRECATED: use doc.update(path, {type:"insert", start:s, text: t}) instead'),e={type:"insert",start:e.insert.offset,text:e.insert.value}):p(t)?e.delete?(console.warn('DEPRECATED: use doc.update(path, {type:"delete", pos:1}) instead'),e={type:"delete",pos:e.delete.offset}):e.insert&&(console.warn('DEPRECATED: use doc.update(path, {type:"insert", pos:1, value: "foo"}) instead'),e={type:"insert",pos:e.insert.offset,value:e.insert.value}):t._isCoordinate&&e.hasOwnProperty("shift")&&(console.warn('DEPRECATED: use doc.update(path, {type:"shift", value:2}) instead'),e={type:"shift",value:e.shift}),e}toJSON(){let t={};return f(this.nodes,e=>{t[e.id]=e.toJSON()}),{schema:[this.schema.id,this.schema.version],nodes:t}}reset(){this.clear()}clear(){this.nodes={},f(this.indexes,t=>t.clear())}addIndex(t,e){return this.indexes[t]&&console.error("Index with name %s already exists.",t),e.reset(this),this.indexes[t]=e,e}getIndex(t){return this.indexes[t]}_updateIndexes(t){t&&!this.__QUEUE_INDEXING__&&f(this.indexes,function(e){if(e.select(t.node))switch(e[t.type]||console.error("Contract: every NodeIndex must implement "+t.type),t.type){case"create":e.create(t.node);break;case"delete":e.delete(t.node);break;case"set":e.set(t.node,t.path,t.newValue,t.oldValue);break;case"update":e.update(t.node,t.path,t.newValue,t.oldValue);break;default:throw new Error("Illegal state.")}})}_stopIndexing(){this.__QUEUE_INDEXING__=!0}_startIndexing(){for(this.__QUEUE_INDEXING__=!1;this.queue.length>0;){var t=this.queue.shift();this._updateIndexes(t)}}}class tp{constructor(t,e){this.fileNode=t,this.context=e,t.setProxy(this)}get id(){return this.fileNode.id}triggerUpdate(){let t=this.fileNode.id;this.context.editorSession.transaction(e=>{e.set([t,"__changed__"],"")},{history:!1})}getUrl(){return""}sync(){return Promise.reject(new Error("sync method not implemented"))}}tp.match=function(t,e){return!1};class ep extends iu{constructor(t){super(),this._property=t||"id",this.index=new Ru}get(t){return this.index.get(t)||{}}getAll(t){return this.index.getAll(t)}clear(){this.index.clear()}select(t){return!0}create(t){var e=t[this._property];p(e)||(e=[e]),f(e,function(e){this.index.set([e,t.id],t)}.bind(this))}delete(t){var e=t[this._property];p(e)||(e=[e]),f(e,function(e){this.index.delete([e,t.id])}.bind(this))}update(t,e,r,n){if(this.select(t)&&e[1]===this._property){var s=n;p(s)||(s=[s]),f(s,function(e){this.index.delete([e,t.id])}.bind(this)),p(s=r)||(s=[s]),f(s,function(e){this.index.set([e,t.id],t)}.bind(this))}}set(t,e,r,n){this.update(t,e,r,n)}_initialize(t){f(t.getNodes(),function(t){this.select(t)&&this.create(t)}.bind(this))}}class rp extends Qd{create(t){t._isNode&&(t=t.toJSON());let e=Rh.Create([t.id],t);return this.apply(e),e}delete(t){var e=null,r=this.get(t);if(r){var n=r.toJSON();e=Rh.Delete([t],n),this.apply(e)}return e}update(t,e){var r=this._getDiffOp(t,e),n=Rh.Update(t,r);return this.apply(n),n}set(t,e){var r=this.get(t),n=Rh.Set(t,r,e);return this.apply(n),n}apply(t){if(t.type!==Rh.NOP){if(t.type===Rh.CREATE)super.create(th(t.val));else if(t.type===Rh.DELETE)super.delete(t.val.id);else if(t.type===Rh.UPDATE){let e=t.diff;super.update(t.path,e)}else{if(t.type!==Rh.SET)throw new Error("Illegal state.");super.set(t.path,t.val)}this.emit("operation:applied",t,this)}}_getDiffOp(t,e){var r=null;if(e._isOperation)r=e;else{var s=this.get(t);if(e=this._normalizeDiff(s,e),null===s||void 0===s)throw new Error("Property has not been initialized: "+JSON.stringify(t));if(n(s))switch(e.type){case"delete":r=vh.Delete(e.start,s.substring(e.start,e.end));break;case"insert":r=vh.Insert(e.start,e.text);break;default:throw new Error("Unknown diff type")}else if(p(s))switch(e.type){case"delete":r=Nh.Delete(e.pos,s[e.pos]);break;case"insert":r=Nh.Insert(e.pos,e.value);break;default:throw new Error("Unknown diff type")}else if(s._isCoordinate)switch(e.type){case"shift":r=Oh.Shift(e.value);break;default:throw new Error("Unknown diff type")}}if(!r)throw new Error("Unsupported diff: "+JSON.stringify(e));return r}}class np{constructor(t){this.doc=t}create(t,e){var r=this.doc.schema.getNodeClass(t);if(!r)throw new Error("No node registered by that name: "+t);return new r(this.doc,e)}}class sp{importDocument(t,e){if(!e.nodes)throw new Error("Invalid JSON format.");var r=e.nodes;return t.import(t=>{r.forEach(e=>t.create(e))}),t}exportDocument(t){var e={schema:{name:t.getSchema().name},nodes:[]};let r={};return f(t.getNodes(),n=>(function n(s){if(!s)return;if(r[s.id])return;r[s.id]=!0,s.getSchema().getOwnedProperties().forEach(e=>{let r=s[e.name];p(r)?r.forEach(e=>{n(t.get(e))}):n(t.get(r))}),e.nodes.push(s.toJSON())})(n)),e}}class ip{constructor(t){this.doc=t,this.parents={},t.data.on("operation:applied",this._onOperationApplied,this)}_onOperationApplied(t){let e,r=this.doc.get(t.path[0]),n=!1,s=!1;switch(r&&(n=(e=r.getSchema()).hasOwnedProperties(),s=r.isAnnotation()),t.type){case"create":if(n)for(let t of e.getOwnedProperties()){let e=t.isArray(),n=r[t.name];n&&this._setParent(r,n,t.name,e),e&&this._updateContainerPositions([r.id,t.name])}s&&this._setAnnotationParent(r),this._setRegisteredParent(r);break;case"update":if(n){let n=t.path[1];if(e.isOwned(n)){let e=t.diff,s=e._isArrayOperation;e.isDelete()?this._setParent(null,e.getValue(),n,s):this._setParent(r,e.getValue(),n,s),s&&this._updateContainerPositions(t.path)}}break;case"set":if(n){let n=t.path[1];if(e.isOwned(n)){let s=e.getProperty(n).isArray(),i=t.getOldValue(),o=t.getValue();this._setParent(null,i,n,s),this._setParent(r,o,n,s),s&&this._updateContainerPositions(t.path)}}s&&"start"===t.path[1]&&"path"===t.path[2]&&this._setAnnotationParent(r)}}_setParent(t,e,r,n){e&&(p(e)?e.forEach(e=>this.__setParent(t,e,r,n)):this.__setParent(t,e,r,n))}__setParent(t,e,r,n){let s=this.doc.get(e);s?this._setParentAndXpath(t,s,r):this.parents[e]={parent:t,property:r,isChildren:n}}_setRegisteredParent(t){let e=this.parents[t.id];if(e){let{parent:r,property:n,isChildren:s}=e;this._setParentAndXpath(r,t,n),s&&(t._xpath.pos=r[n].indexOf(t.id)),delete this.parents[t.id]}}_setParentAndXpath(t,e,r){e.setParent(t);let n=e._xpath;t?(n.prev=t._xpath,n.property=r):(n.prev=null,n.property=null,n.pos=null)}_updateContainerPositions(t){let e=this.doc,r=e.get(t);if(r)for(let t=0;t<r.length;t++){let n=r[t],s=e.get(n);s&&(s._xpath.pos=t)}}_setAnnotationParent(t){let e=t.getDocument(),r=t.start.path,n=e.get(r[0]);this._setParent(n,t.id,r[1])}}ip.register=function(t){return new ip(t)};const op=new sp;class ap extends ud{register(t){var e=t.prototype.type;if(!n(e)||!e)throw new Error("Node type must be string and not empty");if(!t.prototype._isNode)throw new Error("Nodes must be subclasses of Substance.Data.Node");this.contains(e)&&(console.info("Overriding node type",e),this.remove(e)),this.add(e,t)}}class lp{constructor(t){arguments.length>1&&(console.warn('DEPRECATED: use "new Schema(options)" instead'),t={name:arguments[0],version:arguments[1]}),this.name=t.name,this.version=t.version,this.nodeRegistry=new ap,this.addNodes(this.getBuiltIns()),t.nodes&&this.addNodes(t.nodes)}addNodes(t){t&&f(t,t=>{t.prototype._isNode?this.addNode(t):console.error("Illegal node class: ",t)})}addNode(t){this.nodeRegistry.register(t)}getNodeClass(t,e){return this.nodeRegistry.get(t,e)}getBuiltIns(){return[]}isInstanceOf(t,e){var r=this.getNodeClass(t);return!!r&&Ud.isInstanceOf(r,e)}each(...t){return this.nodeRegistry.each(...t)}getDefaultTextType(){throw new Error("Schmema.prototype.getDefaultTextType() must be overridden.")}getNodeSchema(t){var e=this.getNodeClass(t);return e?e.schema:(console.error("Unknown node type ",t),null)}}class cp extends(Vu(Kd)){get _isAnnotation(){return!0}get _isPropertyAnnotation(){return!0}static isPropertyAnnotation(){return!0}static get autoExpandRight(){return!0}}cp.schema={type:"@annotation",_content:{type:"string",optional:!0}};class hp{constructor(t,e={}){if(!t.converters)throw new Error("params.converters is mandatory");if(!t.elementFactory)throw new Error("'elementFactory' is mandatory");this.converters=new ud,t.converters.forEach(t=>{let e=d(t)?new t:t;e.type?this.converters.add(e.type,e):console.error("Converter must provide the type of the associated node.",e)}),this.elementFactory=t.elementFactory,this.idAttribute=t.idAttribute||"id",this.state={doc:null},this.options=e,this.$$=this.createElement.bind(this)}exportDocument(t){return this.convertDocument(t)}convertDocument(t){throw new Error("This method is abstract")}convertContainer(t,e){if(!e)throw new Error("Illegal arguments: containerPath is mandatory.");return this.state.doc=t,t.get(e).map(e=>{let r=t.get(e);return this.convertNode(r)})}convertNode(t){this.state.doc=t.getDocument();let e,r=this.getNodeConverter(t);return!t.isPropertyAnnotation()||r&&r.export?(r||(r=this.getDefaultBlockConverter()),(e=r.tagName?this.$$(r.tagName):this.$$("div")).attr(this.idAttribute,t.id),e=r.export?r.export(t,e,this)||e:this.getDefaultBlockConverter().export(t,e,this)||e):this._convertPropertyAnnotation(t)}convertProperty(t,e,r){return this.state.doc=t,this.initialize(t,r),this.$$("div").append(this.annotatedText(e)).innerHTML}annotatedText(t,e){let r=(e=e||this.state.doc).get(t),n=e.getIndex("annotations").get(t);return this._annotatedText(r,n)}getNodeConverter(t){return this.converters.get(t.type)}getDefaultBlockConverter(){throw new Error("This method is abstract.")}getDefaultPropertyAnnotationConverter(){throw new Error("This method is abstract.")}getDocument(){return this.state.doc}createElement(t){return this.elementFactory.createElement(t)}_annotatedText(t,e){let r=new Hu;r.onText=((t,e)=>{e&&(this.options.ENCODE_ENTITIES_IN_TEXT&&(e=rd(e)),t.children.push(e))}),r.onOpen=function(t){return{children:[]}},r.onClose=((t,e,r)=>{let n,s=t.node,i=this.getNodeConverter(s);if(i||(i=this.getDefaultPropertyAnnotationConverter()),(n=i.tagName?this.$$(i.tagName):this.$$("span")).attr(this.idAttribute,s.id),s.isInlineNode())n=i.export?i.export(s,n,this)||n:this.convertNode(s)||n;else{if(!s.isAnnotation())throw new Error("Illegal element type: only inline nodes and annotations are allowed within a TextNode");if(i.export&&(n=i.export(s,n,this)||n).children.length)throw new Error("A converter for an annotation type must not convert children. The content of an annotation is owned by their TextNode.");n.append(e.children)}r.children.push(n)});let n={children:[]};return r.start(n,t,e),n.children}_convertPropertyAnnotation(t){return this.$$("div").append(this.annotatedText(t.path)).find("["+this.idAttribute+'="'+t.id+'"]')}}const up=/^\s+/g,dp=/\s+$/g,pp=/\s+/g,fp=" ",gp=/[\t\n\r]+/g,mp="​";class _p{constructor(t,e,r={}){if(!t.converters)throw new Error('"params.converters" is mandatory');if(!e)throw new Error('"doc" is mandatory');this.converters=t.converters,this.idAttribute=t.idAttribute||"id",this.options=r,this._defaultBlockConverter=null,this._allConverters=[],this._blockConverters=[],this._propertyAnnotationConverters=[],this.state=new _p.State,this.state.doc=e,this._initialize()}_initialize(){const t=this._getSchema(),e=this.converters,r=t.getDefaultTextType();for(let n=0;n<e.length;n++){let s;if("function"==typeof e[n]){s=new(0,e[n])}else s=e[n];if(!s.type)throw new Error("Converter must provide the type of the associated node.");if(!s.matchElement&&!s.tagName)throw new Error("Converter must provide a matchElement function or a tagName property.");s.matchElement||(s.matchElement=this._defaultElementMatcher.bind(s));const i=t.getNodeClass(s.type);if(!i)throw new Error("No node type defined for converter");r&&!this._defaultBlockConverter&&r===s.type&&(this._defaultBlockConverter=s),this._allConverters.push(s),i.isPropertyAnnotation()||i.isInlineNode()?this._propertyAnnotationConverters.push(s):this._blockConverters.push(s)}}dispose(){this.state.doc&&this.state.doc.dispose()}reset(){this.state.doc&&this.state.doc.dispose(),this.state.reset(),this.state.doc=this._createDocument()}getDocument(){return this.state.doc}convertContainer(t,e){this.state.doc||this.reset();const r=this.state,n=new g(t),s=[];for(;n.hasNext();){const t=n.next();let e;const i=this._getConverterForElement(t,"block");if(i){r.pushContext(t.tagName,i);let n=this._createNodeData(t,i.type);n=i.import(t,n,this)||n,e=this._createNode(n),r.popContext().annos.forEach(t=>{this._createNode(t)})}else{if(t.isCommentNode())continue;if(t.isTextNode()&&/^\s*$/.exec(t.textContent))continue;n.back(),e=this._wrapInlineElementsIntoBlockElement(n)}e&&s.push(e.id)}return this._createNode({type:"@container",id:e,nodes:s})}convertElement(t){const e=this._getSchema();this.state.doc||this.reset();let r,n,s=!this.state.isConverting;s&&(this.state.isConverting=!0);const i=this._getConverterForElement(t);if(!i)throw new Error("No converter found for "+t.tagName);{const s=e.getNodeClass(i.type);r=this._createNodeData(t,i.type),this.state.pushContext(t.tagName,i),r=s.isInlineNode()?this._convertInlineNode(t,r,i):s.isPropertyAnnotation()?this._convertPropertyAnnotation(t,r):i.import(t,r,this)||r,n=this.state.popContext().annos}const o=this._createNode(r);return n.forEach(t=>{this._createNode(t)}),this.options["stand-alone"]&&s&&(this.state.isConverting=!1,this.reset()),o}annotatedText(t,e,r={}){if(!e)throw new Error("path is mandatory");const n=this.state,s=O(n.contexts);if(!s)throw new Error("This should be called from within an element converter.");const i=n.preserveWhitespace;r.preserveWhitespace&&(n.preserveWhitespace=!0),n.stack.push({path:e,offset:0,text:"",annos:[]}),this.state.lastChar="";const o=this.getChildNodeIterator(t),a=this._annotatedText(o),l=n.stack.pop();return s.annos=s.annos.concat(l.annos),n.preserveWhitespace=i,a}plainText(t){var e=this.state,r=t.textContent;if(e.stack.length>0){var n=O(e.stack);n.offset+=r.length,n.text+=n.text.concat(r)}return r}_customText(t){var e=this.state;if(e.stack.length>0){var r=O(e.stack);r.offset+=t.length,r.text+=r.text.concat(t)}return t}nextId(t){return this.state.uuid(t)}_getNextId(t,e){let r=this.nextId(e);for(;this.state.ids[r]||t.find("#"+r);)r=this.nextId(e);return r}_getIdForElement(t,e){let r=t.getAttribute(this.idAttribute);return r&&!this.state.ids[r]?r:this._getNextId(t.getOwnerDocument(),e)}_getSchema(){return this.state.doc.getSchema()}_createDocument(){return this.state.doc.newInstance()}_convertPropertyAnnotation(t,e){const r=[e.id,"_content"];return e._content=this.annotatedText(t,r),e.start={path:r,offset:0},e.end={offset:e._content.length},e}_convertInlineNode(t,e,r){const n=[e.id,"_content"];return r.import&&(e=r.import(t,e,this)||e),e._content="$",e.start={path:n,offset:0},e.end={offset:1},e}_createNodeData(t,e){if(!e)throw new Error("type is mandatory.");let r={type:e,id:this._getIdForElement(t,e)};return this.state.ids[r.id]=!0,r}_createNode(t){let e=this.state.doc,r=e.get(t.id);return r&&e.delete(r.id),e.create(t)}getChildNodeIterator(t){return t.getChildNodeIterator()}_defaultElementMatcher(t){return t.is(this.tagName)}_annotatedText(t){const e=this._getSchema(),r=this.state,n=O(r.stack);if(!n)throw new Error("Illegal state: context is null.");for(;t.hasNext();){var s=t.next(),i="";if(s.isTextNode())(i=this._prepareText(s.textContent)).length&&(n.text=n.text.concat(i),n.offset+=i.length);else{if(s.isCommentNode())continue;if(s.isElementNode()){const t=this._getConverterForElement(s,"inline");if(!t){this.IGNORE_DEFAULT_WARNINGS||console.warn("Unsupported inline element. We will not create an annotation for it, but process its children to extract annotated text.",s.outerHTML);const t=this.getChildNodeIterator(s);this._annotatedText(t);continue}var o=n.offset;const i=t.type,a=e.getNodeClass(i);if(!a)throw new Error(`No Node class registered for type ${i}.`);let l=this._createNodeData(s,i),c={path:n.path,offset:o,text:"",annos:[]};if(r.stack.push(c),t.import&&(r.pushContext(s.tagName,t),l=t.import(s,l,this)||l,r.popContext()),a.isInlineNode())this._customText(mp),r.lastChar="";else{const t=this.getChildNodeIterator(s);this._annotatedText(t)}r.stack.pop(),n.offset=c.offset,n.text=n.text.concat(c.text);const h=n.offset;l.start={path:n.path.slice(0),offset:o},l.end={offset:h};let u=O(r.stack);u.annos=u.annos.concat(c.annos,l)}else console.warn("Unknown element type. Taking plain text.",s.outerHTML),i=this._prepareText(s.textContent),n.text=n.text.concat(i),n.offset+=i.length}}return n.text}_getConverterForElement(t,e){let r;if("block"===e){if(!t.tagName)return null;r=this._blockConverters}else r="inline"===e?this._propertyAnnotationConverters:this._allConverters;let n=null;for(let e=0;e<r.length;e++)if(this._converterCanBeApplied(r[e],t)){n=r[e];break}return n||("inline"===e?this._getUnsupportedInlineElementConverter():this._getUnsupportedElementConverter())}_getUnsupportedElementConverter(){}_getUnsupportedInlineElementConverter(){}_converterCanBeApplied(t,e){return t.matchElement(e,this)}_wrapInlineElementsIntoBlockElement(t){if(!t.hasNext())return;const e=this._getSchema(),r=this._defaultBlockConverter;if(!r)throw new Error("Wrapping inline elements automatically is not supported in this schema.");let n=t.peek().getOwnerDocument(),s=n.createElement("wrapper");for(;t.hasNext();){const e=t.next();if(this._getConverterForElement(e,"block")){t.back();break}s.append(e.clone())}const i=e.getDefaultTextType();let o={type:i,id:this._getNextId(n,i)};this.state.pushContext("wrapper",r),o=r.import(s,o,this)||o;let a=this.state.popContext().annos;const l=this._createNode(o);return a.forEach(t=>{this._createNode(t)}),l}_prepareText(t){const e=this.state;if(e.preserveWhitespace)return t;var r=fp;return t=t.replace(gp,""),t=(t=e.lastChar===fp?t.replace(up,""):t.replace(up,r)).replace(dp,r),(this.options.REMOVE_INNER_WS||e.removeInnerWhitespace)&&(t=t.replace(pp,fp)),e.lastChar=t[t.length-1]||e.lastChar,t}_trimTextContent(t){var e,r,n=t.getChildNodes(),s=n[0],i=O(n);return s&&s.isTextNode()&&(e=s.textContent,r=this._trimLeft(e),s.textContent=r),i&&i.isTextNode()&&(e=i.textContent,r=this._trimRight(e),i.textContent=r),t}_trimLeft(t){return t.replace(up,"")}_trimRight(t){return t.replace(dp,"")}}_p.State=class{constructor(){this.reset()}reset(){this.preserveWhitespace=!1,this.nodes=[],this.annotations=[],this.containerPath=null,this.container=[],this.ids={},this.contexts=[],this.stack=[],this.lastChar="",this.skipTypes={},this.ignoreAnnotations=!1,this.isConverting=!1,this.uuid=td()}pushContext(t,e){this.contexts.push({tagName:t,converter:e,annos:[]})}popContext(){return this.contexts.pop()}getCurrentContext(){return O(this.contexts)}},_p.INVISIBLE_CHARACTER=mp;class yp extends Kd{getUrl(){return this.proxy?this.proxy.getUrl():(console.warn("No file proxy attached to ",this.id),"")}setProxy(t){this.proxy=t}get _isFileNode(){return!0}static get _isFileNode(){return!0}}yp.schema={type:"file",url:{type:"string",optional:!0},fileType:{type:"string",optional:!0},mimeType:{type:"string",optional:!0},sourceFile:{type:"object",optional:!0}};const wp={tagName:"span",export:function(t,e){e.tagName="span",e.attr("data-type",t.type),f(t.toJSON(),function(t,r){"id"!==r&&"type"!==r&&(n(t)||s(t)||fd(t))&&e.attr("data-"+r,t)})}},bp={export:function(t,e,r){e.attr("data-type",t.type);const n=t.getSchema();for(let s of n){const n=s.name;if("id"===n||"type"===n)continue;let i=r.$$("div").attr("property",n),o=t[n];if(s.isText())i.append(r.annotatedText([t.id,n]));else if(s.isReference()){if(!s.isOwned())continue;o=t.resolve(n),s.isArray()?i.append(o.map(t=>r.convertNode(t))):i.append(r.convertNode(o))}else i.append(String(o));e.append(i)}}};const vp="This method is abstract!";class Sp extends cp{_initialize(t,e){if(this.document=t,this.type=e.type,!e.type)throw new Error("'type' is mandatory");if(!e.start)throw new Error("'start' is mandatory");if(!e.end)throw new Error("'end' is mandatory");Object.assign(this._properties,e)}containsSelection(t){return!t.isNull()&&(t.isPropertySelection()?In(this.start.path,t.start.path)&&this.start.offset<=t.start.offset&&this.end.offset>=t.end.offset:void console.warn("Marker.contains() does not support other selection types."))}get type(){return this._type}set type(t){this._type=t}get _isPropertyAnnotation(){return!1}get _isMarker(){return!0}}class Ep{constructor(t,e,r,n,s){if("SKIP"!==arguments[0])if(1===arguments.length&&eh(arguments[0])){let t=arguments[0];this.start=t.start,this.end=t.end,this.reverse=Boolean(t.reverse),this.containerPath=t.containerPath,this.surfaceId=t.surfaceId}else this.start=t,this.end=e,this.reverse=Boolean(r),this.containerPath=n,this.surfaceId=s}isCollapsed(){return this.start.equals(this.end)}equals(t){return this===t||In(this.containerPath,t.containerPath)&&this.start.equals(t.start)&&this.end.equals(t.end)}isReverse(){return this.reverse}toString(){let t=[this.start.toString(),"->",this.end.toString()];return this.isReverse()&&t.push("[reverse]"),this.containerPath&&t.push("[container="+this.containerPath+"]"),this.surfaceId&&t.push("[surface="+this.surfaceId+"]"),t.join("")}get _isRange(){return!0}}function Cp(...t){return{type:"text",targetTypes:t=lu(t)}}const xp=Object.freeze(Cp());function Np(...t){return{type:["array","id"],targetTypes:t=lu(t),default:[],owned:!0}}function Tp(t){return class extends t{getTextPath(){return console.warn("DEPRECATED: use node.getPath()"),this.getPath()}getText(){return this.content}setText(t){return yu(this.getDocument(),this.getPath(),t),this}isEmpty(){return!this.getText()}getLength(){return this.getText().length}getAnnotations(){return this.getDocument().getIndex("annotations").get(this.getPath())}}}class Pp extends(Tp(Kd)){getPath(){return[this.id,"content"]}getText(){return this.content}static isText(){return!0}}Pp.schema={type:"text-node",content:"text",direction:{type:"enum",optional:!0,values:["left","right"]},textAlign:{type:"enum",default:"left",values:["left","right"]}};const Ip={tagName:"annotation",export:function(t,e){e.attr("type",t.type),f(t.toJSON(),function(t,r){"id"!==r&&"type"!==r&&(n(t)||s(t)||fd(t))&&e.attr(r,t)})}},Op={tagName:"block",export:function(t,e,r){e.attr("type",t.type),f(t.toJSON(),function(n,s){if("id"===s||"type"===s)return;const i=r.$$(s);"string"===t.getPropertyType(s)?i.append(r.annotatedText([t.id,s])):i.text(n),e.append(i)})}};const Ap=Symbol("__AppStateImpl__");class Dp{constructor(...t){this[Ap]=new Lp,this._initialize(...t),this._reset()}_initialize(){}dispose(){}isDirty(t){return this._getImpl().isDirty(t)}get(t){return this._getImpl().get(t)}set(t,e,r){const n=this._getImpl();let s,i=n.get(t);(s=!!u(e)||i!==e)&&(n.set(t,e),n.setDirty(t),r&&this.propagateUpdates())}getUpdate(t){return this._getImpl().getUpdate(t)}addObserver(t,e,r,n={}){throw new Error("This method is abstract.")}removeObserver(t){throw new Error("This method is abstract.")}off(t){this.removeObserver(t)}propagateUpdates(){throw new Error("This method is abstract.")}_getImpl(){return this[Ap]}_addProperty(t,e){const r=this._getImpl();if(r.has(t))throw new Error(`State variable '${t}' is already declared.`);r.set(t,e),Object.defineProperty(this,t,{configurable:!1,enumerable:!1,get:()=>this.get(t),set:e=>{this.set(t,e)}})}_setDirty(t){this._getImpl().setDirty(t)}_setUpdate(t,e){const r=this._getImpl();r.setUpdate(t,e),r.setDirty(t)}_reset(){this._getImpl().reset()}}class Lp{constructor(){this.id=h(),this.values=new Map,this.dirty={},this.updates={}}get(t){return this.values.get(t)}set(t,e){this.values.set(t,e)}has(t){return this.values.has(t)}setDirty(t){this.dirty[t]=!0}isDirty(t){return Boolean(this.dirty[t])}getUpdate(t){return this.updates[t]}setUpdate(t,e){this.updates[t]=e}reset(){this.dirty={},this.updates={}}}const kp="@any",Mp="update",Rp=["update","pre-render","render","post-render","pre-position","position","finalize"].reduce((t,e,r)=>(t[e]=r,t),{});class qp extends Dp{_initialize(t={}){super._initialize();const e=this._getImpl();e.slots=new Map,e.schedule=null,e.isFlowing=!1,Object.keys(t).forEach(e=>{const r=t[e];this._addProperty(e,r)})}getId(){return this._getImpl().id}addObserver(t,e,r,n={}){if(i(e))throw new Error("Provided handler function is nil");if(!d(e))throw new Error("Provided handler is not a function");e=e.bind(r);const s=this._getImpl(),o=s.id;n.stage||(n.stage=Mp);const a=n.stage,l=this._getSlotId(a,t.slice());let c=s.slots.get(l);c||(c=this._createSlot(l,a,t),s.slots.set(l,c)),r[o]||(r[o]=new Map),c.addObserver(r,{stage:a,deps:t,handler:e,options:n})}removeObserver(t){const e=this._getImpl().id;(t[e]||[]).forEach(e=>{e.slot.removeObserver(t)}),delete t[e]}propagateUpdates(){const t=this._getImpl();if(t.isFlowing)throw new Error("Already updating.");t.isFlowing=!0;try{const e=this._getSchedule();for(let t of e)t.needsUpdate()&&t.notifyObservers();this._reset()}finally{t.isFlowing=!1}}_getSlotId(t,e){return e.sort(),`@${t}:${e.join(",")}`}_createSlot(t,e,r){return this._getImpl().schedule=null,new Bp(this,t,e,r)}_getSchedule(){const t=this._getImpl();let e=t.schedule;return e||(e=[],t.slots.forEach(t=>e.push(t)),e.sort((t,e)=>Rp[t.stage]-Rp[e.stage]),t.schedule=e),e}_isUpdating(){return this._getImpl().isFlowing}_reset(){super._reset(),this._setDirty(kp)}}class Bp{constructor(t,e,r,n){this._id=t._getImpl().id,this.id=e,this.appState=t,this.stage=r,this.deps=n,this.observers=new Set}addObserver(t,e){t[this._id].set(this.id,{slot:this,spec:e}),this.observers.add(t)}removeObserver(t){this._deleteEntry(t),this.observers.delete(t)}needsUpdate(){const t=this.appState;for(let e of this.deps)if(t.isDirty(e))return!0;return!1}notifyObservers(){let t=this._getObservers();for(let e of t){let t=this._getEntryForObserver(e);t&&this._notifyObserver(t)}}_getObservers(){return this.observers}_getEntryForObserver(t){let e=t[this._id];if(e)return e.get(this.id)}_deleteEntry(t){let e=t[this._id];e&&e.delete(this.id)}_notifyObserver(t){t.spec.handler()}}class jp{constructor(t){this.editorState=t,t.addObserver(["document","selection"],this.update,this,{stage:"update"})}update(){const t=this.editorState;let e=t.get("document"),r=t.get("selection"),n=this.deriveState(e,r);t.set("selectionState",n)}deriveState(t,e){let r=this.createState(e);return this.deriveContext(r,t,e),this.deriveContainerSelectionState(r,t,e),this.deriveAnnoState(r,t,e),t.getIndex("markers")&&this.deriveMarkerState(r,t,e),this.deriveSelectedText(r,t,e),r}deriveContext(t,e,r){if(r&&!r.isNull()&&(r.isPropertySelection()||r.isNodeSelection()||r.isCustomSelection())){let n=r.getNodeId(),s=e.get(n);s&&(t.xpath=s.getXpath().toArray(),t.node=s,r.isPropertySelection()&&(t.property=s.getSchema().getProperty(r.getPropertyName())))}}deriveContainerSelectionState(t,e,r){let n=r.containerPath;if(n){t.containerPath=n;let s=e.get(n),i=r.start.getNodeId(),o=r.end.getNodeId(),a=sh(e,n,i);if(!a)return void console.error("FIXME: invalid ContainerSelection");let l,c=a.getPosition();if(c>0&&(t.previousNode=Pu(e,n,c)),t.isFirst=ah(e,n,r.start),o===i)l=c;else{l=sh(e,n,o).getPosition()}l<s.length-1&&(t.nextNode=Iu(e,n,l)),t.isLast=lh(e,n,r.end)}}deriveAnnoState(t,e,r){let n={};function s(t){n[t.type]||(n[t.type]=[]),n[t.type].push(t)}const i=hu(e,r);if(i.forEach(s),1===i.length){let e=i[0];e.isInlineNode()&&(t.isInlineNodeSelection=e.getSelection().equals(r),t.node=e)}t.annos=i;const o=r.containerPath;if(o){uu(e,r,o).forEach(s)}t.annosByType=n}deriveMarkerState(t,e,r){let n=pu(e,r);t.markers=n}deriveSelectedText(t,e,r){if(r&&r.isPropertySelection()&&!r.isCollapsed()){const n=du(e,r);t.selectedText=n}}createState(t){return new Fp(t)}}class Fp{constructor(t){this.selection=t||Tn.null,Object.assign(this,{annosByType:null,markers:null,isInlineNodeSelection:!1,containerPath:null,node:null,previousNode:null,nextNode:null,annos:[],isFirst:!1,isLast:!1,xpath:[],property:null,selectedText:""})}}class Up{constructor(t,e){this.editorState=e,this.doc=t,this.dirty=new Set,this.init()}init(){const t=this.doc;this.dirty.clear(),t.getIndex("relationships")||t.addIndex("relationships",new zp),t.on("document:changed",this._onDocumentChanged,this)}dispose(){this.doc.off(this)}reset(){this.dirty=new Set}setDirty(t){this.dirty.add(Zu(t))}_onDocumentChanged(t,e={}){t._extracted||t._extractInformation(this.doc);let r=this.dirty;Object.keys(t.updated).forEach(t=>{r.add(t)})}}const Hp=Symbol("ONE"),Vp=Symbol("MANY");class zp extends iu{constructor(){super(),this._relationsByType={},this._byTarget=new Gp}get(t){return this._byTarget.get(t)}select(t){return!0}clear(){this._byTarget.clear()}create(t){let e=this._getRelations(t);if(e)for(let[r,n]of e){const e=t[r];e&&(n===Hp?this._add(e,t.id):e.forEach(e=>this._add(e,t.id)))}}delete(t){let e=this._getRelations(t);if(e)for(let[r,n]of e){const e=t[r];e&&(n===Hp?this._remove(e,t.id):e.forEach(e=>this._remove(e,t.id)))}}update(t,e,r,n){let s=this._getRelations(t);if(!s)return;let i=s.get(e[1]);i&&(i===Hp?(this._remove(n,t.id),this._add(r,t.id)):(n.forEach(e=>this._remove(e,t.id)),r.forEach(e=>this._add(e,t.id))))}_getRelations(t){let e=this._relationsByType[t.type];return void 0===e&&(0===(e=function(t){let e=new Map,r=t.getSchema();for(let t of r)if(t.isReference()){const r=t.name,n=t.isArray()?Vp:Hp;e.set(r,n)}return e}(t)).size&&(e=!1),this._relationsByType[t.type]=e),e}_add(t,e){this._byTarget.add(t,e)}_remove(t,e){this._byTarget.remove(t,e)}}class Gp{constructor(){this._index=new Map}get(t){return this._index.get(t)}add(t,e){let r=this._index.get(t);r||(r=new Set,this._index.set(t,r)),r.add(e)}remove(t,e){let r=this._index.get(t);r&&(r.delete(e),0===r.size&&this._index.delete(t))}clear(){this._index=new Map}}const $p="@any",Jp=new Rd({ops:[],info:{action:"nop"}});class Kp extends qp{_initialize(t){if(super._initialize(t),!t.document)throw new Error("'document' is required");let e=t.document,r=this._getImpl(),n=new Up(e,this);r.documentObserver=n;let s=new jp(this);s.update(),r._selectionStateReducer=s}init(){this._getImpl().documentObserver.init()}dispose(){super.dispose(),this._getImpl().documentObserver.dispose()}getUpdate(t){let e=super.getUpdate(t);if(!e&&"document"===t){let t=Jp;t._extractInformation(),e={change:t,info:t.info}}return e}_createSlot(t,e,r){const n=this._getImpl();return n.schedule=null,-1!==r.indexOf("document")?new Xp(this,t,e,r,n.documentObserver):new Wp(this,t,e,r)}_reset(){super._reset(),this._getImpl().documentObserver.reset()}_getDocumentObserver(){return this._getImpl().documentObserver}}class Wp{constructor(t,e,r,n){this._id=t._getImpl().id,this.id=e,this.editorState=t,this.stage=r,this.deps=n,this.observers=new Set}addObserver(t,e){t[this._id].set(this.id,{slot:this,spec:e}),this.observers.add(t)}removeObserver(t){this._deleteEntry(t),this.observers.delete(t)}needsUpdate(){const t=this.editorState;for(let e of this.deps)if(t.isDirty(e))return!0;return!1}notifyObservers(){let t=this._getObservers();for(let e of t){let t=this._getEntryForObserver(e);t&&this._notifyObserver(t)}}_getObservers(){return this.observers}_getEntryForObserver(t){let e=t[this._id];if(e)return e.get(this.id)}_deleteEntry(t){let e=t[this._id];e&&e.delete(this.id)}_getDocumentChange(){let{change:t,info:e}=this._updates.document;return t.info=e,t}_notifyObserver(t){const e=this.editorState;let r=t.spec;if(1===r.deps.length){let t=r.deps[0];switch(t){case"document":{let t=e.getUpdate("document")||{};r.handler(t.change,t.info);break}default:r.handler(e.get(t))}}else r.handler()}}class Xp extends Wp{constructor(t,e,r,n,s){super(t,e,r,n),this.documentObserver=s,this.byPath={"@any":new Set}}addObserver(t,e){super.addObserver(t,e);const r=this.byPath;let n=e.options.document;if(n&&n.path){let e=Zu(n.path),s=r[e];s||(s=r[e]=new Set),s.add(t)}else r[$p].add(t)}removeObserver(t){const e=t[this._id];if(e){const r=e.get(this.id),n=this.byPath;super.removeObserver(t);let s=r.spec.options.document;if(s&&s.path){n[Zu(s.path)].delete(t)}else n[$p].delete(t)}}_getObservers(){const t=this.editorState;if(!t.isDirty("document"))return this.observers;const e=this.byPath;let{change:r}=t.getUpdate("document");if(!r)return console.error("FIXME: expected to find a document change as update for document"),e[$p];let n=this.documentObserver.dirty,s=[];s.push(e[$p]),n.forEach(t=>{let r=e[t];r&&s.push(r)});let i=new Set;return s.forEach(t=>{t.forEach(t=>i.add(t))}),i}}class Yp{constructor(t){this._editorSession=t,this._done=[],this._undone=[]}canUndo(){return this._done.length>0}canRedo(){return this._undone.length>0}getChanges(){return this._done.slice()}addChange(t){this._done.push(t),this._undone.length>0&&(this._undone.length=0)}undo(){let t=O(this._done);if(t){let e=this._editorSession.getDocument().invert(t);return this._editorSession.applyChange(e,{replay:!0}),this._done.pop(),this._undone.push(t),e}}redo(){let t=O(this._undone);if(t)return this._editorSession.applyChange(t,{replay:!0}),this._undone.pop(),this._done.push(t),t}}class Zp extends od{constructor(t,e,r={}){super(),this._id=t,this._document=e,this._history=this._createChangeHistory(),this._tx=e.createEditingInterface(),this._txOps=[];let n=new Kp(this._createEditorState(e,r));this.editorState=n}_createChangeHistory(){return new Yp(this)}_createEditorState(t,e={}){return Object.assign({document:t,history:this._history,selection:Tn.nullSelection,selectionState:{},hasUnsavedChanges:!1,isBlurred:!1},e)}initialize(){this.editorState.document.on("document:changed",this._onDocumentChange,this)}dispose(){let t=this.editorState;t.document.off(this),t.off(this),t.dispose()}canUndo(){return this._history.canUndo()}canRedo(){return this._history.canRedo()}getChanges(){return this._history.getChanges()}getDocument(){return this._document}getEditorState(){return this.editorState}getFocusedSurface(){}getSelection(){return this._getSelection()}getSelectionState(){return this.editorState.selectionState}getSurface(t){}hasUnsavedChanges(){return Boolean(this.editorState.hasUnsavedChanges)}isBlurred(){return Boolean(this.editorState.isBlurred)}setSelection(t){if(t||(t=Tn.nullSelection),t&&eh(t)&&(t=this.getDocument().createSelection(t)),t&&!t.isNull()&&!t.surfaceId){let e=this.getFocusedSurface();e&&(t.surfaceId=e.id)}t.isCustomSelection()||(t.surfaceId||function(t,e){if(t&&!t.isNull()&&!t.surfaceId){let r=e.getFocusedSurface();r&&(t.surfaceId=r.id)}}(t,this),t.containerPath||function(t,e){if(t&&!t.isNull()&&t.surfaceId&&!t.containerPath){let r=e.getSurface(t.surfaceId);if(r){let e=r.getContainerPath();e&&(t.containerPath=e)}}}(t,this));const e=this.editorState;return e.isBlurred&&(e.isBlurred=!1),this._setSelection(this._normalizeSelection(t)),e.propagateUpdates(),t}transaction(t,e={}){let r=this._document,n=this._getSelection(),s=this._tx,i=r._ops;i.length=0,s.selection=n;let o=!1;try{t(s),o=!0}finally{o||this._revert(i)}let a=null;if(o){let t=s.selection;i.length>0&&((a=new Rd(i,{selection:n},{selection:t})).info=e),this._setSelection(this._normalizeSelection(t))}if(a){let t=!1;try{this._commit(a,e),t=!0}finally{t||(a=null,this._revert(i),this._setSelection(n),this.emit("rescue"))}}return i.length=0,this.editorState.propagateUpdates(),a}_commit(t,e={}){let r=t.after.selection;this._setSelection(this._normalizeSelection(r)),this._document._notifyChangeListeners(t,e),this.emit("change",t,e),this._history.addChange(t)}updateNodeStates(t,e={}){const r=this._document;let n=new Rd([],{},{}),s={action:"node-state-update"};n._extractInformation(),n.info=s;for(let[e,s]of t){let t=r.get(e);t&&(t.state||(t.state={}),Object.assign(t.state,s),n.updated[e]=!0)}e.silent||(r._notifyChangeListeners(n,s),this.emit("change",n,s)),e.propagate&&this.editorState.propagateUpdates()}undo(){let t=this._history.undo();t&&(this._setSelection(this._normalizeSelection(t.after.selection)),this.editorState.propagateUpdates())}redo(){let t=this._history.redo();t&&(this._setSelection(this._normalizeSelection(t.after.selection)),this.editorState.propagateUpdates())}resetHistory(){this._history.reset()}applyChange(t,e={}){if(!t)throw new Error("Invalid change");const r=this.getDocument();r._apply(t),e.replay||this._history.addChange(t),r._notifyChangeListeners(t,e),this.emit("change",t,e),e.replay&&this._setSelection(this._normalizeSelection(t.after.selection))}_normalizeSelection(t){const e=this.getDocument();return t?t.attach(e):t=Tn.nullSelection,t}_getSelection(){return this.editorState.selection}_setSelection(t){this.editorState.selection=t}_onDocumentChange(t,e){const r=this.editorState;if(r.isDirty("document")&&"node-state-update"===e.action){let e=r.getUpdate("document").change;Object.assign(e.updated,t.updated)}else this.editorState._setUpdate("document",{change:t,info:e}),this.editorState.hasUnsavedChanges=!0}_onTxOperation(t){this._txOps.push(t)}_revert(){let t=this._document;for(let e=this._txOps.length-1;e--;e>0){let r=this._txOps[e].invert();t._applyOp(r)}}_transformSelection(t){return Zh(this.getSelection(),t)}}class Qp extends w{constructor(t){super(),this.parent=null,this._owner=t,this._ref=null}getParent(){return this.parent}get childNodes(){return this.getChildNodes()}getChildCount(){return this.children.length}getChildAt(t){return this.children[t]}getComponent(){return this._comp}ref(t){if(!t)throw new Error("Illegal argument");if(this._ref)throw new Error("A VirtualElement can only be referenced once.");if(this._ref=t,this._context){const e=this._context.refs;if(e.has(t))throw new Error('An item with reference "'+t+'" already exists.');e.set(t,this)}return this}isInDocument(){return!1}get _isVirtualElement(){return!0}}class tf extends Qp{constructor(t){super(),this._tagName=t,this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null,this.children=[]}getTagName(){return this._tagName}setTagName(t){return this._tagName=t,this}hasClass(t){return!!this.classNames&&this.classNames.indexOf(t)>-1}addClass(t){return this.classNames||(this.classNames=[]),this.classNames.push(t),this}removeClass(t){return this.classNames&&(this.classNames=Xc(this.classNames,t)),this}removeAttribute(t){return this.attributes&&this.attributes.delete(t),this}getAttribute(t){if(this.attributes)return this.attributes.get(t)}setAttribute(t,e){return this.attributes||(this.attributes=new Map),this.attributes.set(t,e),this}getAttributes(){let t=[];return this.attributes&&(t=Array.from(this.attributes)),this.classNames&&t.push(["class",this.classNames.join(" ")]),this.style&&t.push(["style",Lu(this.style,function(t,e){return e+":"+t}).join(";")]),new Map(t)}getId(){return this.getAttribute("id")}setId(t){return this.setAttribute("id",t),this}setTextContent(t){return t=String(t||""),this.empty(),this.appendChild(t),this}setInnerHTML(t){return t=t||"",this.empty(),this._innerHTMLString=t,this}getInnerHTML(){if(this.hasOwnProperty("_innerHTMLString"))return this._innerHTMLString;throw new Error("Not supported.")}getValue(){return this.htmlProp("value")}setValue(t){return this.htmlProp("value",t),this}getChildNodes(){return this.children}getChildren(){return this.children.filter(function(t){return"text"!==t.getNodeType()})}isTextNode(){return!1}isElementNode(){return!0}isCommentNode(){return!1}isDocumentNode(){return!1}append(){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._append(this.children,arguments),this}appendChild(t){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._appendChild(this.children,t),this}insertAt(t,e){if(!(e=this._normalizeChild(e)))throw new Error("Illegal child: "+e);if(!e._isVirtualElement)throw new Error("Illegal argument for $$.insertAt():"+e);if(t<0||t>this.children.length)throw new Error("insertAt(): index out of bounds.");return this._insertAt(this.children,t,e),this}insertBefore(t,e){var r=this.children.indexOf(e);if(!(r>-1))throw new Error("insertBefore(): reference node is not a child of this element.");return this.insertAt(r,t),this}removeAt(t){if(t<0||t>=this.children.length)throw new Error("removeAt(): Index out of bounds.");return this._removeAt(t),this}removeChild(t){if(!t||!t._isVirtualElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var e=this.children.indexOf(t);if(e<0)throw new Error("removeChild(): element is not a child.");return this.removeAt(e),this}replaceChild(t,e){if(!(e&&t&&e._isVirtualElement&&t._isVirtualElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var r=this.children.indexOf(t);if(r<0)throw new Error("replaceChild(): element is not a child.");return this.removeAt(r),this.insertAt(r,e),this}empty(){for(var t=this.children;t.length;){t.pop().parent=null}return delete this._innerHTMLString,this}getProperty(t){if(this.htmlProps)return this.htmlProps.get(t)}setProperty(t,e){return this.htmlProps||(this.htmlProps=new Map),this.htmlProps.set(t,e),this}removeProperty(t){return this.htmlProps&&this.htmlProps.delete(t),this}getStyle(t){if(this.style)return this.style.get(t)}setStyle(t,e){return this.style||(this.style=new Map),w.pxStyles[t]&&s(e)&&(e+="px"),this.style.set(t,e),this}_createEventListener(t,e,r){return r.context=r.context||this._owner._comp,super._createEventListener(t,e,r)}getNodeType(){return"element"}hasInnerHTML(){return Boolean(this._innerHTMLString)}_normalizeChild(t){if(!i(t)){if(t._isVirtualElement)return t;if(n(t)||fd(t)||s(t))return new nf(String(t));throw new Error("Unsupported child type")}}_append(t,e){if(1!==e.length||p(e[0])){var r;if(p(e[0]))r=e[0];else{if(!(arguments.length>1))return;r=Array.prototype.slice.call(e,0)}r.forEach(this._appendChild.bind(this,t))}else this._appendChild(t,e[0])}_appendChild(t,e){if(e=this._normalizeChild(e))return t.push(e),this._attach(e),e}_insertAt(t,e,r){r&&(t.splice(e,0,r),this._attach(r))}_removeAt(t,e){var r=t[e];t.splice(e,1),this._detach(r)}_attach(t){t.parent=this,this._context&&(t._owner!==this._owner&&t._isVirtualComponent&&this._context.injectedComponents.push(t),t._owner!==this._owner&&t._ref&&(this._context.foreignRefs[t._ref]=t))}_detach(t){t.parent=null,this._context&&(t._isVirtualComponent&&ku(this._context.injectedComponents,t),t._owner!==this._owner&&t._ref&&this._context.foreignRefs.delete(t._ref))}_copy(){if(this.classNames||this.attributes||this.eventListeners||this.htmlProps||this.style){let t={};return this.classNames&&(t.classNames=this.classNames.slice()),this.attributes&&(t.attributes=new Map(this.attributes)),this.eventListeners&&(t.eventListeners=this.eventListeners.slice()),this.htmlProps&&(t.htmlProps=new Map(this.htmlProps)),this.style&&(t.style=new Map(this.style)),t}}_clear(){this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null}_merge(t){if(!t)return;const e=["classNames","eventListeners"];for(let r of e){let e=t[r];if(e){let t=this[r];this[r]=t?t.concat(e):e.slice()}}const r=["attributes","htmlProps","style"];for(let e of r){let r=t[e];if(r){let t=this[e];this[e]=t?new Map([...t,...r]):new Map(r)}}}get _isVirtualHTMLElement(){return!0}}class ef extends tf{constructor(t,e){super(),e=e||{},this.ComponentClass=t,this.props=e,e.children||(e.children=[]),this.children=e.children}getComponent(){return this._comp}getChildren(){return this.props.children}getNodeType(){return"component"}outlet(t){return new rf(this,t)}setInnerHTML(){throw new Error("Can not set innerHTML of a Component")}_attach(t){t._preliminaryParent=this}_detach(t){t._preliminaryParent=null}get _isVirtualHTMLElement(){return!1}get _isVirtualComponent(){return!0}}class rf{constructor(t,e){this.virtualEl=t,this.name=e,Object.freeze(this)}_getOutlet(){var t=this.virtualEl.props[this.name];return t||(t=[],this.virtualEl.props[this.name]=t),t}append(){var t=this._getOutlet();return this.virtualEl._append(t,arguments),this}empty(){var t=this.virtualEl.props[this.name];return t.forEach(function(t){this._detach(t)}.bind(this)),t.splice(0,t.length),this}}class nf extends Qp{constructor(t){super(),this.text=t}get _isVirtualTextNode(){return!0}}Qp.Component=ef,Qp.TextNode=nf,Qp.createElement=function(){var t,e,r=arguments[0],s=arguments[1];if(n(r))e="element";else{if(!d(r)||!r.prototype._isComponent)throw i(r)?new Error("$$(null): provided argument was null or undefined."):new Error("Illegal usage of $$()");e="component"}var o,a,l={};for(var c in s)if(s.hasOwnProperty(c)){var h=s[c];switch(c){case"class":o=h;break;case"ref":a=h;break;default:l[c]=h}}return"element"===e?(t=new tf(r)).attr(l):t=new ef(r,l),t._owner=this.owner,o&&t.addClass(o),a&&t.ref(a),[].forEach(function(e){if(d(e.handler))t.on(e.name,e.handler);else{if(!eh(e.handler))throw new Error("Illegal arguments for $$(_,{ on"+e.name+"})");var r=e.handler;t.on(e.name,r.handler,r.context,r)}}),arguments.length>2&&t.append(cu(Array.prototype.slice.call(arguments,2),3)),t},Qp.Context=class{constructor(t){this.owner=t,this.refs=new Map,this.foreignRefs=new Map,this.elements=[],this.components=[],this.injectedComponents=[],this.$$=this._createComponent.bind(this),this.$$.capturing=!0}_createComponent(){let t=Qp.createElement.apply(this,arguments);return t._context=this,t._owner=this.owner,t._isVirtualComponent&&this.components.push(t),this.elements.push(t),t}};const sf=Symbol("TOP_LEVEL_ELEMENT");class of{constructor(t={}){if(this.componentFactory=t.componentFactory,!this.componentFactory)throw new Error("'componentFactory' is mandatory");if(this.elementFactory=t.elementFactory||_n.createDocument("html"),!this.elementFactory)throw new Error("'elementFactory' is mandatory")}_render(t,e,r){a.VERBOSE_RENDERING_ENGINE&&(console.group("RenderingEngine"),t.el?console.log("Rendering Engine: re-render of %s",t.constructor.name):console.log("Rendering Engine: initial render of %s",t.constructor.name),console.time("rendering (total)"));let n=If(t),s=this._createState();e&&s.set(Mf,n,e),r&&s.set(Rf,n,r);try{a.VERBOSE_RENDERING_ENGINE&&console.time("capturing"),af(s,n,sf),a.VERBOSE_RENDERING_ENGINE&&console.timeEnd("capturing"),a.VERBOSE_RENDERING_ENGINE&&console.time("updating"),_f(s,n),a.VERBOSE_RENDERING_ENGINE&&console.timeEnd("updating"),function t(e,r){r._isVirtualComponent?(e.is(jf,r)||r.children.forEach(t.bind(null,e)),e.is(Ff,r)&&r._comp.didUpdate(e.get(Mf,r),e.get(Rf,r))):r._isVirtualHTMLElement&&r.children.forEach(t.bind(null,e))}(s,n)}finally{a.VERBOSE_RENDERING_ENGINE&&(console.timeEnd("rendering (total)"),console.groupEnd("RenderingEngine")),s.dispose()}}_renderChild(t,e){let r=this._createState();e.parent={_comp:t,_isFake:!0};try{return af(r,e),_f(r,e),e._comp}finally{r.dispose()}}_createState(){return new Uf(this.componentFactory,this.elementFactory)}static createContext(t){let e=If(t);return new Qp.Context(e)}}function af(t,e,r){if(t.is(Of,e))return e;let n=e._comp;if(n||(n=lf(t,e),t.set(kf,e)),e._isVirtualComponent){let s;if(r===sf){s=!0,console.assert(e._comp===n,"top-level element and component should be linked already"),t.set(Lf,e),t.set(Lf,n),t.set(Df,e),t.set(Df,n);let r=yf(n);e.elementProps=r.elementProps}else s=!n.el||n.shouldRerender(e.props,n.state),e.elementProps=e._copy(),e._clear(),t.set(Mf,e,n.props),t.set(Rf,e,n.state),n._setProps(e.props),t.is(kf,e)||t.set(Ff,e);if(s){let r=new Qp.Context(e),s=n.render(r.$$);if(!s)throw new Error("Component.render() returned nil.");if(s._isVirtualComponent)e._forwardedEl=s,e._isForwarding=!0,s._isForwarded=!0,s.parent=e,e.children=[s];else{if(!s._isVirtualHTMLElement)throw new Error("render() must return a plain element or a Component");e.tagName=s.tagName,e._merge(s),s.hasInnerHTML()?(e._innerHTMLString=s._innerHTMLString,e.children=[]):(e.children=s.children,e.children.forEach(t=>{t.parent=e}))}if(e._context=s._context,e.elementProps&&(e._merge(e.elementProps),e._isForwarding&&e._forwardedEl._merge(e)),!t.is(kf,e)&&n.isMounted()&&t.set(Ff,e),cf(t,n,e,hf),a.DEBUG_RENDERING){let s=e.children.slice(0);for(;s.length;){let e=s.shift();t.is(Of,e)||(e._isVirtualComponent||(e._comp||lf(t,e),e._isVirtualHTMLElement&&e.children.length>0&&(s=s.concat(e.children)),t.set(Of,e)))}let i=new Pf(t,r);for(;i.hasPendingCaptures();)i.reset(),n.render(i.$$);for(let e of r.injectedComponents)af(t,e);e._forwardedEl&&af(t,e._forwardedEl)}else if(e._forwardedEl)af(t,e._forwardedEl);else for(let r of e.children)af(t,r);cf(t,n,e,gf)}else t.set(jf,e)}else if(e._isVirtualHTMLElement)for(let r of e.children)af(t,r);return t.set(Of,e),e}function lf(t,e){let r=e._comp;console.assert(!r,"Component instance should not exist when this method is used.");let n=e.parent._comp;if(n||(n=lf(t,e.parent)),e._isVirtualComponent){if(console.assert(n,"A Component should have a parent."),r=t.componentFactory.createComponent(e.ComponentClass,n,e.props),e.props=r.props,e._forwardedEl){let n=e._forwardedEl,s=t.componentFactory.createComponent(n.ComponentClass,r,n.props);n.props=s.props,r._forwardedComp=s}}else e._isVirtualHTMLElement?r=t.componentFactory.createElementComponent(n,e):e._isVirtualTextNode&&(r=t.componentFactory.createTextNodeComponent(n,e));return e._ref&&(r._ref=e._ref),e._owner&&(r._owner=e._owner._comp),e._comp=r,r}function cf(t,e,r,n){if(console.assert(r._isVirtualComponent,"this method is intended for VirtualComponents only"),!r.__components__){let t=r._context;console.assert(t,"there should be a capturing context on the VirtualComponent");let n=t.refs,s=t.foreignRefs;t.internalRefs||(t.internalRefs=function(t,e){let r=new Map,n=new Map;for(let s of t.components){if(s._ref)continue;let t=wf(s,e);if(r.has(t)){let e=r.get(t)+1;r.set(t,e),t=t+"@"+e}else r.set(t,1);n.set(t,s)}return n}(t,r));let i=t.internalRefs,o=[],a=yf(e),l=a.refs,c=a.foreignRefs,h=a.internalRefs||new Map,u=(t,e)=>{for(let[r,n]of t){let t,s=e.get(r);s&&(t=s._comp),o.push({vc:n,comp:t})}};n.size>0&&u(n,l),s.size>0&&u(s,c),i.size>0&&u(i,h),r.__components__=o}if(r.__components__.length>0)for(let e of r.__components__)n(t,e.comp,e.vc)}function hf(t,e,r){e?pf(t,e,r)||ff(t,e,r)||(mf(e,r)?uf(t,e,r):df(t,e,r)):df(t,e,r)}function uf(t,e,r){r._comp=e,t.set(Lf,r),t.set(Lf,e),t.set(Df,r),t.set(Df,e)}function df(t,e,r){r._comp=null,t.set(Lf,r),e&&t.set(Lf,e)}function pf(t,e,r){const n=t.is(Lf,r),s=t.is(Lf,e);return!(!n&&!s)}function ff(t,e,r){let n=t.is(Df,e),s=t.is(Df,r);return r._comp===e&&(s||(console.error("FIXME: comp is linked, but not virtual component"),t.set(Df,r)),n||(console.error("FIXME: virtual comp is linked, but not component"),t.set(Df,r)),!0)}function gf(t,e,r,n){if(!r)return console.error("DOCUMENT WHY THIS IS NEEDED"),!1;if(!e)return!1;if(n&&pf(t,e,r))return ff(t,e,r);if(!r._isVirtualComponent){if(!mf(e,r))return df(t,e,r),!1;uf(t,e,r)}let s=!1,i=e.getParent();if(r.parent)s=gf(t,i,r.parent,!0);else if(r._preliminaryParent){for(;i&&i._isElementComponent;)i=i.getParent();s=gf(t,i,r._preliminaryParent,!0)}return r._isVirtualComponent&&!s&&(a.VERBOSE_RENDERING_ENGINE&&console.info("Component has been relocated: "+e.constructor.name),t.set(qf,r),t.set(qf,e)),s}function mf(t,e){return t._isElementComponent&&e._isVirtualHTMLElement||t._isComponent&&e._isVirtualComponent&&t.constructor===e.ComponentClass||t._isTextNodeComponent&&e._isVirtualTextNode}function _f(t,e){if(t.is(jf,e))return;let r=e._comp;if(r||e._ref&&e._preliminaryParent!==e._owner&&af(t,e),console.assert(r&&r._isComponent,"A captured VirtualElement must have a component instance attached."),e._isForwarding)_f(t,e._forwardedEl);else{if(r.el){let t=r.el;console.assert(t,"Component's element should exist at this point."),xf(t,e)}else r.el=function(t,e){let r;r=e._isVirtualTextNode?t.elementFactory.createTextNode(e.text):t.elementFactory.createElement(e.tagName);e._comp&&(r._comp=e._comp);return xf(r,e),r}(t,e);if((e._isVirtualComponent||e._isVirtualHTMLElement)&&!e.hasInnerHTML()){let n=e.children,s=r.el.getChildNodes().map(e=>{let n=e._comp;return n?(n._isForwarded()&&(n=function(t,e){let r=e.getParent();for(;r;){let e=r.getParent();if(e===t)return r;r=e}}(r,n)),!n||t.is(qf,n)?(r.el.removeChild(e),null):n):(r.el.removeChild(e),null)}).filter(Boolean),i=0,o=0;for(;i<s.length||o<n.length;){let e;do{e=s[i++]}while(e&&t.is(Af,e));let a=n[o++];if(e&&!a){for(;e;)Ef(t,r,e),e=s[i++];break}if(e&&e.el.isTextNode()&&a&&a._isVirtualTextNode&&e.el.textContent===a.text)continue;if(e&&e._isElementComponent&&a._isVirtualHTMLElement&&!t.is(Lf,e)&&!t.is(Lf,a)&&e.tagName===a.tagName){a._comp=e,t.set(Df,a),t.set(Df,e),_f(t,a);continue}t.is(Bf,a)||_f(t,a);let l=a._comp;l!==e&&(t.is(qf,l)&&l._setParent(r),console.assert(l,"Component instance should now be available."),!a||e?t.is(Df,a)?t.is(Df,e)?(t.set(Af,e),Ef(t,r,e),o--):(Ef(t,r,e),o--):t.is(Df,e)?(Sf(t,r,l,e),i--):vf(t,r,e,l):bf(t,r,l))}}}if(e._isVirtualComponent&&(function(t,e){let r=e._context,n=yf(t);n.elementProps=e.elementProps,n.refs=r.refs,n.foreignRefs=r.foreignRefs,n.internalRefs=r.internalRefs,t.refs=Array.from(r.refs).reduce((t,[e,r])=>{let n=r._comp;return n?t[e]=r._comp:console.warn(`Warning: component with reference '${e}' has not been used`),t},{})}(r,e),e._forwardedEl)){let t=e._forwardedEl._comp;if(r.el){let e=r.el._comp;e!==t&&(e.triggerDispose(),r.el.parentNode.replaceChild(r.el,t.el),r.el=t.el,t.triggerDidMount())}else r.el=t.el}t.set(Bf,e),t.set(Bf,r)}function yf(t){return t.__internal__||(t.__internal__=new Hf),t.__internal__}function wf(t,e){let r=[t.ComponentClass.name];if(!t._isForwarded){let n=t.getParent();for(;n&&n!==e&&!n._isFake;)console.assert(n._isVirtualHTMLElement),r.unshift(n.tagName),n=n.parent}return r.join("/")}function bf(t,e,r){e.el.appendChild(r.el),Cf(t,e,r)}function vf(t,e,r,n){e.el.replaceChild(r.el,n.el),t.is(Af,r)||r.triggerDispose(),Cf(t,e,n)}function Sf(t,e,r,n){e.el.insertBefore(r.el,n.el),Cf(t,e,r)}function Ef(t,e,r){e.el.removeChild(r.el),t.is(Af,r)||r.triggerDispose()}function Cf(t,e,r){t.is(Af,r)||!e.isMounted()||r.isMounted()||r.triggerDidMount(!0)}function xf(t,e){if(e._isVirtualTextNode)return void t.setTextContent(e.text);let r=t.getTagName();if(e.tagName.toLowerCase()!==r&&t.setTagName(e.tagName),Tf({oldHash:t.getAttributes(),newHash:e.getAttributes(),update:function(e,r){t.setAttribute(e,r)},remove:function(e){t.removeAttribute(e)}}),Tf({oldHash:t.htmlProps,newHash:e.htmlProps,update:function(e,r){t.setProperty(e,r)},remove:function(e){t.removeProperty(e)}}),function(t){let e=t.el,r=t.newListeners||[];e.removeAllEventListeners();for(let t=0;t<r.length;t++)e.addEventListener(r[t])}({el:t,oldListeners:t.getEventListeners(),newListeners:e.getEventListeners()}),e.hasInnerHTML()){if(t._hasInnerHTML){let r=t.getInnerHTML(),n=e.getInnerHTML();r!==n&&t.setInnerHTML(n)}else t.empty(),t.setInnerHTML(e.getInnerHTML());t._hasInnerHTML=!0}}function Nf(t,e){return t instanceof Map?t.get(e):t[e]}function Tf({newHash:t,oldHash:e,update:r,remove:n}){if(!t&&!e)return;t||(t=new Map),e||(e=new Map);let s={};for(let n of t.keys()){let i=Nf(e,n),o=Nf(t,n);s[n]=!0,i!==o&&r(n,o)}if(d(e.keys)&&e.size>0){Array.from(e.keys()).forEach(t=>{s[t]||n(t)})}else for(let t in e)e.hasOwnProperty(t)&&!s[t]&&n(t)}class Pf{constructor(t,e){this.state=t,this.owner=e.owner,this.refs=new Map,this.foreignRefs=new Map,this.internalRefs=null,this.elements=e.elements,this.pos=0,this.updates=e.components.length,this.remaining=this.updates,this.injectedComponents=e.injectedComponents,this.$$=this._$$.bind(this)}_$$(){let t=this.state,e=this.elements[this.pos++];if(!t.is(Of,e)&&e._isVirtualComponent){let r=e.parent;r&&(r===this.owner||t.is(Of,e.parent))&&(af(t,e),this.updates++,this.remaining--)}return(e=Qp.createElement.apply(this,arguments))._context=this,e._owner=this.owner,e._attach=function(){},e._detach=function(){},e}hasPendingCaptures(){return this.updates>0&&this.remaining>0}reset(){this.pos=0,this.updates=0,this.refs.clear()}}function If(t){let e=new Qp.Component(t.constructor);return e._comp=t,e}const Of=Symbol("CAPTURED"),Af=Symbol("DETACHED"),Df=Symbol("LINKED"),Lf=Symbol("MAPPED"),kf=Symbol("NEW"),Mf=Symbol("OLDPROPS"),Rf=Symbol("OLDSTATE"),qf=Symbol("RELOCATED"),Bf=Symbol("RENDERED"),jf=Symbol("SKIPPED"),Ff=Symbol("UPDATED");class Uf{constructor(t,e){this.componentFactory=t,this.elementFactory=e,this.polluted=[],this.id="__"+h()}dispose(){let t=this.id;this.polluted.forEach(function(e){delete e[t]})}set(t,e,r=!0){let n=e[this.id];n||(n={},e[this.id]=n,this.polluted.push(e)),n[t]=r}get(t,e){let r=e[this.id];if(r)return r[t]}is(t,e){return Boolean(this.get(t,e))}}class Hf{constructor(){this.refs=new Map,this.foreignRefs=new Map,this.internalRefs=new Map,this.elementProps=null}}of._INTERNAL_API={_capture:af,_wrap:If,_update:_f,CAPTURED:Of,DETACHED:Af,LINKED:Df,MAPPED:Lf,NEW:kf,RELOCATED:qf,RENDERED:Bf,SKIPPED:jf,TOP_LEVEL_ELEMENT:sf,UPDATED:Ff};const Vf={createComponent:(t,e,r)=>new t(e,r),createElementComponent:(t,e)=>new Kf(t,e),createTextNodeComponent:(t,e)=>new Wf(t,e)};class zf extends od{constructor(t,e={},r={}){let n;super(),this.parent=t&&t._isComponent?t:null,this.el=r.el,n=d(this.defineContext)?this.defineContext(e,t):r.context||this._getContext(),this.context=n||{},this.renderingEngine=t&&t.renderingEngine||r.renderingEngine||new of({componentFactory:Vf}),this._SKIP_COMPONENT_INIT||(this.__id__=h(),this.refs={},this.__foreignRefs__={},this._actionHandlers=this.getActionHandlers(),this.props=e,this.state=this.getInitialState()||{})}getId(){return this.__id__}setId(){throw new Error("'id' is readonly")}getActionHandlers(){return{}}getChildContext(){return{}}getInitialState(){return{}}getParent(){return this.parent}getRoot(){let t=this,e=t;for(;e;)e=(t=e).getParent();return t}getElement(){return this.el}getNativeElement(){return this.el.getNativeElement()}getLabel(t,...e){let r=this.getLabelProvider();if(!r)throw new Error("Missing labelProvider.");return r.getLabel(t,...e)}getLabelProvider(){return this.context.labelProvider}getComponent(t,e){let r=this.getComponentRegistry();if(!r)throw new Error("Missing componentRegistry.");const n=r.get(t);if(!e&&!n)throw new Error("No Component registered with name "+t);return n}getComponentRegistry(){return this.context.componentRegistry}render(t){return t("div")}mount(t){if(!t)throw new Error("Element is required.");return t=_n.wrap(t),this.el=null,this.renderingEngine=zf.createRenderingEngine(t.getOwnerDocument()),this._render(),t.appendChild(this.el),t.isInDocument()&&this.triggerDidMount(),this}shouldRerender(t,e){return!0}rerender(){this._rerender(this.props,this.state)}_rerender(t,e){this._render(t,e),this.isMounted()||this.didUpdate(t,e)}_render(t,e){if(this.__isRendering__)throw new Error("Component is rendering already.");this.__isRendering__=!0;try{this.renderingEngine._render(this,t,e)}finally{delete this.__isRendering__}}triggerDidMount(){this._isForwarded()&&this.getParent().triggerDidMount();const t=this.getChildren();for(let e of t)e.triggerDidMount();this.__isMounted__||(this.__isMounted__=!0,this.didMount())}triggerDispose(){this._isForwarding()?this.el._comp.triggerDispose():this.getChildren().forEach(function(t){t.triggerDispose()}),this.dispose(),this.__isMounted__=!1}didMount(){}didUpdate(){}isMounted(){return this.__isMounted__}dispose(){}_isForwarding(){return!!this.el&&this.el._comp!==this}_isForwarded(){let t=this.getParent();return t&&t._isForwarding()}_getForwardedComponent(){if(this.el)return this.el._comp}_setParent(t){this.parent=t,this.context=this._getContext()||{},Object.freeze(this.context)}send(t){let e=this;for(;e;){if(e._actionHandlers&&e._actionHandlers[t])return e._actionHandlers[t].apply(e,Array.prototype.slice.call(arguments,1)),!0;e=e.getParent()}return console.warn("Action",t,"was not handled."),!1}handleActions(t){return f(t,function(t,e){this.handleAction(e,t)}.bind(this)),this}handleAction(t,e){if(!t||!e||!d(e))throw new Error("Illegal arguments.");e=e.bind(this),this._actionHandlers[t]=e}getState(){return this.state}setState(t){let e=this.props,r=this.state,n=!this.__isSettingProps__&&this.shouldRerender(this.getProps(),t);this.willUpdateState(t),this.state=t||{},Object.freeze(this.state),n?this._rerender(e,r):this.__isSettingProps__||this.didUpdate(e,r)}extendState(t){t=cd({},this.state,t),this.setState(t)}willUpdateState(t){}getProps(){return this.props}setProps(t){let e=this.props,r=this.state,n=this.shouldRerender(t,this.state);this._setProps(t),n?this._rerender(e,r):this.didUpdate(e,r)}_setProps(t){t=t||{},this.__isSettingProps__=!0;try{this.willReceiveProps(t),this.props=t||{},Object.freeze(t)}finally{delete this.__isSettingProps__}}extendProps(t){let e=cd({},this.props,t);this.setProps(e)}willReceiveProps(t){}getTextContent(){if(this.el)return this.el.textContent}get textContent(){return this.getTextContent()}getInnerHTML(){if(this.el)return this.el.getInnerHTML()}get innerHTML(){return this.getInnerHTML()}getOuterHTML(){if(this.el)return this.el.getOuterHTML()}get outerHTML(){return this.getOuterHTML()}getAttribute(t){if(this.el)return this.el.getAttribute(t)}setAttribute(t,e){return this.el&&this.el.setAttribute(t,e),this}getProperty(t){if(this.el)return this.el.getProperty(t)}setProperty(t,e){return this.el&&this.el.setProperty(t,e),this}get tagName(){if(this.el)return this.el.tagName}hasClass(t){if(this.el)return this.el.hasClass(t)}addClass(t){return this.el&&this.el.addClass(t),this}removeClass(t){return this.el&&this.el.removeClass(t),this}getStyle(t){if(this.el)return this.el.getStyle(t)}setStyle(t,e){return this.el?this.el.setStyle(t,e):this}getValue(){if(this.el)return this.el.getValue()}setValue(t){return this.el&&this.el.setValue(t),this}getChildCount(){return this.el?this.el.getChildCount():0}get childNodes(){return this.getChildNodes()}getChildNodes(){if(!this.el)return[];let t=this.el.getChildNodes();return t=t.map($f).filter(Boolean)}getChildren(){if(!this.el)return[];let t=this.el.getChildren();return t=t.map($f).filter(Boolean)}getChildAt(t){let e=this.el.getChildAt(t);if(e)return Jf(e)}find(t){return $f(this.el.find(t))}findAll(t){return this.el.findAll(t).map($f).filter(Boolean)}appendChild(t){this.insertAt(this.getChildCount(),t)}insertAt(t,e){if(n(e)&&(e=new Qp.TextNode(e)),!e._isVirtualElement)throw new Error('Invalid argument: "child" must be a VirtualElement.');let r=this.renderingEngine._renderChild(this,e);this.el.insertAt(t,r.el),function(t,e){t.isMounted()&&e.triggerDidMount();e._owner&&e._ref&&(e._owner.refs[e._ref]=e)}(this,r)}removeAt(t){let e=this.el.getChildAt(t);if(e){Gf(Jf(e)),this.el.removeAt(t)}}removeChild(t){if(!t||!t._isComponent)throw new Error("removeChild(): Illegal arguments. Expecting a Component instance.");Gf(t),this.el.removeChild(t.el)}replaceChild(t,e){if(!t||!t._isComponent)throw new Error("replaceChild(): oldChild must be a child component.");if(!e||!e._isVirtualElement||e._owner._comp!==this)throw new Error("replaceChild(): newVirtualChild must be a VirtualElement instance created with a rendering context for this component.");let r=this.renderingEngine._renderChild(this,e);Gf(t),this.el.replaceChild(t.el,r.el),this.isMounted()&&r.triggerDidMount()}empty(){return this._clear(),this}_clear(){let t=this.el;t&&(this.getChildNodes().forEach(function(t){Gf(t)}),t.empty()),this.refs={},this.__foreignRefs__={}}remove(){Gf(this),this.el.remove()}addEventListener(){throw new Error("Not supported.")}removeEventListener(){throw new Error("Not supported.")}insertBefore(){throw new Error("Not supported.")}click(){return!!this.el&&this.el.click()}getComponentPath(){let t=[],e=this;for(;e;)t.unshift(e),e=e.getParent();return t}_getContext(){let t={},e=this.getParent();return e&&(t=cd(t,e.context),e.getChildContext)?cd(t,e.getChildContext()):t}get _isComponent(){return!0}attr(){return w.prototype.attr.apply(this,arguments)}htmlProp(){return w.prototype.htmlProp.apply(this,arguments)}val(){return w.prototype.val.apply(this,arguments)}css(){return w.prototype.css.apply(this,arguments)}text(){return w.prototype.text.apply(this,arguments)}append(){return w.prototype.append.apply(this,arguments)}static unwrap(){return $f.apply(this,arguments)}static render(t){let e=new this(null,t=t||{});return e._render(),e}static mount(t,r,s={}){if(1===arguments.length&&(r=t,t={}),!r)throw new Error("'el' is required.");if(n(r)){let t=r;if(!e.inBrowser)throw new Error("This selector is not supported on server side.");r=window.document.querySelector(t)}r=_n.wrap(r);let i=new this(null,t,s);return i.mount(r),i}static getComponentForDOMElement(t){return $f(t)}static unwrapDOMElement(t){return console.warn("DEPRECATED: Use Component.getComponentForDOMElement"),zf.getComponentForDOMElement(t)}static getComponentFromNativeElement(t){return $f(_n.wrap(t))}static createRenderingEngine(t){return new of({componentFactory:Vf,elementFactory:t})}static get Element(){return Kf}static get TextNode(){return Wf}}function Gf(t){t.triggerDispose(),t._owner&&t._ref&&(console.assert(t._owner.refs[t._ref]===t,"Owner's ref should point to this child instance."),delete t._owner.refs[t._ref])}function $f(t){if(t&&(t._isDOMElement||(t=_n.unwrap(t)),t))return t._comp}function Jf(t){let e=$f(t);if(!e)throw new Error("Expecting a back-link to the component instance.");return e}class Kf extends zf{get _isElementComponent(){return!0}get _SKIP_COMPONENT_INIT(){return!0}}class Wf extends zf{setTextContent(t){if(!this.el)throw new Error("Component must be rendered first.");this.el.textContent!==t&&(this.el.textContent=t)}getChildNodes(){return[]}getChildren(){return[]}get _isTextNodeComponent(){return!0}get _SKIP_COMPONENT_INIT(){return!0}}class Xf extends zf{constructor(...t){super(...t),this.name=this.props.node.id,this._state={selectionFragment:null},this.handleAction("escape",this.escape),this.ContentClass=this._getContentClass();let r=e.isFF||!this.ContentClass.noBlocker;this.blockingMode=r?"closed":"open"}getInitialState(){let t=this.getEditorSession().getSelection(),e=this.getEditorSession().getSelectionState();return this._deriveStateFromSelectionState(t,e)}getChildContext(){return{parentSurfaceId:this.getId(),isolatedNodeComponent:this,surface:void 0}}didMount(){this.context.editorSession.getEditorState().addObserver(["selection"],this._onSelectionChanged,this,{stage:"render"})}dispose(){this.context.editorSession.getEditorState().removeObserver(this)}renderContent(t,e,r={}){let n=this.ContentClass;if(n){return t(n,Object.assign(this._getContentProps(),r))}return console.error("Could not resolve a component for type: "+e.type),t(this.__elementTag)}getId(){return this._id||(this._id=this.context.parentSurfaceId+"/"+this.name),this._id}get id(){return this.getId()}getMode(){return this.state.mode}escape(){this.selectNode()}isOpen(){return"open"===this.blockingMode}isClosed(){return"closed"===this.blockingMode}isNotSelected(){return!this.state.mode}isSelected(){return"selected"===this.state.mode}isCoSelected(){return"co-selected"===this.state.mode}isFocused(){return"focused"===this.state.mode}isCoFocused(){return"co-focused"===this.state.mode}getParentSurface(){return this.context.surface}getEditorSession(){return this.context.editorSession}getSurfaceManager(){return this.context.surfaceManager}_onSelectionChanged(){const t=this.getEditorSession(),e=t.getSelection(),r=t.getSelectionState(),n=this._deriveStateFromSelectionState(e,r);!n&&this.state.mode?this.extendState({mode:null}):n&&n.mode!==this.state.mode&&this.extendState(n)}onKeydown(t){t.keyCode===gd.ESCAPE&&"focused"===this.state.mode&&(t.stopPropagation(),t.preventDefault(),this.escape())}_getContentClass(){const t=this.props.node;let e;return(e=this.getComponent(t.type,!0))||(e=zf),e}_getContentProps(){return{disabled:this.props.disabled,node:this.props.node,isolatedNodeState:this.state.mode,focused:"focused"===this.state.mode}}_getSurfaceForSelection(t,e){let r=e.surface;if(!r){if(t&&t.surfaceId){r=this.getSurfaceManager().getSurface(t.surfaceId)}else r=null;e.surface=r}return r}_getIsolatedNodes(t,e){let r=e.isolatedNodes;if(!r){if(r=[],t&&t.surfaceId){let e=this.getSurfaceManager().getSurface(t.surfaceId);e&&(r=e.getComponentPath().filter(t=>t._isAbstractIsolatedNodeComponent))}e.isolatedNodes=r}return r}_shouldConsumeEvent(t){let e=zf.unwrap(t.currentTarget);return this._getIsolatedNode(e)===this}_getIsolatedNode(t){return t._isAbstractIsolatedNodeComponent?this:t.context.isolatedNodeComponent?t.context.isolatedNodeComponent:t.context.surface?t.context.surface.context.isolatedNodeComponent:void 0}get _isAbstractIsolatedNodeComponent(){return!0}}const Yf=["keydown","keyup","keypress","mousedown","mouseup","copy"];class Zf{constructor(){this.listeners=[],this.initialize()}initialize(){if(e.inBrowser){let t=_n.wrapNativeElement(window.document);Yf.forEach(function(e){t.on(e,this._dispatch.bind(this,e),this)}.bind(this))}}dispose(){if(e.inBrowser){_n.wrapNativeElement(window.document).off(this)}}addEventListener(t,e,r){if(!r.id)throw new Error("GlobalEventHandler can only be used with option 'id'");let n=new _(t,e,r);this.listeners.push(n)}removeEventListener(t){let e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)}getEventListeners(){return this.listeners}_getActiveListener(t){const e=this.getSelection();if(e){let r=e.surfaceId;for(let e=0;e<this.listeners.length;e++){let n=this.listeners[e];if(n.eventName===t&&n.options.id===r)return n}}}_dispatch(t,e){const r=this._getActiveListener(t);r&&r.handler(e)}on(...t){return w.prototype.on.apply(this,t)}off(...t){return w.prototype.off.apply(this,t)}}class Qf{constructor(t){const e=t.editorSession;e&&(this.editorSession=e,this.selection=e.getSelection(),this.selectionState=e.getSelectionState(),this.surface=e.getFocusedSurface())}}class tg{onKeydown(t,e){let r=wd(t),n=this._getBindings("keydown",r);if(n){e=e||this._getContext();let r=this._getParams(e),s=!1;for(let t=0;t<n.length&&!s;t++){s=(0,n[t])(r,e)}return s&&(t.preventDefault(),t.stopPropagation()),s}}onTextInput(t,e){let r=this._getBindings("textinput",t);if(r){e=e||this._getContext();let t=this._getParams(e),n=!1;for(let s=0;s<r.length&&!n;s++){n=(0,r[s])(t,e)}return n}}_getParams(t){return new Qf(t)}_getBindings(t,e){throw new Error("This method is abstract")}_getContext(){throw new Error("This method is abstract")}}class eg extends zf{render(t){return this._renderContent(t).addClass("sc-annotated-text").css({whiteSpace:"pre-wrap"})}getPath(){return this.props.path}getText(){return this.getDocument().get(this.props.path)||""}isEmpty(){return!this.getText()}getAnnotations(){return this.getDocument().getIndex("annotations").get(this.props.path)}getDocument(){return this.props.doc||this.context.doc}_getTagName(){return this.props.tagName}_renderContent(t){let e=this.getText(),r=this.getAnnotations(),n=t(this._getTagName()||"span");if(r&&r.length>0){let s=new Hu;s.onText=this._renderTextNode.bind(this),s.onOpen=this._renderFragment.bind(this,t),s.onClose=this._finishFragment.bind(this),s.start(n,e,r)}else n.append(e);return n}_renderTextNode(t,e){e&&e.length>0&&t.append(e)}_renderFragment(t,e){let r=e.node;return t(this._getFragmentComponentClass(r),this._getFragmentProps(r))}_getFragmentComponentClass(t,e){let r=this.getComponent(t.type,"not-strict");return!t.isInlineNode()||r.prototype._isInlineNodeComponent||r.isCustom||(r=this.getComponent("inline-node")),r||e||(r=t._isAnnotation?this._getUnsupportedAnnotationComponentClass():this._getUnsupportedInlineNodeComponentClass()),r}_getUnsupportedAnnotationComponentClass(){return this.getComponent("annotation")}_getUnsupportedInlineNodeComponentClass(){return this.getComponent("annotation")}_getFragmentProps(t){return{node:t}}_finishFragment(t,e,r){r.append(e)}}class rg{constructor(t){if(this.config=t||{},this.name=this.config.name,!this.name)throw new Error("'name' is required")}get isAsync(){return!1}getName(){return this.name}getCommandState(t,e){throw new Error("Command.getCommandState() is abstract.")}execute(t,e){throw new Error("Command.execute() is abstract.")}isAnnotationCommand(){return!1}isInsertCommand(){return!1}isSwitchTypeCommand(){return!1}getParams(t){return new Qf(t)}get _isCommand(){return!0}}rg.DISABLED=Object.freeze({disabled:!0,active:!1});class ng extends zf{didMount(){this.props.node.on("highlighted",this.onHighlightedChanged,this)}dispose(){this.props.node.off(this)}render(t){let e=t(this.getTagName()).attr("data-id",this.props.node.id).addClass(this.getClassNames());return this.props.node.highlighted&&e.addClass("sm-highlighted"),e.append(this.props.children),e}getClassNames(){return`sc-annotation sm-${this.props.node.type}`}onHighlightedChanged(){this.props.node.highlighted?this.el.addClass("sm-highlighted"):this.el.removeClass("sm-highlighted")}getTagName(){return"span"}}const sg="X",ig="/".charCodeAt(0);class og extends Xf{render(t){const e=this.props.node,r=this.ContentClass,n=this.props.disabled;let s=t("div");s.addClass(this.getClassNames()).addClass("sc-isolated-node").addClass("sm-"+this.props.node.type).attr("data-id",e.id),n&&s.addClass("sm-disabled"),this.state.mode&&s.addClass("sm-"+this.state.mode),r.noStyle||s.addClass("sm-default-style"),s.on("keydown",this.onKeydown);const i="closed"===this.blockingMode&&!this.state.unblocked;s.append(t("div").addClass("se-bracket sm-left").ref("left").append(sg));let o=this.renderContent(t,e,{disabled:this.props.disabled||i}).ref("content");return o.attr("contenteditable",!1),s.append(o),s.append(t(ag).ref("blocker")),s.append(t("div").addClass("se-bracket sm-right").ref("right").append(sg)),i||(s.addClass("sm-no-blocker"),s.on("click",this.onClick).on("dblclick",this.onDblClick)),s.on("mousedown",this._reserveMousedown,this),s}getClassNames(){return""}getContent(){return this.refs.content}selectNode(){const t=this.getEditorSession();let e={type:"node",nodeId:this.props.node.id};const r=this.getParentSurface();r&&Object.assign(e,{containerPath:r.getContainerPath(),surfaceId:r.id}),t.setSelection(e)}onClick(t){t.stopPropagation(),t.preventDefault(),this.selectNode()}onDblClick(t){t.stopPropagation()}grabFocus(t){let e=this.refs.content;if(e.grabFocus)return e.grabFocus(t),!0}_reserveMousedown(t){t.__reserved__||(t.__reserved__=this)}_deriveStateFromSelectionState(t,e){const r=this._getSurfaceForSelection(t,e),n=this.getParentSurface();let s={mode:null,unblocked:null};if(!r)return s;if(r===n){let e=this.props.node.id;t.isNodeSelection()&&t.getNodeId()===e&&(t.isFull()?(s.mode="selected",s.unblocked=!0):t.isBefore()?(s.mode="cursor",s.position="before"):t.isAfter()&&(s.mode="cursor",s.position="after")),t.isContainerSelection()&&t.containsNode(e)&&(s.mode="co-selected")}else{let e=t.surfaceId,r=this.getId();if(r.length<e.length&&e.startsWith(r)&&e.charCodeAt(r.length)===ig){e.slice(r.length+1).indexOf("/")>0?(s.mode="co-focused",s.unblocked=!0):(s.mode="focused",s.unblocked=!0)}}return s}get _isIsolatedNodeComponent(){return!0}static getDOMCoordinate(t,e){let{start:r,end:n}=og.getDOMCoordinates(t);return 0===e.offset?r:n}static getDOMCoordinates(t){const e=t.refs.left,r=t.refs.right;return{start:{container:e.getNativeElement(),offset:0},end:{container:r.getNativeElement(),offset:r.getChildCount()}}}static getCoordinate(t,e){let r,n=zf.unwrap(t,"strict").context.isolatedNodeComponent,s=null;return"left"===e.direction||t===n.refs.left.el?s=0:"right"!==e.direction&&t!==n.refs.right.el||(s=1),null!==s&&((r=new On([n.props.node.id],s))._comp=n),r}}class ag extends zf{render(t){return t("div").addClass("sc-isolated-node-blocker").attr("draggable",!0).attr("contenteditable",!1).on("click",this.onClick).on("dblclick",this.onDblClick)}onClick(t){if(t.target!==this.getNativeElement())return;t.stopPropagation();const e=this._getIsolatedNodeComponent();e.extendState({mode:"selected",unblocked:!0}),e.selectNode()}onDblClick(t){t.stopPropagation()}_getIsolatedNodeComponent(){return this.context.isolatedNodeComponent}}class lg extends zf{render(t){let e=t("span").addClass("se-selection-fragment");if(this.props.collaborator){let t=this.props.collaborator.colorIndex;e.addClass("sm-collaborator-"+t)}else e.addClass("sm-local-user");return e.append(this.props.children),e}}class cg extends eg{didMount(){this.context.editorSession.getEditorState().addObserver(["document"],this._onDocumentChange,this,{stage:"render",document:{path:this.getPath()}})}dispose(){this.context.editorSession.getEditorState().removeObserver(this)}render(t){let e=this.getPath(),r=this._renderContent(t).addClass("sc-text-property").attr({"data-path":Zu(e)}).css({"white-space":"pre-wrap"});return this.isEmpty()&&(r.addClass("sm-empty"),this.props.placeholder&&r.setAttribute("data-placeholder",this.props.placeholder)),this.props.withoutBreak||r.append(t("br")),r}getAnnotations(){let t=this.getPath(),e=this.getDocument().getAnnotations(t)||[],r=this.context.markersManager;return r&&(e=e.concat(r.getMarkers(t))),e}_renderFragment(t,e){let r,n=e.node,s=n.id;return"selection-fragment"===n.type?r=t(lg,{collaborator:n.collaborator}):(r=super._renderFragment.apply(this,arguments),s&&r.ref(s+"@"+e.counter)),r.attr("data-offset",e.offset),r}getSurface(){return this.props.surface||this.context.surface}getSurfaceId(){let t=this.getSurface();return t?t.id:null}getContainerPath(){let t=this.getSurface();return t?t.getContainerPath():null}isEditable(){const t=this.getSurface();return!!t&&t.isEditable()}isReadonly(){const t=this.getSurface();return!t||t.isReadonly()}getDOMCoordinate(t){return this._getDOMCoordinate(this.el,t)}_finishFragment(t,e,r){e.attr("data-length",t.length),r.append(e)}_getDOMCoordinate(t,e){let r,n=0;if(0===e)return{container:t.getNativeElement(),offset:0};for(let s=t.getFirstChild();s;s=s.getNextSibling(),n++)if(s.isTextNode()){if((r=s.textContent.length)>=e)return{container:s.getNativeElement(),offset:e};e-=r}else if(s.isElementNode()){let i=s.getAttribute("data-length");if(!i)return console.error("FIXME: Can not map to DOM coordinates."),null;if((r=parseInt(i,10))>=e){if(s.attr("data-inline")){let e=s.getNextSibling();return e&&e.isTextNode()?{container:e.getNativeElement(),offset:0}:{container:t.getNativeElement(),offset:t.getChildIndex(s)+1}}return this._getDOMCoordinate(s,e,n)}e-=r}}_onDocumentChange(){this.rerender()}_getUnsupportedInlineNodeComponentClass(){return this.getComponent("unsupported-inline-node")}get _isTextPropertyComponent(){return!0}static getCoordinate(t,e,r){let n=this._getPropertyContext(t,e,r);if(!n)return null;let i=n.comp,o=i._getCharPos(n.node,n.offset);if(s(o)){let t=new On(n.path,o);return t._comp=i,t}return null}static _getPropertyContext(t,e,r){let n={comp:null,el:null,path:null,node:e,offset:r};for(;e&&e!==t;){if(e.isElementNode()){let t=zf.unwrap(e);if(t&&t._isTextPropertyComponent)return n.comp=t,n.el=e,n.path=t.getPath(),n;e.getAttribute("data-inline")&&(n.node=e,r>0&&(n.offset=1))}e=e.getParent()}return null}_getCharPos(t,e){let r,n,s=e;if(r=t.getParent(),t.isTextNode())if(t===r.firstChild){let t=r.getAttribute("data-path"),n=r.getAttribute("data-offset");s=t?e:n?parseInt(n,10)+e:this._getCharPos(r,0)+e}else n=r.getChildIndex(t),s=this._getCharPos(r,n)+e;else{if(!t.isElementNode())return null;{let i=t.getAttribute("data-path"),o=t.getAttribute("data-offset");i?s=this._countCharacters(t,e):o?(n=r.getChildIndex(t),s=parseInt(o,10)+this._countCharacters(t,e)):(n=r.getChildIndex(t),s=this._getCharPos(r,n)+this._countCharacters(t,e))}}return s}_countCharacters(t,e){let r=0;if(t.getAttribute("data-inline"))return 0===e?0:1;let n=t.getChildCount();1===arguments.length&&(e=n),e=Math.min(n,e);for(let n=0,s=t.getFirstChild();n<e;s=s.getNextSibling(),n++)if(s.isTextNode())r+=s.getTextContent().length;else if(s.isElementNode()){let t=s.getAttribute("data-length");s.getAttribute("data-inline")?r+=1:r+=t?parseInt(t,10):this._countCharacters(s)}return r}}const hg=["a","b","big","i","small","tt","abbr","acronym","cite","code","dfn","em","kbd","strong","samp","time","var","bdo","br","img","map","object","q","script","span","sub","sup","button","input","label","select","textarea"].reduce((t,e)=>(t[e]=!0,t),{});class ug{copy(t,e){let r=e.editorSession.copy();this._setClipboardData(t,e,r)}cut(t,e){let r=e.editorSession.cut();this._setClipboardData(t,e,r)}paste(t,e,r={}){let n={};for(let e=0;e<t.types.length;e++)n[t.types[e]]=!0;let s=n["text/html"]?t.getData("text/html"):"",i=!1;if(s&&!r.plainTextOnly&&(i=this._pasteHtml(s,e,r)),!i){let s=n["text/plain"]?t.getData("text/plain"):"";this._pasteText(s,e,r)}}_setClipboardData(t,e,r){let n=this._createClipboardText(e,r),s=this._createClipboardHtml(e,r);t.setData("text/plain",n),t.setData("text/html",s)}_createClipboardText(t,e){let r=t.config.createExporter("text");return r?r.exportNode(e.getContainer()):""}_createClipboardHtml(t,e){let r,n=t.config.createExporter("html").convertContainer(e,e.getContainer().getPath());r=1===n.length&&n[0].attr("data-id")===vu?n[0].innerHTML:n.map(t=>t.outerHTML).join("");let s=new sp;return"<html><head>"+`<script id="substance-clipboard" type="application/json">${JSON.stringify(s.exportDocument(e))}<\/script>`+"</head><body>"+r+"</body></html>"}_pasteHtml(t,r,n={}){let s,i;try{s=_n.parseHTML(t)}catch(t){return console.error("Could not parse HTML received from the clipboard",t),!1}if(t.search(/script id=.substance-clipboard./)>=0){let t=s.find("#substance-clipboard");if(t){let e=t.textContent;try{i=this._importFromJSON(r,e)}finally{i||console.error("Could not convert clipboard content.")}}}if(!i){let n={};if(Object.assign(n,this._detectApplicationType(t,s)),e.isWindows||n.isMicrosoftWord){const e="\x3c!--StartFragment--\x3e",r="\x3c!--EndFragment--\x3e";let n=t.indexOf(e);if(n>=0){let i=t.indexOf(r),o=t.slice(n+e.length,i);s=_n.parseHTML(o)}}let o=s.find("body");if(!(o=this._sanitizeBody(n,o)))return console.error("Invalid HTML."),!1;o=this._wrapIntoParagraph(o),i=r.editorSession.getDocument().createSnippet();let a=r.config.createImporter("html",i),l=i.get(bu);o.getChildren().forEach(t=>{let e=a.convertElement(t);e&&l.append(e.id)})}return r.editorSession.paste(i,n)}_pasteText(t,e){e.editorSession.insertText(t)}_importFromJSON(t,e){let r=t.editorSession.getDocument().newInstance(),n=JSON.parse(e);return(new sp).importDocument(r,n),r}_detectApplicationType(t,e){let r={},n=e.find('meta[name="generator"]'),s=e.find("html").getAttribute("xmlns:w");if(n){n.getAttribute("content").indexOf("LibreOffice")>-1&&(r.isLibreOffice=!0)}else s?s.indexOf("office:word")>-1&&(r.isMicrosoftWord=!0):t.indexOf("docs-internal-guid")>-1&&(r.isGoogleDoc=!0);return r}_sanitizeBody(t,e){if(e.findAll("meta").forEach(t=>t.remove()),t.isLibreOffice||t.isMicrosoftWord){let t=e.getInnerHTML();e.setInnerHTML(t.replace(/\r\n|\r|\n/g," "))}return t.isGoogleDoc&&(e=this._fixupGoogleDocsBody(t,e)),e}_fixupGoogleDocsBody(t,e){if(!e)return;let r=e.find("b");r&&/^docs-internal/.exec(r.id)&&(e=r),e.findAll("span").forEach(t=>{let e=[];"700"===t.getStyle("font-weight")&&e.push("b"),"italic"===t.getStyle("font-style")&&e.push("i"),"super"===t.getStyle("vertical-align")&&e.push("sup"),"sub"===t.getStyle("vertical-align")&&e.push("sub"),t.removeAttribute("style"),function r(n,s){if(e.length>0){let i=n.createElement(e[0]);1===e.length&&i.append(t.textContent),s?n.replaceChild(t,i):n.appendChild(i),e.shift(),r(i)}}(t.getParent(),!0)});return["b","i","sup","sub"].forEach(t=>{e.findAll(t).forEach(e=>{let r=e.getPreviousSibling();if(r&&e.tagName===r.tagName){let n=e.getParent(),s=n.createElement(t);s.setInnerHTML(r.getInnerHTML()+e.getInnerHTML()),n.replaceChild(e,s),n.removeChild(r)}if(r&&r.tagName&&e.getChildCount()>0&&e.getChildAt(0).tagName===r.tagName){let n=e.getParent(),s=e.getChildAt(0),i=n.createElement(r.tagName),o=i.createElement(t);o.setTextContent(s.textContent),i.appendChild(o),n.replaceChild(e,i)}})}),e}_wrapIntoParagraph(t){let e=t.getChildNodes(),r=!1;for(let t=0;t<e.length;t++){const n=e[t];if(n.isTextNode()){if(!/^\s+$/.exec(n.textContent)){r=!0;break}}else if(hg[n.tagName]){r=!0;break}}if(r){let r=t.createElement("p");r.append(e),t.append(r)}return t}}const dg=!1;class pg{constructor(t){this.editor=t,e.inBrowser&&(this.wRange=window.document.createRange()),this.state={dom:null,model:null}}getSelection(t){if(!e.inBrowser)return;let r=this.mapDOMSelection(t);return this.editor.getDocument()._createSelectionFromRange(r)}getSelectionForDOMRange(t){let e=this.mapDOMRange(t);return this.editor.getDocument()._createSelectionFromRange(e)}mapDOMSelection(t){let e,r=window.getSelection(),n=this.state;if(dg&&console.info("DOM->Model: ",r.anchorNode,r.anchorOffset,r.focusNode,r.focusOffset),0===r.rangeCount)return i();let s=_n.wrapNativeElement(r.anchorNode);if(r.isCollapsed){let n=this._getCoordinate(s,r.anchorOffset,t);if(!n)return i();e=fg({start:n,end:n})}else{let n=_n.wrapNativeElement(r.focusNode);e=this._getRange(s,r.anchorOffset,n,r.focusOffset,t)}return dg&&console.info("DOM->Model: range ",e?e.toString():null),n.model=e,e;function i(){return n.dom=null,n.model=null,null}}setSelection(t){if(!e.inBrowser)return;let r=this.state,n=window.getSelection(),s=this.wRange;if(!t||t.isNull())return this.clear();let{start:i,end:o}=this.mapModelToDOMCoordinates(t);if(!i)return this.clear();t.isReverse()&&([i,o]=[o,i]),r.dom={anchorNode:i.container,anchorOffset:i.offset,focusNode:o.container,focusOffset:o.offset};try{!function({anchorNode:t,anchorOffset:e,focusNode:r,focusOffset:i}){n.removeAllRanges(),s.setStart(t,e),s.setEnd(t,e),n.addRange(s),(r!==e||i!==e)&&n.extend(r,i)}(r.dom)}finally{}}mapModelToDOMCoordinates(t){let e;dg&&console.info("Model->DOM: sel =",t.toString());let r,n,s=this.editor.getSurfaceManager().getSurface(t.surfaceId);if(s?e=s.el:(console.warn("No surface:",t.surfaceId),e=this.editor.getElement()),t.isNull()||t.isCustomSelection())return{};if(t.isPropertySelection()||t.isContainerSelection()){if(!(r=this._getDOMCoordinate(e,t.start)))return console.warn("FIXME: selection seems to be invalid."),{};if(t.isCollapsed())n=r;else if(!(n=this._getDOMCoordinate(e,t.end)))return console.warn("FIXME: selection seems to be invalid."),{}}else if(t.isNodeSelection()){let s=zf.unwrap(e.find('*[data-id="'+t.getNodeId()+'"]'));if(!s)return console.error("Could not find component with id",t.getNodeId()),{};if(s._isIsolatedNodeComponent){let e=og.getDOMCoordinates(s,t);r=e.start,n=e.end}else{let t=s.el;r={container:t.getNativeElement(),offset:0},n={container:t.getNativeElement(),offset:t.getChildCount()}}}return dg&&console.info("Model->DOM:",r.container,r.offset,n.container,n.offset,"isReverse?",t.isReverse()),{start:r,end:n}}_getDOMCoordinate(t,e){let r,n=null;if(e.isNodeCoordinate()){if(r=zf.unwrap(t.find('*[data-id="'+e.getNodeId()+'"]')))if(r._isIsolatedNodeComponent)n=og.getDOMCoordinate(r,e);else{let t=0;e.offset>0&&(t=r.getChildCount()),n={container:r.getNativeElement(),offset:t}}}else(r=zf.unwrap(t.find('.sc-text-property[data-path="'+e.path.join(".")+'"]')))&&(n=r.getDOMCoordinate(e.offset));return n}mapDOMRange(t,e){return this._getRange(_n.wrapNativeElement(t.startContainer),t.startOffset,_n.wrapNativeElement(t.endContainer),t.endOffset,e)}clear(){window.getSelection().removeAllRanges(),this.state.dom=null,this.state.model=null}collapse(t){let e,r=window.getSelection();r.rangeCount>0&&((e=r.getRangeAt(0)).collapse("left"===t),r.removeAllRanges(),r.addRange(e))}select(t){let e=window.getSelection(),r=window.document.createRange();r.selectNode(t.getNativeElement()),e.removeAllRanges(),e.addRange(r)}extend(t,e){window.getSelection().extend(t.getNativeElement(),e)}setCursor(t,e){let r=window.getSelection(),n=window.document.createRange();n.setStart(t.getNativeElement(),e),r.removeAllRanges(),r.addRange(n)}_getRange(t,e,r,n,s={}){let i,o,a=_n.isReverse(t,e,r,n);return t===r&&e===n?i=o=this._getCoordinate(t,e,s):(i=this._getCoordinate(t,e,{direction:a?"right":"left"}),o=this._getCoordinate(r,n,s)),i&&o?fg({start:i,end:o,isReverse:a}):null}_getCoordinate(t,e,r={}){let n=null;n||(n=cg.getCoordinate(this.editor.getElement(),t,e));let s=zf.unwrap(t);if(!n&&s&&s.context.isolatedNodeComponent&&(n=og.getCoordinate(t,r)),!n)if(s&&s._isContainerEditor){let t=0===e?0:e-1,r=0===e,i=s.getDocument(),o=s.getContainerPath(),a=i.get(o),l=i.get(a[t]),c=s.getChildAt(t);(n=new On([l.id],r?0:1))._comp=c}else if(t.isElementNode()&&t.getChildCount()>0){let r,s=e>0?t.getChildAt(e-1):t.firstChild,i=zf.unwrap(s);i&&i._isTextPropertyComponent&&(r=s),r&&(n=cg.getCoordinate(t,r,e>0?r.getChildCount():0))}return n}}function fg({start:t,end:e,isReverse:r}){if(r&&([t,e]=[e,t]),!t._comp||!e._comp)return console.error("FIXME: getCoordinate() should provide a component instance"),null;let n=t._comp.context.surface;return n?n!==e._comp.context.surface?(console.error("Coordinates are within two different surfaces. Can not create a selection."),null):new Ep(t,e,r,n.getContainerPath(),n.id):(console.error("FIXME: Editable components should have their surface in the context"),null)}const gg=e.isFF?1:0;class mg extends zf{constructor(...t){super(...t),this._initialize()}_initialize(){if(!this.getEditorSession())throw new Error("editorSession is mandatory");if(this.name=this.props.name,!this.name)throw new Error("Surface must have a name.");if(this.name.indexOf("/")>-1)throw new Error("Surface.name must not contain '/'");this._surfaceId=mg.createSurfaceId(this),this.clipboard=this.context.clipboard||this._initializeClipboard(),this.domSelection=this.context.domSelection||this._initializeDOMSelection(),this._state={skipNextFocusEvent:!1}}_initializeClipboard(){return new ug}_initializeDOMSelection(){return new pg(this)}getChildContext(){return{surface:this,parentSurfaceId:this.getId(),doc:this.getDocument(),isolatedNodeComponent:null}}didMount(){const t=this.getSurfaceManager();t&&this.isEditable()&&t.registerSurface(this);const e=this.getGlobalEventHandler();e&&e.addEventListener("keydown",this._muteNativeHandlers,this)}dispose(){this.getSurfaceManager().unregisterSurface(this);const t=this.getGlobalEventHandler();t&&t.removeEventListener("keydown",this._muteNativeHandlers)}didUpdate(){this._updateContentEditableState()}render(t){let r=t(this.props.tagName||"div").addClass(this._getClassNames()).attr("tabindex",2).attr("data-surface-id",this.id);return this.isDisabled()||(this.isEditable()&&(r.on("keydown",this.onKeyDown),e.isIE||(r.on("compositionstart",this.onCompositionStart),r.on("compositionend",this.onCompositionEnd)),e.isChromium||e.isOpera?r.on("input",this.onTextInput):r.on("keypress",this.onTextInputShim),r.on("paste",this._onPaste),r.on("cut",this._onCut)),this.isReadonly()||(r.on("mousedown",this.onMouseDown),r.on("contextmenu",this.onContextMenu),r.on("focus",this.onNativeFocus),r.on("blur",this.onNativeBlur),r.on("click",this.onClick)),r.on("copy",this._onCopy)),r}_getClassNames(){return`sc-surface sm-${this.name}`}getName(){return this.name}getId(){return this._surfaceId}getSurfaceId(){return this._surfaceId}isDisabled(){return this.props.disabled}isEditable(){return!this.isReadonly()}isReadonly(){return!1===this.props.editable||!this.parent.context.editable}getElement(){return this.el}getDocument(){return this.getEditorSession().getDocument()}getComponentRegistry(){return this.context.componentRegistry}getConfig(){return this.context.config}getEditorSession(){return this.context.editorSession}getSurfaceManager(){return this.context.surfaceManager}getGlobalEventHandler(){return this.context.globalEventHandler}getKeyboardManager(){return this.context.keyboardManager}isEnabled(){return!this.state.disabled}isContainerEditor(){return!1}isCustomEditor(){return!1}hasNativeSpellcheck(){return"native"===this.props.spellcheck}getContainerPath(){return null}focus(){this.getEditorSession().getSelection().surfaceId!==this.getId()&&this.selectFirst()}blur(){const t=this.getEditorSession();t.getSelection().surfaceId===this.getId()&&t.setSelection(null)}selectFirst(){}type(t){this.getEditorSession().transaction(e=>{e.insertText(t)},{action:"type"})}rerenderDOMSelection(){if(!this.isDisabled()&&e.inBrowser){let t=this.getEditorSession().getSelection();if(t.surfaceId===this.getId()){this.domSelection.setSelection(t);const e=this.context.scrollPane;e&&e.onSelectionPositioned&&(console.error("DEPRECATED: you should manage the scrollPane yourself"),e.onSelectionPositioned())}}}getDomNodeForId(t){return this.el.getNativeElement().querySelector('*[data-id="'+t+'"]')}onKeyDown(t){if(!this._shouldConsumeEvent(t))return;if("Dead"===t.key)return;const e=this.getKeyboardManager();if(!e||!e.onKeydown(t))switch(t.keyCode){case gd.LEFT:case gd.RIGHT:return this._handleLeftOrRightArrowKey(t);case gd.UP:case gd.DOWN:return this._handleUpOrDownArrowKey(t);case gd.HOME:case gd.END:return this._handleHomeOrEndKey(t);case gd.PAGEUP:case gd.PAGEDOWN:return this._handlePageUpOrDownKey(t);case gd.ENTER:return this._handleEnterKey(t);case gd.TAB:return this._handleTabKey(t);case gd.BACKSPACE:case gd.DELETE:return this._handleDeleteKey(t);case gd.ESCAPE:return this._handleEscapeKey(t);case gd.SPACE:return this._handleSpaceKey(t)}}onTextInput(t){if(!this._shouldConsumeEvent(t))return;if(t.preventDefault(),t.stopPropagation(),!t.data)return;let e=t.data;const r=this.getKeyboardManager();r&&r.onTextInput(e)||this.type(e)}onCompositionStart(t){if(this._shouldConsumeEvent(t)&&t.data){const e=this.getEditorSession();let r=t.data.length,n=e.getSelection();if(n.isPropertySelection()&&n.isCollapsed()){let t=n.start.offset;e.setSelection(n.createWithNewRange(t-r,t))}}}onCompositionEnd(t){if(this._shouldConsumeEvent(t)&&e.isFF){if(t.preventDefault(),t.stopPropagation(),!t.data)return;this._delayed(()=>{let e=t.data;const r=this.getKeyboardManager();r&&r.onTextInput(e)||this.type(e)})}}onTextInputShim(t){if(!this._shouldConsumeEvent(t))return;if(0===t.which||0===t.charCode||t.keyCode===gd.TAB||t.keyCode===gd.ESCAPE||Boolean(t.metaKey)||Boolean(t.ctrlKey)^Boolean(t.altKey))return;let e=String.fromCharCode(t.which);t.shiftKey||(e=e.toLowerCase()),t.preventDefault(),t.stopPropagation();const r=this.getKeyboardManager();r&&r.onTextInput(e)||e.length>0&&this.type(e)}onClick(t){if(!this._shouldConsumeEvent(t))return!1;t.stopPropagation()}onMouseDown(t){if(!this._shouldConsumeEvent(t))return!1;if(t.stopPropagation(),!t.__reserved__&&(t.__reserved__=this,this.isEditable()&&this.el.setAttribute("contenteditable",!0),0===t.button)){if(!(e.isIE&&e.version<12)&&t.detail>=3){let e=this.getEditorSession().getSelection();if(e.isPropertySelection())return this._selectProperty(e.path),t.preventDefault(),void t.stopPropagation();if(e.isContainerSelection())return this._selectProperty(e.startPath),t.preventDefault(),void t.stopPropagation()}if(this._state.skipNextFocusEvent=!0,this.el.on("mouseup",this.onMouseUp,this),e.inBrowser){_n.wrapNativeElement(window.document).on("mouseup",this.onMouseUp,this)}}}onMouseUp(t){if(this.el.off("mouseup",this.onMouseUp,this),e.inBrowser){_n.wrapNativeElement(window.document).off("mouseup",this.onMouseUp,this)}t.stopPropagation(),this._delayed(()=>{let t=this.domSelection.getSelection();this._setSelection(t)})}onContextMenu(t){if(!this._shouldConsumeEvent(t))return;let e=this.domSelection.getSelection();this._setSelection(e)}onNativeBlur(){this._state.hasNativeFocus=!1}onNativeFocus(){this._state.hasNativeFocus=!0}_onCopy(t){t.preventDefault(),t.stopPropagation();let e=t.clipboardData;this.clipboard.copy(e,this.context)}_onCut(t){t.preventDefault(),t.stopPropagation();let e=t.clipboardData;this.clipboard.cut(e,this.context)}_onPaste(t){t.preventDefault(),t.stopPropagation();let e=t.clipboardData;this.clipboard.paste(e,this.context)}_onSelectionChanged(t){let e=this._deriveModeFromSelection(t);this.state.mode!==e&&this.extendState({mode:e})}_deriveModeFromSelection(t){if(!t)return null;let e,r=t.surfaceId,n=this.getId();return bd(r,n)&&(e=r.length===n.length?"focused":"co-focused"),e}_updateContentEditableState(){let t=this.isEditable()&&!this.props.disabled;t&&"co-focused"===this.state.mode&&(t=function(t,e){if(e){let r=t.getSelection(),n=e.getSurface(r.surfaceId);if(n){let t=n.context.isolatedNodeComponent;if(t)return t.isOpen()}}}(this.getEditorSession(),this.getSurfaceManager())),t?this.el.setAttribute("contenteditable",!0):this.el.removeAttribute("contenteditable")}_blur(){this.el&&this.el.blur()}_focus(){this.isDisabled()||(e.isFF&&(this.domSelection.clear(),this.el.getNativeElement().blur()),this._focusElement())}_focusElement(){this._state.hasNativeFocus=!0,this.el&&!e.isWebkit&&(this._state.skipNextFocusEvent=!0,this.el.focus({preventScroll:!0}),this._state.skipNextFocusEvent=!1)}_handleLeftOrRightArrowKey(t){t.stopPropagation();let e=t.keyCode===gd.LEFT?"left":"right";this._delayed(()=>{this._updateModelSelection({direction:e})})}_handleUpOrDownArrowKey(t){t.stopPropagation(),this._delayed(()=>{let e={direction:t.keyCode===gd.UP?"left":"right"};this._updateModelSelection(e)})}_handleHomeOrEndKey(t){t.stopPropagation(),this._delayed(()=>{let e={direction:t.keyCode===gd.HOME?"left":"right"};this._updateModelSelection(e)})}_handlePageUpOrDownKey(t){t.stopPropagation(),this._delayed(()=>{let e={direction:t.keyCode===gd.PAGEUP?"left":"right"};this._updateModelSelection(e)})}_handleSpaceKey(t){t.stopPropagation(),t.preventDefault();const e=this.getKeyboardManager();e&&e.onTextInput(" ")||this.type(" ")}_handleTabKey(t){t.stopPropagation(),this.el.emit("tab",{altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,code:t.code}),!1===this.props.handleTab?t.preventDefault():this.__handleTab(t)}__handleTab(){this._delayed(()=>{this._updateModelSelection()})}_handleEnterKey(t){t.preventDefault(),t.stopPropagation(),this.getEditorSession().transaction(t=>{t.break()},{action:"break"})}_handleEscapeKey(){}_handleDeleteKey(t){t.preventDefault(),t.stopPropagation();let e=t.keyCode===gd.BACKSPACE?"left":"right";this.getEditorSession().transaction(t=>{t.deleteCharacter(e)},{action:"delete"})}_hasNativeFocus(){return Boolean(this._state.hasNativeFocus)}_setSelection(t){!t.isNull()&&t.surfaceId===this.id&&e.isFF&&this._focusElement(),this.getEditorSession().setSelection(t)}_updateModelSelection(t){let e=this.domSelection.getSelection(t);this._setSelection(e)}_selectProperty(t){let e=this.getDocument(),r=e.get(t);this._setSelection(e.createSelection({type:"property",path:t,startOffset:0,endOffset:r.length}))}_renderNode(t,e){let r=this.getDocument().get(e),n=this.getComponent(r.type,!0);return n||(console.error("Could not resolve a component for type: "+r.type),n=this.getComponent("unsupported-node")),t(n,this._getNodeProps(r))}_getNodeProps(t){return{node:t,placeholder:this.props.placeholder,disabled:this.props.disabled}}_shouldConsumeEvent(t){let e=zf.unwrap(t.target);return e&&(e===this||e.context.surface===this)}getSelectionFromEvent(t){let e=Sd(t),r=this.domSelection.getSelectionForDOMRange(e);return r.surfaceId=this.getId(),r}setSelectionFromEvent(t){let e=this.getSelectionFromEvent(t);e?(this._state.skipNextFocusEvent=!0,this._setSelection(e)):console.error("Could not create a selection from event.")}get id(){return this._surfaceId}_delayed(t){e.inBrowser&&window.setTimeout(t,gg)}_muteNativeHandlers(t){let r;r=e.isMac?["META+66","META+73","META+85"]:["CTRL+66","CTRL+73","CTRL+85"];const n=wd(t);r.indexOf(n)>-1&&t.preventDefault()}}mg.prototype._isSurface=!0,mg.createSurfaceId=function(t){let e=t.context.parentSurfaceId;return e?e+"/"+t.name:t.name};class _g extends mg{constructor(t,e){if(e.name=e.name||e.path.join("."),super(t,e),!e.path)throw new Error("Property 'path' is mandatory.")}didMount(){super.didMount(),this.context.editorSession.getEditorState().addObserver(["selection"],this._onSelectionChanged,this,{stage:"render"})}dispose(){super.dispose(),this.context.editorSession.getEditorState().removeObserver(this)}render(t){const e=this.getComponent("text-property");let r=super.render.apply(this,arguments);return this.props.disabled||(r.addClass("sm-enabled"),r.attr("contenteditable",!0),r.attr("spellcheck","native"===this.props.spellcheck)),r.append(t(e,{doc:this.getDocument(),placeholder:this.props.placeholder,tagName:this.props.tagName||"div",path:this.props.path,markers:this.props.markers,withoutBreak:this.props.withoutBreak}).ref("property")),this.isEditable()?r.addClass("sm-editable"):(r.addClass("sm-readonly"),r.setAttribute("contenteditable",!1)),r}_getClassNames(){return"sc-text-property-editor sc-surface"}selectFirst(){this.editorSession.setSelection({type:"property",path:this.getPath(),startOffset:0,surfaceId:this.id})}getPath(){return this.props.path}_handleEnterKey(t){t.stopPropagation(),t.preventDefault(),this.props.multiLine&&this.type("\n")}_handleEscapeKey(t){this.el.emit("escape",{altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,code:t.code})}get _isTextPropertyEditor(){return!0}}class yg extends zf{didMount(){}render(t){let e,r=this.context.surface;e=r&&r.isContainerEditor()?this.getComponent("text-property"):this.getComponent("text-property-editor");const n=this.props.node,s=this.getTagName(),i=n.getPath();let o=t(s).addClass(this.getClassNames()).attr("data-id",n.id);return o.append(t(e,{doc:n.getDocument(),name:Zu(i),path:i,placeholder:this.props.placeholder})),o}getTagName(){return"div"}getClassNames(){return"sc-text-node sm-"+this.props.node.type}}class wg extends og{_getContentClass(){return bg}}class bg extends zf{render(t){const e=this.props.node;let r;return r=e._isXMLNode?e.toXML().serialize():e.data?e.data:JSON.stringify(e.toJSON()),t("div").addClass("sc-unsupported").append(t("pre").text(r)).attr({"data-id":e.id,contenteditable:!1})}}var vg={configure(t){t.addComponent("annotation",ng),t.addComponent("isolated-node",og),t.addComponent("text-node",yg),t.addComponent("text-property",cg),t.addComponent("text-property-editor",_g),t.addComponent("unsupported-node",wg)}};const Sg=Object.freeze({disabled:!0});class Eg{constructor(t,e,r){this.editorSession=t,this._allCommands=r,this._commands=null,t.getEditorState().addObserver(e,this.reduce,this,{stage:"update"})}dispose(){this.editorSession.getEditorState().off(this)}initialize(){this._initializeCommands(),this.reduce()}reduce(){const t=this._getCommandStates();this.editorSession.getEditorState().set("commandStates",t)}executeCommand(t,e={}){const r=this.editorSession.getEditorState().commandStates[t];if(!r||r.disabled)return!1;{const n=this._getCommands().get(t),s=this.editorSession.getContext();return(e=Object.assign(new Qf(s),e)).commandState=r,n.execute(e,s),!0}}_getCommandStates(){this._commands||this._initializeCommands();const t=this.editorSession.getEditorState(),e=this.editorSession.getContext(),r=new Qf(e),n=t.document,s=t.selection,i=t.selectionState,o=t.isBlurred,a=!s||s.isNull()||!s.isAttached(),l=Object.assign({},this._allDisabled);if(!o&&!a&&!s.isCustomSelection()){const t=s.start.path,o=n.get(t[0]);if(!o)throw new Error("FIXME: explain when this happens");const a=function(t,e){if(2===e.length){let r=O(e),n=t.getSchema().getProperty(r);return n||console.error("Could not find property for path",e,t),n}}(o,t);!!a&&a.isText()&&s.isPropertySelection()&&!i.isInlineNodeSelection&&Object.assign(l,xg(this._annotationCommands,a.targetTypes,r,e));let c=i.containerPath;if(c){let t=n.getProperty(c);if(t){let n=t.targetTypes;Object.assign(l,xg(this._insertCommands,n,r,e)),Object.assign(l,xg(this._switchTypeCommands,n,r,e))}}}return Object.assign(l,function(t,e,r){return t.reduce((t,n)=>(t[n.getName()]=n.getCommandState(e,r),t),{})}(this._otherCommands,r,e)),l}_getCommands(){return this._commands||this._initializeCommands(),this._commands}_initializeCommands(){const t=this.editorSession.getContext(),e=Array.from(this._allCommands);let r=new Map(e.filter(([e,r])=>!r.shouldBeEnabled||r.shouldBeEnabled(t)));const n=[],s=[],i=[],o=[];r.forEach(t=>{t.isAnnotationCommand()?n.push(t):t.isInsertCommand()?s.push(t):t.isSwitchTypeCommand()?i.push(t):o.push(t)}),this._commands=r,this._annotationCommands=n,this._insertCommands=s,this._switchTypeCommands=i,this._otherCommands=o,this._allDisabled=function(t){return t.reduce((t,e)=>(t[e.getName()]=Sg,t),{})}(Array.from(r.values()))}}const Cg=new Set;function xg(t,e,r,n){return e=e||Cg,t.reduce((t,s)=>{const i=s.getType(),o=s.getName();return e.has(i)?t[o]=s.getCommandState(r,n):t[o]=Sg,t},{})}class Ng{constructor(t,e){this.lang=e||"en",this.labels=t}getLabel(t,e){let r=this.labels[this.lang];if(!r)return t;let n=r[t]||t;return e?this._evalTemplate(n,e):n}setLanguage(t){this.lang=t||"en"}_evalTemplate(t,e){return this._extractVariables(t).forEach(r=>{let n=new RegExp(`\\\${${r}}`,"g"),s=e[r];t=t.replace(n,s)}),t}_extractVariables(t){let e,r=/\${(\w+)}/g,n=[];for(;e=r.exec(t);)n.push(e[1]);return n}}class Tg extends zf{render(t){return this.props.stack?t("span").addClass("fa-stack").append(this.props.stack.map(e=>t("i").addClass("fa "+e+" fa-stack"))):t("i").addClass("fa "+this.props.icon)}}class Pg extends rg{constructor(t){if(super(t),!t.spec)throw new Error("'config.spec' is mandatory");if(!t.spec.type)throw new Error("'config.spec.type' is mandatory")}getType(){return this.config.spec.type}getCommandState(t){const e=t.editorSession,r=e.getDocument(),n=t.selection,s=e.isBlurred();let i={disabled:!1};if(n.isPropertySelection()&&!s){let t=n.getPath(),e=r.get(t[0]);e&&e.isText()?i.active=uc(e,this.config.spec):i.disabled=!0}else i.disabled=!0;return i}execute(t){t.editorSession.transaction(t=>t.switchTextType(this.config.spec))}isSwitchTypeCommand(){return!0}}class Ig{constructor(t,e){this._config=t,this._key=e}get(t,e){let r=this._config;const n=this._key;for(;r;){let e=r[n];if(e.has(t))return e.get(t);r=r.parent}if(e)throw new Error(`No value registered for name '${t}'`)}getAll(){let t=this._config,e=[];const r=this._key;for(;t;){let n=t[r];n&&e.unshift(n),t=t.parent}return new Map([].concat(...e.map(t=>Array.from(t.entries()))))}getRecords(t){let e=this._config,r=[];const n=this._key;for(;e;){let s=e[n];if(s){let e=s.get(t);e&&r.unshift(e)}e=e.parent}return r}}class Og extends Ng{constructor(t){super(),this.config=t}getLabel(t,e){const r=this.lang;let n=this.config._labelRegistry.get(t);if(!n)return t;let s=n[r]||t;return e?this._evalTemplate(s,e):s}}class Ag{constructor(t){this.config=t}renderIcon(t,e){let r=this._getIconDef(e);if(r){if(r.fontawesome)return t(Tg,{icon:r.fontawesome});throw new Error("Unsupported icon spec")}throw new Error(`No icon found for name '${e}'`)}_getIconDef(t){return this.config._iconRegistry.get(t)}}function Dg(t){return{componentRegistry:t.getComponentRegistry(),labelProvider:t.getLabelProvider(),iconProvider:t.getIconProvider()}}class Lg extends Zf{constructor(t){super(),this.editorState=t}getSelection(){return this.editorState.selection}}const kg=!1;class Mg{constructor(t){this.editorState=t,this.surfaces=new Map,t.addObserver(["selection","document"],this._onSelectionOrDocumentChange,this,{stage:"pre-position"}),t.addObserver(["selection","document"],this._scrollSelectionIntoView,this,{stage:"finalize"})}dispose(){this.editorState.off(this)}getSurface(t){if(t)return this.surfaces.get(t)}getFocusedSurface(){return console.error("DEPRECATED: use 'context.editorState.focusedSurface instead"),this.editorState.focusedSurface}registerSurface(t){const e=t.getId();if(kg&&console.log(`Registering surface ${e}.`,t.__id__),this.surfaces.has(e))throw new Error(`A surface with id ${e} has already been registered.`);this.surfaces.set(e,t)}unregisterSurface(t){let e=t.getId();kg&&console.log(`Unregistering surface ${e}.`,t.__id__),this.surfaces.get(e)===t&&this.surfaces.delete(e)}_getSurfaceForProperty(t){let e=Zu(t);if(this.surfaces.has(e))return this.surfaces.get(e);for(let e of this.surfaces.values()){let r=null;if(e._isContainerEditor?r=e.getContainerPath():e.getPath&&(r=e.getPath()),r&&In(t,r))return e}}_onSelectionOrDocumentChange(){if(this.editorState.isDirty("selection")){const t=this.editorState.selection;if(!t||t.isNull()){let t=this.editorState.focusedSurface;t&&t._blur&&t._blur()}this._reduceFocusedSurface(t),t&&t.isCustomSelection()&&e.inBrowser&&(window.getSelection().removeAllRanges(),window.document.activeElement.blur())}this._recoverDOMSelection()}_reduceFocusedSurface(t){const e=this.editorState;let r=null;t&&t.surfaceId&&(r=this.surfaces.get(t.surfaceId)),e.focusedSurface=r}_recoverDOMSelection(){const t=this.editorState;if(t.isBlurred)return;let e=t.focusedSurface;e&&!e.isDisabled()&&(e._focus(),e.rerenderDOMSelection())}_scrollSelectionIntoView(){let t=this.editorState.focusedSurface;t&&!t.isDisabled()&&t.send("scrollSelectionIntoView")}}class Rg extends od{constructor(t){super(),this._editorState=t,this._markers=new qg,t.addObserver(["document"],this._onDocumentChange,this,{stage:"update"})}dispose(){this._editorState.removeObserver(this)}addMarker(t){let e=t.getPath();this._markers.add(e,t),this._setDirty(e)}removeMarker(t){let e=t.getPath();this._markers.remove(e,t),this._setDirty(e)}clearMarkers(t,e){this._markers.clearMarkers(t,e),this._setDirty(t)}getMarkers(t){return this._markers.get(t)}_getDocumentObserver(){return this._editorState._getDocumentObserver()}_setDirty(t){this._editorState._setDirty("document"),this._getDocumentObserver().setDirty(t)}_onDocumentChange(t){for(let e of t.ops)if("update"===e.type&&e.diff._isTextOperation){let t=this._markers.get(e.path);if(!t||0===t.length)continue;let r=e.diff;switch(r.type){case"insert":t.forEach(t=>this._transformInsert(t,r));break;case"delete":t.forEach(t=>this._transformDelete(t,r))}}}_transformInsert(t,e){const r=e.pos,n=e.str.length;if(0===n)return;let s=t.start.offset,i=t.end.offset,o=s,a=i;return r>=i?void 0:r<=s?(o+=n,a+=n,t.start.offset=o,void(t.end.offset=a)):void(r<i&&(a+=n,t.end.offset=a,this._remove(t)))}_transformDelete(t,e){const r=e.pos,n=e.str.length,s=r+n;if(r!==s){var i=t.start.offset,o=t.end.offset,a=i,l=o;if(s<=i)a-=n,l-=n,t.start.offset=a,t.end.offset=l;else if(r>=o);else{if(r<=i&&(a=i-Math.min(s-r,i-r)),r<=o&&(l=o-Math.min(s-r,o-r)),i!==o&&a===l)return void this._remove(t);i!==a&&(t.start.offset=a),o!==l&&(t.end.offset=l),this._remove(t)}}}_remove(t){this.removeMarker(t)}}class qg{add(t,e){let r=Zu(t);this[r]||(this[r]=[]),this[r].push(e)}remove(t,e){let r=Zu(t);this[r]&&ku(this[r],e)}get(t){return this[Zu(t)]||[]}clearMarkers(t,e){let r=this[Zu(t)];if(r)for(let t=r.length-1;t>=0;t--)e(r[t])&&r.splice(t,1)}}class Bg extends tg{constructor(t,e,r){super(),this.contextProvider=r,this.bindings={},t.forEach(({key:t,spec:r})=>{if(!r.command)throw new Error("'spec.command' is required");const n=r.type||"keydown";"textinput"!==n&&(t=wd(yd(t))),this.bindings[n]||(this.bindings[n]={}),this.bindings[n][t]||(this.bindings[n][t]=[]),this.bindings[n][t].push(()=>e(r.command))})}_getBindings(t,e){let r=this.bindings[t];if(r)return r[e]}_getContext(){return this.contextProvider.context}}const jg=200;class Fg{constructor(t){this._editorSession=t,this._doc=t.getDocument(),this._dirty=new Set,this._updateSearchDebounced=Wa(this._updateSearch.bind(this,!0),jg);let e=this._editorSession.getEditorState();e.addObserver(["document"],this._onUpdate,this,{stage:"update"}),e.addObserver(["document"],this._onRender,this,{stage:"render"})}dispose(){this._editorSession.getEditorState().removeObserver(this)}openDialog(t){t=Boolean(t);let e=this._getState();e.enabled?e.showReplace!==t&&(e.showReplace=Boolean(t),this._updateState(e)):(e.enabled=!0,e.showReplace=Boolean(t),this._dirty=new Set,this._performSearch()),this._propgateUpdates()}closeDialog(){let t=this._getState();t.enabled&&(t.enabled=!1,this._clearHighlights(),this._updateState(t,"recoverSelection"),this._propgateUpdates())}next(){this._next(),this._propgateUpdates()}previous(){let t=this._getState();this._nav("back"),this._updateState(t),this._propgateUpdates()}setSearchPattern(t){let e=this._getState();e.pattern!==t&&(e.pattern=t,this._performSearch(),this._propgateUpdates())}setReplacePattern(t){let e=this._getState();e.replacePattern!==t&&(e.replacePattern=t,this._updateState(e),this._propgateUpdates())}replaceNext(){let t=this._getState();if(t._forceNav)return t._forceNav=!1,void this._next();if(t.replacePattern){let e=!1;if(t.cursor>=0){let r=this._getMatchAt(t.cursor);r&&(this._editorSession.transaction(e=>{this._replace(e,r,t)},{action:"replace"}),this._updateSearchForProperty(Zu(r.path)),this._editorSession.getEditorState().propagateUpdates(),t.cursor--,this._nav("forward"),this._updateState(t),e=!0)}e||this._next(),this._propgateUpdates()}}replaceAll(){let t=this._getState();if(!t.matches)return;let e=[];t.matches.forEach(t=>{e=e.concat(t)}),this._editorSession.transaction(r=>{for(let n=e.length-1;n>=0;n--)this._replace(r,e[n],t)},{action:"replace-all"}),t.matches=new Map,t.count=0,t.cursor=-1,this._updateState(t),this._propgateUpdates()}toggleCaseSensitivity(){this._toggleOption("caseSensitive"),this._propgateUpdates()}toggleRegexSearch(){this._toggleOption("regexSearch"),this._propgateUpdates()}toggleFullWordSearch(){this._toggleOption("fullWord"),this._propgateUpdates()}_getMarkersManager(){return this._editorSession.markersManager}_getState(){return this._editorSession.getEditorState().get("findAndReplace")||Fg.defaultState()}_toggleOption(t){let e=this._getState();e[t]=!e[t],this._performSearch()}_performSearch(){let t=this._getState();t.pattern?this._searchAndHighlight():this._clear(),t.cursor=-1,this._updateState(t),t.count>0&&this._next()}_next(){let t=this._getState();this._nav("forward"),this._updateState(t)}_updateState(t,e){const r=this._editorSession.getEditorState();e&&r._setDirty("selection"),r.set("findAndReplace",t)}_propgateUpdates(){const t=this._editorSession.getEditorState();t._isUpdating()||t.propagateUpdates()}_searchAndHighlight(){this._clearHighlights(),this._search(),this._addHighlights(),this._propgateUpdates()}_search(){let t=this._getState(),e=new Map,r=0,n=t.pattern,s=t;if(n){let t=this._getTextProperties();for(let i of t){let t=this._searchInProperty(i,n,s);r+=t.length,t.length>0&&e.set(Zu(i.getPath()),t)}}t.matches=e,t.count=r}_updateSearch(t){let e=this._getState();if(e.enabled&&e.pattern&&0!==this._dirty.size){for(let t of this._dirty)this._updateSearchForProperty(t);this._updateState(e,"recoverSelection"),this._dirty=new Set,t&&this._propgateUpdates()}}_updateSearchForProperty(t){let e=this._getMarkersManager(),r=this._getState(),n=r.matches,s=r.count,i=n.get(t);i&&(s-=i.length);let o=t.split(".");e.clearMarkers(o,t=>"find-marker"===t.type);let a=this._getTextProperty(t);a?(s+=(i=this._searchInProperty(a,r.pattern,r)).length,n.set(t,i),this._addHighlightsForProperty(o,i)):n.delete(t),r.count=s}_searchInProperty(t,e,r){let n=t.getPath();return function(t,e,r={}){r.regexSearch||(e=function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}(e));r.fullWord&&(e="\\b"+e+"\\b");let n=[];try{let s,i=new RegExp(e,r.caseSensitive?"g":"gi");for(;s=i.exec(t);)n.push({start:s.index,end:i.lastIndex})}catch(t){}return n}(t.getText(),e,r).map(e=>(e.id=h(),e.path=n,e.textProperty=t,e))}_replace(t,e,r){let n;if(t.setSelection({type:"property",path:e.path,startOffset:e.start,endOffset:e.end}),r.regexSearch){let e=du(t,t.selection),s=new RegExp(r.pattern);n=e.replace(s,r.replacePattern)}else n=r.replacePattern;t.insertText(n)}_clear(){let t=this._getState();this._clearHighlights(),t.matches=new Map,t.count=0}_clearHighlights(){const t=this._getMarkersManager(),e=this._getState();e.matches&&e.matches.forEach((e,r)=>{let n=r.split(".");t.clearMarkers(n,t=>"find-marker"===t.type)})}_addHighlights(){const t=this._getState();t.matches&&t.matches.forEach((t,e)=>{let r=e.split(".");this._addHighlightsForProperty(r,t)})}_addHighlightsForProperty(t,e){let r=this._getMarkersManager();e.forEach(e=>{r.addMarker(new Sp(this._doc,{type:"find-marker",id:e.id,start:{path:t,offset:e.start},end:{path:t,offset:e.end}}))})}_getTextProperties(){let t=this._editorSession.getRootComponent();if(t)return t.findAll(".sc-text-property");console.error("FindAndReplaceManager: no root component has been assigned yet.")}_getTextProperty(t){let e=this._editorSession.getRootComponent();if(e)return e.find(`.sc-text-property[data-path="${t}"]`);console.error("FindAndReplaceManager: no root component has been assigned yet.")}_nav(t){let e=this._getState(),[r,n]=this._getNext(t);n&&(e.cursor=r,this._scrollToMatch(n))}_getNext(t){let e,r=this._getState();return[e="forward"===t?Math.min(r.count-1,r.cursor+1):Math.max(0,r.cursor-1),this._getMatchAt(e)]}_getMatchAt(t){let e=this._getState();if(e.matches)for(let[,r]of e.matches){if(!(t>=r.length))return r[t];t-=r.length}}_scrollToMatch(t){let e=this._getState();e.marker&&e.marker.el.removeClass("sm-active");let r=t.textProperty,n=r.find(`.sm-find-marker[data-id="${t.id}"]`);n&&(n.el.addClass("sm-active"),e.marker=n,r.send("scrollElementIntoView",n.el))}_onUpdate(t){if("replace"===t.info.action||"replace-all"===t.info.action||"nop"===t.info.action)return;for(let e of t.ops)e.isUpdate()&&e.diff._isTextOperation&&this._dirty.add(Zu(e.path));let r=this._getState();r.enabled&&(r._forceNav=!0,e.test?this._updateSearch():this._updateSearchDebounced())}_onRender(t){}static defaultState(){return{enabled:!1,pattern:"",showReplace:!1,replacePattern:"",caseSensitive:!1,fullWord:!1,regexSearch:!1,matches:null,count:0,cursor:0}}}function Ug(t){return class extends t{_setup(t,e={}){this.config=t;const r=this.editorState;let n=new Mg(r),s=new Rg(r),i=new Bg(t.getKeyboardShortcuts(e),(t,e)=>this.executeCommand(t,e),this),o=new Eg(this,["document","selection"],t.getCommands(e)),a=new Fg(this);this.surfaceManager=n,this.markersManager=s,this.keyboardManager=i,this.commandManager=o,this.findAndReplaceManager=a,this.context=null,this._rootComponent=null}initialize(){super.initialize(),this.editorState.addObserver(["selection"],this._resetOverlayId,this,{stage:"update"}),this.commandManager.initialize()}dispose(){super.dispose(),this.editorState.removeObserver(this),this.surfaceManager.dispose(),this.markersManager.dispose(),this.commandManager.dispose(),this.findAndReplaceManager.dispose()}_createEditorState(t,e={}){return Object.assign(super._createEditorState(t,e),{focusedSurface:null,commandStates:{},overlayId:null,findAndReplace:Fg.defaultState()})}copy(){const t=this.getSelection(),e=this.getDocument();if(t&&!t.isNull()&&!t.isCollapsed())return xd(e,t)}cut(){const t=this.getSelection();if(t&&!t.isNull()&&!t.isCollapsed()){let t=this.copy();return this.deleteSelection(),t}}deleteSelection(t){const e=this.getSelection();!e||e.isNull()||e.isCollapsed()||this.transaction(e=>{e.deleteSelection(t)},{action:"deleteSelection"})}paste(t,e){return this.transaction(r=>{r.paste(t,e)},{action:"paste"}),!0}insertText(t){const e=this.getSelection();e&&!e.isNull()&&this.transaction(e=>{e.insertText(t)},{action:"insertText"})}executeCommand(t,e){return this.commandManager.executeCommand(t,e)}getCommandStates(){return this.editorState.commandStates}getConfig(){return this.config}getContext(){return this.context}setContext(t){this.context=t}getFocusedSurface(){return this.editorState.focusedSurface}getSurface(t){return this.surfaceManager.getSurface(t)}getSurfaceForProperty(t){return this.surfaceManager._getSurfaceForProperty(t)}setRootComponent(t){this._rootComponent=t}getRootComponent(){return this._rootComponent}_resetOverlayId(){const t=this.editorState.overlayId;let e=this.getSelection();if(e&&"value"===e.customType){let r=Zu(e.data.path);t!==r&&this.editorState.set("overlayId",r)}else this.editorState.set("overlayId",null)}}}const Hg=Object.freeze({disabled:!1});class Vg extends rg{getCommandState(t,e){if(!e.findAndReplaceManager)return{disabled:!0};switch(this.config.action){case"open-find":case"open-replace":return Hg}}execute(t,e){let r=e.findAndReplaceManager;switch(this.config.action){case"open-find":r.openDialog();break;case"open-replace":r.openDialog("replace")}}}const zg=300;class Gg extends zf{constructor(...t){super(...t),e.test||(this._updatePattern=Wa(this._updatePattern.bind(this),zg),this._updateReplacePattern=Wa(this._updateReplacePattern.bind(this),zg))}didMount(){this.context.editorState.addObserver(["findAndReplace"],this._onUpdate,this,{stage:"render"})}dispose(){this.context.editorState.removeObserver(this)}render(t){let e=this._getState(),r=t("div").addClass("sc-find-and-replace-dialog");return r.append(this._renderHeader(t),this._renderFindSection(t),this._renderReplaceSection(t)),e.enabled||r.addClass("sm-hidden"),r.on("keydown",this._onKeydown),r}_renderTitle(t){const e=this._getState();let r=e.showReplace?this.getLabel(`find-replace-title-${this.props.viewName}`):this.getLabel(`find-title-${this.props.viewName}`),n=[];return e.caseSensitive&&n.push("case-sensitive-title"),e.fullWord&&n.push("whole-word-title"),e.regexSearch&&n.push("regex-title"),n.length>0&&(r+=" ("+n.map(t=>this.getLabel(t)).join(", ")+")"),t("div").addClass("se-title").append(r)}_renderHeader(t){const e=this._getState(),r=this.getComponent("button");return t("div").addClass("se-header").append(this._renderTitle(t),t("div").addClass("se-group sm-options").append(t(r,{tooltip:this.getLabel("find-case-sensitive"),active:e.caseSensitive,theme:this.props.theme}).addClass("sm-case-sensitive").append("Aa").on("click",this._toggleCaseSensitivity),t(r,{tooltip:this.getLabel("find-whole-word"),active:e.fullWord,theme:this.props.theme}).addClass("sm-whole-word").append("Abc|").on("click",this._toggleFullWordSearch),t(r,{tooltip:this.getLabel("find-regex"),active:e.regexSearch,theme:this.props.theme}).addClass("sm-regex-search").append(".*").on("click",this._toggleRegexSearch),t(r,{tooltip:this.getLabel("close"),theme:this.props.theme}).addClass("sm-close").append(this.context.iconProvider.renderIcon(t,"close")).on("click",this._close)))}_renderFindSection(t){const e=this._getState(),r=this.getComponent("button");return t("div").addClass("se-section").addClass("sm-find").append(t("div").addClass("se-group sm-input").append(this._renderPatternInput(t),this._renderStatus(t)),t("div").addClass("se-group sm-actions").append(t(r,{tooltip:this.getLabel("find-next"),theme:this.props.theme,disabled:e.count<1}).addClass("sm-next").append(this.getLabel("next")).on("click",this._findNext),t(r,{tooltip:this.getLabel("find-previous"),theme:this.props.theme,disabled:e.count<1}).addClass("sm-previous").append(this.getLabel("previous")).on("click",this._findPrevious)))}_renderReplaceSection(t){let e=this._getState();if(e.showReplace){const r=this.getComponent("button");return t("div").addClass("se-section").addClass("sm-replace").append(t("div").addClass("se-group sm-input").append(this._renderReplacePatternInput(t)),t("div").addClass("se-group sm-actions").append(t(r,{tooltip:this.getLabel("replace"),theme:this.props.theme,disabled:e.count<1}).addClass("sm-replace").append(this.getLabel("replace")).on("click",this._replaceNext),t(r,{tooltip:this.getLabel("replace-all"),theme:this.props.theme,disabled:e.count<1}).addClass("sm-replace-all").append(this.getLabel("replace-all")).on("click",this._replaceAll)))}}_renderPatternInput(t){let e=this._getState();return t("input").ref("pattern").addClass("sm-find").attr({type:"text",placeholder:this.getLabel("find"),tabindex:500}).val(e.pattern).on("keydown",this._onPatternKeydown).on("input",this._updatePattern).on("focus",this._onFocus)}_renderReplacePatternInput(t){let e=this._getState();return t("input").ref("replacePattern").addClass("sm-replace").attr({type:"text",placeholder:this.getLabel("replace"),tabindex:500}).val(e.replacePattern).on("keydown",this._onReplacePatternKeydown).on("input",this._updateReplacePattern)}_renderStatus(t){let e=this._getState(),r=t("span").addClass("se-status");if(e.count>0){let t=-1===e.cursor?"?":String(e.cursor+1);r.append(`${t} of ${e.count}`)}else e.pattern&&r.append(this.getLabel("no-result"));return r}_grabFocus(){(this._getState().showReplace?this.refs.replacePattern:this.refs.pattern).el.focus()}_getState(){return this.context.editorSession.getEditorState().get("findAndReplace")}_getManager(){return this.context.findAndReplaceManager}_close(){this._getManager().closeDialog()}_findNext(){this._getManager().next()}_findPrevious(){this._getManager().previous()}_replaceNext(){this._getManager().replaceNext()}_replaceAll(){this._getManager().replaceAll()}_updatePattern(){this._getManager().setSearchPattern(this.refs.pattern.val())}_updateReplacePattern(){this._getManager().setReplacePattern(this.refs.replacePattern.val())}_toggleCaseSensitivity(){this._getManager().toggleCaseSensitivity()}_toggleFullWordSearch(){this._getManager().toggleFullWordSearch()}_toggleRegexSearch(){this._getManager().toggleRegexSearch()}_onUpdate(){let t=this.el.hasClass("sm-hidden");this.rerender();let e=this.el.hasClass("sm-hidden");t&&!e&&this._grabFocus()}_onKeydown(t){t.keyCode===gd.ESCAPE&&(t.stopPropagation(),t.preventDefault(),this._close())}_onFocus(t){t.stopPropagation(),this.context.editorState.set("isBlurred",!0)}_onPatternKeydown(t){t.stopPropagation(),t.keyCode===gd.ENTER&&(t.preventDefault(),this._findNext())}_onReplacePatternKeydown(t){t.stopPropagation(),t.keyCode===gd.ENTER&&(t.preventDefault(),this._replaceNext())}}var $g={name:"find-and-replace",configure:function(t,r){t.addComponent("find-and-replace-dialog",Gg),t.addComponent("find-marker",ng),t.addCommand("open-find",Vg,{commandGroup:"find-and-replace",action:"open-find"}),t.addCommand("open-replace",Vg,{commandGroup:"find-and-replace",action:"open-replace"}),t.addKeyboardShortcut("CommandOrControl+F",{command:"open-find"}),e.isMac?t.addKeyboardShortcut("CommandOrControl+Alt+F",{command:"open-replace"}):t.addKeyboardShortcut("CommandOrControl+H",{command:"open-replace"}),t.addLabel("find-and-replace-title",{en:"Find and replace"}),t.addLabel("find",{en:"Find"}),t.addLabel("find-next",{en:"Next match"}),t.addLabel("find-previous",{en:"Previous match"}),t.addLabel("find-case-sensitive",{en:"Match Case"}),t.addLabel("find-whole-word",{en:"Match Whole Word"}),t.addLabel("find-regex",{en:"Use Regular Expression"}),t.addLabel("replace",{en:"Replace"}),t.addLabel("replace-all",{en:"Replace All"}),t.addLabel("next",{en:"Next"}),t.addLabel("previous",{en:"Previous"}),t.addLabel("find-title-manuscript",{en:"Find in Article"}),t.addLabel("find-title-metadata",{en:"Find in Metadata"}),t.addLabel("no-result",{en:"No results"}),t.addLabel("find-replace-title-manuscript",{en:"Find and replace in article"}),t.addLabel("find-replace-title-metadata",{en:"Find and replace in metadata"}),t.addLabel("case-sensitive-title",{en:"Case Sensitive"}),t.addLabel("whole-word-title",{en:"Whole Word"}),t.addLabel("regex-title",{en:"Regex"}),t.addIcon("close",{fontawesome:"fa-close"})}};class Jg extends zf{render(t){const e=this.props.node;return t("span").text("???").attr("data-id",e.id).attr("data-type",e.type)}}class Kg extends Zp{constructor(t,e,r){super(t,e.getDocument().clone(),r),this.parentEditorSession=e}commitChanges(t={}){let e=this.getChanges();if(e.length>0){let r=lu(e.map(t=>t.ops)),n=this.parentEditorSession.getSelection(),s=t.selection||n,i=new Rd(r,{selection:n},{selection:s});this.parentEditorSession.applyChange(i)}}}class Wg extends od{constructor(...t){super(...t),this.__isStarted__=!1}start(){_n.getBrowserWindow().on("hashchange",this._onHashChange,this),this.__isStarted__=!0}readRoute(){return this.__isStarted__||this.start(),this.parseRoute(this.getRouteString())}writeRoute(t,e={}){let r=this.stringifyRoute(t);r?this._writeRoute(r,e):this.clearRoute(e)}dispose(){_n.getBrowserWindow().off(this)}parseRoute(t){return Wg.routeStringToObject(t)}stringifyRoute(t){return Wg.objectToRouteString(t)}getRouteString(){return _n.getBrowserWindow().getNativeElement().location.hash.slice(1)}_writeRoute(t,e){let r=_n.getBrowserWindow().getNativeElement();this.__isSaving__=!0;try{e.replace?r.history.replaceState({},"",`#${t}`):r.history.pushState({},"",`#${t}`)}finally{this.__isSaving__=!1}}clearRoute(t={}){this._writeRoute("",t)}_onHashChange(){if(!this.__isSaving__)if(this.__isLoading__)console.error("FIXME: router is currently applying a route.");else{this.__isLoading__=!0;try{let t=this.getRouteString(),e=this.parseRoute(t);this.emit("route:changed",e)}finally{this.__isLoading__=!1}}}static objectToRouteString(t){let e=[];return f(t,(t,r)=>{i(t)||e.push(`${r}=${t}`)}),e.join(",")}static routeStringToObject(t){let e={};if(!t)return e;let r=t.split(",");for(let t of r)if(t.indexOf("=")>=0){let r=t.split("=");if(2!==r.length)throw new Error("Illegal route.");e[r[0].trim()]=r[1].trim()}else e[t]=!0;return e}}t.cssSelect=qt,t.DomUtils=mt,t.domHelpers=wn,t.BrowserDOMElement=N,t.compareDOMElementPosition=function(t,e){if(t.el._isBrowserDOMElement){let r=t.getNativeElement().compareDocumentPosition(e.getNativeElement());return r&window.Node.DOCUMENT_POSITION_CONTAINS?En:r&window.Node.DOCUMENT_POSITION_CONTAINED_BY?Sn:r&window.Node.DOCUMENT_POSITION_PRECEDING?vn:r&window.Node.DOCUMENT_POSITION_FOLLOWING?bn:0}return console.error("FIXME: compareDOMElementPosition() is not implemented for MemoryDOMElement."),0},t.DefaultDOMElement=_n,t.DOMElement=w,t.DOMEventListener=_,t.MemoryDOMElement=en,t.nameWithoutNS=function(t){const e=t.indexOf(":");return e>0?t.slice(e+1):t},t.prettyPrintXML=function(t){let e;const r=[];let s=(e=n(t)?_n.parseXML(t):t).getChildNodes();if(e.isDocumentNode()){let t=e.empty().serialize();/<\?\s*xml/.exec(t)&&r.push(t)}return s.forEach(t=>{!function t(e,r,n){let s=new Array(2*n).fill(" ").join("");if(r.isElementNode()){const i=function(t){const e=t.childNodes;for(let t=0;t<e.length;t++){let r=e[t];if(r.isTextNode()&&!Cn(r))return!0}}(r),o=function(t){const e=t.childNodes;for(let t=0;t<e.length;t++){let r=e[t];if("cdata"===r.getNodeType())return!0}}(r);if(i||o)e.push(s+r.outerHTML);else{let i=r.children;const o=r.tagName;let a=[`<${o}`];r.getAttributes().forEach((t,e)=>{a.push(`${e}="${t}"`)}),i.length>0?(e.push(s+a.join(" ")+">"),r.children.forEach(r=>{t(e,r,n+1)}),e.push(s+`</${o}>`)):e.push(s+a.join(" ")+" />")}}else 0===n&&r.isTextNode()||e.push(s+r.outerHTML)}(r,t,0)}),r.join("\n")},t.sanitizeHTML=function(t,e={}){let r=Xr(t,{format:"html",xmlMode:!0,elementFactory:(t,e)=>new en(t,e)});return function(t){t.findAll("form").forEach(t=>{t.removeAttribute("id")})}(r),mt.getOuterHTML(r,{decodeEntities:!0,disallowedTags:xn,disallowHandlers:!0,disallowedAttributes:Nn,stripComments:!0,stripCDATA:!0})},t.documentHelpers=Du,t.operationHelpers=ru,t.selectionHelpers=mh,t.annotationHelpers=nu,t.AnnotationIndex=Bu,t.AnnotationMixin=Vu,t.ArrayOperation=Nh,t.ChangeRecorder=qd,t.Conflict=yh,t.Container=Xd,t.ContainerAnnotation=Yd,t.ContainerAnnotationIndex=Zd,t.ContainerMixin=Wd,t.ContainerSelection=Mn,t.Coordinate=On,t.CoordinateAdapter=class extends On{constructor(t,e,r){super("SKIP"),this._owner=t,this._pathProp=e,this._offsetProp=r,Object.freeze(this)}equals(t){return t===this||In(t.path,this.path)&&t.offset===this.offset}get path(){return this._owner[this._pathProp]}set path(t){this._owner[this._pathProp]=t}get offset(){return this._owner[this._offsetProp]}set offset(t){this._owner[this._offsetProp]=t}toJSON(){return{path:this.path,offset:this.offset}}toString(){return"("+this.path.join(".")+", "+this.offset+")"}},t.CoordinateOperation=Oh,t.copySelection=xd,t.createDocumentFactory=function(t,e){return{ArticleClass:t,createEmptyArticle:function(){return new t},createArticle:function(){const r=new t;return e(r),r},createChangeset:function(){const r=new t,n=new qd(r);return e(n),[n.generateChange().toJSON()]}}},t.CustomSelection=nh,t.Data=Qd,t.DefaultFileProxy=class extends tp{constructor(t,e){super(t,e),this.file=t.sourceFile,this.file&&(this._fileUrl=URL.createObjectURL(this.file)),this.url=t.url}getUrl(){return this.url?this.url:this._fileUrl?this._fileUrl:""}sync(){return this.url||(console.info("Simulating file upload. Creating blob url instead.",this._fileUrl),this.url=this._fileUrl),Promise.resolve()}},t.Document=class extends od{constructor(t,...e){if(super(),this.schema=t,!t)throw new Error("A document needs a schema for reflection.");this._ops=[],this._initialize(...e)}_initialize(){this.__id__=h(),this.nodeFactory=new np(this),this.data=new rp(this.schema,this.nodeFactory),this.addIndex("type",new ep("type")),this.addIndex("annotations",new Bu),this.addIndex("container-annotations",new Zd),ip.register(this)}dispose(){this.off(),this.data.off()}get id(){return this.__id__}getSchema(){return this.schema}contains(t){return this.data.contains(t)}get(t,e){return this.data.get(t,e)}resolve(t,e){let r=this.getProperty(t);if(!r){if(e)throw new Error("Invalid path");return}let n=this.get(t,e);return r.isReference()?r.isArray()?n.map(t=>this.get(t)):this.get(n):n}getNodes(){return this.data.getNodes()}getAnnotations(t){return this.getIndex("annotations").get(t)}getProperty(t){if(2!==t.length)throw new Error("path must have length=2");let[e,r]=t,n=this.get(e);if(n)return n.getSchema().getProperty(r);throw new Error("Invalid path.")}import(t){try{this.data._stopIndexing(),t(this),this.data._startIndexing()}finally{this.data.queue=[],this.data._startIndexing()}}create(t){if(t.id||(t.id=h(t.type)),!t.type)throw new Error("No node type provided");const e=this._create(t);if(e)return this._ops.push(e),this._emitInternalChange(e),this.get(t.id)}createDefaultTextNode(t,e){return this.create({type:this.getSchema().getDefaultTextType(),content:t||"",direction:e})}delete(t){const e=this.get(t),r=this._delete(t);return r&&(this._ops.push(r),this._emitInternalChange(r)),e}set(t,e){const r=this.get(t),n=this._set(t,e);return n&&(this._ops.push(n),this._emitInternalChange(n)),r}update(t,e){const r=this._update(t,e);return r&&(this._ops.push(r),this._emitInternalChange(r)),r}updateNode(t,e){let r=this.get(t);f(e,(n,s)=>{rh(r[s],e[s])||this.set([t,s],n)})}addIndex(t,e){return this.data.addIndex(t,e)}getIndex(t){return this.data.getIndex(t)}createSelection(t){let e;if(i(t))return Tn.nullSelection;if(1!==arguments.length||!eh(t))throw new Error("Illegal argument: call createSelection({ type: ... }");switch(t.type){case"property":{i(t.endOffset)&&(t.endOffset=t.startOffset),t.hasOwnProperty("reverse")||t.startOffset>t.endOffset&&([t.startOffset,t.endOffset]=[t.endOffset,t.startOffset],t.reverse=!t.reverse);let r=this.get(t.path,"strict");if(t.startOffset<0||t.startOffset>r.length)throw new Error("Invalid startOffset: target property has length "+r.length+", given startOffset is "+t.startOffset);if(t.endOffset<0||t.endOffset>r.length)throw new Error("Invalid startOffset: target property has length "+r.length+", given endOffset is "+t.endOffset);e=new An(t);break}case"container":{let r=t.containerPath;if(!this.get(r))throw new Error('Can not create ContainerSelection: container "'+r+'" does not exist.');let n=this._normalizeCoor({path:t.startPath,offset:t.startOffset,containerPath:r}),s=this._normalizeCoor({path:t.endPath,offset:t.endOffset,containerPath:r});t.hasOwnProperty("reverse")||Dn(this,r,n,s)>0&&([n,s]=[s,n],t.reverse=!0),e=new Mn(r,n.path,n.offset,s.path,s.offset,t.reverse,t.surfaceId);break}case"node":e=dh({doc:this,nodeId:t.nodeId,mode:t.mode,containerPath:t.containerPath,reverse:t.reverse,surfaceId:t.surfaceId});break;case"custom":e=nh.fromJSON(t);break;default:throw new Error("Illegal selection type",t)}return e.isNull()||e.attach(this),e}newInstance(){return new(0,this.constructor)(this.schema)}createSnippet(){var t=this.newInstance(),e=t.create({type:"@container",id:bu});return t.getContainer=function(){return e},t}rebase(t,e){return e.length>0&&Yh(e,t,{rebase:!0,immutableLeft:!0}),t}createFromDocument(t){this.clear();let e=Object.values(t.getNodes()),r={},n=new Set;return e.forEach(t=>{n.has(t)||this._computeDependencyLevel(t,r,n)}),e.sort((t,e)=>r[e.id]-r[t.id]),e.forEach(t=>this.create(t)),this}_computeDependencyLevel(t,e,r){if(!t)throw new Error("node was nil");if(r.has(t))throw new Error("Cyclic node dependency");r.add(t);let n=0;if(t.isAnnotation()||t.isInlineNode())n=-1;else{let s=t.getParent();if(s){let t;n=(t=e.hasOwnProperty(s.id)?e[s.id]:this._computeDependencyLevel(s,e,r))+1}}return e[t.id]=n,n}toJSON(){return op.exportDocument(this)}clone(){let t=this.newInstance();return t.createFromDocument(this),t}clear(){this.data.clear(),this._ops.length=0}createEditingInterface(){return new Ld(this)}invert(t){return t.invert()}_apply(t){let e=t.ops;for(let t of e)this._applyOp(t);t._extractInformation(this)}_applyOp(t){this.data.apply(t),this.emit("operation:applied",t)}_create(t){return this.data.create(t)}_delete(t){return this.data.delete(t)}_set(t,e){return this.data.set(t,e)}_update(t,e){return this.data.update(t,e)}_emitInternalChange(t){const e=new Rd([t],{},{});e._extractInformation(this),this.emit("document:changed:internal",e,this)}_notifyChangeListeners(t,e={}){this.emit("document:changed",t,e,this)}_createSelectionFromRange(t){return t?rh(t.start.path,t.end.path)?t.start.isNodeCoordinate()?new qn(t.containerPath,t.start.getNodeId(),"full",t.reverse,t.surfaceId):this.createSelection({type:"property",path:t.start.path,startOffset:t.start.offset,endOffset:t.end.offset,reverse:t.reverse,containerPath:t.containerPath,surfaceId:t.surfaceId}):this.createSelection({type:"container",startPath:t.start.path,startOffset:t.start.offset,endPath:t.end.path,endOffset:t.end.offset,reverse:t.reverse,containerPath:t.containerPath,surfaceId:t.surfaceId}):Tn.nullSelection}_normalizeCoor({path:t,offset:e,containerPath:r}){if(1===t.length){let n=sh(this,r,t[0]);if(n.isText())return new On(n.getPath(),0===e?0:n.getLength());if(n.isList()){if(0===e){let t=n.getItemAt(0);return new On(t.getPath(),0)}{let t=this.get(O(n.items));return new On(t.getPath(),t.getLength())}}}return new On(t,e)}get _isDocument(){return!0}},t.DocumentChange=Rd,t.DocumentIndex=ou,t.DocumentNode=Kd,t.DocumentNodeFactory=np,t.DocumentSchema=class extends lp{constructor(t){if(super(t),!t.DocumentClass)throw new Error("DocumentClass is mandatory");Object.assign(this,t)}getDocumentClass(){return this.DocumentClass}getDefaultTextType(){return this.defaultTextType}getBuiltIns(){return[Kd,cp,Xd,Yd]}},t.DOMExporter=hp,t.DOMImporter=_p,t.Editing=Dd,t.EditingInterface=Ld,t.FileNode=yp,t.FileProxy=tp,t.Fragmenter=Hu,t.getChangeFromDocument=function(t){return new qd(t).generateChange()},t.HTMLExporter=class extends hp{constructor(t,e={}){super(function(t,e){return(t=Object.assign({idAttribute:"data-id"},t,e)).elementFactory||(t.elementFactory=_n.createDocument("html")),t}(t,e),e)}exportDocument(t){let e=_n.parseHTML("<html><head></head><body></body></html>");return this.convertDocument(t,e)}getDefaultBlockConverter(){return bp}getDefaultPropertyAnnotationConverter(){return wp}},t.HTMLImporter=class extends _p{constructor(t,e,r){super(function(t,e){return Object.assign({idAttribute:"data-id"},t,e)}(t,r),e,r),this.IGNORE_DEFAULT_WARNINGS=!0,this._el=_n.parseHTML("<html></html>")}importDocument(t){this.reset();let e=_n.parseHTML(t);return this.convertDocument(e),this.state.doc}convertDocument(t){throw new Error("This method is abstract")}},t.importNodeIntoDocument=function(t,e){let r=Nd(e.getDocument(),t,e.id,{});return t.get(r)},t.IncrementalData=rp,t.InlineNode=class extends(Vu(Kd)){mustNotBeSplit(){return!0}static isInlineNode(){return!0}},t.JSONConverter=sp,t.ListMixin=function(t){return class extends t{createListItem(t){throw new Error(vp)}getItemsPath(){throw new Error(vp)}getListTypeString(){throw new Error(vp)}setListTypeString(t){throw new Error(vp)}getItems(){return xu(this.getDocument(),this.getItemsPath())}getItemAt(t){return this.getItems()[t]}getItemPosition(t){return this.getItems().indexOf(t)}getLength(){return this.getItems().length}getFirstItem(){return this.getItemAt(0)}getLastItem(){return this.getItemAt(this.getLength()-1)}appendItem(t){this.insertItemAt(this.getLength(),t)}removeItem(t){const e=this.getItemPosition(t);e>=0&&this.removeItemAt(e)}insertItemAt(t,e){Su(this.getDocument(),this.getItemsPath(),t,e.id)}removeItemAt(t){Cu(this.getDocument(),this.getItemsPath(),t)}isEmpty(){return 0===this.getLength()}get length(){return this.getLength()}getListType(t){let e=t-1;return this._getListTypes()[e]||"bullet"}setListType(t,e){let r=t-1,n=this._getListTypes();if(n.length<t)for(let t=0;t<r;t++)n[t]||(n[t]="bullet");n[r]=e,this._setListTypes(n)}_getListTypes(){let t=this.getListTypeString();return t?t.split(",").map(t=>t.trim()):[]}_setListTypes(t){p(t)&&(t=t.join(",")),this.getListTypeString()!==t&&this.setListTypeString(t)}static isList(){return!0}}},t.Marker=Sp,t.Node=Ud,t.NodeIndex=iu,t.NodeProperty=Bd,t.NodeRegistry=ap,t.NodeSelection=qn,t.ObjectOperation=Rh,t.OperationSerializer=kd,t.ParentNodeHook=ip,t.paste=Pd,t.PropertyAnnotation=cp,t.PropertyIndex=ep,t.PropertySelection=An,t.Range=Ep,t.Schema=lp,t.Selection=Tn,t.TextNode=Pp,t.TextNodeMixin=Tp,t.TextOperation=vh,t.XMLExporter=class extends hp{constructor(t,e={}){super(function(t,e){if(!(t=Object.assign({idAttribute:"id"},t,e)).elementFactory){let r={version:e.xmlVersion||"1.0",encoding:e.xmlEncoding||"UTF-8"};t.elementFactory=_n.createDocument("xml",r)}return t}(t,e),e)}getDefaultBlockConverter(){return Op}getDefaultPropertyAnnotationConverter(){return Ip}},t.XMLImporter=class extends _p{constructor(t,e,r={}){super(function(t,e){return Object.assign({idAttribute:"id"},t,e)}(t,r),e,r)}importDocument(t){this.reset();let e=_n.parseXML(t);return this.convertDocument(e),this.state.doc}convertDocument(t){let e=t.children[0];if(!e)throw new Error("XML Root node could not be found.");this.convertElement(e)}},t.STRING={type:"string",default:""},t.TEXT=Cp,t.PLAIN_TEXT=xp,t.STRING_ARRAY={type:["array","string"],default:[]},t.BOOLEAN={type:"boolean",default:!1},t.ENUM=function(t,e={}){let r={type:"enum",values:t};return Object.assign(r,e),r},t.MANY=function(...t){return{type:["array","id"],targetTypes:t=lu(t),default:[]}},t.ONE=function(...t){return{type:"id",targetTypes:t=lu(t),default:null}},t.CHILDREN=Np,t.CHILD=function(...t){return{type:"id",targetTypes:t=lu(t),owned:!0}},t.CONTAINER=function(t){let e,r;if(n(t)?(e=[t],r=t):({nodeTypes:e,defaultTextType:r}=t),!e)throw new Error("CONTAINER({ nodeTypes: [...] }) is mandatory.");if(!r)throw new Error("CONTAINER({ defaultTextType: [...] }) is mandatory.");let s=Np(...e);return s.defaultTextType=r,s._isContainer=!0,s},t.OPTIONAL=function(t){return t.optional=!0,t},t.AbstractAppState=Dp,t.AbstractEditorSession=Zp,t.AbstractIsolatedNodeComponent=Xf,t.AbstractScrollPane=class extends zf{getChildContext(){return{scrollPane:this}}didMount(){e.inBrowser&&(this.windowEl=_n.wrapNativeElement(window),this.windowEl.on("resize",this.onSelectionPositioned,this))}dispose(){this.windowEl&&this.windowEl.off(this)}getName(){return this.props.name}onSelectionPositioned(){let t=this._getContentRect(),e=this._getSelectionRect();if(!e)return;let r={contentRect:t,selectionRect:e};this._emitSelectionPositioned(r),this._scrollSelectionIntoView(e)}_emitSelectionPositioned(t){this.emit("selection:positioned",t),this.emit("dom-selection:rendered",t)}_onContextMenu(t){t.preventDefault();let e=this._getMouseBounds(t);this.emit("context-menu:opened",{mouseBounds:e})}_scrollSelectionIntoView(t){let e=this.getScrollPosition(),r=e+this.getHeight(),n=t.top,s=t.top+t.height;(n<e&&s<e||n>r&&s>r)&&this.setScrollPosition(n)}getHeight(){throw new Error("Abstract method")}getContentHeight(){throw new Error("Abstract method")}getContentElement(){throw new Error("Abstract method")}getScrollableElement(){throw new Error("Abstract method")}getScrollPosition(){throw new Error("Abstract method")}setScrollPosition(){throw new Error("Abstract method")}getPanelOffsetForElement(t){throw new Error("Abstract method")}scrollTo(t,e){throw new Error("Abstract method")}_getContentRect(){return this.getContentElement().getNativeElement().getBoundingClientRect()}_getSelectionRect(){return Cd(this._getContentRect())}_getMouseBounds(t){return pd(t,this.getContentElement().getNativeElement())}},t.AbstractGlobalEventHandler=Zf,t.AbstractKeyboardManager=tg,t.AnnotatedTextComponent=eg,t.AnnotationCommand=class extends rg{constructor(t){if(super(t),!this.config.nodeType)throw new Error("'nodeType' is required")}getAnnotationType(){return this.config.nodeType}getType(){return this.getAnnotationType()}getAnnotationData(){return{}}isDisabled(t,e){let r=e.selectionState;return!!(e.editorSession.isBlurred()||!t||t.isNull()||!t.isAttached()||t.isCustomSelection()||t.isNodeSelection()||t.isContainerSelection()||r.isInlineNodeSelection)}showInContext(t){return!t.isCollapsed()}canCreate(t,e,r){if(e.isCollapsed())return!1;if(0===t.length)return!0;for(let r of t)if(e.overlaps(r.getSelection(),"strict"))return!1;return!0}canFuse(t,e){return t.length>=2&&!e.isCollapsed()}canDelete(t,e){if(1!==t.length)return!1;let r=t[0].getSelection();return e.isInsideOf(r)}canExpand(t,e){if(1!==t.length)return!1;let r=t[0].getSelection();return e.overlaps(r,"strict")&&!e.isInsideOf(r)}canTruncate(t,e){if(1!==t.length)return!1;let r=t[0].getSelection();return(e.isLeftAlignedWith(r)||e.isRightAlignedWith(r))&&!e.contains(r)&&!e.isCollapsed()}getCommandState(t,e){const r=t.selection;if(this.isDisabled(r,t,e))return{disabled:!0};let n=this._getAnnotationsForSelection(t),s={disabled:!1,active:!1,mode:null};return this.canCreate(n,r,e)?s.mode="create":this.canFuse(n,r)?s.mode="fuse":this.canTruncate(n,r)?(s.active=!0,s.mode="truncate"):this.canExpand(n,r)?s.mode="expand":this.canDelete(n,r)?(s.active=!0,s.mode="delete"):s.disabled=!0,s.showInContext=this.showInContext(r,t,e),s}execute(t,e){let r=t.commandState;if(r.disabled)return!1;switch(r.mode){case"create":return this.executeCreate(t,e);case"fuse":return this.executeFuse(t,e);case"truncate":return this.executeTruncate(t,e);case"expand":return this.executeExpand(t,e);case"delete":return this.executeDelete(t,e);default:return console.warn("Command.execute(): unknown mode",r.mode),!1}}executeCreate(t,e){const r=t.editorSession,n=this._getAnnotationsForSelection(t,e);this._checkPrecondition(t,e,n,this.canCreate);let s,i=this.getAnnotationData();return i.type=this.getAnnotationType(),r.transaction(t=>{s=t.annotate(i)}),{mode:"create",anno:s}}executeFuse(t,e){let r=this._getAnnotationsForSelection(t);return this._checkPrecondition(t,e,r,this.canFuse),this._applyTransform(t,t=>{nu.fuseAnnotation(t,r)}),{mode:"fuse",anno:r[0]}}executeTruncate(t,e){let r=this._getAnnotationsForSelection(t),n=r[0];return this._checkPrecondition(t,e,r,this.canTruncate),this._applyTransform(t,e=>{nu.truncateAnnotation(e,n,t.selection)}),{mode:"truncate",anno:n}}executeExpand(t,e){let r=this._getAnnotationsForSelection(t),n=r[0];return this._checkPrecondition(t,e,r,this.canExpand),this._applyTransform(t,e=>{nu.expandAnnotation(e,n,t.selection)}),{mode:"expand",anno:n}}executeDelete(t,e){let r=this._getAnnotationsForSelection(t),n=r[0];return this._checkPrecondition(t,e,r,this.canDelete),this._applyTransform(t,t=>t.delete(n.id)),{mode:"delete",annoId:n.id}}isAnnotationCommand(){return!0}_checkPrecondition(t,e,r,n){let s=t.selection;if(!n.call(this,r,s,e))throw new Error("AnnotationCommand: can't execute command for selection "+s.toString())}_getAnnotationsForSelection(t){return t.selectionState.annosByType[this.getAnnotationType()]||[]}_applyTransform(t,e){const r=t.editorSession,n=t.selection;if(n.isNull())return;let s;return r.setSelection(n),r.transaction(function(r){let n=e(r,t);n&&(s=n.result)}),s}},t.AnnotationComponent=ng,t.AppState=qp,t.BasePackage=vg,t.Clipboard=ug,t.Command=rg,t.CommandManager=Eg,t.Component=zf,t.ComponentRegistry=class extends ud{constructor(t){super(t,function(t){if(!t.prototype._isComponent)throw new Error("Component registry: wrong type. Expected a ComponentClass. Was: "+String(t))})}},t.ContainerEditor=class extends mg{constructor(t,e,r){e.containerPath=e.containerPath||e.node.getContentPath(),e.name=e.name||e.containerPath.join(".")||e.node.id,super(t,e,r)}_initialize(){if(super._initialize(),this.containerPath=this.props.containerPath,!p(this.containerPath))throw new Error("Property 'containerPath' is mandatory.");this._deriveInternalState(this.props)}shouldRerender(t){return t.disabled!==this.props.disabled}willReceiveProps(t){super.willReceiveProps.apply(this,arguments),this._deriveInternalState(t)}didMount(){super.didMount();let t=this.context.editorSession.getEditorState();t.addObserver(["selection"],this._onSelectionChanged,this,{stage:"render"}),t.addObserver(["document"],this._onContainerChanged,this,{stage:"render",document:{path:this.containerPath}})}dispose(){super.dispose(),this.context.editorSession.getEditorState().removeObserver(this)}render(t){let e=super.render(t),r=this.getDocument(),n=this.getContainerPath();e.attr("data-id",n.join(".")),e.attr("spellcheck","native"===this.props.spellcheck);let s=r.get(n);return e.append(s.map((e,n)=>this._renderNode(t,r.get(e),n))),this.props.disabled||this.isEmpty()||(e.addClass("sm-enabled"),e.setAttribute("contenteditable",!0)),this.isEditable()?e.addClass("sm-editable"):(e.addClass("sm-readonly"),e.setAttribute("contenteditable",!1)),e}_getClassNames(){return"sc-container-editor sc-surface"}selectFirst(){let t=this.getDocument(),e=this.getContainerPath(),r=t.get();r.length>0&&hh(this.getEditorSession(),t.get(r[0]),e,"before")}_renderNode(t,e,r){if(!e)throw new Error("Illegal argument");return t(this._getNodeComponentClass(e),this._getNodeProps(e)).ref(e.id)}_getNodeComponentClass(t){let e=this.getComponent(t.type,"not-strict");return e?t.isText()||this.props.disabled?e:e.prototype._isCustomNodeComponent||e.prototype._isIsolatedNodeComponent?e:this.getComponent("isolated-node"):t.isText()?this.getComponent("text-node"):this.getComponent("unsupported-node")}_deriveInternalState(t){let e=this._state;!t.hasOwnProperty("enabled")||t.enabled?e.enabled=!0:e.enabled=!1}_selectNextIsolatedNode(t){let e=this.getEditorSession().getSelectionState(),r="left"===t?e.previousNode:e.nextNode,n=!r.isText()&&!r.isList();return!(!r||!n||!("left"===t&&e.isFirst||"right"===t&&e.isLast)||(this.getEditorSession().setSelection({type:"node",nodeId:r.id,containerPath:this.getContainerPath(),surfaceId:this.id}),0))}_softBreak(){let t=this.getEditorSession();t.getSelection().isPropertySelection()?t.transaction(t=>{t.insertText("\n")},{action:"soft-break"}):t.transaction(t=>{t.break()},{action:"break"})}_handleEnterKey(t){t.shiftKey?(t.preventDefault(),t.stopPropagation(),this._softBreak()):super._handleEnterKey(t)}_handleLeftOrRightArrowKey(t){t.stopPropagation();const e=this.getDocument(),r=this.getEditorSession().getSelection(),n=t.keyCode===gd.LEFT,s=!n,i=n?"left":"right";if(r&&!r.isNull()){let o=r.containerPath;if(r.isNodeSelection()){let i=e.get(o),a=ih(e,o,r.getNodeId());if(n&&0===a||s&&a===i.length-1)return void t.preventDefault()}r.isNodeSelection()&&!t.shiftKey&&this.domSelection.collapse(i)}this._delayed(()=>{this._updateModelSelection({direction:i})})}_handleUpOrDownArrowKey(t){t.stopPropagation();const e=this.getDocument(),r=this.getEditorSession().getSelection(),n=t.keyCode===gd.UP,s=!n,i=n?"left":"right";if(r&&!r.isNull()){let i=r.containerPath;if(r.isNodeSelection()){let o=e.get(i),a=ih(e,i,r.getNodeId());if(n&&0===a||s&&a===o.length-1)return void t.preventDefault();let l=this.getEditorSession();if(!t.shiftKey)return t.preventDefault(),n?void hh(l,e.get(o[a-1]),i,"after"):void hh(l,e.get(o[a+1]),i,"before")}}this._delayed(()=>{this._updateModelSelection({direction:i})})}_handleTabKey(t){const e=this.getEditorSession(),r=e.getSelection();if(r.isNodeSelection()&&r.isFull()){const n=this.refs[r.getNodeId()];if(n&&ph(e,n))return t.preventDefault(),void t.stopPropagation()}super._handleTabKey(t)}__handleTab(t){t.preventDefault(),t.shiftKey?this.getEditorSession().transaction(t=>{t.dedent()},{action:"dedent"}):this.getEditorSession().transaction(t=>{t.indent()},{action:"indent"})}isContainerEditor(){return!0}getContainerPath(){return this.containerPath}isEmpty(){let t=this.getDocument().get(this.containerPath);return!t||0===t.length}isEditable(){return super.isEditable.call(this)&&!this.isEmpty()}_onContainerChanged(t){let e=this.getDocument(),r=of.createContext(this).$$,n=this.getContainerPath();for(let s=0;s<t.ops.length;s++){let i=t.ops[s];if(In(i.path,n))if("update"===i.type){let t=i.diff;if("insert"===t.type){let n,s=t.getValue(),i=e.get(s);n=i?this._renderNode(r,i):r("div"),this.insertAt(t.getOffset(),n)}else"delete"===t.type&&this.removeAt(t.getOffset())}else this.empty(),this.rerender()}}get _isContainerEditor(){return!0}},t.Configurator=class{constructor(t,e){this.parent=t,this.name=e,this._subConfigurations=new Map,this._values=new Map,this._commands=new Map,this._commandGroups=new Map,this._components=new Map,this._converters=new Map,this._documentLoaders=new Map,this._documentSerializers=new Map,this._dropHandlers=[],this._exporters=new Map,this._icons=new Map,this._importers=new Map,this._keyboardShortcuts=[],this._keyboardShortcutsByCommandName=new Map,this._labels=new Map,this._nodes=new Map,this._toolPanels=new Map,this._services=new Map,this._valuesRegistry=new Ig(this,"_values"),this._commandRegistry=new Ig(this,"_commands"),this._componentRegistry=new Ig(this,"_components"),this._iconRegistry=new Ig(this,"_icons"),this._labelRegistry=new Ig(this,"_labels"),this._serviceRegistry=new Ig(this,"_services"),this._toolPanelRegistry=new Ig(this,"_toolPanels"),this._keyboardShortcutsByCommandNameRegistry=new Ig(this,"_keyboardShortcutsByCommandName"),this._commandGroupRegistry=new Ig(this,"_commandGroups"),this._compiledToolPanels=new Map}import(t,e){return t.configure(this,e||{}),this}createSubConfiguration(t,e={}){let r=new(e.ConfiguratorClass||this.constructor)(this,t);return this._subConfigurations.set(t,r),r}getConfiguration(t){n(t)&&(t=t.split("."));let e=this._subConfigurations.get(t[0]);return 1===t.length?e:e?e.getConfiguration(t.slice(1)):void 0}getValue(t){return this._valuesRegistry.get(t)}setValue(t,e){this._values.set(t,e)}addCommand(t,e,r={}){if(this._commands.has(t)&&!r.force)throw new Error(`Command with name '${t}' already registered`);this._commands.set(t,new e(Object.assign({name:t},r))),r.commandGroup&&this._addCommandToCommandGroup(t,r.commandGroup),r.accelerator&&this.addKeyboardShortcut(r.accelerator,{command:t})}addComponent(t,e,r={}){if(this._components.has(t)&&!r.force)throw new Error(`Component with name '${t}' already registered`);this._components.set(t,e)}addConverter(t,e){let r=this._converters.get(t);if(r||(r=new Map,this._converters.set(t,r)),d(e)&&(e=new e),!e.type)throw new Error("A converter needs an associated type.");r.set(e.type,e)}addDropHandler(t){this._dropHandlers.push(t)}addExporter(t,e,r={}){if(this._exporters.has(t))throw new Error(`Exporter already registered for '${t}'`);this._exporters.set(t,{ExporterClass:e,spec:r})}addIcon(t,e){this._icons.has(t)||this._icons.set(t,{});let r=this._icons.get(t);Object.assign(r,e)}addImporter(t,e,r={}){if(this._importers.has(t))throw new Error(`Importer already registered for '${t}'`);this._importers.set(t,{ImporterClass:e,spec:r})}addLabel(t,e,r={}){if(this._labels.has(t)&&!r.force)throw new Error(`Label with name '${t}' already registered.`);let s;s=n(e)?{en:e}:e,this._labels.set(t,s)}addNode(t,e={}){let r=t.type;if(this._nodes.has(r)&&!e.force)throw new Error(`Node class for type '${r}' already registered`);this._nodes.set(r,t)}addKeyboardShortcut(t,r){let n=t.toUpperCase(),s={key:t,label:n=e.isMac?(n=(n=(n=(n=(n=n.replace(/CommandOrControl/i,"⌘")).replace(/Ctrl/i,"^")).replace(/Shift/i,"⇧")).replace(/Enter/i,"↵")).replace(/Alt/i,"⌥")).replace(/\+/g,""):n.replace(/CommandOrControl/i,"Ctrl"),spec:r};this._keyboardShortcuts.push(s),r.command&&this._keyboardShortcutsByCommandName.set(r.command,s)}addTextTypeTool(t){this.addCommand(t.name,Pg,{spec:t.nodeSpec,commandGroup:"text-types"}),this.addIcon(t.name,{fontawesome:t.icon}),this.addLabel(t.name,t.label),t.accelerator&&this.addKeyboardShortcut(t.accelerator,{command:t.name})}addToolPanel(t,e,r={}){if(this._toolPanels.has(t)&&!r.force)throw new Error(`ToolPanel '${t}' is already defined`);this._toolPanels.set(t,e)}extendToolPanel(t,e){e(this._toolPanels.get(t))}addService(t,e,r={}){if(this._services.has(t)&&!r.force)throw new Error(`Service '${t}' is already defined`);this._services.set(t,{factory:e,instance:null})}getService(t,e){let r=this._serviceRegistry.get(t);if(r){if(r.instance)return Promise.resolve(r.instance);{let t=r.factory(e);return t instanceof Promise?t.then(t=>(r.instance=t,t)):(r.instance=t,Promise.resolve(t))}}return Promise.reject(new Error(`Unknown service: ${t}`))}registerDocumentLoader(t,e,r={},n={}){if(this._documentLoaders.has(t)&&!n.force)throw new Error(`Loader for docType '${t}' is already defined`);this._documentLoaders.set(t,{LoaderClass:e,spec:r})}registerDocumentSerializer(t,e,r={},n={}){if(this._documentSerializers.has(t)&&!n.force)throw new Error(`Serializer for docType '${t}' is already defined`);this._documentSerializers.set(t,{SerializerClass:e,spec:r})}getCommands(t={}){return t.inherit?this._commandRegistry.getAll():this._commands}getCommandGroup(t){let e=lu(this._commandGroupRegistry.getRecords(t)),r=new Set(e);return Array.from(r)}getComponent(t){return this.getComponentRegistry().get(t,"strict")}getComponentRegistry(){return this._componentRegistry}getConverters(t){return this._converters.has(t)?Array.from(this._converters.get(t).values()):[]}getDocumentLoader(t){if(this._documentLoaders.has(t)){let{LoaderClass:e,spec:r}=this._documentLoaders.get(t);return new e(r)}}getDocumentSerializer(t){if(this._documentSerializers.has(t)){let{SerializerClass:e,spec:r}=this._documentSerializers.get(t);return new e(r)}}getIconProvider(){return new Ag(this)}getLabelProvider(){return new Og(this)}createImporter(t,e,r={}){if(this._importers.has(t)){let{ImporterClass:n,spec:s}=this._importers.get(t),i=[];if(s.converterGroups)for(let t of s.converterGroups)i=i.concat(this.getConverters(t));else i=this.getConverters(t);return new n({converters:i},e,r,this)}if(this.parent)return this.parent.createImporter(t,e,r)}createExporter(t,e,r={}){if(this._exporters.has(t)){let{ExporterClass:n,spec:s}=this._exporters.get(t),i=[];if(s.converterGroups)for(let t of s.converterGroups)i=i.concat(this.getConverters(t));else i=this.getConverters(t);return new n({converters:i},e,r,this)}if(this.parent)return this.parent.createExporter(t,e,r)}getKeyboardShortcuts(t={}){return t.inherit?Array.from(this._keyboardShortcutsByCommandNameRegistry.getAll().values()):this._keyboardShortcuts}getKeyboardShortcutsByCommandName(t){return this._keyboardShortcutsByCommandNameRegistry.get(t)}getNodes(){return this._nodes}getToolPanel(t,e){let r=this._toolPanelRegistry.get(t);if(r){if(this._compiledToolPanels.has(t))return this._compiledToolPanels.get(t);let e=r.map(t=>this._compileToolPanelItem(t));return this._compiledToolPanels.set(t,e),e}if(e)throw new Error(`No toolpanel configured with name ${t}`)}_addCommandToCommandGroup(t,e){this._commandGroups.has(e)||this._commandGroups.set(e,[]),this._commandGroups.get(e).push(t)}_compileToolPanelItem(t){let e=Object.assign({},t),r=t.type;switch(r){case"command":if(!t.name)throw new Error("'name' is required for type 'command'");break;case"command-group":return this.getCommandGroup(t.name).map(t=>({type:"command",name:t}));case"prompt":case"group":case"dropdown":e.items=lu(t.items.map(t=>this._compileToolPanelItem(t)));break;case"custom":case"separator":case"spacer":break;default:throw new Error("Unsupported tool panel item type: "+r)}return e}},t.createComponentContext=Dg,t.createEditorContext=function(t,e){return Object.assign(Dg(t),{config:t,editorSession:e,editorState:e.getEditorState(),surfaceManager:e.surfaceManager,markersManager:e.markersManager,globalEventHandler:e.globalEventHandler,keyboardManager:e.keyboardManager,findAndReplaceManager:e.findAndReplaceManager})},t.CustomSurface=class extends zf{constructor(...t){super(...t),this._name=this._getCustomResourceId(),this._surfaceId=this._createSurfaceId()}getChildContext(){return{surface:this,parentSurfaceId:this.getId()}}didMount(){this._getSurfaceManager().registerSurface(this)}dispose(){this._getSurfaceManager().unregisterSurface(this)}rerenderDOMSelection(){}get name(){return this._name}getId(){return this._surfaceId}getSurfaceId(){return this.getId()}getContainer(){}getContainerId(){}isContainerEditor(){return!1}isCustomEditor(){return!0}isDisabled(){return Boolean(this.props.disabled)}selectFirst(){}_focus(){}_blur(){}_createSurfaceId(){let t=this.context.isolatedNodeComponent;return t?t.context.surface.id+"/"+t.props.node.id+"/"+this._name:this._name}_getCustomResourceId(){throw new Error("This method needs to be implemented by a CustomSurface")}_getSurfaceManager(){return this.context.surfaceManager}},t.DefaultLabelProvider=Ng,t.DocumentObserver=Up,t.DOMSelection=pg,t.DragAndDropHandler=class{match(t,e){return!1}drop(t,e){}get _isDragAndDropHandler(){return!0}},t.EditorSession=class extends(Ug(Zp)){constructor(t,e,r,n={}){super(t,e,n),this._setup(r)}_setup(t){super._setup(t),this.globalEventHandler=new Lg(this.editorState)}dispose(){super.dispose(),this.globalEventHandler.dispose()}},t.EditorState=Kp,t.FindAndReplaceCommand=Vg,t.FindAndReplaceDialog=Gg,t.FindAndReplaceManager=Fg,t.FindAndReplacePackage=$g,t.FontAwesomeIcon=Tg,t.FontAwesomeIconProvider=class{constructor(t){this.faMap={},this.textMap={},f(t,(t,e)=>{let r=t.fontawesome;r&&(n(r)&&(r={icon:r}),this.addFAIcon(e,r));let s=t.text;s&&this.addTextIcon(e,s)})}renderIcon(t,e){let r=this.faMap[e],n=this.textMap[e];return r?t(Tg,r):n||void 0}addFAIcon(t,e){this.faMap[t]=e}addTextIcon(t,e){this.textMap[t]=e}},t.GlobalEventHandler=Lg,t.HandlerParams=Qf,t.IndentListCommand=class extends rg{getCommandState(t){let e=t.editorSession,r=e.getDocument(),n=e.getSelection();if(n&&n.isPropertySelection()){let t=n.path,e=r.get(t[0]);if(e&&e.isListItem())return{disabled:!1}}return{disabled:!0}}execute(t){let e=t.commandState;const{disabled:r}=e;if(r)return;let n=t.editorSession;switch(this.config.spec.action){case"indent":n.transaction(t=>{t.indent()},{action:"indent"});break;case"dedent":n.transaction(t=>{t.dedent()},{action:"dedent"})}}},t.InsertInlineNodeCommand=class extends rg{getCommandState(t,e){let r=t.selection;return{disabled:this.isDisabled(t,e),active:!1,showInContext:this.showInContext(r,t,e)}}showInContext(t,e){return!t.isCollapsed()}isDisabled(t,e){const r=this.getEditorSession(t,e);let n=r.getSelection(),s=r.getSelectionState();return!n.isPropertySelection()||!!s.isInlineNodeSelection}isAnnotationCommand(){return!0}execute(t,e){let r=t.commandState,n=t.editorSession;r.disabled||n.transaction(r=>{let n=this.createNodeData(r,t,e);r.insertInlineNode(n)})}createNodeData(t,e,r){throw new Error("This method is abstract")}},t.InsertNodeCommand=class extends rg{constructor(t){super(t),this.config.nodeType||console.error("'config.nodeType' should be provided for InsertNodeCommand")}getType(){return this.config.nodeType}getCommandState(t,e){let r=t.selection,n={disabled:!0,active:!1};return r&&!r.isNull()&&!r.isCustomSelection()&&r.containerPath&&(n.disabled=!1),n.showInContext=this.showInContext(r,t,e),n}showInContext(t,e,r){let n=e.editorSession.getSelectionState();return t.isCollapsed()&&n.isFirst&&n.isLast}isInsertCommand(){return!0}execute(t,e){t.commandState.disabled||t.editorSession.transaction(r=>{let n=this.createNodeData(r,t,e),s=r.insertBlockNode(n);this.setSelection(r,s)})}createNodeData(t,e,r){const n=e.type;if(!n)throw new Error("'type' is mandatory");const s=e.editorSession.getDocument().getSchema().getNodeSchema(n);let i={type:n};for(let t of s)i[t.name]=e[t.name];return i}setSelection(t,e){e.isText()&&(t.selection={type:"property",path:e.getPath(),startOffset:0})}},t.IsolatedNodeComponent=og,t.IsolatedInlineNodeComponent=class extends Xf{render(t){const e=this.props.node,r=this.ContentClass,n=this.state;let s=t("span");s.addClass(this.getClassNames()).addClass("sc-inline-node").addClass("sm-"+e.type).attr("data-id",e.id).attr("data-inline","1");let i=this.isDisabled();return n.mode?s.addClass("sm-"+n.mode):s.addClass("sm-not-selected"),r.noStyle||s.addClass("sm-default-style"),s.on("keydown",this.onKeydown),s.append(this.renderContent(t,e).ref("content").addClass("se-content")),s.on("click",this.onClick),i&&s.addClass("sm-disabled").attr("contenteditable",!1),e.shouldBeDraggable&&s.attr("draggable",!0),s}isDisabled(){return!this.state.mode||["co-selected","cursor"].indexOf(this.state.mode)>-1}getClassNames(){return""}onClick(t){this._shouldConsumeEvent(t)&&(t.stopPropagation(),t.preventDefault(),this.selectNode())}selectNode(){const t=this.getEditorSession(),e=this.props.node;let r={type:"property",path:e.start.path,startOffset:e.start.offset,endOffset:e.end.offset};const n=this.getParentSurface();n&&Object.assign(r,{containerPath:n.getContainerPath(),surfaceId:n.id}),t.setSelection(r)}_getContentClass(){const t=this.props.node;let e;return(e=this.getComponent(t.type,!0))||(e=this.getComponent("unsupported-inline-node",!0)),e||(console.error(`No component registered for inline node '${t.type}'.`),e=Jg),e}_deriveStateFromSelectionState(t,e){const r=this._getSurfaceForSelection(t,e),n=this.getParentSurface();if(!r)return null;if(r===n){const e=this.props.node;if(t.isPropertySelection()&&!t.isCollapsed()&&rh(t.start.path,e.start.path)){const r=e.getSelection();if(r.equals(t))return{mode:"selected"};if(t.contains(r))return{mode:"co-selected"}}}let s=r.context.isolatedNodeComponent;return s?s===this?{mode:"focused"}:this._getIsolatedNodes(t,e).indexOf(this)>-1?{mode:"co-focused"}:null:null}get _isInlineNodeComponent(){return!0}},t.KeyboardManager=Bg,t.MarkersManager=Rg,t.ModalEditorSession=class extends(Ug(Kg)){constructor(t,e,r,n){super(t,e,n),this._setup(r,{inherit:!0})}},t.RedoCommand=class extends rg{getCommandState(t){return{disabled:!t.editorSession.canRedo(),active:!1}}execute(t){let e=t.editorSession;return!!e.canRedo()&&(e.redo(),!0)}},t.RenderingEngine=of,t.Router=Wg,t.SelectAllCommand=class extends rg{getCommandState(t){let e=t.editorSession,r=e.isBlurred(),n=e.getSelection();return{disabled:r||!n||n.isNull()}}execute(t,e){let r=e.editorSession,n=r.getDocument(),s=r.getEditorState().focusedSurface;if(s){let t=null,e=s.id;if(s._isContainerEditor){let r=s.getContainerPath(),i=n.get(r);if(0===i.length)return!1;t={type:"container",startPath:[i[0]],startOffset:0,endPath:[O(i)],endOffset:1,containerPath:r,surfaceId:e}}else if(s._isTextPropertyEditor){let r=s.getPath();t={type:"property",path:r,startOffset:0,endOffset:n.get(r).length,surfaceId:e}}return t&&r.setSelection(t),!0}return!1}},t.SelectionFragmentComponent=lg,t.SelectionStateReducer=jp,t.SimpleChangeHistory=Yp,t.StageSession=Kg,t.Surface=mg,t.SurfaceManager=Mg,t.SwitchTextTypeCommand=Pg,t.TextNodeComponent=yg,t.TextPropertyComponent=cg,t.TextPropertyEditor=_g,t.UndoCommand=class extends rg{getCommandState(t){return{disabled:!t.editorSession.canUndo(),active:!1}}execute(t){let e=t.editorSession;return e.canUndo()&&e.undo(),!0}},t.VirtualElement=Qp,t.findParentComponent=function(t){for(;t;){const e=zf.unwrap(t);if(e)return e;t=t.parentNode}},t.async=zu,t.tableHelpers=Yu,t.ArrayIterator=g,t.ArrayTree=class{add(t,e){let r=this._getKey(t);this[r]||(this[r]=[]),this[r].push(e)}remove(t,e){let r=this._getKey(t);this[r]&&ku(this[r],e)}get(t){return this[this._getKey(t)]||[]}_getKey(t){return n?t:Zu(t)}},t.array2table=Qu,t.camelCase=Ks,t.capitalize=Es,t.clone=Ma,t.cloneDeep=th,t.createCountingIdGenerator=td,t.debounce=Wa,t.deleteFromArray=ku,t.deterministicId=c,t.diff=function(t,e,r){if(!n(t)||!n(e))throw new Error("Illegal arguments.");r=r||0;let s=[];(t||e)&&(!t&&e?s.push({type:"insert",start:r,text:e}):t&&!e?s.push({type:"delete",start:r,end:r+t.length}):s=function(t,e,r,n){let s,i=e.length,o=t.length,a=[];for(;i>0&&o>0;)l();return c(),a;function l(){let t=r[i][o],n=i-1,a=o-1;r[n][a]<t?(s&&"replace"===s.type?(s.start--,s.text.unshift(e.charAt(n))):(c(),s={type:"replace",start:a,end:o,text:[e.charAt(n)]}),i--,o--):r[n][o]<t?(s&&"insert"===s.type?(s.start--,s.text.unshift(e.charAt(n))):(c(),s={type:"insert",start:a,text:[e.charAt(n)]}),i--):r[i][a]<t?(s&&"delete"===s.type?s.start--:(c(),s={type:"delete",start:a,end:o}),o--):(c(),i--,o--)}function c(){if(s){switch(s.type){case"insert":s.start+=n,s.text=s.text.join("");break;case"delete":s.start+=n,s.end+=n;break;case"replace":s.start+=n,s.end+=n,s.text=s.text.join("");break;default:throw new Error("Invalid state")}a.push(s),s=null}}}(t,e,ed(t,e),r));return s},t.encodeXMLEntities=rd,t.EventEmitter=od,t.extend=cd,t.Factory=class extends ud{create(t){var e=this.get(t);if(!e)throw new Error("No class registered by that name: "+t);var r=Array.prototype.slice.call(arguments,1),n=Object.create(e.prototype);return e.apply(n,r),n}},t.filter=au,t.find=hc,t.findIndex=m,t.flatten=lu,t.flattenOften=cu,t.forEach=f,t.getKeyForPath=Zu,t.getRangeFromMatrix=function(t,e,r,n,s,i){if(!i){if(e===n&&r===s){let e=t[r];return e?e[s]:void 0}if(e===n){let n=t[e];return n?n.slice(r,s+1):[]}if(r===s){let s=[];for(let i=e;i<=n;i++){let e=t[i];e&&s.push(e[r])}return s}}let o=[];for(var a=e;a<n+1;a++){let e=t[a];e&&o.push(e.slice(r,s+1))}return o},t.getRelativeBoundingRect=function(t,e){let r;var n,s,i,o,a;r=e._isDOMElement?e.getNativeElement():e,p(t)||(t=[t]);let l=dd(t.map(t=>{let e;return e=t._isDOMElement?t.getNativeElement():t,t=e,s=r.getBoundingClientRect(),i=dd(t.getClientRects()),o=i.left-s.left,a=i.top-s.top,{left:o,top:a,right:s.width-o-i.width,bottom:s.height-a-i.height,width:i.width,height:i.height}})),c=r.getBoundingClientRect();return{left:l.left,top:l.top,right:c.width-l.left-l.width,bottom:c.height-l.top-l.height,width:l.width,height:l.height}},t.getRelativeMouseBounds=pd,t.inBrowser=A,t.includes=function(t,e){return!!t&&t.indexOf(e)>=0},t.isArray=p,t.isArrayEqual=In,t.isBoolean=fd,t.isEqual=rh,t.isFunction=d,t.isMatch=uc,t.isNil=i,t.isNumber=s,t.isObject=u,t.isPlainObject=eh,t.isString=n,t.keys=gd,t.last=O,t.levenshtein=ed,t.makeMap=Qu,t.map=Lu,t.merge=function(t,e,r){var n=null;return"replace"===(r=r||{}).array?n=_d:"concat"===r.array&&(n=md),n?Mc(t,e,n):kc(t,e)},t.parseKeyCombo=yd,t.parseKeyEvent=wd,t.PathObject=_h,t.percentage=function(t){return String(Math.floor(100*t*100)/100)+" %"},t.pick=Uc,t.platform=e,t.pluck=function(t,e){return Lu(t,function(t){return t[e]})},t.printStacktrace=function(){try{throw new Error}catch(t){console.error(t.stack)}},t.request=function(t,e,r,n){var s=new XMLHttpRequest;s.open(t,e,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.onload=function(){if(!(s.status>=200&&s.status<400))return n(new Error("Request failed. Returned status: "+s.status));var t=s.responseText;(function(t){try{JSON.parse(t)}catch(t){return!1}return!0})(t)&&(t=JSON.parse(t)),n(null,t)},r?s.send(JSON.stringify(r)):s.send()},t.renderListNode=function(t,e){let r=t.getItems(),n=[e(s(1))];for(let t=0;t<r.length;t++){const i=r[t],o=i.getLevel();if(o<n.length)for(let t=n.length;t>o;t--)n.pop();else if(o>n.length)for(let t=n.length;t<o;t++){let r,i=n[t-1],o=i.getChildCount();0===o?(r=e("li"),i.append(r)):r=i.getChildAt(o-1);let a=e(s(t+1));r.append(a),n.push(a)}console.assert(o===n.length,"item.level should now be the same as stack.length"),O(n).append(e(i))}for(let t=n.length;t>1;t--)n.pop();return n[0];function s(e){return"order"===t.getListType(e)?"ol":"ul"}},t.sendRequest=function(t,e){return new Promise(function(r,n){var s=(t.method||"GET").toUpperCase(),i=t.url;if(["GET","POST","PUT","DELETE"].indexOf(s)<0)throw new Error("Parameter 'method' must be 'GET', 'POST', 'PUT', or 'DELETE'.");if(!i)throw new Error("Parameter 'url' is required.");var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState)return function(){if(200===o.status){var t=o.responseText;e&&e(null,t),r(t)}else{console.error(o.statusText);let t=new Error(o.statusText);e&&e(t),n(t)}}()},o.open(s,i,!0),t.header&&f(t.header,function(t,e){o.setRequestHeader(e,t)}),t.data instanceof FormData?o.send(t.data):t.data?o.send(JSON.stringify(t.data)):o.send()})},t.startsWith=bd,t.SubstanceError=vd,t.substanceGlobals=a,t.times=function(t,e,r){for(let n=0;n<t;n++)e.call(r)},t.toUnixLineEndings=function(t){return t.replace(/\r?\n/g,"\n")},t.TreeIndex=Ru,t.uniq=function(t){return t&&t.length?function(t,e,r){var n=-1,s=zc,i=t.length,o=!0,a=[],l=a;if(r)o=!1,s=Gc;else if(i>=Jc){var c=e?null:$c(t);if(c)return bl(c);o=!1,s=gl,l=new pl}else l=e?[]:a;t:for(;++n<i;){var h=t[n],u=e?e(h):h;if(h=r||0!==h?h:0,o&&u==u){for(var d=l.length;d--;)if(l[d]===u)continue t;e&&l.push(u),a.push(h)}else s(l,u,r)||(l!==a&&l.push(u),a.push(h))}return a}(t):[]},t.uuid=h,t.without=Xc,t.orderBy=function(t,e,r,n){return null==t?[]:(Vn(e)||(e=null==e?[]:[e]),Vn(r=n?void 0:r)||(r=null==r?[]:[r]),Qc(t,e,r))},t.getDOMRangeFromEvent=Sd,t.getRelativeRect=Ed,t.getSelectionRect=Cd,t.isMouseInsideDOMSelection=function(t){let e=window.getSelection();if(0===e.rangeCount)return!1;let r=e.getRangeAt(0).getBoundingClientRect();return t.clientX>=r.left&&t.clientX<=r.right&&t.clientY>=r.top&&t.clientY<=r.bottom},t.getQueryStringParam=function(t,e){if("undefined"==typeof window)return null;let r=e||window.location.href,n=new RegExp("[?&]"+t+"=([^&#]*)","i").exec(r);return n?decodeURIComponent(n[1]):null},t.setDOMSelection=function(t,e,r,n){let s=window.getSelection(),i=window.document.createRange();t._isDOMElement&&(t=t.getNativeElement()),r||(r=t,n=e),r._isDOMElement&&(r=r.getNativeElement()),i.setStart(t,e),i.setEnd(r,n),s.removeAllRanges(),s.addRange(i)},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=./substance.min.js.map